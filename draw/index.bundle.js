"use strict";var jsdraw=(()=>{var Tn=class s{onDrop(o){}static union(o,e){return new class extends s{apply(r){o.apply(r),e.apply(r)}unapply(r){e.unapply(r),o.unapply(r)}description(r,n){let i=o.description(r,n),a=e.description(r,n);return i===a?i:`${i}, ${a}`}}}static{this.empty=new class extends s{description(o,e){return""}apply(o){}unapply(o){}}}},Ne=Tn;var Sn=class{constructor(o,e,r){this.x=o;this.y=e;this.z=r}get xy(){return{x:this.x,y:this.y}}at(o){if(o===0)return this.x;if(o===1)return this.y;if(o===2)return this.z;throw new Error(`${o} out of bounds!`)}length(){return this.magnitude()}magnitude(){return Math.sqrt(this.magnitudeSquared())}magnitudeSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}squareDistanceTo(o){let e=this.x-o.x,r=this.y-o.y,n=this.z-o.z;return e*e+r*r+n*n}distanceTo(o){return Math.sqrt(this.squareDistanceTo(o))}maximumEntryMagnitude(){return Math.max(Math.abs(this.x),Math.max(Math.abs(this.y),Math.abs(this.z)))}angle(){return Math.atan2(this.y,this.x)}normalized(){let o=this.magnitude();return N.of(this.x/o,this.y/o,this.z/o)}normalizedOrZero(){return this.eq(N.zero)?N.zero:this.normalized()}times(o){return N.of(this.x*o,this.y*o,this.z*o)}plus(o){return N.of(this.x+o.x,this.y+o.y,this.z+o.z)}minus(o){return N.of(this.x-o.x,this.y-o.y,this.z-o.z)}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z}cross(o){return N.of(this.y*o.z-o.y*this.z,o.x*this.z-this.x*o.z,this.x*o.y-o.x*this.y)}scale(o){return typeof o=="number"?this.times(o):N.of(this.x*o.x,this.y*o.y,this.z*o.z)}orthog(){return this.dot(N.unitX)===0&&this.dot(N.unitY)===0?this.dot(N.unitX)===0?N.unitX:this.cross(N.unitX).normalized():this.cross(N.unitZ.times(-1)).normalized()}extend(o,e){return this.plus(e.normalized().times(o))}lerp(o,e){return this.times(1-e).plus(o.times(e))}zip(o,e){return N.of(e(o.x,this.x),e(o.y,this.y),e(o.z,this.z))}map(o){return N.of(o(this.x,0),o(this.y,1),o(this.z,2))}asArray(){return[this.x,this.y,this.z]}eq(o,e=1e-10){return Math.abs(o.x-this.x)<=e&&Math.abs(o.y-this.y)<=e&&Math.abs(o.z-this.z)<=e}toString(){return`Vec(${this.x}, ${this.y}, ${this.z})`}},Cn=class{constructor(o,e){this.x=o;this.y=e}get z(){return 0}get xy(){return{x:this.x,y:this.y}}at(o){if(o===0)return this.x;if(o===1)return this.y;if(o===2)return 0;throw new Error(`${o} out of bounds!`)}length(){return this.magnitude()}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}magnitudeSquared(){return this.x*this.x+this.y*this.y}squareDistanceTo(o){let e=this.x-o.x,r=this.y-o.y;return e*e+r*r+o.z*o.z}distanceTo(o){return Math.sqrt(this.squareDistanceTo(o))}maximumEntryMagnitude(){return Math.max(Math.abs(this.x),Math.abs(this.y))}angle(){return Math.atan2(this.y,this.x)}normalized(){let o=this.magnitude();return T.of(this.x/o,this.y/o)}normalizedOrZero(){return this.eq(N.zero)?N.zero:this.normalized()}times(o){return T.of(this.x*o,this.y*o)}plus(o){return N.of(this.x+o.x,this.y+o.y,o.z)}minus(o){return N.of(this.x-o.x,this.y-o.y,-o.z)}dot(o){return this.x*o.x+this.y*o.y}cross(o){return N.of(this.y*o.z,-this.x*o.z,this.x*o.y-o.x*this.y)}scale(o){return typeof o=="number"?this.times(o):T.of(this.x*o.x,this.y*o.y)}orthog(){return this.dot(N.unitX)===0&&this.dot(N.unitY)===0?this.dot(N.unitX)===0?N.unitX:this.cross(N.unitX).normalized():this.cross(N.unitZ.times(-1)).normalized()}extend(o,e){return this.plus(e.normalized().times(o))}lerp(o,e){return this.times(1-e).plus(o.times(e))}zip(o,e){return N.of(e(o.x,this.x),e(o.y,this.y),e(o.z,0))}map(o){return N.of(o(this.x,0),o(this.y,1),o(0,2))}asArray(){return[this.x,this.y,0]}eq(o,e=1e-10){return Math.abs(o.x-this.x)<=e&&Math.abs(o.y-this.y)<=e&&Math.abs(o.z)<=e}toString(){return`Vec(${this.x}, ${this.y})`}},T;(i=>(i.of=(a,l)=>new Cn(a,l),i.ofXY=({x:a,y:l})=>i.of(a,l),i.unitX=i.of(1,0),i.unitY=i.of(0,1),i.zero=i.of(0,0)))(T||={});var N;(i=>(i.of=(a,l,c)=>c===0?T.of(a,l):new Sn(a,l,c),i.unitX=T.unitX,i.unitY=T.unitY,i.zero=T.zero,i.unitZ=i.of(0,0,1)))(N||={});var ke=N;var k=class s{constructor(o,e,r,n,i,a,l,c,d){this.a1=o;this.a2=e;this.a3=r;this.b1=n;this.b2=i;this.b3=a;this.c1=l;this.c2=c;this.c3=d;this.cachedInverse=void 0;this.rows=[ke.of(o,e,r),ke.of(n,i,a),ke.of(l,c,d)]}static ofRows(o,e,r){return new s(o.x,o.y,o.z,e.x,e.y,e.z,r.x,r.y,r.z)}static{this.identity=new s(1,0,0,0,1,0,0,0,1)}inverse(){return this.computeInverse()??s.identity}invertable(){return this.computeInverse()!==null}computeInverse(){if(this.cachedInverse!==void 0)return this.cachedInverse;let o=[this.rows[0],this.rows[1],this.rows[2]],e=[ke.unitX,ke.unitY,ke.unitZ];for(let n=0;n<3;n++){let i=o[n].at(n),a=1e-10;if(Math.abs(i)<a){let p=-1;for(let f=1;f<=2;f++){let b=(n+f)%3;if(Math.abs(o[b].at(n))>=a){p=b;break}}if(p===-1)return this.cachedInverse=null,null;let u=o[n],h=e[n];o[n]=o[p],e[n]=e[p],o[p]=u,e[p]=h,i=o[n].at(n)}let l=1/i;o[n]=o[n].times(l),e[n]=e[n].times(l);let c=o[n],d=e[n];for(let p=1;p<=2;p++){let u=(n+p)%3;l=-o[u].at(n),o[u]=o[u].plus(c.times(l)),e[u]=e[u].plus(d.times(l))}}let r=s.ofRows(e[0],e[1],e[2]);return this.cachedInverse=r,r}transposed(){return new s(this.a1,this.b1,this.c1,this.a2,this.b2,this.c2,this.a3,this.b3,this.c3)}rightMul(o){o=o.transposed();let e=(r,n)=>this.rows[r].dot(o.rows[n]);return new s(e(0,0),e(0,1),e(0,2),e(1,0),e(1,1),e(1,2),e(2,0),e(2,1),e(2,2))}transformVec2(o){let e=ke.of(o.x,o.y,1);return e=this.transformVec3(e),T.of(e.x,e.y)}transformVec3(o){return ke.of(this.rows[0].dot(o),this.rows[1].dot(o),this.rows[2].dot(o))}isIdentity(){return this===s.identity?!0:this.eq(s.identity)}eq(o,e=0){for(let r=0;r<3;r++)if(!this.rows[r].eq(o.rows[r],e))return!1;return!0}toString(){let o="",e=[0,0,0];for(let r of this.rows)for(let n=0;n<3;n++)e[n]=Math.max(e[0],`${r.at(n)}`.length);for(let r=0;r<3;r++){r===0?o+="\u23A1 ":r===1?o+="\u23A2 ":o+="\u23A3 ";for(let n=0;n<3;n++){let i=this.rows[r].at(n).toString(),a="";for(let l=i.length;l<e[n];l++)a+=" ";o+=i+", "+a}r===0?o+=" \u23A4":r===1?o+=" \u23A5":o+=" \u23A6",o+=`
`}return o.trimEnd()}toArray(){return[this.a1,this.a2,this.a3,this.b1,this.b2,this.b3,this.c1,this.c2,this.c3]}mapEntries(o){return new s(o(this.a1,[0,0]),o(this.a2,[0,1]),o(this.a3,[0,2]),o(this.b1,[1,0]),o(this.b2,[1,1]),o(this.b3,[1,2]),o(this.c1,[2,0]),o(this.c2,[2,1]),o(this.c3,[2,2]))}getScaleFactor(){return Math.hypot(this.a1,this.a2)}getColumn(o){return ke.of(this.rows[0].at(o),this.rows[1].at(o),this.rows[2].at(o))}maximumEntryMagnitude(){let o=Math.abs(this.a1);for(let e of this.toArray())o=Math.max(o,Math.abs(e));return o}static translation(o){return new s(1,0,o.x,0,1,o.y,0,0,1)}static zRotation(o,e=T.zero){if(o===0)return s.identity;let r=Math.cos(o),n=Math.sin(o),i=s.translation(e);return i=i.rightMul(new s(r,-n,0,n,r,0,0,0,1)),i.rightMul(s.translation(e.times(-1)))}static scaling2D(o,e=T.zero){let r=s.translation(e),n,i;return typeof o=="number"?(n=o,i=o):(n=o.x,i=o.y),r=r.rightMul(new s(n,0,0,0,i,0,0,0,1)),r.rightMul(s.translation(e.times(-1)))}toCSSMatrix(){return`matrix(${this.a1},${this.b1},${this.a2},${this.b2},${this.a3},${this.b3})`}static fromCSSMatrix(o){if(o===""||o==="none")return s.identity;o=o.trim().replace(/\s+/g," ");let e=l=>l.split(/[, \t\n]+/g).map(d=>{if(d.trim()==="")return null;let p=!1;if(d.endsWith("%")&&(p=!0,d=d.substring(0,d.length-1)),d=d.replace(/px$/gi,""),!/^[-]?\d*(?:\.\d*)?(?:[eE][-+]?\d+)?$/i.exec(d))throw new Error(`All arguments to transform functions must be numeric (state: ${JSON.stringify({currentArgument:d,allArguments:l})})`);let h=parseFloat(d);return p&&(h/=100),h}).filter(d=>d!==null),r={matrix:l=>{if(l.length!==6)throw new Error(`Invalid matrix argument: ${l}. Must have length 6`);let c=l[0],d=l[1],p=l[2],u=l[3],h=l[4],f=l[5];return new s(c,p,h,d,u,f,0,0,1)},scale:l=>{let c,d;if(l.length===1)c=l[0],d=l[0];else if(l.length===2)c=l[0],d=l[1];else throw new Error(`The scale() function only supports two arguments. Given: ${l}`);return s.scaling2D(T.of(c,d))},translate:l=>{let c=0,d=0;if(l.length===1)c=l[0];else if(l.length===2)c=l[0],d=l[1];else throw new Error(`The translate() function requires either 1 or 2 arguments. Given ${l}`);return s.translation(T.of(c,d))}},n=/(?:^|\W)(\w+)\s?\(([^)]*)\)/gi,i,a=null;for(;(i=n.exec(o))!==null;){let l=i[1].toLowerCase();if(!(l in r))throw new Error(`Unsupported CSS transform action: ${l}`);let c=e(i[2]),d=r[l](c);a?a=a.rightMul(d):a=d}return a??s.identity}},ts=k;var mr=class s{static{this.smallValue=1e-12}distance(o){return Math.abs(this.signedDistance(o))}containsPoint(o,e=s.smallValue){return this.signedDistance(o)<e}getLooseBoundingBox(){return this.getTightBoundingBox()}},fr=mr;var R=class s extends fr{constructor(e,r,n,i){super();this.x=e;this.y=r;this.w=n;this.h=i;n<0&&(this.x+=n,this.w=Math.abs(n)),i<0&&(this.y+=i,this.h=Math.abs(i)),this.topLeft=T.of(this.x,this.y),this.size=T.of(this.w,this.h),this.area=this.w*this.h}translatedBy(e){return new s(e.x+this.x,e.y+this.y,this.w,this.h)}resizedTo(e){return new s(this.x,this.y,e.x,e.y)}containsPoint(e){return this.x<=e.x&&this.y<=e.y&&this.x+this.w>=e.x&&this.y+this.h>=e.y}containsRect(e){return this.x<=e.x&&this.y<=e.y&&this.x+this.w>=e.x+e.w&&this.y+this.h>=e.y+e.h}intersects(e){let r=this.x,n=r+this.w,i=e.x,a=e.x+e.w;if(n<i||r>a)return!1;let l=this.y,c=l+this.h,d=e.y,p=e.y+e.h;return!(c<d||l>p)}intersection(e){if(!this.intersects(e))return null;let r=this.topLeft.zip(e.topLeft,Math.max),n=this.bottomRight.zip(e.bottomRight,Math.min);return s.fromCorners(r,n)}union(e){return s.union(this,e)}divideIntoGrid(e,r){let n=[];if(e<=0||r<=0)return n;let i=this.w/e,a=this.h/r;i===0&&(e=1),a===0&&(r=1);for(let l=0;l<r;l++)for(let c=0;c<e;c++){let d=i*c+this.x,p=a*l+this.y;n.push(new s(d,p,i,a))}return n}grownToPoint(e,r=0){let n=new s(e.x-r,e.y-r,r*2,r*2);return this.union(n)}grownBy(e){if(e===0)return this;if(e<0){let r=-Math.min(-e,this.w/2),n=-Math.min(-e,this.h/2);return new s(this.x-r,this.y-n,this.w+r*2,this.h+n*2)}return new s(this.x-e,this.y-e,this.w+e*2,this.h+e*2)}grownToSize(e){if(this.width>=e.x&&this.height>=e.y)return this;let r=Math.max(0,e.x-this.width),n=Math.max(0,e.y-this.height);return new s(this.x-r/2,this.y-n/2,this.width+r,this.height+n)}getClosestPointOnBoundaryTo(e){let r=this.getEdges().map(a=>a.closestPointTo(e)),n=null,i=null;for(let a of r){let l=a.distanceTo(e);(i===null||l<i)&&(n=a,i=l)}return n}isWithinRadiusOf(e,r){if(this.maxDimension>e)return!1;let n=e*e;return this.corners.every(i=>i.minus(r).magnitudeSquared()<n)}get corners(){return[this.bottomRight,this.topRight,this.topLeft,this.bottomLeft]}get maxDimension(){return Math.max(this.w,this.h)}get minDimension(){return Math.min(this.w,this.h)}get bottomRight(){return this.topLeft.plus(this.size)}get topRight(){return this.bottomRight.plus(T.of(0,-this.h))}get bottomLeft(){return this.topLeft.plus(T.of(0,this.h))}get width(){return this.w}get height(){return this.h}get center(){return T.of(this.x+this.w/2,this.y+this.h/2)}getEdges(){let e=this.corners;return[new ze(e[0],e[1]),new ze(e[1],e[2]),new ze(e[2],e[3]),new ze(e[3],e[0])]}intersectsLineSegment(e){let r=[];for(let n of this.getEdges())n.intersectsLineSegment(e).forEach(a=>r.push(a));return r}signedDistance(e){let r=this.getClosestPointOnBoundaryTo(e),n=e.minus(r).magnitude();return this.containsPoint(e)?-n:n}getTightBoundingBox(){return this}transformedBoundingBox(e){return e===ts.identity?this:s.bboxOf(this.corners.map(r=>e.transformVec2(r)))}eq(e,r=0){return this.topLeft.eq(e.topLeft,r)&&this.size.eq(e.size,r)}toString(){return`Rect(point(${this.x}, ${this.y}), size(${this.w}, ${this.h}))`}static fromCorners(e,r){return new s(Math.min(e.x,r.x),Math.min(e.y,r.y),Math.abs(e.x-r.x),Math.abs(e.y-r.y))}static bboxOf(e,r=0){let n=0,i=0,a=0,l=0,c=!0;for(let d of e)c&&(n=d.x,i=d.y,a=d.x,l=d.y,c=!1),n=Math.min(n,d.x),i=Math.min(i,d.y),a=Math.max(a,d.x),l=Math.max(l,d.y);return s.fromCorners(T.of(n-r,i-r),T.of(a+r,l+r))}static union(...e){if(e.length===0)return s.empty;let r=e[0],n=r.x,i=r.y,a=r.x+r.w,l=r.y+r.h;for(let c=1;c<e.length;c++){let d=e[c];n=Math.min(n,d.x),i=Math.min(i,d.y),a=Math.max(a,d.x+d.w),l=Math.max(l,d.y+d.h)}return new s(n,i,a-n,l-i)}static of(e){let r=e.width??e.w??0,n=e.height??e.h??0;return new s(e.x,e.y,r,n)}static{this.empty=new s(0,0,0,0)}static{this.unitSquare=new s(0,0,1,1)}},fe=R;var gr=class extends fr{intersectsLineSegment(o){return this.argIntersectsLineSegment(o).map(e=>this.at(e))}},$t=gr;var ge=class s extends $t{constructor(e,r){super();this.point1=e;this.point2=r;this.bbox=fe.bboxOf([e,r]),this.direction=r.minus(e),this.length=this.direction.magnitude(),this.length>0&&(this.direction=this.direction.times(1/this.length))}static ofSmallestContainingPoints(e){if(e.length<=1)return null;let r=[...e].sort((i,a)=>i.x!==a.x?i.x-a.x:i.y-a.y),n=new s(r[0],r[r.length-1]);for(let i of r)if(!n.containsPoint(i))return null;return n}get p1(){return this.point1}get p2(){return this.point2}get center(){return this.point1.lerp(this.point2,.5)}get(e){return this.point1.plus(this.direction.times(e))}at(e){return this.get(e*this.length)}normalAt(e){return this.direction.orthog()}tangentAt(e){return this.direction}splitAt(e){return e<=0||e>=1?[this]:[new s(this.point1,this.at(e)),new s(this.at(e),this.point2)]}intersection(e){let r,n;if(Math.abs(this.direction.x)<4e-13){if(e.direction.x===0||this.direction.y===0)return null;let p=this.point1.x,u=(this.point1.x-e.point1.x)*e.direction.y/e.direction.x+e.point1.y;r=T.of(p,u),n=(u-this.point1.y)/this.direction.y}else{let p=(this.point1.y-e.point1.y)*this.direction.x*e.direction.x+this.direction.x*e.direction.y*e.point1.x-this.direction.y*e.direction.x*this.point1.x,u=e.direction.y*this.direction.x-this.direction.y*e.direction.x;if(u===0)return null;let h=p/u,f=(h-this.point1.x)/this.direction.x,b=this.point1.y+this.direction.y*f;r=T.of(h,b),n=(h-this.point1.x)/this.direction.x}let a=r.distanceTo(this.point1),l=r.distanceTo(this.point2),c=r.distanceTo(e.point1),d=r.distanceTo(e.point2);return a>this.length||l>this.length||c>e.length||d>e.length?null:{point:r,t:n}}intersects(e){return this.intersection(e)!==null}argIntersectsLineSegment(e){let r=this.intersection(e);return r?[r.t/this.length]:[]}intersectsLineSegment(e){let r=this.intersection(e);return r?[r.point]:[]}closestPointTo(e){return this.nearestPointTo(e).point}nearestPointTo(e){let r=e.minus(this.p1).dot(this.direction),n=this.length-r,i=this.p1.plus(this.direction.times(r));return r>0&&r<this.length?{point:i,parameterValue:r/this.length}:Math.abs(n)<Math.abs(r)?{point:this.p2,parameterValue:1}:{point:this.p1,parameterValue:0}}signedDistance(e){return this.closestPointTo(e).minus(e).magnitude()}transformedBy(e){return new s(e.transformVec2(this.p1),e.transformVec2(this.p2))}getTightBoundingBox(){return this.bbox}toString(){return`LineSegment(${this.p1.toString()}, ${this.p2.toString()})`}eq(e,r){if(!(e instanceof s))return!1;let n=r?.tolerance,i=r?.ignoreDirection??!0;return e.p1.eq(this.p1,n)&&e.p2.eq(this.p2,n)||i&&e.p1.eq(this.p2,n)&&e.p2.eq(this.p1,n)}},ze=ge;var{abs:Co,cos:Je,sin:Wt,acos:El,atan2:Eo,sqrt:lt,pow:Me}=Math;function Po(s){return s<0?-Me(-s,1/3):Me(s,1/3)}var os=Math.PI,br=2*os,ct=os/2,Pl=1e-6,En=Number.MAX_SAFE_INTEGER||9007199254740991,Pn=Number.MIN_SAFE_INTEGER||-9007199254740991,kl={x:0,y:0,z:0},z={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(s,o){let e=o(s),r=e.x*e.x+e.y*e.y;return typeof e.z<"u"&&(r+=e.z*e.z),lt(r)},compute:function(s,o,e){if(s===0)return o[0].t=0,o[0];let r=o.length-1;if(s===1)return o[r].t=1,o[r];let n=1-s,i=o;if(r===0)return o[0].t=s,o[0];if(r===1){let l={x:n*i[0].x+s*i[1].x,y:n*i[0].y+s*i[1].y,t:s};return e&&(l.z=n*i[0].z+s*i[1].z),l}if(r<4){let l=n*n,c=s*s,d,p,u,h=0;r===2?(i=[i[0],i[1],i[2],kl],d=l,p=n*s*2,u=c):r===3&&(d=l*n,p=l*s*3,u=n*c*3,h=s*c);let f={x:d*i[0].x+p*i[1].x+u*i[2].x+h*i[3].x,y:d*i[0].y+p*i[1].y+u*i[2].y+h*i[3].y,t:s};return e&&(f.z=d*i[0].z+p*i[1].z+u*i[2].z+h*i[3].z),f}let a=JSON.parse(JSON.stringify(o));for(;a.length>1;){for(let l=0;l<a.length-1;l++)a[l]={x:a[l].x+(a[l+1].x-a[l].x)*s,y:a[l].y+(a[l+1].y-a[l].y)*s},typeof a[l].z<"u"&&(a[l]=a[l].z+(a[l+1].z-a[l].z)*s);a.splice(a.length-1,1)}return a[0].t=s,a[0]},computeWithRatios:function(s,o,e,r){let n=1-s,i=e,a=o,l=i[0],c=i[1],d=i[2],p=i[3],u;if(l*=n,c*=s,a.length===2)return u=l+c,{x:(l*a[0].x+c*a[1].x)/u,y:(l*a[0].y+c*a[1].y)/u,z:r?(l*a[0].z+c*a[1].z)/u:!1,t:s};if(l*=n,c*=2*n,d*=s*s,a.length===3)return u=l+c+d,{x:(l*a[0].x+c*a[1].x+d*a[2].x)/u,y:(l*a[0].y+c*a[1].y+d*a[2].y)/u,z:r?(l*a[0].z+c*a[1].z+d*a[2].z)/u:!1,t:s};if(l*=n,c*=1.5*n,d*=3*n,p*=s*s*s,a.length===4)return u=l+c+d+p,{x:(l*a[0].x+c*a[1].x+d*a[2].x+p*a[3].x)/u,y:(l*a[0].y+c*a[1].y+d*a[2].y+p*a[3].y)/u,z:r?(l*a[0].z+c*a[1].z+d*a[2].z+p*a[3].z)/u:!1,t:s}},derive:function(s,o){let e=[];for(let r=s,n=r.length,i=n-1;n>1;n--,i--){let a=[];for(let l=0,c;l<i;l++)c={x:i*(r[l+1].x-r[l].x),y:i*(r[l+1].y-r[l].y)},o&&(c.z=i*(r[l+1].z-r[l].z)),a.push(c);e.push(a),r=a}return e},between:function(s,o,e){return o<=s&&s<=e||z.approximately(s,o)||z.approximately(s,e)},approximately:function(s,o,e){return Co(s-o)<=(e||Pl)},length:function(s){let e=z.Tvalues.length,r=0;for(let n=0,i;n<e;n++)i=.5*z.Tvalues[n]+.5,r+=z.Cvalues[n]*z.arcfn(i,s);return .5*r},map:function(s,o,e,r,n){let i=e-o,a=n-r,l=s-o,c=l/i;return r+a*c},lerp:function(s,o,e){let r={x:o.x+s*(e.x-o.x),y:o.y+s*(e.y-o.y)};return o.z!==void 0&&e.z!==void 0&&(r.z=o.z+s*(e.z-o.z)),r},pointToString:function(s){let o=s.x+"/"+s.y;return typeof s.z<"u"&&(o+="/"+s.z),o},pointsToString:function(s){return"["+s.map(z.pointToString).join(", ")+"]"},copy:function(s){return JSON.parse(JSON.stringify(s))},angle:function(s,o,e){let r=o.x-s.x,n=o.y-s.y,i=e.x-s.x,a=e.y-s.y,l=r*a-n*i,c=r*i+n*a;return Eo(l,c)},round:function(s,o){let e=""+s,r=e.indexOf(".");return parseFloat(e.substring(0,r+1+o))},dist:function(s,o){let e=s.x-o.x,r=s.y-o.y;return lt(e*e+r*r)},closest:function(s,o){let e=Me(2,63),r,n;return s.forEach(function(i,a){n=z.dist(o,i),n<e&&(e=n,r=a)}),{mdist:e,mpos:r}},abcratio:function(s,o){if(o!==2&&o!==3)return!1;if(typeof s>"u")s=.5;else if(s===0||s===1)return s;let e=Me(s,o)+Me(1-s,o),r=e-1;return Co(r/e)},projectionratio:function(s,o){if(o!==2&&o!==3)return!1;if(typeof s>"u")s=.5;else if(s===0||s===1)return s;let e=Me(1-s,o),r=Me(s,o)+e;return e/r},lli8:function(s,o,e,r,n,i,a,l){let c=(s*r-o*e)*(n-a)-(s-e)*(n*l-i*a),d=(s*r-o*e)*(i-l)-(o-r)*(n*l-i*a),p=(s-e)*(i-l)-(o-r)*(n-a);return p==0?!1:{x:c/p,y:d/p}},lli4:function(s,o,e,r){let n=s.x,i=s.y,a=o.x,l=o.y,c=e.x,d=e.y,p=r.x,u=r.y;return z.lli8(n,i,a,l,c,d,p,u)},lli:function(s,o){return z.lli4(s,s.c,o,o.c)},makeline:function(s,o){return new Ut(s.x,s.y,(s.x+o.x)/2,(s.y+o.y)/2,o.x,o.y)},findbbox:function(s){let o=En,e=En,r=Pn,n=Pn;return s.forEach(function(i){let a=i.bbox();o>a.x.min&&(o=a.x.min),e>a.y.min&&(e=a.y.min),r<a.x.max&&(r=a.x.max),n<a.y.max&&(n=a.y.max)}),{x:{min:o,mid:(o+r)/2,max:r,size:r-o},y:{min:e,mid:(e+n)/2,max:n,size:n-e}}},shapeintersections:function(s,o,e,r,n){if(!z.bboxoverlap(o,r))return[];let i=[],a=[s.startcap,s.forward,s.back,s.endcap],l=[e.startcap,e.forward,e.back,e.endcap];return a.forEach(function(c){c.virtual||l.forEach(function(d){if(d.virtual)return;let p=c.intersects(d,n);p.length>0&&(p.c1=c,p.c2=d,p.s1=s,p.s2=e,i.push(p))})}),i},makeshape:function(s,o,e){let r=o.points.length,n=s.points.length,i=z.makeline(o.points[r-1],s.points[0]),a=z.makeline(s.points[n-1],o.points[0]),l={startcap:i,forward:s,back:o,endcap:a,bbox:z.findbbox([i,s,o,a])};return l.intersections=function(c){return z.shapeintersections(l,l.bbox,c,c.bbox,e)},l},getminmax:function(s,o,e){if(!e)return{min:0,max:0};let r=En,n=Pn,i,a;e.indexOf(0)===-1&&(e=[0].concat(e)),e.indexOf(1)===-1&&e.push(1);for(let l=0,c=e.length;l<c;l++)i=e[l],a=s.get(i),a[o]<r&&(r=a[o]),a[o]>n&&(n=a[o]);return{min:r,mid:(r+n)/2,max:n,size:n-r}},align:function(s,o){let e=o.p1.x,r=o.p1.y,n=-Eo(o.p2.y-r,o.p2.x-e),i=function(a){return{x:(a.x-e)*Je(n)-(a.y-r)*Wt(n),y:(a.x-e)*Wt(n)+(a.y-r)*Je(n)}};return s.map(i)},roots:function(s,o){o=o||{p1:{x:0,y:0},p2:{x:1,y:0}};let e=s.length-1,r=z.align(s,o),n=function(S){return 0<=S&&S<=1};if(e===2){let S=r[0].y,B=r[1].y,V=r[2].y,F=S-2*B+V;if(F!==0){let U=-lt(B*B-S*V),j=-S+B,Z=-(U+j)/F,se=-(-U+j)/F;return[Z,se].filter(n)}else if(B!==V&&F===0)return[(2*B-V)/(2*B-2*V)].filter(n);return[]}let i=r[0].y,a=r[1].y,l=r[2].y,c=r[3].y,d=-i+3*a-3*l+c,p=3*i-6*a+3*l,u=-3*i+3*a,h=i;if(z.approximately(d,0)){if(z.approximately(p,0))return z.approximately(u,0)?[]:[-h/u].filter(n);let S=lt(u*u-4*p*h),B=2*p;return[(S-u)/B,(-u-S)/B].filter(n)}p/=d,u/=d,h/=d;let f=(3*u-p*p)/3,b=f/3,v=(2*p*p*p-9*p*u+27*h)/27,g=v/2,y=g*g+b*b*b,m,w,C,E,P;if(y<0){let S=-f/3,B=S*S*S,V=lt(B),F=-v/(2*V),U=F<-1?-1:F>1?1:F,j=El(U),Z=Po(V),se=2*Z;return C=se*Je(j/3)-p/3,E=se*Je((j+br)/3)-p/3,P=se*Je((j+2*br)/3)-p/3,[C,E,P].filter(n)}else{if(y===0)return m=g<0?Po(-g):-Po(g),C=2*m-p/3,E=-m-p/3,[C,E].filter(n);{let S=lt(y);return m=Po(-g+S),w=Po(g+S),[m-w-p/3].filter(n)}}},droots:function(s){if(s.length===3){let o=s[0],e=s[1],r=s[2],n=o-2*e+r;if(n!==0){let i=-lt(e*e-o*r),a=-o+e,l=-(i+a)/n,c=-(-i+a)/n;return[l,c]}else if(e!==r&&n===0)return[(2*e-r)/(2*(e-r))];return[]}if(s.length===2){let o=s[0],e=s[1];return o!==e?[o/(o-e)]:[]}return[]},curvature:function(s,o,e,r,n){let i,a,l,c,d=0,p=0,u=z.compute(s,o),h=z.compute(s,e),f=u.x*u.x+u.y*u.y;if(r?(i=lt(Me(u.y*h.z-h.y*u.z,2)+Me(u.z*h.x-h.z*u.x,2)+Me(u.x*h.y-h.x*u.y,2)),a=Me(f+u.z*u.z,3/2)):(i=u.x*h.y-u.y*h.x,a=Me(f,3/2)),i===0||a===0)return{k:0,r:0};if(d=i/a,p=a/i,!n){let b=z.curvature(s-.001,o,e,r,!0).k,v=z.curvature(s+.001,o,e,r,!0).k;c=(v-d+(d-b))/2,l=(Co(v-d)+Co(d-b))/2}return{k:d,r:p,dk:c,adk:l}},inflections:function(s){if(s.length<4)return[];let o=z.align(s,{p1:s[0],p2:s.slice(-1)[0]}),e=o[2].x*o[1].y,r=o[3].x*o[1].y,n=o[1].x*o[2].y,i=o[3].x*o[2].y,a=18*(-3*e+2*r+3*n-i),l=18*(3*e-r-3*n),c=18*(n-e);if(z.approximately(a,0)){if(!z.approximately(l,0)){let h=-c/l;if(0<=h&&h<=1)return[h]}return[]}let d=2*a;if(z.approximately(d,0))return[];let p=l*l-4*a*c;if(p<0)return[];let u=Math.sqrt(p);return[(u-l)/d,-(l+u)/d].filter(function(h){return 0<=h&&h<=1})},bboxoverlap:function(s,o){let e=["x","y"],r=e.length;for(let n=0,i,a,l,c;n<r;n++)if(i=e[n],a=s[i].mid,l=o[i].mid,c=(s[i].size+o[i].size)/2,Co(a-l)>=c)return!1;return!0},expandbox:function(s,o){o.x.min<s.x.min&&(s.x.min=o.x.min),o.y.min<s.y.min&&(s.y.min=o.y.min),o.z&&o.z.min<s.z.min&&(s.z.min=o.z.min),o.x.max>s.x.max&&(s.x.max=o.x.max),o.y.max>s.y.max&&(s.y.max=o.y.max),o.z&&o.z.max>s.z.max&&(s.z.max=o.z.max),s.x.mid=(s.x.min+s.x.max)/2,s.y.mid=(s.y.min+s.y.max)/2,s.z&&(s.z.mid=(s.z.min+s.z.max)/2),s.x.size=s.x.max-s.x.min,s.y.size=s.y.max-s.y.min,s.z&&(s.z.size=s.z.max-s.z.min)},pairiteration:function(s,o,e){let r=s.bbox(),n=o.bbox(),i=1e5,a=e||.5;if(r.x.size+r.y.size<a&&n.x.size+n.y.size<a)return[(i*(s._t1+s._t2)/2|0)/i+"/"+(i*(o._t1+o._t2)/2|0)/i];let l=s.split(.5),c=o.split(.5),d=[{left:l.left,right:c.left},{left:l.left,right:c.right},{left:l.right,right:c.right},{left:l.right,right:c.left}];d=d.filter(function(u){return z.bboxoverlap(u.left.bbox(),u.right.bbox())});let p=[];return d.length===0||(d.forEach(function(u){p=p.concat(z.pairiteration(u.left,u.right,a))}),p=p.filter(function(u,h){return p.indexOf(u)===h})),p},getccenter:function(s,o,e){let r=o.x-s.x,n=o.y-s.y,i=e.x-o.x,a=e.y-o.y,l=r*Je(ct)-n*Wt(ct),c=r*Wt(ct)+n*Je(ct),d=i*Je(ct)-a*Wt(ct),p=i*Wt(ct)+a*Je(ct),u=(s.x+o.x)/2,h=(s.y+o.y)/2,f=(o.x+e.x)/2,b=(o.y+e.y)/2,v=u+l,g=h+c,y=f+d,m=b+p,w=z.lli8(u,h,v,g,f,b,y,m),C=z.dist(w,s),E=Eo(s.y-w.y,s.x-w.x),P=Eo(o.y-w.y,o.x-w.x),S=Eo(e.y-w.y,e.x-w.x),B;return E<S?((E>P||P>S)&&(E+=br),E>S&&(B=S,S=E,E=B)):S<P&&P<E?(B=S,S=E,E=B):S+=br,w.s=E,w.e=S,w.r=C,w},numberSort:function(s,o){return s-o}};var qt=class s{constructor(o){this.curves=[],this._3d=!1,o&&(this.curves=o,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(o){return z.pointsToString(o.points)}).join(", ")+"]"}addCurve(o){this.curves.push(o),this._3d=this._3d||o._3d}length(){return this.curves.map(function(o){return o.length()}).reduce(function(o,e){return o+e})}curve(o){return this.curves[o]}bbox(){let o=this.curves;for(var e=o[0].bbox(),r=1;r<o.length;r++)z.expandbox(e,o[r].bbox());return e}offset(o){let e=[];return this.curves.forEach(function(r){e.push(...r.offset(o))}),new s(e)}};var{abs:ko,min:rs,max:ns,cos:Ll,sin:Il,acos:Rl,sqrt:Lo}=Math,zl=Math.PI;var Ut=class s{constructor(o){let e=o&&o.forEach?o:Array.from(arguments).slice(),r=!1;if(typeof e[0]=="object"){r=e.length;let f=[];e.forEach(function(b){["x","y","z"].forEach(function(v){typeof b[v]<"u"&&f.push(b[v])})}),e=f}let n=!1,i=e.length;if(r){if(r>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");n=!0}}else if(i!==6&&i!==8&&i!==9&&i!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");let a=this._3d=!n&&(i===9||i===12)||o&&o[0]&&typeof o[0].z<"u",l=this.points=[];for(let f=0,b=a?3:2;f<i;f+=b){var c={x:e[f],y:e[f+1]};a&&(c.z=e[f+2]),l.push(c)}let d=this.order=l.length-1,p=this.dims=["x","y"];a&&p.push("z"),this.dimlen=p.length;let u=z.align(l,{p1:l[0],p2:l[d]}),h=z.dist(l[0],l[d]);this._linear=u.reduce((f,b)=>f+ko(b.y),0)<h/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(o,e,r,n){if(typeof n>"u"&&(n=.5),n===0)return new s(e,e,r);if(n===1)return new s(o,e,e);let i=s.getABC(2,o,e,r,n);return new s(o,i.A,r)}static cubicFromPoints(o,e,r,n,i){typeof n>"u"&&(n=.5);let a=s.getABC(3,o,e,r,n);typeof i>"u"&&(i=z.dist(e,a.C));let l=i*(1-n)/n,c=z.dist(o,r),d=(r.x-o.x)/c,p=(r.y-o.y)/c,u=i*d,h=i*p,f=l*d,b=l*p,v={x:e.x-u,y:e.y-h},g={x:e.x+f,y:e.y+b},y=a.A,m={x:y.x+(v.x-y.x)/(1-n),y:y.y+(v.y-y.y)/(1-n)},w={x:y.x+(g.x-y.x)/n,y:y.y+(g.y-y.y)/n},C={x:o.x+(m.x-o.x)/n,y:o.y+(m.y-o.y)/n},E={x:r.x+(w.x-r.x)/(1-n),y:r.y+(w.y-r.y)/(1-n)};return new s(o,C,E,r)}static getUtils(){return z}getUtils(){return s.getUtils()}static get PolyBezier(){return qt}valueOf(){return this.toString()}toString(){return z.pointsToString(this.points)}toSVG(){if(this._3d)return!1;let o=this.points,e=o[0].x,r=o[0].y,n=["M",e,r,this.order===2?"Q":"C"];for(let i=1,a=o.length;i<a;i++)n.push(o[i].x),n.push(o[i].y);return n.join(" ")}setRatios(o){if(o.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=o,this._lut=[]}verify(){let o=this.coordDigest();o!==this._print&&(this._print=o,this.update())}coordDigest(){return this.points.map(function(o,e){return""+e+o.x+o.y+(o.z?o.z:0)}).join("")}update(){this._lut=[],this.dpoints=z.derive(this.points,this._3d),this.computedirection()}computedirection(){let o=this.points,e=z.angle(o[0],o[this.order],o[1]);this.clockwise=e>0}length(){return z.length(this.derivative.bind(this))}static getABC(o=2,e,r,n,i=.5){let a=z.projectionratio(i,o),l=1-a,c={x:a*e.x+l*n.x,y:a*e.y+l*n.y},d=z.abcratio(i,o);return{A:{x:r.x+(r.x-c.x)/d,y:r.y+(r.y-c.y)/d},B:r,C:c,S:e,E:n}}getABC(o,e){e=e||this.get(o);let r=this.points[0],n=this.points[this.order];return s.getABC(this.order,r,e,n,o)}getLUT(o){if(this.verify(),o=o||100,this._lut.length===o+1)return this._lut;this._lut=[],o++,this._lut=[];for(let e=0,r,n;e<o;e++)n=e/(o-1),r=this.compute(n),r.t=n,this._lut.push(r);return this._lut}on(o,e){e=e||5;let r=this.getLUT(),n=[];for(let i=0,a,l=0;i<r.length;i++)a=r[i],z.dist(a,o)<e&&(n.push(a),l+=i/r.length);return n.length?t/=n.length:!1}project(o){let e=this.getLUT(),r=e.length-1,n=z.closest(e,o),i=n.mpos,a=(i-1)/r,l=(i+1)/r,c=.1/r,d=n.mdist,p=a,u=p,h;d+=1;for(let f;p<l+c;p+=c)h=this.compute(p),f=z.dist(o,h),f<d&&(d=f,u=p);return u=u<0?0:u>1?1:u,h=this.compute(u),h.t=u,h.d=d,h}get(o){return this.compute(o)}point(o){return this.points[o]}compute(o){return this.ratios?z.computeWithRatios(o,this.points,this.ratios,this._3d):z.compute(o,this.points,this._3d,this.ratios)}raise(){let o=this.points,e=[o[0]],r=o.length;for(let n=1,i,a;n<r;n++)i=o[n],a=o[n-1],e[n]={x:(r-n)/r*i.x+n/r*a.x,y:(r-n)/r*i.y+n/r*a.y};return e[r]=o[r-1],new s(e)}derivative(o){return z.compute(o,this.dpoints[0],this._3d)}dderivative(o){return z.compute(o,this.dpoints[1],this._3d)}align(){let o=this.points;return new s(z.align(o,{p1:o[0],p2:o[o.length-1]}))}curvature(o){return z.curvature(o,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return z.inflections(this.points)}normal(o){return this._3d?this.__normal3(o):this.__normal2(o)}__normal2(o){let e=this.derivative(o),r=Lo(e.x*e.x+e.y*e.y);return{t:o,x:-e.y/r,y:e.x/r}}__normal3(o){let e=this.derivative(o),r=this.derivative(o+.01),n=Lo(e.x*e.x+e.y*e.y+e.z*e.z),i=Lo(r.x*r.x+r.y*r.y+r.z*r.z);e.x/=n,e.y/=n,e.z/=n,r.x/=i,r.y/=i,r.z/=i;let a={x:r.y*e.z-r.z*e.y,y:r.z*e.x-r.x*e.z,z:r.x*e.y-r.y*e.x},l=Lo(a.x*a.x+a.y*a.y+a.z*a.z);a.x/=l,a.y/=l,a.z/=l;let c=[a.x*a.x,a.x*a.y-a.z,a.x*a.z+a.y,a.x*a.y+a.z,a.y*a.y,a.y*a.z-a.x,a.x*a.z-a.y,a.y*a.z+a.x,a.z*a.z];return{t:o,x:c[0]*e.x+c[1]*e.y+c[2]*e.z,y:c[3]*e.x+c[4]*e.y+c[5]*e.z,z:c[6]*e.x+c[7]*e.y+c[8]*e.z}}hull(o){let e=this.points,r=[],n=[],i=0;for(n[i++]=e[0],n[i++]=e[1],n[i++]=e[2],this.order===3&&(n[i++]=e[3]);e.length>1;){r=[];for(let a=0,l,c=e.length-1;a<c;a++)l=z.lerp(o,e[a],e[a+1]),n[i++]=l,r.push(l);e=r}return n}split(o,e){if(o===0&&e)return this.split(e).left;if(e===1)return this.split(o).right;let r=this.hull(o),n={left:this.order===2?new s([r[0],r[3],r[5]]):new s([r[0],r[4],r[7],r[9]]),right:this.order===2?new s([r[5],r[4],r[2]]):new s([r[9],r[8],r[6],r[3]]),span:r};return n.left._t1=z.map(0,0,1,this._t1,this._t2),n.left._t2=z.map(o,0,1,this._t1,this._t2),n.right._t1=z.map(o,0,1,this._t1,this._t2),n.right._t2=z.map(1,0,1,this._t1,this._t2),e?(e=z.map(e,o,1,0,1),n.right.split(e).left):n}extrema(){let o={},e=[];return this.dims.forEach(function(r){let n=function(a){return a[r]},i=this.dpoints[0].map(n);o[r]=z.droots(i),this.order===3&&(i=this.dpoints[1].map(n),o[r]=o[r].concat(z.droots(i))),o[r]=o[r].filter(function(a){return a>=0&&a<=1}),e=e.concat(o[r].sort(z.numberSort))}.bind(this)),o.values=e.sort(z.numberSort).filter(function(r,n){return e.indexOf(r)===n}),o}bbox(){let o=this.extrema(),e={};return this.dims.forEach(function(r){e[r]=z.getminmax(this,r,o[r])}.bind(this)),e}overlaps(o){let e=this.bbox(),r=o.bbox();return z.bboxoverlap(e,r)}offset(o,e){if(typeof e<"u"){let r=this.get(o),n=this.normal(o),i={c:r,n,x:r.x+n.x*e,y:r.y+n.y*e};return this._3d&&(i.z=r.z+n.z*e),i}if(this._linear){let r=this.normal(0),n=this.points.map(function(i){let a={x:i.x+o*r.x,y:i.y+o*r.y};return i.z&&r.z&&(a.z=i.z+o*r.z),a});return[new s(n)]}return this.reduce().map(function(r){return r._linear?r.offset(o)[0]:r.scale(o)})}simple(){if(this.order===3){let n=z.angle(this.points[0],this.points[3],this.points[1]),i=z.angle(this.points[0],this.points[3],this.points[2]);if(n>0&&i<0||n<0&&i>0)return!1}let o=this.normal(0),e=this.normal(1),r=o.x*e.x+o.y*e.y;return this._3d&&(r+=o.z*e.z),ko(Rl(r))<zl/3}reduce(){let o,e=0,r=0,n=.01,i,a=[],l=[],c=this.extrema().values;for(c.indexOf(0)===-1&&(c=[0].concat(c)),c.indexOf(1)===-1&&c.push(1),e=c[0],o=1;o<c.length;o++)r=c[o],i=this.split(e,r),i._t1=e,i._t2=r,a.push(i),e=r;return a.forEach(function(d){for(e=0,r=0;r<=1;)for(r=e+n;r<=1+n;r+=n)if(i=d.split(e,r),!i.simple()){if(r-=n,ko(e-r)<n)return[];i=d.split(e,r),i._t1=z.map(e,0,1,d._t1,d._t2),i._t2=z.map(r,0,1,d._t1,d._t2),l.push(i),e=r;break}e<1&&(i=d.split(e,1),i._t1=z.map(e,0,1,d._t1,d._t2),i._t2=d._t2,l.push(i))}),l}translate(o,e,r){r=typeof r=="number"?r:e;let n=this.order,i=this.points.map((a,l)=>(1-l/n)*e+l/n*r);return new s(this.points.map((a,l)=>({x:a.x+o.x*i[l],y:a.y+o.y*i[l]})))}scale(o){let e=this.order,r=!1;if(typeof o=="function"&&(r=o),r&&e===2)return this.raise().scale(r);let n=this.clockwise,i=this.points;if(this._linear)return this.translate(this.normal(0),r?r(0):o,r?r(1):o);let a=r?r(0):o,l=r?r(1):o,c=[this.offset(0,10),this.offset(1,10)],d=[],p=z.lli4(c[0],c[0].c,c[1],c[1].c);if(!p)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(u){let h=d[u*e]=z.copy(i[u*e]);h.x+=(u?l:a)*c[u].n.x,h.y+=(u?l:a)*c[u].n.y}),r?([0,1].forEach(function(u){if(!(e===2&&u)){var h=i[u+1],f={x:h.x-p.x,y:h.y-p.y},b=r?r((u+1)/e):o;r&&!n&&(b=-b);var v=Lo(f.x*f.x+f.y*f.y);f.x/=v,f.y/=v,d[u+1]={x:h.x+b*f.x,y:h.y+b*f.y}}}),new s(d)):([0,1].forEach(u=>{if(e===2&&u)return;let h=d[u*e],f=this.derivative(u),b={x:h.x+f.x,y:h.y+f.y};d[u+1]=z.lli4(h,b,p,i[u+1])}),new s(d))}outline(o,e,r,n){if(e=e===void 0?o:e,this._linear){let E=this.normal(0),P=this.points[0],S=this.points[this.points.length-1],B,V,F;r===void 0&&(r=o,n=e),B={x:P.x+E.x*o,y:P.y+E.y*o},F={x:S.x+E.x*r,y:S.y+E.y*r},V={x:(B.x+F.x)/2,y:(B.y+F.y)/2};let U=[B,V,F];B={x:P.x-E.x*e,y:P.y-E.y*e},F={x:S.x-E.x*n,y:S.y-E.y*n},V={x:(B.x+F.x)/2,y:(B.y+F.y)/2};let j=[F,V,B],Z=z.makeline(j[2],U[0]),se=z.makeline(U[2],j[0]),te=[Z,new s(U),se,new s(j)];return new qt(te)}let i=this.reduce(),a=i.length,l=[],c=[],d,p=0,u=this.length(),h=typeof r<"u"&&typeof n<"u";function f(E,P,S,B,V){return function(F){let U=B/S,j=(B+V)/S,Z=P-E;return z.map(F,0,1,E+U*Z,E+j*Z)}}i.forEach(function(E){let P=E.length();h?(l.push(E.scale(f(o,r,u,p,P))),c.push(E.scale(f(-e,-n,u,p,P)))):(l.push(E.scale(o)),c.push(E.scale(-e))),p+=P}),c=c.map(function(E){return d=E.points,d[3]?E.points=[d[3],d[2],d[1],d[0]]:E.points=[d[2],d[1],d[0]],E}).reverse();let b=l[0].points[0],v=l[a-1].points[l[a-1].points.length-1],g=c[a-1].points[c[a-1].points.length-1],y=c[0].points[0],m=z.makeline(g,b),w=z.makeline(v,y),C=[m].concat(l).concat([w]).concat(c);return new qt(C)}outlineshapes(o,e,r){e=e||o;let n=this.outline(o,e).curves,i=[];for(let a=1,l=n.length;a<l/2;a++){let c=z.makeshape(n[a],n[l-a],r);c.startcap.virtual=a>1,c.endcap.virtual=a<l/2-1,i.push(c)}return i}intersects(o,e){return o?o.p1&&o.p2?this.lineIntersects(o):(o instanceof s&&(o=o.reduce()),this.curveintersects(this.reduce(),o,e)):this.selfintersects(e)}lineIntersects(o){let e=rs(o.p1.x,o.p2.x),r=rs(o.p1.y,o.p2.y),n=ns(o.p1.x,o.p2.x),i=ns(o.p1.y,o.p2.y);return z.roots(this.points,o).filter(a=>{var l=this.get(a);return z.between(l.x,e,n)&&z.between(l.y,r,i)})}selfintersects(o){let e=this.reduce(),r=e.length-2,n=[];for(let i=0,a,l,c;i<r;i++)l=e.slice(i,i+1),c=e.slice(i+2),a=this.curveintersects(l,c,o),n.push(...a);return n}curveintersects(o,e,r){let n=[];o.forEach(function(a){e.forEach(function(l){a.overlaps(l)&&n.push({left:a,right:l})})});let i=[];return n.forEach(function(a){let l=z.pairiteration(a.left,a.right,r);l.length>0&&(i=i.concat(l))}),i}arcs(o){return o=o||.5,this._iterate(o,[])}_error(o,e,r,n){let i=(n-r)/4,a=this.get(r+i),l=this.get(n-i),c=z.dist(o,e),d=z.dist(o,a),p=z.dist(o,l);return ko(d-c)+ko(p-c)}_iterate(o,e){let r=0,n=1,i;do{i=0,n=1;let a=this.get(r),l,c,d,p,u=!1,h=!1,f,b=n,v=1,g=0;do if(h=u,p=d,b=(r+n)/2,g++,l=this.get(b),c=this.get(n),d=z.getccenter(a,l,c),d.interval={start:r,end:n},u=this._error(d,a,r,n)<=o,f=h&&!u,f||(v=n),u){if(n>=1){if(d.interval.end=v=1,p=d,n>1){let m={x:d.x+d.r*Ll(d.e),y:d.y+d.r*Il(d.e)};d.e+=z.angle({x:d.x,y:d.y},m,this.get(1))}break}n=n+(n-r)/2}else n=b;while(!f&&i++<100);if(i>=100)break;p=p||d,e.push(p),r=v}while(n<1);return e}};var vr=class extends $t{#e=null;constructor(o){super(),o&&(this.#e=o)}getBezier(){return this.#e||(this.#e=new Ut(this.getPoints().map(o=>o.xy))),this.#e}signedDistance(o){return this.nearestPointTo(o).point.distanceTo(o)}distance(o){return this.signedDistance(o)}at(o){return T.ofXY(this.getBezier().get(o))}derivativeAt(o){return T.ofXY(this.getBezier().derivative(o))}secondDerivativeAt(o){return T.ofXY(this.getBezier().dderivative(o))}normal(o){return T.ofXY(this.getBezier().normal(o))}normalAt(o){return this.normal(o)}tangentAt(o){return this.derivativeAt(o).normalized()}getTightBoundingBox(){let o=this.getBezier().bbox(),e=o.x.max-o.x.min,r=o.y.max-o.y.min;return new fe(o.x.min,o.y.min,e,r)}argIntersectsLineSegment(o){let e=ze.ofSmallestContainingPoints(this.getPoints());return e?e.intersectsLineSegment(o).map(i=>this.nearestPointTo(i).parameterValue):this.getBezier().intersects(o).map(n=>{typeof n=="string"&&(n=parseFloat(n));let i=T.ofXY(this.at(n));return i.distanceTo(o.p1)>o.length||i.distanceTo(o.p2)>o.length?null:n}).filter(n=>n!==null)}splitAt(o){if(o<=0||o>=1)return[this];let r=this.getBezier().split(o);return[new yr(r.left.points.map(n=>T.ofXY(n)),r.left),new yr(r.right.points.map(n=>T.ofXY(n)),r.right)]}nearestPointTo(o){let e=p=>o.squareDistanceTo(this.at(p)),r=e(0),n=0,i=r,a=4;for(let p=0;p<a;p++){let u=p/(a-1),h=e(u);h<i&&(n=u,i=h)}let l=p=>{let u=this.at(p),h=this.derivativeAt(p),f=this.secondDerivativeAt(p);return 2*h.x*h.x+2*u.x*f.x-2*o.x*f.x+2*h.y*h.y+2*u.y*f.y-2*o.y*f.y},c=p=>{let u=this.at(p),h=this.derivativeAt(p);return 2*u.x*h.x-2*o.x*h.x+2*u.y*h.y-2*o.y*h.y},d=()=>{let p=l(n);if(p===0)return;n=(0-c(n))/p+n,n>1?n=1:n<0&&(n=0)};for(let p=0;p<12;p++)d();return{parameterValue:n,point:this.at(n)}}intersectsBezier(o){let e=this.getBezier().intersects(o.getBezier());if(!e||e.length===0)return[];let r=[];for(let n of e){let i=/^([-0-9.eE]+)\/([-0-9.eE]+)$/.exec(n);if(!i)throw new Error(`Incorrect format returned by .intersects: ${e} should be array of "number/number"!`);let a=parseFloat(i[1]);r.push({parameterValue:a,point:this.at(a)})}return r}toString(){return`B\xE9zier(${this.getPoints().map(o=>o.toString()).join(", ")})`}},yr=class extends vr{constructor(e,r){super(r);this.controlPoints=e}getPoints(){return this.controlPoints}},xr=vr;var kn=class extends xr{constructor(e,r,n,i){super();this.p0=e;this.p1=r;this.p2=n;this.p3=i}getPoints(){return[this.p0,this.p1,this.p2,this.p3]}getLooseBoundingBox(){return fe.bboxOf([this.p0,this.p1,this.p2,this.p3])}},is=kn;var Ml=(s,o,e)=>{if(s===0){let l;return o===0?l=e===0?0:NaN:l=-e/o,[l,l]}let r=o*o-4*s*e;if(r<0)return[NaN,NaN];let n=Math.sqrt(r),i=(-o+n)/(2*s),a=(-o-n)/(2*s);return i>a?[i,a]:[a,i]},ss=Ml;var $e=class s extends xr{constructor(e,r,n){super();this.p0=e;this.p1=r;this.p2=n}static componentAt(e,r,n,i){return r+e*(-2*r+2*n)+e*e*(r-2*n+i)}static derivativeComponentAt(e,r,n,i){return-2*r+2*n+2*e*(r-2*n+i)}static secondDerivativeComponentAt(e,r,n,i){return 2*(r-2*n+i)}at(e){if(e===0)return this.p0;if(e===1)return this.p2;let r=this.p0,n=this.p1,i=this.p2;return T.of(s.componentAt(e,r.x,n.x,i.x),s.componentAt(e,r.y,n.y,i.y))}derivativeAt(e){let r=this.p0,n=this.p1,i=this.p2;return T.of(s.derivativeComponentAt(e,r.x,n.x,i.x),s.derivativeComponentAt(e,r.y,n.y,i.y))}secondDerivativeAt(e){let r=this.p0,n=this.p1,i=this.p2;return T.of(s.secondDerivativeComponentAt(e,r.x,n.x,i.x),s.secondDerivativeComponentAt(e,r.y,n.y,i.y))}normal(e){return this.derivativeAt(e).orthog().normalized()}getLooseBoundingBox(){return fe.bboxOf([this.p0,this.p1,this.p2])}approximateDistance(e){let r=this.p0.x-e.x,n=-2*this.p0.x+2*this.p1.x,i=this.p0.x-2*this.p1.x+this.p2.x,a=this.p0.y-e.y,l=-2*this.p0.y+2*this.p1.y,c=this.p0.y-2*this.p1.y+this.p2.y,d=2*r*n+2*a*l-e.x*n-e.y*l,p=2*n*n+2*l*l+2*i*r+2*c*a-e.x*i-e.y*c,u=2*l*c+2*n*i+2*i*n+2*c*l,h=d,f=p,b=2*u,[v,g]=ss(b/2,f,h);isNaN(v)&&(v=.25),isNaN(g)&&(g=.75);let y=this.at(v),m=this.at(g),w=y.squareDistanceTo(e),C=m.squareDistanceTo(e),E=this.at(0).squareDistanceTo(e),P=this.at(1).squareDistanceTo(e);return Math.sqrt(Math.min(w,C,E,P))}getPoints(){return[this.p0,this.p1,this.p2]}},as=$e;var Ln=class extends $t{constructor(e){super();this.p=e}signedDistance(e){return this.p.distanceTo(e)}argIntersectsLineSegment(e,r){return e.containsPoint(this.p,r)?[0]:[]}getTightBoundingBox(){return new fe(this.p.x,this.p.y,0,0)}at(e){return this.p}normalAt(e){return T.unitY}tangentAt(e){return T.unitX}splitAt(e){return[this]}nearestPointTo(e){return{point:this.p,parameterValue:0}}},ls=Ln;var Bl=s=>{if(s.indexOf("e")>0&&s.match(/[eE][-]\d{2,}$/))return"0";let o=s.charAt(s.length-1);(o==="0"||o===".")&&(s=s.replace(/([.]\d*[^0])0+$/,"$1"),s=s.replace(/[.]0+$/,"."),s=s.replace(/[.]$/,""));let e=s.charAt(0);return(e==="0"||e==="-")&&(s=s.replace(/^(0+)[.]/,"."),s=s.replace(/^-(0+)[.]/,"-."),s=s.replace(/^(-?)0+$/,"$10")),s==="-0"?"0":s},wr=Bl;var be=s=>{let o=/^([-]?\d*\.\d{3,})0{4,}\d{1,4}$/,e=/^([-]?)(\d*)\.(\d{3,}9{4,})\d{1,4}$/,r=s.toString(10);if(r.indexOf(".")===-1)return r;let n=e.exec(r);if(n){let i=n[1],a=n[3],l=parseInt(a.charAt(a.length-1),10),c=parseInt(a,10),d=parseInt(n[2],10),p=n[3],u=(c+10-l).toString(),h=0;for(u.length>c.toString().length&&(u=u.substring(1),h=1);u.length<p.length;)u=h.toString(10)+u,h=0;r=`${i+(d+h).toString()}.${u}`}return r=r.replace(o,"$1"),wr(r)},Ct=be;var Tr=/^([-]?)(\d*)[.](\d+)$/;var Dl=s=>{let o=Tr.exec(s);return o?o[3].length:s.search(/[eE]/)!==-1||/^[a-zA-Z]+$/.exec(s)?-1:0},cs=Dl;var Al=(s,...o)=>{let e=s.toString(10),r=Tr.exec(e);if(!r)return e;let n=-1;for(let d of o)n=Math.max(cs(d),n);if(n===-1)return Ct(s);let i=r[3].substring(0,n),a=r[2],l=r[3].charAt(n);if(l!==""&&parseInt(l,10)>=5){if(i.length>0){let p=/^(0+)(\d*)$/.exec(i),u="",h=i;p&&(u=p[1],h=p[2]),i=(parseInt(i)+1).toString(),i.length>h.length&&u.length>0&&(u=u.substring(1)),i=u+i}(i.length===0||i.length>n)&&(a=(parseInt(a)+1).toString(),i=i.substring(1))}let c=r[1];return wr(`${c}${a}.${i}`)},In=Al;var Vl=s=>{if(s.length===0)return[];let o=s.reduce((i,a)=>a.y<i.y?a:i,s[0]),e=[o],r=[...s.filter(i=>!i.eq(o))],n=T.of(-1,0);for(;r.length>0;){let i=e[e.length-1],a=n.dot(o.minus(i).normalizedOrZero()),l=o;for(let d of r){let p=n.dot(d.minus(i).normalizedOrZero());p<=a&&(l=d,a=p)}r=r.filter(d=>!d.eq(l));let c=l.minus(i).normalized();if(Math.abs(c.dot(n))===1&&e.length>1&&e.pop(),l.eq(o))break;e.push(l),n=i.minus(l).normalized()}return e},ds=Vl;var Sr=(s,o)=>{let e=s.curveIndex-o.curveIndex;return e===0?s.parameterValue-o.parameterValue:e},Rn=(s,o)=>s.parameterValue+o>1?{curveIndex:s.curveIndex+1,parameterValue:s.parameterValue+o-1}:s.parameterValue+o<0?s.curveIndex===0?{curveIndex:0,parameterValue:0}:{curveIndex:s.curveIndex-1,parameterValue:s.parameterValue+o+1}:{curveIndex:s.curveIndex,parameterValue:s.parameterValue+o},W=class s{constructor(o,e){this.startPoint=o;this.cachedGeometry=null;this.cachedPolylineApproximation=null;this.cachedStringVersion=null;this.parts=e,this.bbox=fe.bboxOf([o]);for(let r of this.parts)this.bbox=this.bbox.union(s.computeBBoxForSegment(o,r))}getExactBBox(){let o=[];for(let e of this.geometry)o.push(e.getTightBoundingBox());return fe.union(...o)}get geometry(){if(this.cachedGeometry)return this.cachedGeometry;let o=this.startPoint,e=[];for(let r of this.parts){let n;switch(r.kind){case 2:e.push(new is(o,r.controlPoint1,r.controlPoint2,r.endPoint)),o=r.endPoint;break;case 3:e.push(new as(o,r.controlPoint,r.endPoint)),o=r.endPoint;break;case 0:e.push(new ze(o,r.point)),o=r.point;break;case 1:e.push(new ls(r.point)),o=r.point;break;default:return n=r,n}}return this.cachedGeometry=e,this.cachedGeometry}*startEndPoints(){yield this.startPoint;for(let o of this.parts){let e;switch(o.kind){case 2:yield o.endPoint;break;case 3:yield o.endPoint;break;case 0:yield o.point;break;case 1:yield o.point;break;default:return e=o,e}}}polylineApproximation(){if(this.cachedPolylineApproximation)return this.cachedPolylineApproximation;let o=[];for(let n of this.parts)switch(n.kind){case 2:o.push(n.controlPoint1,n.controlPoint2,n.endPoint);break;case 3:o.push(n.controlPoint,n.endPoint);break;case 1:case 0:o.push(n.point);break}let e=[],r=this.startPoint;for(let n of o)e.push(new ze(r,n)),r=n;return e}static computeBBoxForSegment(o,e){let r=[o],n;switch(e.kind){case 1:case 0:r.push(e.point);break;case 2:r.push(e.controlPoint1,e.controlPoint2,e.endPoint);break;case 3:r.push(e.controlPoint,e.endPoint);break;default:return n=e,n}return fe.bboxOf(r)}signedDistance(o,e){let r=1/0;for(let n of this.geometry){let i=n.signedDistance(o)-e;i<r&&(r=i)}return r}raymarchIntersectionWith(o,e,r=[]){if(!o.bbox.intersects(this.bbox.grownBy(e)))return[];let n=o.length,i=[];for(let b of this.geometry){let v=b.getTightBoundingBox().grownBy(e);if(!v.intersects(o.bbox))continue;let g=m=>b.signedDistance(m),y=m=>g(m)-e;y(o.p1)>n&&y(o.p2)>n||i.push({part:b,distFn:g,bbox:v})}if(i.length===0)return[];let a=b=>{let v=1/0,g=null,y=[];for(let m of i){let{part:w,distFn:C,bbox:E}=m;if(!E.containsPoint(b)){y.push(m);continue}let P=C(b);P<=v&&(v=P,g=w)}for(let{part:m,distFn:w,bbox:C}of y){if(isFinite(v)&&!C.grownBy(v).containsPoint(b))continue;let E=w(b);E<=v&&(v=E,g=m)}return[g,v-e]},l=8,c=[o.p1,...r,o.p2],d=b=>b.minus(o.p1).dot(o.direction);c.sort((b,v)=>{let g=d(b),y=d(v);return g-y});let p=[],u=e/1e3,h=(b,v,g)=>{let y=b,[m,w]=a(y),C=d(y);if(w>n)return C;let E=o.direction.times(v);for(let S=0;S<l;S++){let B=w;if(y=y.plus(E.times(B)),C=d(y),C<=g)return C;let[V,F]=a(y);if(Math.abs(F)>Math.abs(w))return null;if(w=F,m=V,Math.abs(w)<u)break}let P=C>=0&&C<=n;if(m&&P&&Math.abs(w)<u){p.push({point:y,parameterValue:m.nearestPointTo(y).parameterValue,curve:m,curveIndex:this.geometry.indexOf(m)});let S=e/20/o.length;C+=isFinite(S)?S:0}return C},f=0;for(let b=0;b<c.length;b++){let v=c[b];f=Math.max(f,h(v,1,f)??f),f=Math.max(f,h(v,-1,f)??f)}return p}intersection(o,e){let r=[];if(!o.bbox.intersects(this.bbox.grownBy(e??0)))return[];if(this.parts.length===0)return new s(this.startPoint,[{kind:1,point:this.startPoint}]).intersection(o,e);let n=0;for(let a of this.geometry){let l=a.argIntersectsLineSegment(o);for(let c of l)r.push({curve:a,curveIndex:n,point:a.at(c),parameterValue:c});n++}if(e&&e>1e-8){let a=r.map(l=>l.point);r=this.raymarchIntersectionWith(o,e,a)}return r}nearestPointTo(o){let e=1/0,r=0,n=0,i=this.startPoint;for(let a=0;a<this.geometry.length;a++){let c=this.geometry[a].nearestPointTo(o),d=c.point.squareDistanceTo(o);(a===0||d<e)&&(r=a,e=d,n=c.parameterValue,i=c.point)}return{curve:this.geometry[r],curveIndex:r,parameterValue:n,point:i}}at(o){return o.curveIndex===0&&o.parameterValue===0?this.startPoint:this.geometry[o.curveIndex].at(o.parameterValue)}tangentAt(o){return this.geometry[o.curveIndex].tangentAt(o.parameterValue)}splitNear(o,e){let r=this.nearestPointTo(o);return this.splitAt(r,e)}spliced(o,e,r,n){if(((a,l)=>a.curveIndex<l.curveIndex||a.curveIndex===l.curveIndex&&a.parameterValue<=l.parameterValue)(o,e)){let a=this.splitAt(o,n),l=this.splitAt(e,n),c=a[0],d=l[l.length-1];return r?c.union(r).union(d):c.union(d)}else{let c=this.splitAt([o],n)[0].splitNear(this.at(e),n),d=c[c.length-1];return r?d.union(r):d}}splitAt(o,e){for(Array.isArray(o)||(o=[o]),o=[...o],o.sort(Sr);o.length>0&&o[o.length-1].curveIndex>=this.parts.length-1&&o[o.length-1].parameterValue>=1;)o.pop();for(o.reverse();o.length>0&&o[o.length-1].curveIndex<=0&&o[o.length-1].parameterValue<=0;)o.pop();if(o.length===0||this.parts.length===0)return[this];let r=o.length+1,n=e?.mapNewPoint??(p=>p),i=[],a=this.startPoint,l=[],{curveIndex:c,parameterValue:d}=o.pop();for(let p=0;p<this.parts.length;p++)if(p!==c)l.push(this.parts[p]);else{let u=this.parts[p],h=this.geometry[p];for(;p===c;){let f,b=[];switch(u.kind){case 1:l.push({kind:u.kind,point:u.point}),f=u.point;break;case 0:{let g=h.splitAt(d);l.push({kind:u.kind,point:n(g[0].p2)}),f=g[0].p2,g.length>1&&(console.assert(g.length===2),b.push({kind:u.kind,point:g[1].p2}),h=g[1])}break;case 3:case 2:{let g=h.splitAt(d),y=g.length===2;for(let m of g){h=m;let w=y?l:b,C=m.getPoints();u.kind===2?w.push({kind:u.kind,controlPoint1:n(C[1]),controlPoint2:n(C[2]),endPoint:n(C[3])}):w.push({kind:u.kind,controlPoint:n(C[1]),endPoint:n(C[2])}),y||(f=C[0]),y=!1}}break;default:return u}i.push(new s(a,[...l])),a=n(f),console.assert(!!a,"should have a start point"),l=b,u=b[b.length-1]??u;let v=o.pop();if(v)if(c=v.curveIndex,p===c){let g=this.at(v);d=h.nearestPointTo(g).parameterValue,l=[]}else d=v.parameterValue;else break}}return i.push(new s(a,l)),console.assert(i.length===r,`should split into splitAt.length + 1 splits (was ${i.length}, expected ${r})`),i}asClosed(){let o=[],e=!1;for(let n of this.parts)n.kind===1?(o.push({kind:0,point:n.point}),e=!0):o.push(n);if(this.getEndPoint().eq(this.startPoint)||(o.push({kind:0,point:this.startPoint}),e=!0),!e)return this;let r=new s(this.startPoint,o);return console.assert(r.getEndPoint().eq(r.startPoint)),r}static mapPathCommand(o,e){switch(o.kind){case 1:case 0:return{kind:o.kind,point:e(o.point)};case 2:return{kind:o.kind,controlPoint1:e(o.controlPoint1),controlPoint2:e(o.controlPoint2),endPoint:e(o.endPoint)};case 3:return{kind:o.kind,controlPoint:e(o.controlPoint),endPoint:e(o.endPoint)}}return o}mapPoints(o){let e=o(this.startPoint),r=[];for(let n of this.parts)r.push(s.mapPathCommand(n,o));return new s(e,r)}transformedBy(o){return o.isIdentity()?this:this.mapPoints(e=>o.transformVec2(e))}closedContainsPoint(o){let e=this.getExactBBox();if(!e.containsPoint(o))return!1;let r=o.plus(T.of(e.width,0)),n=this.asClosed(),i=new ze(o,r),a=n.intersection(i);return a.filter((c,d)=>d===0?!0:!(a[d-1].parameterValue>=1&&c.parameterValue<=0)).length%2===1}closedContainsRect(o){if(!this.bbox.containsRect(o)||!o.corners.every(e=>this.closedContainsPoint(e)))return!1;for(let e of o.getEdges())if(this.intersection(e).length)return!1;return!0}union(o,e={allowReverse:!0}){if(!o)return this;if(Array.isArray(o))return new s(this.startPoint,[...this.parts,...o]);let r=this.getEndPoint(),n=[];if(r.eq(o.startPoint))n=this.parts.concat(o.parts);else{if(e.allowReverse&&this.startPoint.eq(o.getEndPoint()))return o.union(this,{allowReverse:!1});if(e.allowReverse&&this.startPoint.eq(o.startPoint))return this.union(o.reversed(),{allowReverse:!1});n=[...this.parts,{kind:1,point:o.startPoint},...o.parts]}return new s(this.startPoint,n)}reversed(){let o=this.getEndPoint(),e=[],r=this.startPoint;for(let n of this.parts)switch(n.kind){case 0:case 1:e.push({kind:n.kind,point:r}),r=n.point;break;case 2:e.push({kind:n.kind,controlPoint1:n.controlPoint2,controlPoint2:n.controlPoint1,endPoint:r}),r=n.endPoint;break;case 3:e.push({kind:n.kind,controlPoint:n.controlPoint,endPoint:r}),r=n.endPoint;break;default:return n}return e.reverse(),new s(o,e)}getEndPoint(){if(this.parts.length===0)return this.startPoint;let o=this.parts[this.parts.length-1];return o.kind===3||o.kind===2?o.endPoint:o.point}roughlyIntersects(o,e=0){if(this.parts.length===0)return o.containsPoint(this.startPoint);if(this.startPoint.eq(this.getEndPoint())&&e===0)return this.closedRoughlyIntersects(o);if(o.containsRect(this.bbox))return!0;let n=this.startPoint;for(let i of this.parts){let a=s.computeBBoxForSegment(n,i).grownBy(e);if(i.kind===0||i.kind===1?n=i.point:n=i.endPoint,o.intersects(a))return!0}return!1}closedRoughlyIntersects(o){if(o.containsRect(this.bbox))return!0;let e=this.bbox.topLeft.minus(T.of(1,1)),r=o.corners,n=this.polylineApproximation();for(let l of r){let c=new ze(l,e),d=0;for(let p of n)p.intersects(c)&&d++;if(d%2===1)return!0}let i=o.grownBy(Math.min(o.size.x,o.size.y)),a=[];for(let l of i.divideIntoGrid(4,4))a.push(...l.getEdges());for(let l of a)for(let c of n)if(l.intersects(c))return!0;return!1}eq(o,e){if(o.parts.length!==this.parts.length)return!1;for(let r=0;r<this.parts.length;r++){let n=this.parts[r],i=o.parts[r];switch(n.kind){case 0:case 1:if(n.kind!==i.kind)return!1;if(!n.point.eq(i.point,e))return!1;break;case 2:if(n.kind!==i.kind)return!1;if(!n.controlPoint1.eq(i.controlPoint1,e)||!n.controlPoint2.eq(i.controlPoint2,e)||!n.endPoint.eq(i.endPoint,e))return!1;break;case 3:if(n.kind!==i.kind)return!1;if(!n.controlPoint.eq(i.controlPoint,e)||!n.endPoint.eq(i.endPoint,e))return!1;break;default:return n}}return!0}static fromRect(o,e=null){let r=[],n,i;if(e!==null){let a=T.of(e,e).times(.5),l=fe.fromCorners(o.topLeft.plus(a),o.bottomRight.minus(a)),c=fe.fromCorners(o.topLeft.minus(a),o.bottomRight.plus(a));n=[l.corners[3],...l.corners,...c.corners.reverse()],i=c.corners[3]}else n=o.corners.slice(1),i=o.corners[0];for(let a of n)r.push({kind:0,point:a});return r.push({kind:0,point:i}),new s(i,r)}toString(o,e=!1){if(this.cachedStringVersion&&!e)return this.cachedStringVersion;o===void 0&&(o=Math.abs(this.bbox.topLeft.x)>10&&Math.abs(this.bbox.topLeft.y)>10);let r=s.toString(this.startPoint,this.parts,!o);return this.cachedStringVersion=r,r}serialize(){return this.toString()}static toString(o,e,r){let n=[],i,a=(c,...d)=>{let p=[],u=[],h=!i||r,f=i?Ct(i.x):"",b=i?Ct(i.y):"";for(let g of d){let y=Ct(g.x),m=Ct(g.y);if(h)p.push(`${y},${m}`);else{let w=In(g.x-i.x,y,f,b),C=In(g.y-i.y,m,f,b);C.charAt(0)==="-"?u.push(`${w}${C}`):u.push(`${w},${C}`)}}let v;h?v=`${c}${p.join(" ")}`:v=`${c.toLowerCase()}${u.join(" ")}`,!(v==="l0,0"||v==="m0,0")&&(n.push(v),d.length>0&&(i=d[d.length-1]))};e[0]?.kind!==1&&a("M",o);let l;for(let c=0;c<e.length;c++){let d=e[c];switch(d.kind){case 1:a("M",d.point);break;case 0:a("L",d.point);break;case 2:a("C",d.controlPoint1,d.controlPoint2,d.endPoint);break;case 3:a("Q",d.controlPoint,d.endPoint);break;default:return l=d,l}}return n.join("")}static fromString(o){o=o.split(`
`).join(" ");let e=T.zero,r=null,n=null,i=!0,a=[],l=v=>{if(i){i=!1;return}a.push({kind:1,point:v})},c=v=>{if(i){i=!1;return}a.push({kind:0,point:v})},d=(v,g,y)=>{a.push({kind:2,controlPoint1:v,controlPoint2:g,endPoint:y})},p=(v,g)=>{a.push({kind:3,controlPoint:v,endPoint:g})},u={m:1,l:1,c:3,q:2,z:0,h:1,v:1},h=/([MZLHVCSQTA])\s*([^MZLHVCSQTA]*)/gi,f;for(;(f=h.exec(o))!==null;){let g=f[2].trim().split(/[^0-9Ee.-]/).filter(E=>E.length>0).reduce((E,P)=>{P=P.replace(/([^eE])[-]/g,"$1 -");let S=P.split(" -");return S[0]!==""&&E.push(S[0]),E.push(...S.slice(1).map(B=>`-${B}`)),E},[]).map(E=>parseFloat(E)),y=f[1].toLowerCase(),m=f[1]!==y;if(y==="v"||y==="h")g=g.reduce((E,P)=>y==="v"?E.concat(m?e.x:0,P):E.concat(P,m?e.y:0),[]),y="l";else if(y==="z"){if(r)g=[r.x,r.y],r=e;else continue;m=!0,y="l"}let w=u[y]??0,C=g.reduce((E,P,S,B)=>{if(S%2!==0){let V=P,F=B[S-1];return E.concat(T.of(F,V))}else return E},[]).map((E,P)=>{let S;return m?S=E:S=e.plus(E),(P+1)%w===0&&(e=S),S});if(C.length%w!==0)throw new Error([`Incorrect number of arguments: got ${JSON.stringify(C)} with a length of ${C.length} \u2260 ${w}k, k \u2208 \u2124.`,`The number of arguments to ${y} must be a multiple of ${w}!`,`Command: ${f[0]}`].join(`
`));for(let E=0;E<C.length;E+=w){let P=C.slice(E,E+w);switch(y.toLowerCase()){case"m":E===0?l(P[0]):c(P[0]);break;case"l":c(P[0]);break;case"c":d(P[0],P[1],P[2]);break;case"q":p(P[0],P[1]);break;default:throw new Error(`Unknown path command ${y}`)}i=!1}C.length>0&&(r??=C[0],n??=r,e=C[C.length-1])}let b=new s(n??T.zero,a);return b.cachedStringVersion=o,b}static fromConvexHullOf(o){if(o.length===0)return s.empty;let e=ds(o),r=e.slice(1).map(n=>({kind:0,point:n}));return r.push({kind:0,point:e[0]}),new s(e[0],r)}static{this.empty=new s(T.zero,[])}};var M=class s{constructor(o,e,r,n){this.r=o;this.g=e;this.b=r;this.a=n;this.hexString=null}static ofRGB(o,e,r){return s.ofRGBA(o,e,r,1)}static ofRGBA(o,e,r,n){return o=Math.max(0,Math.min(o,1)),e=Math.max(0,Math.min(e,1)),r=Math.max(0,Math.min(r,1)),n=Math.max(0,Math.min(n,1)),new s(o,e,r,n)}static fromRGBArray(o,e=255){let r=o[0],n=o[1]??r,i=o[2]??r,a=255;return 3<o.length&&(a=o[3]),s.ofRGBA(r/e,n/e,i/e,a/e)}static fromHex(o){if(o=(o.match(/^[#]?(.*)$/)??[])[1],o=o.toUpperCase(),!o.match(/^[0-9A-F]+$/))throw new Error(`${o} is not in a valid format.`);(o.length===3||o.length===4)&&(o=o.split("").map(n=>`${n}0`).join("")),o.length===6&&(o+="FF");let e=[];for(let r=2;r<=o.length;r+=2){let n=o.substring(r-2,r);e.push(parseInt(n,16)/255)}if(e.length!==4)throw new Error(`Unable to parse ${o}: Wrong number of components.`);return s.ofRGBA(e[0],e[1],e[2],e[3])}static fromString(o){if(o.startsWith("#"))return s.fromHex(o);if(o==="none"||o==="transparent")return s.transparent;if(o==="")return s.black;let e=/^rgba?\(([,0-9.]+)\)$/i,r=o.replace(/\s*/g,"").match(e);if(r){let u=r[1],h=JSON.parse(`[ ${u} ]`);if(h.length===3)return s.ofRGB(h[0]/255,h[1]/255,h[2]/255);if(h.length===4)return s.ofRGBA(h[0]/255,h[1]/255,h[2]/255,h[3]);throw new Error(`RGB string, ${o}, has wrong number of components: ${h.length}`)}let n=document.createElement("canvas");n.width=1,n.height=1;let i=n.getContext("2d");if(!i)return s.black;i.fillStyle=o,i.fillRect(0,0,1,1);let a=i.getImageData(0,0,1,1),l=a.data[0]/255,c=a.data[1]/255,d=a.data[2]/255,p=a.data[3]/255;return s.ofRGBA(l,c,d,p)}eq(o){return o==null?!1:this.a===0&&o.a===0?!0:this.toHexString()===o.toHexString()}mix(o,e){e=Math.min(Math.max(e,0),1);let r=1-e;return new s(this.r*r+o.r*e,this.g*r+o.g*e,this.b*r+o.b*e,this.a*r+o.a*e)}withAlpha(o){return new s(this.r,this.g,this.b,o)}get rgb(){return ke.of(this.r,this.g,this.b)}relativeLuminance(){let o=[this.r,this.g,this.b].map(e=>e<.03928?e/12.92:Math.pow((e+.055)/1.055,2.4));return .2126*o[0]+.7152*o[1]+.0722*o[2]}static contrastRatio(o,e){let r=o.relativeLuminance(),n=e.relativeLuminance();return(Math.max(r,n)+.05)/(Math.min(r,n)+.05)}static average(o){let e=0,r=0,n=0,i=0;for(let a of o)e+=a.a,r+=a.r,n+=a.g,i+=a.b;return o.length>0&&(e/=o.length,r/=o.length,n/=o.length,i/=o.length),new s(r,n,i,e)}asHSV(){let o=Math.min(this.r,this.g,this.b),e=Math.max(this.r,this.g,this.b),r=e-o,n;r===0?n=0:this.r>=this.g&&this.r>=this.b?n=(this.g-this.b)/r%6:this.g>=this.r&&this.g>=this.b?n=(this.b-this.r)/r+2:n=(this.r-this.g)/r+4,n*=60,n*=Math.PI/180,n<0&&(n+=Math.PI*2);let i=e,a=i>0?r/i:0;return ke.of(n,a,i)}static fromHSV(o,e,r){o<0&&(o+=Math.PI*2),o%=Math.PI*2,r=Math.max(0,Math.min(1,r)),e=Math.max(0,Math.min(1,e));let n=r*e,i=o/(Math.PI/3),a=n*(1-Math.abs(i%2-1)),l;i<1?l=[n,a,0]:i<2?l=[a,n,0]:i<3?l=[0,n,a]:i<4?l=[0,a,n]:i<5?l=[a,0,n]:l=[n,0,a];let c=r-n;return s.ofRGB(l[0]+c,l[1]+c,l[2]+c)}static fromRGBVector(o,e){return s.ofRGBA(o.x,o.y,o.z,e??1)}toHexString(){if(this.hexString)return this.hexString;let o=a=>{let l=Math.round(255*a).toString(16);return l.length===1?`0${l}`:l},e=o(this.a),r=o(this.r),n=o(this.g),i=o(this.b);return e==="ff"?`#${r}${n}${i}`:(this.hexString=`#${r}${n}${i}${e}`,this.hexString)}toString(){return this.toHexString()}static{this.transparent=s.ofRGBA(0,0,0,0)}static{this.red=s.ofRGB(1,0,0)}static{this.orange=s.ofRGB(1,.65,0)}static{this.green=s.ofRGB(0,1,0)}static{this.blue=s.ofRGB(0,0,1)}static{this.purple=s.ofRGB(.5,.2,.5)}static{this.yellow=s.ofRGB(1,1,.1)}static{this.clay=s.ofRGB(.8,.4,.2)}static{this.black=s.ofRGB(0,0,0)}static{this.gray=s.ofRGB(.5,.5,.5)}static{this.white=s.ofRGB(1,1,1)}};var Ol=(s,o,e,r)=>{let n=o.transformVec3(T.unitX),i=o.transformVec2(s),a=n.magnitude(),l=-(180/Math.PI)*n.angle(),c=i.minus(s),d=[];if(a>1.2?d.push(r.zoomedIn):a<.8&&d.push(r.zoomedOut),Math.floor(Math.abs(l))>0){let u=Math.round(e?-l:l);d.push(r.rotatedBy(u))}let p=1e-4;return c.x>p?d.push(e?r.movedLeft:r.movedRight):c.x<-p&&d.push(e?r.movedRight:r.movedLeft),c.y<-p?d.push(e?r.movedDown:r.movedUp):c.y>p&&d.push(e?r.movedUp:r.movedDown),d.join("; ")},Kt=Ol;var zn=class extends Ne{},Le=class s{constructor(o){this.onTransformChangeCallback=o;this.resetTransform(k.identity),this.screenRect=R.empty}static{this.ViewportTransform=class extends zn{constructor(e){super();this.transform=e;this.#e=e.inverse()}#e;apply(e){let r=e.viewport;r.resetTransform(r.transform.rightMul(this.transform)),e.queueRerender()}unapply(e){let r=e.viewport;r.resetTransform(r.transform.rightMul(this.#e)),e.queueRerender()}description(e,r){return Kt(e.viewport.visibleRect.center,this.transform,!0,r)}}}getTemporaryClone(){let o=new s(()=>{});return o.transform=this.transform,o.inverseTransform=this.inverseTransform,o.screenRect=this.screenRect,o}updateScreenSize(o){this.screenRect=this.screenRect.resizedTo(o)}get visibleRect(){return this.screenRect.transformedBoundingBox(this.inverseTransform)}screenToCanvas(o){return this.inverseTransform.transformVec2(o)}canvasToScreen(o){return this.transform.transformVec2(o)}static transformBy(o){return new s.ViewportTransform(o)}resetTransform(o=k.identity){let e=this.transform;this.transform=o,this.inverseTransform=o.inverse(),this.onTransformChangeCallback?.(e,o)}get screenToCanvasTransform(){return this.inverseTransform}get canvasToScreenTransform(){return this.transform}getScreenRectSize(){return this.screenRect.size}getResolution(){return this.getScreenRectSize()}getScaleFactor(){return this.transform.transformVec3(N.unitX).magnitude()}getScaleFactorToNearestPowerOfTen(){return this.getScaleFactorToNearestPowerOf(10)}getScaleFactorToNearestPowerOf(o){let e=this.getScaleFactor();return Math.pow(o,Math.round(Math.log(e)/Math.log(o)))}static getGridSize(o){return 50/o}snapToGrid(o){let e=this.getScaleFactorToNearestPowerOf(2),r=i=>{let a=1/s.getGridSize(e);return Math.round(i*a)/a};return T.of(r(o.x),r(o.y))}getSizeOfPixelOnCanvas(){return 1/this.getScaleFactor()}getRotationAngle(){return this.transform.transformVec3(N.unitX).angle()}static roundPoint(o,e){let r=10**Math.floor(Math.log10(e)),n=i=>Math.round(i/r)*r;return typeof o=="number"?n(o):o.map(n)}roundPoint(o){return s.roundPoint(o,1/this.getScaleFactor())}static roundScaleRatio(o,e=1){if(Math.abs(o)<=1e-12)return 0;let r=10**Math.floor(Math.log10(Math.abs(o))),n=2**e;return o=Math.round(o/r*n)/n*r,o}computeZoomToTransform(o,e=!0,r=!0){let n=k.identity;if(o.w===0||o.h===0){let d=Math.max(o.w,o.h);d===0&&(d=50,e=!1,r=!1),o=new R(o.x,o.y,d,d)}if(isNaN(o.size.magnitude()))throw new Error(`${o.toString()} rectangle has NaN size! Cannot zoom to!`);let i=()=>{let d=this.visibleRect.transformedBoundingBox(n.inverse());return d.transformedBoundingBox(k.scaling2D(4/5,d.center))},a=i(),l=a.w<o.w||a.h<o.h,c=o.maxDimension/a.maxDimension<1/3;if(l&&r||c&&e){let d=Math.max(o.w/a.w,o.h/a.h),u=k.scaling2D(d,a.topLeft).inverse();n=n.rightMul(u)}if(a=i(),!a.containsRect(o)){let d=o.center.minus(a.center),u=k.translation(d).inverse();n=n.rightMul(u)}return n.invertable()||(console.warn("Unable to zoom to ",o,"! Computed transform",n,"is singular."),n=k.identity),n}zoomTo(o,e=!0,r=!0){let n=this.computeZoomToTransform(o,e,r);return new s.ViewportTransform(n)}},q=Le;var K=class s extends Ne{#e;constructor(o){if(super(),!(o in s.deserializationCallbacks))throw new Error(`Command ${o} must have a registered deserialization callback. To do this, call SerializableCommand.register.`);this.#e=o}static{this.deserializationCallbacks={}}serialize(){return{data:this.serializeToJSON(),commandType:this.#e}}static deserialize(o,e){let r=typeof o=="string"?JSON.parse(o):o,n=r.commandType;if(!(n in s.deserializationCallbacks))throw new Error(`Unrecognised command type ${n}!`);return s.deserializationCallbacks[n](r.data,e)}static register(o,e){s.deserializationCallbacks[o]=e}};var Et=class extends K{constructor(o,e,r){super(o),this.component=r??null,this.componentID=e}resolveComponent(o){if(this.component)return;let e=o.lookupElement(this.componentID);if(!e)throw new Error(`Unable to resolve component with ID ${this.componentID}`);this.component=e}};function ps(s){throw new Error(`Should be unreachable. Key: ${s}.`)}function et(s,o=!1){if(typeof s!="number"||!o&&isNaN(s))throw new Error("Given value is not a number")}function Mn(s){if(typeof s!="string")throw new Error("Given value is not a string")}function us(s){if(!Array.isArray(s))throw new Error("Asserting isArray: Given entity is not an array")}function dt(s,o=!1){us(s),et(s.length);for(let e of s)et(e,o)}function Io(s){us(s),et(s.length);for(let o of s)Mn(o)}function Bn(s){if(typeof s!="boolean")throw new Error("Given value is not a boolean")}function hs(s){if(!s)throw new Error(`${JSON.stringify(s)} is not truthy`)}function Cr(s){if(typeof s!="object")throw new Error(`AssertIsObject: Given entity is not an object (type = ${typeof s})`)}var J=class s{constructor(o,e){this.componentKind=o;this.loadSaveData={};if(this.lastChangedTime=new Date().getTime(),e!==void 0?this.zIndex=e:this.zIndex=s.zIndexCounter++,this.id=`${new Date().getTime()}-${Math.random()}`,s.deserializationCallbacks[o]===void 0)throw new Error(`Component ${o} has not been registered using AbstractComponent.registerComponent`)}static{this.zIndexCounter=0}getId(){return this.id}static{this.deserializationCallbacks={}}static registerComponent(o,e){this.deserializationCallbacks[o]=e??null}attachLoadSaveData(o,e){this.loadSaveData[o]||(this.loadSaveData[o]=[]),this.loadSaveData[o].push(e)}getLoadSaveData(){return this.loadSaveData}getZIndex(){return this.zIndex}getBBox(){return this.contentBBox}getExactBBox(){return this.getBBox()}getSizingMode(){return 0}occludesEverythingBelowWhenRenderedInRect(o){return!1}onAddToImage(o){}onRemoveFromImage(){}intersectsRect(o){return o.containsRect(this.getExactBBox())?!0:o.getEdges().some(r=>this.intersects(r))}keyPoints(){return[this.getBBox().center]}isSelectable(){return!0}isBackground(){return!1}getProportionalRenderingTime(){return 1}transformBy(o){return new s.TransformElementCommand(o,this.getId(),this)}setZIndex(o){return new s.TransformElementCommand(k.identity,this.getId(),this,o)}setZIndexAndTransformBy(o,e,r){return new s.TransformElementCommand(o,this.getId(),this,e,r)}static{this.transformElementCommandId="transform-element"}static{this.TransformElementCommand=class extends Et{constructor(e,r,n,i,a){super(s.transformElementCommandId,r,n);this.affineTransfm=e;this.origZIndex=a;this.targetZIndex=i??s.zIndexCounter++,this.targetZIndex>=s.zIndexCounter&&(s.zIndexCounter=this.targetZIndex+1),n&&a===void 0&&(this.origZIndex=n.getZIndex())}resolveComponent(e){this.component||(super.resolveComponent(e),this.origZIndex??=this.component.getZIndex())}updateTransform(e,r,n){if(!this.component)throw new Error("this.component is undefined or null!");let i=e.image.findParent(this.component),a=!1;i&&(i.remove(),a=!0),this.component.applyTransformation(r),this.component.zIndex=n,this.component.lastChangedTime=new Date().getTime(),n>=s.zIndexCounter&&(s.zIndexCounter=n+1),a&&X.addComponent(this.component).apply(e)}apply(e){this.resolveComponent(e.image),this.updateTransform(e,this.affineTransfm,this.targetZIndex),e.queueRerender()}unapply(e){this.resolveComponent(e.image),this.updateTransform(e,this.affineTransfm.inverse(),this.origZIndex),e.queueRerender()}description(e,r){return r.transformedElements(1,Kt(T.zero,this.affineTransfm,!1,r))}static{K.register(s.transformElementCommandId,(e,r)=>{let n=r.image.lookupElement(e.id)??void 0,i=new k(...e.transfm),a=e.targetZIndex,l=e.origZIndex??void 0;return new s.TransformElementCommand(i,e.id,n,a,l)})}serializeToJSON(){return{id:this.componentID,transfm:this.affineTransfm.toArray(),targetZIndex:this.targetZIndex,origZIndex:this.origZIndex}}}}clone(){let o=this.createClone();for(let e in this.loadSaveData)for(let r of this.loadSaveData[e])o.attachLoadSaveData(e,r);return o}cloneWithId(o){let e=this.clone();return e.id=o,e}serialize(){let o=this.serializeToJSON();if(o===null)throw new Error(`${this} cannot be serialized.`);return{name:this.componentKind,zIndex:this.zIndex,id:this.id,loadSaveData:this.loadSaveData,data:o}}static isNotDeserializable(o){return typeof o=="string"&&(o=JSON.parse(o)),typeof o!="object"||!this.deserializationCallbacks[o?.name]||!o.data}static deserialize(o){if(typeof o=="string"&&(o=JSON.parse(o)),s.isNotDeserializable(o))throw new Error(`Element with data ${o} cannot be deserialized.`);let e=this.deserializationCallbacks[o.name](o.data);return o.id&&(Mn(o.id),e.id=o.id),isFinite(o.zIndex)&&(e.zIndex=o.zIndex,s.zIndexCounter=Math.max(s.zIndexCounter,e.zIndex+1)),e}};var Be=class{constructor(){this.listeners={}}dispatch(o,e){let r=this.listeners[o];if(r)for(let n=0;n<r.length;n++)r[n](e)}on(o,e){return this.listeners[o]||(this.listeners[o]=[]),this.listeners[o].push(e),{remove:()=>{let r=this.listeners[o];return this.off(o,e),r.length!==this.listeners[o].length}}}off(o,e){let r=this.listeners[o];r&&(this.listeners[o]=r.filter(n=>n!==e))}};var Pt=s=>{s.sort((o,e)=>o.getContent().getZIndex()-e.getContent().getZIndex())};var Er=!1,X=class s{constructor(){this.componentCount=0;this.settingExportRect=!1;this.root=new Pr,this.background=new Pr,this.componentsById=new Map,this.notifier=new Be,this.importExportViewport=new q(()=>{this.onExportViewportChanged()}),this.importExportViewport.updateScreenSize(T.of(500,500)),this.shouldAutoresizeExportViewport=!1}getBackgroundComponents(){let o=[],e=this.background.getLeaves();Pt(e);for(let r of e){let n=r.getContent();n&&o.push(n)}return o}findParent(o){return this.background.getChildWithContent(o)??this.root.getChildWithContent(o)}queueRerenderOf(o){let e=this.findParent(o);e&&(e.remove(),this.addComponentDirectly(o))}renderWithCache(o,e,r){this.background.render(o,r.visibleRect),Er?this.root.render(o,r.visibleRect):e.render(o,this.root,r)}render(o,e){this.background.render(o,e?.visibleRect),this.root.render(o,e?.visibleRect)}async renderAllAsync(o,e){return await this.background.renderAllAsync(o,e)?await this.root.renderAllAsync(o,e):!1}renderAll(o){this.render(o,null)}getAllComponents(){let o=this.root.getLeaves();return Pt(o),o.map(e=>e.getContent())}getAllElements(){return this.getAllComponents()}estimateNumElements(){return this.componentCount}getElementsIntersectingRegion(o,e=!1){return this.getComponentsIntersecting(o,e)}getComponentsIntersecting(o,e=!1){let r=this.root.getLeavesIntersectingRegion(o);return e&&(r=r.concat(this.background.getLeavesIntersectingRegion(o))),Pt(r),r.map(n=>n.getContent())}onDestroyElement(o){this.componentCount--;let e=o.getId();this.componentsById.delete(e),this.notifier.dispatch(3,{kind:3,image:this,componentId:e}),this.autoresizeExportViewport()}onElementAdded(o){this.componentCount++;let e=o.getId();this.componentsById.set(o.getId(),o),this.notifier.dispatch(2,{kind:2,image:this,componentId:e}),this.autoresizeExportViewport()}lookupElement(o){return this.componentsById.get(o)??null}addComponentDirectly(o){o.onAddToImage(this);let r=(o.isBackground()?this.background:this.root).addLeaf(o);return this.onElementAdded(o),r}removeElementDirectly(o){let e=this.findParent(o);return e?.remove(),e?(this.onDestroyElement(o),!0):!1}static addComponent(o,e=!1){return new s.AddComponentCommand(o,e)}addComponent(o,e){return s.addComponent(o,e)}addElement(o,e){return this.addComponent(o,e)}static addElement(o,e=!1){return this.addComponent(o,e)}static{this.AddComponentCommand=class extends K{constructor(e,r=!1){super("add-element");this.element=e;this.applyByFlattening=r;this.serializedElem=null;if(this.serializedElem=null,isNaN(e.getBBox().area))throw new Error("Elements in the image cannot have NaN bounding boxes")}apply(e){e.image.addComponentDirectly(this.element),this.applyByFlattening?(this.applyByFlattening=!1,e.display.flatten()):e.queueRerender()}unapply(e){e.image.removeElementDirectly(this.element),e.queueRerender()}description(e,r){return r.addComponentAction(this.element.description(r))}serializeToJSON(){return{elemData:this.serializedElem??this.element.serialize()}}static{K.register("add-element",(e,r)=>{let n=e.elemData.id,a=r.image.lookupElement(n)??J.deserialize(e.elemData),l=new s.AddComponentCommand(a);return l.serializedElem=e.elemData,l})}}}getImportExportViewport(){return this.importExportViewport}getImportExportRect(){return this.getImportExportViewport().visibleRect}setImportExportRect(o){return s.SetImportExportRectCommand.of(this,o,!1)}getAutoresizeEnabled(){return this.shouldAutoresizeExportViewport}setAutoresizeEnabled(o){if(o===this.shouldAutoresizeExportViewport)return Ne.empty;let e=this.root.getBBox();return s.SetImportExportRectCommand.of(this,e,o)}setAutoresizeEnabledDirectly(o){o!==this.shouldAutoresizeExportViewport&&(this.shouldAutoresizeExportViewport=o,this.notifier.dispatch(1,{kind:1,image:this}))}autoresizeExportViewport(){this.shouldAutoresizeExportViewport&&this.setExportRectDirectly(this.root.getBBox())}setExportRectDirectly(o){let e=this.getImportExportViewport(),r=e.getScreenRectSize(),n=e.canvasToScreenTransform,i=k.translation(o.topLeft.times(-1));return!r.eq(o.size)||!n.eq(i)?(this.settingExportRect=!0,e.updateScreenSize(o.size),e.resetTransform(i),this.settingExportRect=!1,this.onExportViewportChanged(),!0):!1}onExportViewportChanged(){this.settingExportRect||this.notifier.dispatch(0,{kind:0,image:this})}static setDebugMode(o){Er=o}static{this.SetImportExportRectCommand=class extends K{constructor(e,r,n,i,a){super(s.SetImportExportRectCommand.commandId);this.originalSize=e;this.originalTransform=r;this.originalAutoresize=n;this.newExportRect=i;this.newAutoresize=a}static{this.commandId="set-import-export-rect"}static of(e,r,n){let i=e.getImportExportViewport(),a=i.visibleRect.size,l=i.canvasToScreenTransform,c=e.getAutoresizeEnabled();return new s.SetImportExportRectCommand(a,l,c,r,n)}apply(e){e.image.setAutoresizeEnabledDirectly(this.newAutoresize),e.image.setExportRectDirectly(this.newExportRect),e.queueRerender()}unapply(e){let r=e.image.getImportExportViewport();e.image.setAutoresizeEnabledDirectly(this.originalAutoresize),r.updateScreenSize(this.originalSize),r.resetTransform(this.originalTransform),e.queueRerender()}description(e,r){return this.newAutoresize!==this.originalAutoresize?this.newAutoresize?r.enabledAutoresizeOutputCommand:r.disabledAutoresizeOutputCommand:r.resizeOutputCommand(this.newExportRect)}serializeToJSON(){return{originalSize:this.originalSize.xy,originalTransform:this.originalTransform.toArray(),newRegion:{x:this.newExportRect.x,y:this.newExportRect.y,w:this.newExportRect.w,h:this.newExportRect.h},autoresize:this.newAutoresize,originalAutoresize:this.originalAutoresize}}static{let e=this.commandId;K.register(e,(r,n)=>{et(r.originalSize.x),et(r.originalSize.y),dt(r.originalTransform),dt([r.newRegion.x,r.newRegion.y,r.newRegion.w,r.newRegion.h]),Bn(r.autoresize??!1),Bn(r.originalAutoresize??!1);let i=T.ofXY(r.originalSize),a=new k(...r.originalTransform),l=new R(r.newRegion.x,r.newRegion.y,r.newRegion.w,r.newRegion.h),c=r.autoresize??!1,d=r.originalAutoresize??!1;return new s.SetImportExportRectCommand(i,a,d,l,c)})}}}},An=(s,o)=>{let e=0;if(o){for(let r=s.length-1;r>=1;r--)if(s[r].getBBox().containsRect(o)&&s[r].getContent()?.occludesEverythingBelowWhenRenderedInRect(o)){e=r;break}}return e},Ro=class s{constructor(o=null){this.parent=o;this.targetChildCount=30;this.children=[],this.bbox=R.empty,this.content=null,this.id=s.idCounter++}static{this.idCounter=0}getId(){return this.id}onContentChange(){this.id=s.idCounter++}getContent(){return this.content}getParent(){return this.parent}getChildrenIntersectingRegion(o,e){return this.children.filter(r=>{let n=r.getBBox();return!e?.(n)&&n.intersects(o)})}getChildrenOrSelfIntersectingRegion(o,e){return this.content&&this.bbox.intersects(o)&&!e?.(this.bbox)?[this]:this.getChildrenIntersectingRegion(o,e)}getLeavesIntersectingRegion(o,e){let r=[],n=[];for(n.push(this);n.length>0;){let a=n.pop().getChildrenOrSelfIntersectingRegion(o,e);for(let l of a)l.content?r.push(l):n.push(l)}return r}getChildWithContent(o){let e=this.getLeavesIntersectingRegion(o.getBBox());for(let r of e)if(r.getContent()===o)return r;return null}getLeaves(){if(this.content)return[this];let o=[];for(let e of this.children)o.push(...e.getLeaves());return o}addLeaf(o){if(this.onContentChange(),this.content===null&&this.children.length===0)return this.content=o,this.recomputeBBox(!0),this;if(this.content!==null){console.assert(this.children.length===0);let i=new s(this);i.content=this.content,this.content=null,this.children.push(i),i.recomputeBBox(!1)}let e=o.getBBox();if(e.containsRect(this.getBBox())){let i=new s(this);if(this.children.length<this.targetChildCount)this.children.push(i);else{let a=new s(this);a.children=this.children,this.children=[i,a],a.updateParents(),a.recomputeBBox(!0)}return i.addLeaf(o)}let r=this.children.filter(i=>i.getBBox().containsRect(e));if(r.length>0&&this.children.length>=this.targetChildCount){r.sort((a,l)=>a.getBBox().area-l.getBBox().area);let i=r[0].addLeaf(o);return i.rebalance(),i}let n=s.createLeafNode(this,o);return this.children.push(n),n.recomputeBBox(!0),this.children.length>=this.targetChildCount&&this.rebalance(),n}static createLeafNode(o,e){let r=new s(o);return r.content=e,r}getBBox(){return this.bbox}recomputeBBox(o){let e=this.bbox;this.content!==null?this.bbox=this.content.getBBox():this.bbox=R.union(...this.children.map(r=>r.getBBox())),o&&!e.eq(this.bbox)&&(this.bbox.containsRect(e)?this.parent?.unionBBoxWith(this.bbox):this.parent?.recomputeBBox(!0)),this.checkRep()}unionBBoxWith(o){this.bbox=this.bbox.union(o),this.parent?.unionBBoxWith(o)}updateParents(o=!1){for(let e of this.children)e.parent=this,o&&e.updateParents(o)}rebalance(){if(this.parent&&this.parent.children.length===1){console.assert(this.parent.content===null),console.assert(this.parent.children[0]===this);let o=this.parent;if(o.parent!==null){let e=o.parent;e.children=e.children.filter(r=>r!==o),o.parent=null,o.children=[],this.parent=e,e.children.push(this),this.parent.recomputeBBox(!1)}else this.content===null&&(this.parent.children=this.children,this.parent.updateParents(),this.parent=null)}if(this.children.length>this.targetChildCount*10){let o=this.getBBox().divideIntoGrid(4,4),e=[];for(;e.length<o.length;)e.push(0);for(let a of this.children)for(let l=0;l<o.length;l++)o[l].containsRect(a.getBBox())&&e[l]++;let r=0,n=e[0];for(let a=1;a<e.length;a++)e[a]>n&&(r=a,n=e[a]);let i=o[r];if(n>4){let a=[],l=[];for(let c of this.children)i.containsRect(c.getBBox())?l.push(c):a.push(c);if(l.length<this.children.length){this.children=a;let c=new s(this);this.children.push(c),c.children=l,c.updateParents(!1),c.recomputeBBox(!1),c.rebalance()}}}this.parent&&this.children.length===0&&this.content===null&&this.remove()}removeChild(o){this.checkRep();let e=this.children.length;this.children=this.children.filter(r=>r!==o),console.assert(this.children.length===e-1,`${e-1} \u2260 ${this.children.length} after removing all nodes equal to ${o}. Nodes should only be removed once.`),this.children.forEach(r=>{r.rebalance()}),this.recomputeBBox(!0),this.rebalance(),this.checkRep()}remove(){if(this.content?.onRemoveFromImage(),!this.parent){this.content=null,this.children=[];return}this.parent.removeChild(this),this.parent=null,this.content=null,this.children=[],this.checkRep()}async renderAllAsync(o,e){let r=this.getLeaves();Pt(r);let n=r.length;for(let i=0;i<n;i++){let l=r[i].getContent();if(!l)continue;if(!await e(l,i,n))return!1;l.render(o,void 0)}return!0}render(o,e){let r;e?r=this.getLeavesIntersectingRegion(e,i=>o.isTooSmallToRender(i)):r=this.getLeaves(),Pt(r);let n=An(r);for(let i=n;i<r.length;i++)r[i].getContent().render(o,e);Er&&e&&(n!==0&&console.log("EditorImage: skipped ",n,"nodes due to occlusion"),this.renderDebugBoundingBoxes(o,e))}renderDebugBoundingBoxes(o,e,r=0){let n=this.getBBox(),i=1/(o.getSizeOfCanvasPixelOnScreen()||1);if(n.maxDimension<3*i||!n.intersects(e))return;o.startObject(n);let a=!!this.content,l=a?M.ofRGBA(1,0,1,.4):M.ofRGBA(0,1,Math.sin(r),.6),c=a?1*i:2*i;if(o.drawRect(n.intersection(e),c,{fill:l}),o.endObject(),n.maxDimension>e.maxDimension/3){let d={fontFamily:"monospace",size:n.minDimension/20,renderingStyle:{fill:M.red}};o.drawText(`Depth: ${r}`,k.translation(n.bottomLeft),d)}for(let d of this.children)d.renderDebugBoundingBoxes(o,e,r+1)}checkRep(o=0){if(Er){if(this.parent&&!this.parent.children.includes(this))throw new Error(`Parent does not have this node as a child. (depth: ${o})`);let e=null,r=new Set;for(let i of this.children){if(e??=i.getBBox(),e=e.union(i.getBBox()),i.parent!==this)throw new Error(`Child with bbox ${i.getBBox()} and ${i.children.length} has wrong parent (was ${i.parent}).`);if(r.has(i))throw new Error(`Child ${i} is present twice or more in its parent's child list`);r.add(i)}let n=this.bbox.minDimension/100;if(e&&!this.bbox.eq(e,n))throw new Error(`Wrong bounding box ${e} \\neq ${this.bbox} (depth: ${o})`)}}},Pr=class extends Ro{constructor(){super(...arguments);this.fullscreenChildren=[];this.dataComponents=[]}getChildrenIntersectingRegion(e,r){let n=super.getChildrenIntersectingRegion(e);for(let i of this.fullscreenChildren)n.push(i);return n}getChildrenOrSelfIntersectingRegion(e,r){let n=this.getContent();return n&&n.getSizingMode()===1?[this]:super.getChildrenOrSelfIntersectingRegion(e,r)}getLeaves(){let e=super.getLeaves();return this.dataComponents.concat(this.fullscreenChildren,e)}removeChild(e){let r=!1,n=i=>{let a=i===e;return r||=a,!a};this.dataComponents=this.dataComponents.filter(n),this.fullscreenChildren=this.fullscreenChildren.filter(n),r||super.removeChild(e)}getChildWithContent(e){let r=()=>{let n=this.fullscreenChildren.concat(this.dataComponents);for(let i of n)if(i.getContent()===e)return i;return null};return e.getSizingMode()===0?super.getChildWithContent(e)??r():super.getChildWithContent(e)??r()}addLeaf(e){let r=e.getSizingMode();if(r===0)return super.addLeaf(e);if(r===1){this.onContentChange();let n=Ro.createLeafNode(this,e);return this.fullscreenChildren.push(n),n}else if(r===2){this.onContentChange();let n=Ro.createLeafNode(this,e);return this.dataComponents.push(n),n}else{let n=r;throw new Error(`Invalid sizing mode, ${r}`)}}};var Ue=class s{constructor(o,e,r,n,i,a,l,c){this.screenPos=o;this.canvasPos=e;this.pressure=r;this.isPrimary=n;this.down=i;this.device=a;this.id=l;this.timeStamp=c}snappedToGrid(o){let e=o.snapToGrid(this.canvasPos);return this.withCanvasPosition(e,o)}lockedToXYAxesScreen(o,e){let n=this.screenPos.minus(o),i=T.unitX.times(n.x),a=T.unitY.times(n.y),l;return n.dot(i)>n.dot(a)?l=i:l=a,l=l.plus(o),this.withScreenPosition(l,e)}withScreenPosition(o,e){let r=e.screenToCanvas(o);return this.withCanvasPosition(r,e)}withTimestamp(o){return new s(this.screenPos,this.canvasPos,this.pressure,this.isPrimary,this.down,this.device,this.id,o)}withCanvasPosition(o,e){let r=e.canvasToScreen(o);return new s(r,o,this.pressure,this.isPrimary,this.down,this.device,this.id,this.timeStamp)}static ofEvent(o,e,r,n){let i=T.of(o.clientX,o.clientY);if(n){let u=n.getBoundingClientRect();i=i.minus(T.of(u.left,u.top))}let l={mouse:3,pen:0,touch:2}[o.pointerType]??5;l===0&&(o.buttons&32)!==0&&(l=1);let d=o.timeStamp,p=r.roundPoint(r.screenToCanvas(i));return l===3&&o.buttons&2&&(l=4),new s(i,p,o.pressure??null,o.isPrimary,e,l,o.pointerId,d)}static ofCanvasPoint(o,e,r,n=0,i=0,a=!0,l=null,c=null){let d=r.canvasToScreen(o);return c??=performance.now(),new s(d,o,l,a,e,i,n,c)}static ofScreenPoint(o,e,r,n=0,i=0,a=!0,l=null,c=null){let d=r.screenToCanvas(o);return c??=performance.now(),new s(o,d,l,a,e,i,n,c)}};var Fl=()=>new Promise(s=>{requestAnimationFrame(()=>s())}),tt=Fl;var ms=(s,o)=>({kind:s,key:o.key,code:o.code,ctrlKey:o.ctrlKey||o.metaKey,altKey:o.altKey,shiftKey:o.shiftKey}),kr=s=>ms(6,s),Lr=s=>ms(5,s),zo=s=>s.kind===0||s.kind===1||s.kind===2;var fs={remove(){}},Hl=()=>fs,Y=class s{waitForNextUpdate(){return new Promise(o=>{let e=this.onUpdate(r=>{e.remove(),o(r)})})}static fromInitialValue(o){return new Ir(o)}static fromImmutable(o){return{get:()=>o,onUpdate:Hl,onUpdateAndNow:e=>(e(o),fs),waitForNextUpdate:()=>new Promise(()=>{})}}static fromCallback(o,e){let r=new Ir(o()),n=typeof WeakRef<"u"?new WeakRef(r):{deref:()=>r};for(let i of e){let a=i.onUpdate(()=>{let l=n.deref();l?l.set(o()):a.remove()})}return r}static map(o,e,r){let n=s.fromInitialValue(e(o.get())),i=n.get();return o.onUpdate(a=>{i=e(a),n.set(i)}),r&&n.onUpdate(a=>{a!==i&&o.set(r(a))}),n}static union(o){return s.fromCallback(()=>o.map(e=>e.get()),o)}},de=class extends Y{static fromProperty(o,e){let r=Y.fromInitialValue(o.get()[e]),n=typeof WeakRef<"u"?new WeakRef(r):{deref:()=>r},i=o.onUpdate(a=>{let l=n.deref();l?l.set(a[e]):i.remove()});return r.onUpdate(a=>{o.set({...o.get(),[e]:a})}),r}},Ir=class extends de{#e;#t;constructor(o){super(),this.#e=o,this.#t=[]}set(o){if(this.#e!==o){this.#e=o;for(let e of this.#t)e(o)}}get(){return this.#e}onUpdate(o){return this.#t.push(o),{remove:()=>{this.#t=this.#t.filter(e=>e!==o)}}}onUpdateAndNow(o){return o(this.get()),this.onUpdate(o)}},Rr=Y;var _=class{constructor(o,e){this.notifier=o;this.description=e;this.#e=Y.fromInitialValue(!0),this.#e.onUpdate(r=>{r?(this.#t?.notifyEnabled(this),this.notifier.dispatch(0,{kind:0,tool:this})):this.notifier.dispatch(1,{kind:1,tool:this})})}#e;#t=null;#o=null;#r=null;canReceiveInputInReadOnlyEditor(){return!1}setInputMapper(o){this.#o=o,o&&o.setEmitListener(e=>this.dispatchEventToCallback(e))}getInputMapper(){return this.#o}dispatchEventToCallback(o){let e;switch(o.kind){case 0:return this.onPointerDown(o);case 1:this.onPointerMove(o);break;case 2:return this.onPointerUp(o)??!1;case 3:this.onGestureCancel(o);break;case 4:return this.onWheel(o);case 5:return this.onKeyPress(o);case 6:return this.onKeyUp(o);case 7:return this.onCopy(o);case 8:return this.onPaste(o);case 9:return this.onContextMenu(o);default:return e=o,e}return!0}onEvent(o){return this.#o?this.#o.onEvent(o):this.dispatchEventToCallback(o)}onPointerDown(o){return!1}onPointerMove(o){}onPointerUp(o){}onGestureCancel(o){}onWheel(o){return!1}onCopy(o){return!1}onPaste(o){return!1}onKeyPress(o){return!1}onKeyUp(o){return!1}onContextMenu(o){return!1}eventCanBeDeliveredToNonActiveTool(o){return!0}setEnabled(o){this.#e.set(o)}isEnabled(){return this.#e.get()}enabledValue(){return this.#e}setToolGroup(o){this.isEnabled()&&o.notifyEnabled(this),this.#t=o}getToolGroup(){return this.#t?this.#t:null}onDestroy(){this.#r?.remove(),this.#r=null,this.#t=null}};var gs={updatedViewport:"Transformed Viewport",transformedElements:(s,o)=>`Transformed ${s} element${s===1?"":"s"} (${o})`,resizeOutputCommand:s=>`Resized image to ${s.w}x${s.h}`,enabledAutoresizeOutputCommand:"Enabled output autoresize",disabledAutoresizeOutputCommand:"Disabled output autoresize",addComponentAction:s=>`Added ${s}`,eraseAction:(s,o)=>`Erased ${o} ${s}`,duplicateAction:(s,o)=>`Duplicated ${o} ${s}`,unionOf:(s,o)=>`Union: ${o} ${s}`,inverseOf:s=>`Inverse of ${s}`,elements:"Elements",erasedNoElements:"Erased nothing",duplicatedNoElements:"Duplicated nothing",rotatedBy:s=>`Rotated by ${Math.abs(s)} degrees ${s<0?"clockwise":"counter-clockwise"}`,movedLeft:"Moved left",movedUp:"Moved up",movedDown:"Moved down",movedRight:"Moved right",zoomedOut:"Zoomed out",zoomedIn:"Zoomed in",andNMoreCommands:s=>`And ${s} more commands.`,selectedElements:s=>`Selected ${s} element${s===1?"":"s"}`};var bs={unlabeledImageNode:"Unlabeled image node",stroke:"Stroke",svgObject:"SVG Object",emptyBackground:"Empty background",gridBackground:"Grid background",filledBackgroundWithColor:s=>`Filled background (${s})`,text:s=>`Text object: ${s}`,imageNode:s=>`Image: ${s}`,restyledElement:s=>`Restyled ${s}`};var vs={pathNodeCount:s=>`There are ${s} visible path objects.`,textNodeCount:s=>`There are ${s} visible text nodes.`,imageNodeCount:s=>`There are ${s} visible image nodes.`,textNode:s=>`Text: ${s}`,imageNode:s=>`Image: ${s}`,unlabeledImageNode:"Unlabeled image",rerenderAsText:"Re-render as text"};var ys={help:"Help",helpHidden:"Help hidden",next:"Next",previous:"Previous",close:"Close",helpScreenNavigationHelp:"Click on a control for more information.",helpControlsAccessibilityLabel:"Controls: Activate a control to show help."};var xs={...ys,pen:"Pen",eraser:"Eraser",select:"Select",handTool:"Pan",zoom:"Zoom",image:"Image",reformatSelection:"Format selection",inputAltText:"Alt text",decreaseImageSize:"Decrease size",resetImage:"Reset",chooseFile:"Choose file",dragAndDropHereOrBrowse:`Drag and drop here
or
{{browse}}`,submit:"Submit",addAll:"Add all",cancel:"Cancel",resetView:"Reset view",thicknessLabel:"Thickness",colorLabel:"Color",fontLabel:"Font",textSize:"Size",resizeImageToSelection:"Resize image to selection",deleteSelection:"Delete selection",duplicateSelection:"Duplicate selection",exit:"Exit",save:"Save",undo:"Undo",redo:"Redo",fullStrokeEraser:"Full stroke eraser",selectPenType:"Pen type",selectShape:"Shape",pickColorFromScreen:"Pick color from screen",clickToPickColorAnnouncement:"Click on the screen to pick a color",colorSelectionCanceledAnnouncement:"Color selection canceled",selectionTool__lassoSelect:"Freeform selection",selectionTool__lassoSelect__help:"When enabled, dragging creates a freeform (lasso) selection.",selectionToolKeyboardShortcuts:"Selection tool: Use arrow keys to move selected items, lowercase/uppercase \u2018i\u2019 and \u2018o\u2019 to resize.",documentProperties:"Page",backgroundColor:"Background color",imageWidthOption:"Width",imageHeightOption:"Height",useGridOption:"Grid",enableAutoresizeOption:"Auto-resize",toggleOverflow:"More",about:"About",inputStabilization:"Stabilization",strokeAutocorrect:"Autocorrect",pressureSensitivity:"Pressure",touchPanning:"Scroll with touch",roundedTipPen:"Round",roundedTipPen2:"Polyline",flatTipPen:"Flat",arrowPen:"Arrow",linePen:"Line",outlinedRectanglePen:"Outlined rectangle",filledRectanglePen:"Filled rectangle",outlinedCirclePen:"Outlined circle",lockRotation:"Lock rotation",paste:"Paste",errorImageHasZeroSize:"Error: Image has zero size",describeTheImage:"Image description",fileInput__loading:"Loading...",fileInput__andNMoreFiles:s=>`(...${s} more)`,penDropdown__baseHelpText:"This tool draws shapes or freehand lines.",penDropdown__colorHelpText:"Changes the pen's color",penDropdown__thicknessHelpText:"Changes the thickness of strokes drawn by the pen.",penDropdown__penTypeHelpText:`Changes the pen style.

Either a \u201Cpen\u201D style or \u201Cshape\u201D can be chosen. Choosing a \u201Cpen\u201D style draws freehand lines. Choosing a \u201Cshape\u201D draws shapes.`,penDropdown__autocorrectHelpText:`Converts approximate freehand lines and rectangles to perfect ones.

The pen must be held stationary at the end of a stroke to trigger a correction.`,penDropdown__stabilizationHelpText:`Draws smoother strokes.

This also adds a short delay between the mouse/stylus and the stroke.`,penDropdown__pressureSensitivityHelpText:"Changes the thickness of strokes according to how hard you press, when using a compatible device like a stylus.",handDropdown__baseHelpText:"This tool is responsible for scrolling, rotating, and zooming the editor.",handDropdown__zoomInHelpText:"Zooms in.",handDropdown__zoomOutHelpText:"Zooms out.",handDropdown__resetViewHelpText:"Resets the zoom level to 100% and resets scroll.",handDropdown__zoomDisplayHelpText:"Shows the current zoom level. 100% shows the image at its actual size.",handDropdown__touchPanningHelpText:"When enabled, touchscreen gestures move the image rather than select or draw.",handDropdown__lockRotationHelpText:"When enabled, prevents touch gestures from rotating the screen.",eraserDropdown__baseHelpText:"This tool removes strokes, images, and text under the cursor.",eraserDropdown__thicknessHelpText:"Changes the size of the eraser.",eraserDropdown__fullStrokeEraserHelpText:`When in full-stroke mode, entire shapes are erased.

When not in full-stroke mode, shapes can be partially erased.`,selectionDropdown__baseHelpText:"Selects content and manipulates the selection",selectionDropdown__resizeToHelpText:`Crops the drawing to the size of what's currently selected.

If auto-resize is enabled, it will be disabled.`,selectionDropdown__deleteHelpText:"Erases selected items.",selectionDropdown__duplicateHelpText:"Makes a copy of selected items.",selectionDropdown__changeColorHelpText:"Changes the color of selected items.",pageDropdown__baseHelpText:"Controls the drawing canvas' background color, pattern, and size.",pageDropdown__backgroundColorHelpText:"Changes the background color of the drawing canvas.",pageDropdown__gridCheckboxHelpText:"Enables/disables a background grid pattern.",pageDropdown__autoresizeCheckboxHelpText:`When checked, the page grows to fit the drawing.

When unchecked, the page is visible and its size can be set manually.`,pageDropdown__aboutButtonHelpText:"Shows version, debug, and other information.",colorPickerPipetteHelpText:"Picks a color from the screen.",colorPickerToggleHelpText:"Opens/closes the color picker.",closeSidebar:s=>`Close sidebar for ${s}`,dropdownShown:s=>`Menu for ${s} shown`,dropdownHidden:s=>`Menu for ${s} hidden`,zoomLevel:s=>`Zoom: ${s}%`,colorChangedAnnouncement:s=>`Color changed to ${s}`,imageSize:(s,o)=>`Image size: ${s} ${o}`,imageLoadError:s=>`Error loading image: ${s}`};var ws={penTool:s=>`Pen ${s}`,selectionTool:"Selection",selectAllTool:"Select all shortcut",eraserTool:"Eraser",touchPanTool:"Touch panning",twoFingerPanZoomTool:"Panning and zooming",undoRedoTool:"Undo/Redo",rightClickDragPanTool:"Right-click drag",pipetteTool:"Pick color from screen",keyboardPanZoom:"Keyboard pan/zoom shortcuts",selectionMenu__show:"Show selection menu",selectionMenu__copyToClipboard:"Copy to clipboard",selectionMenu__duplicate:"Duplicate",selectionMenu__delete:"Delete",selectionMenu__paste:"Paste",copyPasteError__heading:"Copy/paste",copyPasteError__description:"Something went wrong \u2014 this tool may not have clipboard access.",copyPasteError__errorDetails:"Show error",copyPasteError__pasteRetry:"To retry, please paste into the input box below:",copyPasteError__copyRetry:"To retry, please copy the text in the input box below:",copyPasteError__copyMe:"Copy me!",autocorrectedTo:s=>`Autocorrected to ${s}`,autocorrectionCanceled:"Autocorrect cancelled",textTool:"Text",enterTextToInsert:"Text to insert",changeTool:"Change tool",pasteHandler:"Copy paste handler",soundExplorer:"Sound-based image exploration",disableAccessibilityExploreTool:"Disable sound-based exploration",enableAccessibilityExploreTool:"Enable sound-based exploration",soundExplorerUsageAnnouncement:"Sound-based image exploration enabled: Click/drag the screen to play a sound representation of different parts of the image.",findLabel:"Find",toNextMatch:"Next",closeDialog:"Close",findDialogShown:"Find dialog shown",findDialogHidden:"Find dialog hidden",focusedFoundText:(s,o)=>`Viewing match ${s} of ${o}`,anyDevicePanning:"Any device panning",copied:s=>`Copied ${s} item(s)`,pasted:s=>`Pasted ${s} item(s)`,toolEnabledAnnouncement:s=>`${s} enabled`,toolDisabledAnnouncement:s=>`${s} disabled`};var De={...xs,...ws,...gs,...bs,...vs,accessibilityInputInstructions:['Press "t" to read the contents of the viewport as text.',"Use the arrow keys to move the viewport, click and drag to draw strokes.",'Press "w" to zoom in and "s" to zoom out.'].join(" "),loading:s=>`Loading ${s}%...`,imageEditor:"Image Editor",doneLoading:"Done loading",undoAnnouncement:s=>`Undid ${s}`,redoAnnouncement:s=>`Redid ${s}`,softwareLibraries:"Libraries",developerInformation:"Developer information"};var Nl={...De,help:"\u5E2E\u52A9",helpHidden:"\u5E2E\u52A9\u5DF2\u9690\u85CF",next:"\u4E0B\u4E00\u9875",previous:"\u4E0A\u4E00\u9875",close:"\u5173\u95ED",helpScreenNavigationHelp:"\u70B9\u51FB\u63A7\u4EF6\u67E5\u770B\u66F4\u591A\u4FE1\u606F\u3002",helpControlsAccessibilityLabel:"\u63A7\u4EF6\uFF1A\u6FC0\u6D3B\u63A7\u4EF6\u4EE5\u663E\u793A\u5E2E\u52A9\u3002",pen:"\u753B\u7B14",eraser:"\u6A61\u76AE\u64E6",select:"\u9009\u62E9",handTool:"\u5E73\u79FB",zoom:"\u7F29\u653E",image:"\u56FE\u7247",reformatSelection:"\u683C\u5F0F\u5316\u9009\u533A",inputAltText:"\u66FF\u4EE3\u6587\u672C",decreaseImageSize:"\u51CF\u5C0F\u5C3A\u5BF8",resetImage:"\u91CD\u7F6E",chooseFile:"\u9009\u62E9\u6587\u4EF6",dragAndDropHereOrBrowse:"\u5C06\u6587\u4EF6\u62D6\u62FD\u5230\u6B64\u5904\u6216{{\u6D4F\u89C8}}",submit:"\u63D0\u4EA4",addAll:"\u5168\u90E8\u6DFB\u52A0",cancel:"\u53D6\u6D88",resetView:"\u91CD\u7F6E\u89C6\u56FE",thicknessLabel:"\u7C97\u7EC6",colorLabel:"\u989C\u8272",fontLabel:"\u5B57\u4F53",textSize:"\u5B57\u53F7",resizeImageToSelection:"\u6309\u9009\u533A\u8C03\u6574\u56FE\u7247\u5927\u5C0F",deleteSelection:"\u5220\u9664\u9009\u533A",duplicateSelection:"\u590D\u5236\u9009\u533A",exit:"\u9000\u51FA",save:"\u4FDD\u5B58",undo:"\u64A4\u9500",redo:"\u91CD\u505A",fullStrokeEraser:"\u5168\u7B14\u5212\u6A61\u76AE\u64E6",selectPenType:"\u5DE5\u5177\u7C7B\u578B",selectShape:"\u5F62\u72B6",pickColorFromScreen:"\u4ECE\u5C4F\u5E55\u53D6\u8272",clickToPickColorAnnouncement:"\u70B9\u51FB\u5C4F\u5E55\u4EE5\u9009\u53D6\u989C\u8272",colorSelectionCanceledAnnouncement:"\u989C\u8272\u9009\u62E9\u5DF2\u53D6\u6D88",selectionTool__lassoSelect:"\u81EA\u7531\u9009\u533A",selectionTool__lassoSelect__help:"\u542F\u7528\u540E\uFF0C\u62D6\u62FD\u5C06\u521B\u5EFA\u81EA\u7531\u5F62\u5F0F\uFF08\u5957\u7D22\uFF09\u9009\u533A\u3002",selectionToolKeyboardShortcuts:"\u9009\u62E9\u5DE5\u5177\uFF1A\u4F7F\u7528\u65B9\u5411\u952E\u79FB\u52A8\u6240\u9009\u9879\u76EE\uFF0C\u4F7F\u7528\u5C0F\u5199/\u5927\u5199 \u201Ci\u201D \u548C \u201Co\u201D \u8C03\u6574\u5927\u5C0F\u3002",documentProperties:"\u9875\u9762",backgroundColor:"\u80CC\u666F\u8272",imageWidthOption:"\u5BBD\u5EA6",imageHeightOption:"\u9AD8\u5EA6",useGridOption:"\u7F51\u683C",enableAutoresizeOption:"\u81EA\u52A8\u8C03\u6574\u5927\u5C0F",toggleOverflow:"\u66F4\u591A",about:"\u5173\u4E8E",inputStabilization:"\u7A33\u5B9A",strokeAutocorrect:"\u81EA\u52A8\u66F4\u6B63",pressureSensitivity:"\u538B\u529B",touchPanning:"\u89E6\u5C4F\u5E73\u79FB",roundedTipPen:"\u81EA\u7531\u753B\u7B14",roundedTipPen2:"\u6298\u7EBF",flatTipPen:"\u5E73\u5934\u7B14",arrowPen:"\u7BAD\u5934",linePen:"\u76F4\u7EBF",outlinedRectanglePen:"\u7A7A\u5FC3\u77E9\u5F62",filledRectanglePen:"\u5B9E\u5FC3\u77E9\u5F62",outlinedCirclePen:"\u7A7A\u5FC3\u5706",lockRotation:"\u9501\u5B9A\u65CB\u8F6C",paste:"\u7C98v\u8D34",errorImageHasZeroSize:"\u9519\u8BEF\uFF1A\u56FE\u7247\u5C3A\u5BF8\u4E3A\u96F6",describeTheImage:"\u56FE\u50CF\u63CF\u8FF0",fileInput__loading:"\u52A0\u8F7D\u4E2D...",fileInput__andNMoreFiles:s=>`(\u8FD8\u6709 ${s} \u4E2A)`,closeSidebar:s=>`\u5173\u95ED ${s} \u7684\u4FA7\u8FB9\u680F`,dropdownShown:s=>`\u5DF2\u663E\u793A ${s} \u4E0B\u62C9\u83DC\u5355`,dropdownHidden:s=>`\u5DF2\u9690\u85CF ${s} \u4E0B\u62C9\u83DC\u5355`,zoomLevel:s=>`\u7F29\u653E\uFF1A${s}%`,colorChangedAnnouncement:s=>`\u989C\u8272\u5DF2\u66F4\u6539\u4E3A ${s}`,imageSize:(s,o)=>`\u56FE\u7247\u5C3A\u5BF8\uFF1A${s} ${o}`,imageLoadError:s=>`\u56FE\u7247\u52A0\u8F7D\u9519\u8BEF\uFF1A${s}`,penTool:s=>`\u753B\u7B14 ${s}`,selectionTool:"\u9009\u62E9\u5DE5\u5177",selectAllTool:"\u5168\u9009",eraserTool:"\u6A61\u76AE\u64E6\u5DE5\u5177",touchPanTool:"\u89E6\u5C4F\u5E73\u79FB\u5DE5\u5177",twoFingerPanZoomTool:"\u53CC\u6307\u5E73\u79FB\u4E0E\u7F29\u653E",undoRedoTool:"\u64A4\u9500/\u91CD\u505A\u5DE5\u5177",rightClickDragPanTool:"\u53F3\u952E\u62D6\u62FD",pipetteTool:"\u53D6\u8272\u5668",keyboardPanZoom:"\u952E\u76D8\u5E73\u79FB\u4E0E\u7F29\u653E\u5FEB\u6377\u952E",selectionMenu__show:"\u663E\u793A\u9009\u62E9\u83DC\u5355",selectionMenu__copyToClipboard:"\u590D\u5236\u5230\u526A\u8D34\u677F",selectionMenu__duplicate:"\u590D\u5236",selectionMenu__delete:"\u5220\u9664",selectionMenu__paste:"\u7C98\u8D34",copyPasteError__heading:"\u590D\u5236/\u7C98\u8D34",copyPasteError__description:"\u51FA\u9519\u4E86\u2014\u2014\u6B64\u5DE5\u5177\u53EF\u80FD\u65E0\u6CD5\u8BBF\u95EE\u526A\u8D34\u677F\u3002",copyPasteError__errorDetails:"\u663E\u793A\u9519\u8BEF",copyPasteError__pasteRetry:"\u8BF7\u91CD\u8BD5\uFF1A\u5728\u4E0B\u65B9\u8F93\u5165\u6846\u4E2D\u7C98\u8D34\uFF1A",copyPasteError__copyRetry:"\u8BF7\u91CD\u8BD5\uFF1A\u5728\u4E0B\u65B9\u8F93\u5165\u6846\u4E2D\u590D\u5236\u6587\u672C\uFF1A",copyPasteError__copyMe:"\u70B9\u6211\u590D\u5236\uFF01",autocorrectedTo:s=>`\u5DF2\u81EA\u52A8\u66F4\u6B63\u4E3A ${s}`,autocorrectionCanceled:"\u81EA\u52A8\u66F4\u6B63\u5DF2\u53D6\u6D88",textTool:"\u6587\u672C\u5DE5\u5177",enterTextToInsert:"\u8F93\u5165\u8981\u63D2\u5165\u7684\u6587\u672C",changeTool:"\u5207\u6362\u5DE5\u5177",pasteHandler:"\u590D\u5236\u7C98\u8D34\u5904\u7406\u5668",soundExplorer:"\u58F0\u97F3\u63A2\u7D22",disableAccessibilityExploreTool:"\u5173\u95ED\u58F0\u97F3\u63A2\u7D22",enableAccessibilityExploreTool:"\u5F00\u542F\u58F0\u97F3\u63A2\u7D22",soundExplorerUsageAnnouncement:"\u5DF2\u542F\u7528\u58F0\u97F3\u56FE\u50CF\u63A2\u7D22\uFF1A\u70B9\u51FB\u6216\u62D6\u62FD\u5C4F\u5E55\uFF0C\u5373\u53EF\u901A\u8FC7\u58F0\u97F3\u611F\u53D7\u56FE\u50CF\u4E0D\u540C\u533A\u57DF\u3002",findLabel:"\u67E5\u627E",toNextMatch:"\u4E0B\u4E00\u4E2A",closeDialog:"\u5173\u95ED",findDialogShown:"\u5DF2\u663E\u793A\u67E5\u627E\u5BF9\u8BDD\u6846",findDialogHidden:"\u5DF2\u9690\u85CF\u67E5\u627E\u5BF9\u8BDD\u6846",focusedFoundText:(s,o)=>`\u7B2C ${s} \u6761\u7ED3\u679C\uFF0C\u5171 ${o} \u6761`,anyDevicePanning:"\u4EFB\u610F\u8BBE\u5907\u5E73\u79FB",copied:s=>`\u5DF2\u590D\u5236 ${s} \u4E2A\u9879\u76EE`,pasted:s=>`\u5DF2\u7C98\u8D34 ${s} \u4E2A\u9879\u76EE`,toolEnabledAnnouncement:s=>`${s} \u5DF2\u542F\u7528`,toolDisabledAnnouncement:s=>`${s} \u5DF2\u7981\u7528`,updatedViewport:"\u5DF2\u66F4\u65B0\u89C6\u53E3",transformedElements:(s,o)=>`${s} \u4E2A\u5143\u7D20\u5DF2\u53D8\u6362 (${o})`,resizeOutputCommand:s=>`\u56FE\u7247\u5C3A\u5BF8\u5DF2\u66F4\u6539\u4E3A ${s.w}\xD7${s.h}`,enabledAutoresizeOutputCommand:"\u5DF2\u542F\u7528\u8F93\u51FA\u81EA\u52A8\u8C03\u6574\u5927\u5C0F",disabledAutoresizeOutputCommand:"\u5DF2\u7981\u7528\u8F93\u51FA\u81EA\u52A8\u8C03\u6574\u5927\u5C0F",addComponentAction:s=>`\u5DF2\u6DFB\u52A0 ${s}`,eraseAction:(s,o)=>`\u5DF2\u5220\u9664 ${o} \u4E2A ${s}`,duplicateAction:(s,o)=>`\u5DF2\u590D\u5236 ${o} \u4E2A ${s}`,unionOf:(s,o)=>`\u5408\u5E76\uFF1A${o} \u4E2A ${s}`,inverseOf:s=>`${s} \u5DF2\u53CD\u5411`,elements:"\u5143\u7D20",erasedNoElements:"\u672Av\u5220\u9664\u4EFB\u4F55\u5185\u5BB9",duplicatedNoElements:"\u672A\u590D\u5236\u4EFB\u4F55\u5185\u5BB9",rotatedBy:s=>`\u5DF2\u65CB\u8F6C ${Math.abs(s)} \u5EA6 ${s<0?"\u987A\u65F6\u9488":"\u9006\u65F6\u9488"}`,movedLeft:"\u5DF2\u5411\u5DE6\u79FB\u52A8",movedUp:"\u5DF2\u5411\u4E0A\u79FB\u52A8",movedDown:"\u5DF2\u5411\u4E0B\u79FB\u52A8",movedRight:"\u5DF2\u5411\u53F3\u79FB\u52A8",zoomedOut:"\u5DF2\u7F29\u5C0F",zoomedIn:"\u5DF2\u653E\u5927",andNMoreCommands:s=>`\u8FD8\u6709 ${s} \u6761\u547D\u4EE4\u3002`,selectedElements:s=>`\u5DF2\u9009 ${s} \u4E2A\u5143\u7D20`,unlabeledImageNode:"\u672A\u547D\u540D\u56FE\u7247",stroke:"\u7B14\u753B",svgObject:"SVG \u5BF9\u8C61",emptyBackground:"\u7A7A\u767D\u80CC\u666F",gridBackground:"\u7F51\u683C\u80CC\u666F",filledBackgroundWithColor:s=>`\u5DF2\u586B\u5145\u80CC\u666F\uFF08${s}\uFF09`,text:s=>`\u6587\u672C\u5BF9\u8C61\uFF1A${s}`,imageNode:s=>`\u56FE\u7247\uFF1A${s}`,restyledElement:s=>`\u5DF2\u91CD\u65B0\u6837\u5F0F\u5316 ${s}`,pathNodeCount:s=>`\u53EF\u89C1\u8DEF\u5F84\u5BF9\u8C61\uFF1A${s} \u4E2A`,textNodeCount:s=>`\u53EF\u89C1\u6587\u672C\u8282\u70B9\uFF1A${s} \u4E2A`,imageNodeCount:s=>`\u53EF\u89C1\u56FE\u7247\u8282\u70B9\uFF1A${s} \u4E2A`,textNode:s=>`\u6587\u672C\uFF1A${s}`,rerenderAsText:"\u4EE5\u6587\u672C\u5F62\u5F0F\u91CD\u7ED8",accessibilityInputInstructions:"\u6309\u201Ct\u201D\u5C06\u89C6\u53E3\u5185\u5BB9\u6717\u8BFB\u4E3A\u6587\u672C\u3002\u4F7F\u7528\u65B9\u5411\u952E\u79FB\u52A8\u89C6\u53E3\uFF0C\u70B9\u51FB\u5E76\u62D6\u62FD\u7ED8\u5236\u7B14\u753B\u3002\u6309\u201Cw\u201D\u653E\u5927\uFF0C\u6309\u201Cs\u201D\u7F29\u5C0F\u3002",loading:s=>`\u52A0\u8F7D\u4E2D ${s}%...`,imageEditor:"\u56FE\u7247\u7F16\u8F91\u5668",doneLoading:"\u52A0\u8F7D\u5B8C\u6210",undoAnnouncement:s=>`\u5DF2\u64A4\u9500 ${s}`,redoAnnouncement:s=>`\u5DF2\u91CD\u505A ${s}`,softwareLibraries:"\u8F6F\u4EF6\u5E93",developerInformation:"\u5F00\u53D1\u8005\u4FE1\u606F"},Ts=Nl;var $l={...De,pen:"Stift",eraser:"Radierer",select:"Auswahl",handTool:"Verschieben",zoom:"Vergr\xF6\xDFerung",image:"Bild",inputAltText:"Alt-Text: ",chooseFile:"W\xE4hle Datei: ",submit:"Absenden",cancel:"Abbrechen",resetView:"Ansicht zur\xFCcksetzen",thicknessLabel:"Dicke: ",colorLabel:"Farbe: ",fontLabel:"Schriftart: ",textSize:"Gr\xF6\xDFe: ",resizeImageToSelection:"Bildgr\xF6\xDFe an Auswahl anpassen",deleteSelection:"Auswahl l\xF6schen",duplicateSelection:"Auswahl duplizieren",undo:"R\xFCckg\xE4ngig",redo:"Wiederholen",pickColorFromScreen:"Farbe von Bildschirm ausw\xE4hlen",clickToPickColorAnnouncement:"Klicke auf den Bildschirm, um eine Farbe auszuw\xE4hlen",selectionToolKeyboardShortcuts:"Auswahl-Werkzeug: Verwende die Pfeiltasten, um ausgew\xE4hlte Elemente zu verschieben und \u201Ai\u2018 und \u201Ao\u2018, um ihre Gr\xF6\xDFe zu \xE4ndern.",touchPanning:"Ansicht mit Touchscreen verschieben",anyDevicePanning:"Ansicht mit jedem Eingabeger\xE4t verschieben",selectPenType:"Objekt-Typ: ",roundedTipPen:"Freihand",flatTipPen:"Stift (druckempfindlich)",arrowPen:"Pfeil",linePen:"Linie",outlinedRectanglePen:"Umrissenes Rechteck",filledRectanglePen:"Ausgef\xFClltes Rechteck",lockRotation:"Sperre Rotation",paste:"Einf\xFCgen",dropdownShown:s=>`Dropdown-Men\xFC f\xFCr ${s} angezeigt`,dropdownHidden:s=>`Dropdown-Men\xFC f\xFCr ${s} versteckt`,zoomLevel:s=>`Verg\xF6\xDFerung: ${s}%`,colorChangedAnnouncement:s=>`Farbe zu ${s} ge\xE4ndert`,imageSize:(s,o)=>`Bild-Gr\xF6\xDFe: ${s} ${o}`,imageLoadError:s=>`Fehler beim Laden des Bildes: ${s}`,errorImageHasZeroSize:"Fehler: Bild hat Gr\xF6\xDFe Null",penTool:s=>`Stift ${s}`,selectionTool:"Auswahl",eraserTool:"Radiergummi",touchPanTool:"Ansicht mit Touchscreen verschieben",twoFingerPanZoomTool:"Ansicht verschieben und vergr\xF6\xDFern",undoRedoTool:"R\xFCckg\xE4ngig/Wiederholen",rightClickDragPanTool:"Rechtsklick-Ziehen",pipetteTool:"Farbe von Bildschirm ausw\xE4hlen",keyboardPanZoom:"Tastaturk\xFCrzel zum Verschieben/Vergr\xF6\xDFern der Ansicht",textTool:"Text",enterTextToInsert:"Einzuf\xFCgender Text",changeTool:"Wechsle Werkzeug",pasteHandler:"Copy-Paste-Handler",findLabel:"Finde",toNextMatch:"N\xE4chstes",closeDialog:"Schlie\xDFen",findDialogShown:"Finde-Dialog angezeigt",findDialogHidden:"Finde-Dialog versteckt",focusedFoundText:(s,o)=>`Sieh Treffer ${s} von ${o} an`,toolEnabledAnnouncement:s=>`${s} aktiviert`,toolDisabledAnnouncement:s=>`${s} deaktiviert`,updatedViewport:"Transformierte Ansicht",transformedElements:(s,o)=>`${s} Element${s===1?"":"e"} transformiert (${o})`,resizeOutputCommand:s=>`Bildgr\xF6\xDFe auf ${s.w}x${s.h} ge\xE4ndert`,addComponentAction:s=>`${s} hinzugef\xFCgt`,eraseAction:(s,o)=>`${o} ${s} gel\xF6scht`,duplicateAction:(s,o)=>`${o} ${s} dupliziert`,inverseOf:s=>`${s} umgekehrt`,elements:"Elemente",erasedNoElements:"Nichts entfernt",duplicatedNoElements:"Nichts dupliziert",rotatedBy:s=>`${Math.abs(s)} Grad ${s<0?"im Uhrzeigersinn":"gegen den Uhrzeigersinn"} gedreht`,movedLeft:"Nacht links bewegt",movedUp:"Nacht oben bewegt",movedDown:"Nacht unten bewegt",movedRight:"Nacht rechts bewegt",zoomedOut:"Ansicht verkleinert",zoomedIn:"Ansicht vergr\xF6\xDFert",selectedElements:s=>`${s} Element${s===1?"":"e"} ausgew\xE4hlt`,stroke:"Strich",svgObject:"SVG-Objekt",text:s=>`Text-Objekt: ${s}`,pathNodeCount:s=>`Es gibt ${s} sichtbare Pfad-Objekte.`,textNodeCount:s=>`Es gibt ${s} sichtbare Text-Knotenpunkte.`,textNode:s=>`Text: ${s}`,imageNodeCount:s=>`Es gibt ${s} sichtbare Bild-Knoten.`,imageNode:s=>`Bild: ${s}`,unlabeledImageNode:"Bild ohne Label",rerenderAsText:"Als Text darstellen",accessibilityInputInstructions:"Dr\xFCcke \u201At\u2018, um den Inhalt des Ansichtsfensters als Text zu lesen. Verwende die Pfeiltasten, um die Ansicht zu verschieben, und klicke und ziehe, um Striche zu zeichnen. Dr\xFCcke \u201Aw\u2018 zum Vergr\xF6\xDFern und \u201As\u2018 zum Verkleinern der Ansicht.",loading:s=>`Laden ${s}%...`,doneLoading:"Laden fertig",imageEditor:"Bild-Editor",undoAnnouncement:s=>`${s} r\xFCckg\xE4ngig gemacht`,redoAnnouncement:s=>`${s} wiederholt`,reformatSelection:"Formatiere Auswahl",documentProperties:"Seite",backgroundColor:"Hintergrundfarbe: ",imageWidthOption:"Breite: ",imageHeightOption:"H\xF6he: ",useGridOption:"Gitter: ",toggleOverflow:"Mehr",selectAllTool:"Alle ausw\xE4hlen",soundExplorer:"Klangbasierte Bilderkundung",disableAccessibilityExploreTool:"Deaktiviere klangbasierte Erkundung",enableAccessibilityExploreTool:"Aktiviere klangbasierte Erkundung",unionOf:(s,o)=>`Vereinigung: ${o} ${s}`,emptyBackground:"Leerer Hintergrund",filledBackgroundWithColor:s=>`Gef\xFCllter Hintergrund (${s})`,restyledElement:s=>`${s} umgestaltet`},Ss=$l;var Wl={...De},Cs=Wl;var Ul={...De,pen:"Lapiz",eraser:"Borrador",select:"Selecciona",handTool:"Mover",image:"Imagen",inputAltText:"Texto alternativo",resetImage:"Reiniciar",chooseFile:"Seleccionar archivo",cancel:"Cancelar",resetView:"Reiniciar vista",thicknessLabel:"Tama\xF1o",fontLabel:"Fuente:",textSize:"Tama\xF1o",resizeImageToSelection:"Redimensionar la imagen a lo que est\xE1 seleccionado",deleteSelection:"Borra la selecci\xF3n",duplicateSelection:"Duplica la selecci\xF3n",exit:"Salir",save:"Guardar",undo:"Deshace",redo:"Rehace",selectPenType:"Punta",selectShape:"Forma",pickColorFromScreen:"Selecciona un color de la pantalla",clickToPickColorAnnouncement:"Haga un clic en la pantalla para seleccionar un color",documentProperties:"Fondo",backgroundColor:"Color de fondo",imageWidthOption:"Ancho",imageHeightOption:"Alto",enableAutoresizeOption:"Redimensionar autom\xE1tico",toggleOverflow:"M\xE1s",about:"Acerca de",touchPanning:"Mover la pantalla con un dedo",roundedTipPen:"Lapiz Redondeado",arrowPen:"Flecha",linePen:"L\xEDnea",outlinedRectanglePen:"Rect\xE1ngulo delineado",filledRectanglePen:"Rect\xE1ngulo sin borde",lockRotation:"Bloquea rotaci\xF3n",paste:"Pegar",selectionMenu__paste:"Pegar",selectionMenu__delete:"Eliminar",selectionMenu__duplicate:"Duplicar",closeSidebar:s=>`Close sidebar for ${s}`,dropdownShown:s=>`Men\xFA por ${s} es visible`,dropdownHidden:s=>`Men\xFA por ${s} fue ocultado`,zoomLevel:s=>`Zoom: ${s}%`,colorChangedAnnouncement:s=>`Color fue cambiado a ${s}`,imageSize:(s,o)=>`Tama\xF1o del imagen: ${s} ${o}`,imageLoadError:s=>`Error cargando imagen: ${s}`,penTool:s=>`Lapiz ${s}`,selectionTool:"Selecciona",eraserTool:"Borrador",touchPanTool:"Instrumento de mover la pantalla con un dedo",undoRedoTool:"Deshace/rehace",pipetteTool:"Seleccione un color de la pantalla",keyboardPanZoom:"Mover la pantalla con el teclado",textTool:"Texto",enterTextToInsert:"Entra texto",findLabel:"Buscar",toNextMatch:"Pr\xF3xima",closeDialog:"Cerrar",anyDevicePanning:"Mover la pantalla con todo dispotivo",copied:s=>`${s} cosas fueron copiados`,pasted:s=>s===1?"Pegado":`${s} cosas fueron pegados`,toolEnabledAnnouncement:s=>`${s} fue activado`,toolDisabledAnnouncement:s=>`${s} fue desactivado`,resizeOutputCommand:s=>`Tama\xF1o de imagen fue cambiado a ${s.w}x${s.h}`,eraseAction:(s,o)=>`Borrado: ${o} ${s}`,rerenderAsText:"Redibuja la pantalla al texto",loading:s=>`Cargando: ${s}%...`,imageEditor:"Editor de dibujos",doneLoading:"El cargado termin\xF3",undoAnnouncement:s=>`${s} fue deshecho`,redoAnnouncement:s=>`${s} fue rehecho`},Es=Ul;var ql={...De,help:"Pomoc",helpHidden:"Skryt\xE1 pomoc",next:"\u010Eal\u0161ie",previous:"Prech\xE1dzaj\xFAce",close:"Zavrie\u0165",helpScreenNavigationHelp:"Kliknut\xEDm na ovl\xE1dac\xED prvok z\xEDskate viac inform\xE1ci\xED.",helpControlsAccessibilityLabel:"Ovl\xE1dacie prvky: Aktivujte ovl\xE1dac\xED prvok, ktor\xFD zobraz\xED pomoc.",pen:"Pero",eraser:"Guma",select:"Vybra\u0165",handTool:"Posun",zoom:"Pribl\xED\u017Ei\u0165",image:"Obr\xE1zok",reformatSelection:"V\xFDber form\xE1tu",inputAltText:"Alternat\xEDvny text",decreaseImageSize:"Zmen\u0161i\u0165 ve\u013Ekos\u0165",resetImage:"Obnovi\u0165",chooseFile:"Vybra\u0165 s\xFAbor",dragAndDropHereOrBrowse:"Presu\u0148te sem alebo {{preh\u013Ead\xE1va\u0165}}",submit:"Odosla\u0165",addAll:"Prida\u0165 v\u0161etko",cancel:"Zru\u0161i\u0165",resetView:"Obnovi\u0165 zobrazenie",thicknessLabel:"Hr\xFAbka",colorLabel:"Farba",fontLabel:"P\xEDsmo",textSize:"Ve\u013Ekos\u0165",resizeImageToSelection:"Zmena ve\u013Ekosti obr\xE1zka pod\u013Ea v\xFDberu",deleteSelection:"Vymaza\u0165 v\xFDber",duplicateSelection:"Duplikova\u0165 v\xFDber",exit:"Ukon\u010Di\u0165",save:"Ulo\u017Ei\u0165",undo:"Sp\xE4\u0165",redo:"Opakova\u0165",fullStrokeEraser:"Guma s pln\xFDm \u0165ahom",selectPenType:"Typ pera",selectShape:"Tvar",pickColorFromScreen:"Vybra\u0165 farbu z obrazovky",clickToPickColorAnnouncement:"Kliknut\xEDm na obrazovku vyberte farbu",colorSelectionCanceledAnnouncement:"V\xFDber farby zru\u0161en\xFD",selectionTool__lassoSelect:"V\xFDber vo\u013En\xE9ho tvaru",selectionTool__lassoSelect__help:"Ak je t\xE1to funkcia zapnut\xE1, \u0165ahanie vytvor\xED vo\u013En\xFD tvar (laso) v\xFDberu.",selectionToolKeyboardShortcuts:"N\xE1stroj na v\xFDber: Pomocou kl\xE1vesov so \u0161\xEDpkami m\xF4\u017Eete presun\xFA\u0165 vybran\xE9 polo\u017Eky, mal\xFDmi/ve\u013Ek\xFDmi p\xEDsmenami \u201Ei\u201C a \u201Eo\u201C m\xF4\u017Eete zmeni\u0165 ve\u013Ekos\u0165.",documentProperties:"Strana",backgroundColor:"Farba pozadia",imageWidthOption:"\u0160\xEDrka",imageHeightOption:"V\xFD\u0161ka",useGridOption:"Mrie\u017Eka",enableAutoresizeOption:"Automatick\xE1 zmena ve\u013Ekosti",toggleOverflow:"Viac",about:"O aplik\xE1cii",inputStabilization:"Stabiliz\xE1cia",strokeAutocorrect:"Automatick\xE1 oprava",pressureSensitivity:"Tlak",touchPanning:"Pos\xFAvanie dotykom",roundedTipPen:"Okr\xFAhle",roundedTipPen2:"Viac\u010Diarov\xE9",flatTipPen:"Ploch\xE9",arrowPen:"\u0160\xEDpka",linePen:"\u010Ciara",outlinedRectanglePen:"Obrys obd\u013A\u017Enika",filledRectanglePen:"Pln\xFD obd\u013A\u017Enik",outlinedCirclePen:"Kru\u017Enica",lockRotation:"Zamkn\xFA\u0165 ot\xE1\u010Danie",paste:"Vlo\u017Ei\u0165",errorImageHasZeroSize:"Chyba: Obr\xE1zok m\xE1 nulov\xFA ve\u013Ekos\u0165",describeTheImage:"Popis obr\xE1zku",fileInput__loading:"Na\u010D\xEDtavanie...",fileInput__andNMoreFiles:s=>`(...${s} \u010Fal\u0161\xEDch)`,penDropdown__baseHelpText:"Tento n\xE1stroj kresl\xED tvary alebo vo\u013En\xE9 \u010Diary.",penDropdown__colorHelpText:"Zmen\xED farbu pera",penDropdown__thicknessHelpText:"Men\xED hr\xFAbku \u0165ahov nakreslen\xFDch perom.",penDropdown__penTypeHelpText:`Zmen\xED \u0161t\xFDl pera.

M\xF4\u017Eete si vybra\u0165 bu\u010F \u0161t\xFDl \u201Epero\u201C, alebo \u201Etvar\u201C. V\xFDberom \u0161t\xFDlu \u201Epero\u201C sa kreslia vo\u013En\xE9 \u010Diary. V\xFDberom \u0161t\xFDlu \u201Etvar\u201C sa kreslia tvary.`,penDropdown__autocorrectHelpText:`Prevedie pribli\u017En\xE9 vo\u013En\xE9 \u010Diary a obd\u013A\u017Eniky na dokonal\xE9.

Pero mus\xED by\u0165 dr\u017Ean\xE9 nehybne na konci \u0165ahu, aby sa spustila oprava.`,penDropdown__stabilizationHelpText:`Kresl\xED hlad\u0161ie \u0165ahy.

Prid\xE1va tie\u017E kr\xE1tke oneskorenie medzi pohybom my\u0161i/stylusu a \u0165ahom.`,penDropdown__pressureSensitivityHelpText:"Pri pou\u017Eit\xED kompatibiln\xE9ho zariadenia, napr\xEDklad stylusu, men\xED hr\xFAbku \u0165ahov pod\u013Ea sily stla\u010Denia.",handDropdown__baseHelpText:"Tento n\xE1stroj je zodpovedn\xFD za pos\xFAvanie, ot\xE1\u010Danie a zv\xE4\u010D\u0161ovanie editora.",handDropdown__zoomInHelpText:"Pribl\xED\u017Ei\u0165.",handDropdown__zoomOutHelpText:"Oddiali\u0165.",handDropdown__resetViewHelpText:"Obnov\xED \xFArove\u0148 pribl\xED\u017Eenia na 100 % a vynuluje pos\xFAvanie.",handDropdown__zoomDisplayHelpText:"Zobraz\xED aktu\xE1lnu \xFArove\u0148 pribl\xED\u017Eenia. 100 % zobrazuje obr\xE1zok v jeho skuto\u010Dnej ve\u013Ekosti.",handDropdown__touchPanningHelpText:"Ke\u010F je t\xE1to funkcia zapnut\xE1, gest\xE1 dotykovej obrazovky pos\xFAvaj\xFA obr\xE1zok, a nevyberaj\xFA ho ani nekreslia.",handDropdown__lockRotationHelpText:"Ak je t\xE1to funkcia zapnut\xE1, zabra\u0148uje dotykov\xFDm gest\xE1m ot\xE1\u010Da\u0165 obrazovku.",eraserDropdown__baseHelpText:"Tento n\xE1stroj odstra\u0148uje \u0165ahy, obr\xE1zky a text pod kurzorom.",eraserDropdown__thicknessHelpText:"Zmen\xED ve\u013Ekos\u0165 gumy.",eraserDropdown__fullStrokeEraserHelpText:"`V re\u017Eime pln\xE9ho \u0165ahu sa vyma\u017E\xFA cel\xE9 tvary.\n\nKe\u010F nie je v re\u017Eime pln\xE9ho \u0165ahu, tvary sa m\xF4\u017Eu by\u0165 \u010Diasto\u010Dne vymazan\xE9.`",selectionDropdown__baseHelpText:"Vyber\xE1 obsah a manipuluje s v\xFDberom",selectionDropdown__resizeToHelpText:`Ore\u017Ee kresbu na ve\u013Ekos\u0165 toho, \u010Do je aktu\xE1lne vybran\xE9.

Ak je zapnut\xE1 automatick\xE1 zmena ve\u013Ekosti, bude t\xE1to funkcia vypnut\xE1.`,selectionDropdown__deleteHelpText:"Vyma\u017Ee vybran\xE9 polo\u017Eky.",selectionDropdown__duplicateHelpText:"Vytvor\xED k\xF3piu vybran\xFDch polo\u017Eiek.",selectionDropdown__changeColorHelpText:"Zmen\xED farbu vybran\xFDch polo\u017Eiek.",pageDropdown__baseHelpText:"Ovl\xE1da farbu, vzor a ve\u013Ekos\u0165 pozadia kresliaceho pl\xE1tna.",pageDropdown__backgroundColorHelpText:"Zmen\xED farbu pozadia kresliaceho pl\xE1tna.",pageDropdown__gridCheckboxHelpText:"Zapne/vypne vzor mrie\u017Eky na pozad\xED.",pageDropdown__autoresizeCheckboxHelpText:`Pokia\u013E je ozna\u010Den\xE9, str\xE1nka sa zv\xE4\u010D\u0161\xED tak, aby sa prisp\xF4sobila kresbe.

Ke\u010F nie je ozna\u010Den\xE9, str\xE1nka je vidite\u013En\xE1 a jej ve\u013Ekos\u0165 sa d\xE1 nastavi\u0165 ru\u010Dne.`,pageDropdown__aboutButtonHelpText:"Zobraz\xED verziu, ladenie a \u010Fal\u0161ie inform\xE1cie.",colorPickerPipetteHelpText:"Vyberie farbu z obrazovky.",colorPickerToggleHelpText:"Otvor\xED/zatvor\xED v\xFDber farieb.",closeSidebar:s=>`Zatvori\u0165 bo\u010Dn\xFD panel pre ${s}`,dropdownShown:s=>`Ponuka pre ${s} zobrazen\xE1`,dropdownHidden:s=>`Ponuka pre ${s} skryt\xE1`,zoomLevel:s=>`Pribl\xED\u017Eenie: ${s}%`,colorChangedAnnouncement:s=>`Farba zmenen\xE1 na ${s}`,imageSize:(s,o)=>`Ve\u013Ekos\u0165 obr\xE1zka: ${s} ${o}`,imageLoadError:s=>`Chyba pri na\u010D\xEDtavan\xED obr\xE1zka: ${s}`,penTool:s=>`Pero ${s}`,selectionTool:"V\xFDber",selectAllTool:"Skratka pre v\xFDber v\u0161etk\xFDch",eraserTool:"Guma",touchPanTool:"Pos\xFAvanie dotykom",twoFingerPanZoomTool:"Posun a pribl\xED\u017Eenie",undoRedoTool:"Sp\xE4\u0165/Opakova\u0165",rightClickDragPanTool:"\u0164ahanie prav\xFDm tla\u010Didlom my\u0161i",pipetteTool:"Vybra\u0165 farbu z obrazovky",keyboardPanZoom:"Kl\xE1vesov\xE9 skratky pre pos\xFAvanie/pribl\xED\u017Eenie",selectionMenu__show:"Zobrazi\u0165 ponuku v\xFDberu",selectionMenu__copyToClipboard:"Kop\xEDrova\u0165 do schr\xE1nky",selectionMenu__duplicate:"Duplikova\u0165",selectionMenu__delete:"Vymaza\u0165",selectionMenu__paste:"Vlo\u017Ei\u0165",copyPasteError__heading:"Kop\xEDrova\u0165/vlo\u017Ei\u0165",copyPasteError__description:"Nie\u010Do sa pokazilo - tento n\xE1stroj nemus\xED ma\u0165 pr\xEDstup k schr\xE1nke.",copyPasteError__errorDetails:"Zobrazi\u0165 chybu",copyPasteError__pasteRetry:"Ak chcete opakova\u0165 pokus, vlo\u017Ete ho do ni\u017E\u0161ie uveden\xE9ho vstupn\xE9ho po\u013Ea:",copyPasteError__copyRetry:"Ak chcete opakova\u0165 pokus, skop\xEDrujte text do vstupn\xE9ho po\u013Ea ni\u017E\u0161ie:",copyPasteError__copyMe:"Skop\xEDruj ma!",autocorrectedTo:s=>`Automaticky opraven\xE9 na ${s}`,autocorrectionCanceled:"Automatick\xE1 oprava zru\u0161en\xE1",enterTextToInsert:"Text, ktor\xFD sa m\xE1 vlo\u017Ei\u0165",changeTool:"Zmeni\u0165 n\xE1stroj",findLabel:"H\u013Eada\u0165",toNextMatch:"\u010Eal\u0161ie",closeDialog:"Zavrie\u0165",findDialogShown:"Dial\xF3gov\xE9 okno vyh\u013Ead\xE1vania zobrazen\xE9",findDialogHidden:"Dial\xF3gov\xE9 okno vyh\u013Ead\xE1vania je skryt\xE9",copied:s=>`Skop\xEDrovan\xFDch ${s} polo\u017Eiek`,pasted:s=>`Vlo\u017Een\xFDch ${s} polo\u017Eiek`,toolEnabledAnnouncement:s=>`${s} zapnut\xE9`,toolDisabledAnnouncement:s=>`${s} vypnut\xE9`,resizeOutputCommand:s=>`Zmenen\xE1 ve\u013Ekos\u0165 obr\xE1zka na ${s.w}x${s.h}`,enabledAutoresizeOutputCommand:"Automatick\xE1 zmena ve\u013Ekosti v\xFDstupu je povolen\xE1",disabledAutoresizeOutputCommand:"Automatick\xE1 zmena ve\u013Ekosti v\xFDstupu je zak\xE1zan\xE1",addComponentAction:s=>`Pridan\xE9 ${s}`,eraseAction:(s,o)=>`Vymazan\xE9 ${o} ${s}`,duplicateAction:(s,o)=>`Duplikovan\xE9 ${o} ${s}`,elements:"Prvky",erasedNoElements:"Ni\u010D sa nevymazalo.",duplicatedNoElements:"Ni\u010D sa neduplikovalo.",rotatedBy:s=>`Oto\u010Den\xE9 o ${Math.abs(s)} stup\u0148ov ${s<0?"clockwise":"counter-clockwise"}`,movedLeft:"Presunut\xE9 do\u013Eava",movedUp:"Presunut\xE9 hore",movedDown:"Presunut\xE9 dole",movedRight:"Presunut\xE9 doprava",zoomedOut:"Oddialen\xE9",zoomedIn:"Pribl\xED\u017Een\xE9",andNMoreCommands:s=>`A ${s} \u010Fal\u0161\xEDch pr\xEDkazov.`,unlabeledImageNode:"Obr\xE1zok bez ozna\u010Denia",stroke:"\u0164ah",svgObject:"Objekt SVG",emptyBackground:"Pr\xE1zdne pozadie",gridBackground:"Pozadie s mrie\u017Ekou",filledBackgroundWithColor:s=>`Vyplnen\xE9 pozadie (${s})`,text:s=>`Textov\xFD objekt: ${s}`,imageNode:s=>`Obr\xE1zok: ${s}`,pathNodeCount:s=>`Vidite\u013En\xFDch je ${s} objektov ciest.`,textNodeCount:s=>`Vidite\u013En\xFDch je ${s} textov\xFDch uzlov.`,imageNodeCount:s=>`Vidite\u013En\xFDch je ${s} obrazov\xFDch uzlov.`,rerenderAsText:"Op\xE4tovne vykresli\u0165 ako text.",accessibilityInputInstructions:"Pomocou tla\u010Didla \u201Et\u201C pre\u010D\xEDtate obsah zobrazovacieho okna ako text. Pomocou kl\xE1vesov so \u0161\xEDpkami pohybujte zobrazovac\xEDm oknom, kliknut\xEDm a \u0165ahan\xEDm kreslite \u0165ahy. Stla\u010Den\xEDm tla\u010Didla \u201Ew\u201C pribl\xED\u017Eite a stla\u010Den\xEDm tla\u010Didla \u201Es\u201C oddialite poh\u013Ead.",loading:s=>`Na\u010D\xEDtava sa ${s}%...`,imageEditor:"Editor obr\xE1zkov",doneLoading:"Na\u010D\xEDtanie dokon\u010Den\xE9",softwareLibraries:"Kni\u017Enice",developerInformation:"Inform\xE1cie pre v\xFDvoj\xE1rov"},Ps=ql;var Kl={de:Ss,en:Cs,es:Es,sk:Ps,zh:Ts},Gl=s=>{let o=/^(\w+)[_-](\w+)$/.exec(s);return o?o[1]:s},ut=(s,o,e)=>{let r;for(let n of s){let i=Gl(n);if(r&&i!==r&&r in o)return o[r];if(n in o)return o[n];r=i}return r&&r in o?o[r]:e},_l=s=>(s??=navigator.languages,ut(s,Kl,De)),Vn=_l;var ks=s=>s.toUpperCase()===s&&s.toLowerCase()!==s&&s.length===1,Ls=s=>s.toLowerCase()===s&&s.toUpperCase()!==s&&s.length===1,Ge=class s{constructor(o){this.key=o.key,this.shiftKey=o.shiftKey,this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.metaKey=o.metaKey,this.controlOrMeta=o.controlOrMeta}matchesEvent(o){let e=o.key?.toLowerCase(),r=ks(o.key??""),n=Ls(o.key??""),i=(o.ctrlKey??!1)||e==="control",a=(o.altKey??!1)||e==="alt",l=(o.metaKey??!1)||e==="meta",c=(o.shiftKey??r)||e==="shift",d=o.controlOrMeta||o.ctrlKey||o.metaKey||!1;if(this.key!==o.code&&(this.key.toLowerCase()!==e||(r||n)&&this.key!==o.key&&!(this.shiftKey===!0&&this.key.toUpperCase()===o.key)))return!1;let p=this.controlOrMeta;return(i===this.ctrlKey&&l===this.metaKey&&!p||p&&d)&&a===this.altKey&&(c===this.shiftKey||this.shiftKey===void 0)}toString(){let o=[];return this.ctrlKey&&this.key!=="control"&&o.push("Ctrl"),this.controlOrMeta&&o.push("CtrlOrMeta"),this.altKey&&this.key!=="alt"&&o.push("Alt"),this.metaKey&&this.key!=="meta"&&o.push("Meta"),this.shiftKey&&this.key!=="shift"&&o.push("Shift"),o.push(this.key),o.join("+")}static fromString(o){let e=v=>{let g;ks(v)?g=!0:(Ls(v)||v.length>1)&&(g=!1);let y=v.toLowerCase();return y==="shift"&&(g=!0),{shiftKey:g,ctrlKey:y==="control"||y==="ctrl",altKey:y==="alt",metaKey:y==="meta",controlOrMeta:y==="control or meta"||y==="ctrlormeta"}};if(o.search(/[-+]/)===-1||o.length===1){let v=e(o);return new s({key:o,...v})}let i=/^(.*[-+])?(.+)$/g.exec(o);if(!i)throw new Error(`Invalid shortcut expression, ${o}!`);let a=i[2],l=e(a),c=(i[1]??"").split(/[-+]/),d=l.shiftKey,p=l.ctrlKey,u=l.altKey,h=l.metaKey,f=l.controlOrMeta;for(let v of c)if(v!=="")switch(v.toLowerCase()){case"shift":d=!0;break;case"anyshift":d=void 0;break;case"ctrl":case"control":p=!0;break;case"meta":h=!0;break;case"ctrlormeta":case"ctrl or meta":case"controlormeta":f=!0;break;case"alt":u=!0;break;default:throw new Error(`Unknown modifier: "${v}" in shortcut ${o}.`)}return new s({key:a,shiftKey:d,ctrlKey:p,altKey:u,metaKey:h,controlOrMeta:f})}};var H=class s{constructor(o){this.shortcutOverrides=Object.create(null);for(let e in o)this.overrideShortcut(e,o[e])}static{this.shortcuts=Object.create(null)}static{this.shortcutDefaultDescriptions=Object.create(null)}static{this.shortcutLocalizedDescriptions=Object.create(null)}overrideShortcut(o,e){this.shortcutOverrides[o]=[...e]}matchesShortcut(o,e){let r=this.shortcutOverrides[o];if(!r)if(o in s.shortcuts)r=s.shortcuts[o];else throw new Error(`No shortcut with ID ${o} exists!`);for(let n of r)if(n.matchesEvent(e))return!0;return!1}static registerDefaultKeyboardShortcut(o,e,r){if(o in s.shortcuts)return!1;let n=e.map(i=>typeof i=="string"?Ge.fromString(i):i);return s.shortcuts[o]=[...n],s.shortcutDefaultDescriptions[o]=r,!0}static provideShortcutDescription(o,e,r){e in s.shortcutLocalizedDescriptions||(s.shortcutLocalizedDescriptions[e]=Object.create(null)),s.shortcutLocalizedDescriptions[e][o]=r}static getAllShortcutIds(){let o=[];for(let e in this.shortcuts)o.push(e);return o}static getShortcutDefaultKeybindings(o){if(!(o in s.shortcuts))throw new Error(`No shortcut with ID ${o} exists!`);return s.shortcuts[o]}static getShortcutDescription(o,e){return ut(e??[],this.shortcutLocalizedDescriptions,this.shortcutDefaultDescriptions)[o]??this.shortcutDefaultDescriptions[o]??null}};var Gt="jsdraw.tools.SelectionTool.selectAll";H.registerDefaultKeyboardShortcut(Gt,["CtrlOrMeta+KeyA"],"Select all");var zr="jsdraw.tools.SelectionTool.duplicateSelection";H.registerDefaultKeyboardShortcut(zr,["CtrlOrMeta+KeyD"],"Duplicate selection");var Mr="jsdraw.tools.SelectionTool.sendToBack";H.registerDefaultKeyboardShortcut(Mr,["End"],"Send to back");var On="jsdraw.tools.SelectionTool.translateLeft";H.registerDefaultKeyboardShortcut(On,["KeyA","KeyH","ArrowLeft"],"Move selection left");var Fn="jsdraw.tools.SelectionTool.translateRight";H.registerDefaultKeyboardShortcut(Fn,["KeyD","KeyL","ArrowRight"],"Move selection right");var Hn="jsdraw.tools.SelectionTool.translateUp";H.registerDefaultKeyboardShortcut(Hn,["KeyQ","KeyK","ArrowUp"],"Move selection up");var Nn="jsdraw.tools.SelectionTool.translateDown";H.registerDefaultKeyboardShortcut(Nn,["KeyE","KeyJ","ArrowDown"],"Move selection down");var $n="jsdraw.tools.SelectionTool.rotateCCW";H.registerDefaultKeyboardShortcut($n,["Shift+KeyR"],"Rotate selection counter clockwise");var Wn="jsdraw.tools.SelectionTool.rotateCW";H.registerDefaultKeyboardShortcut(Wn,["KeyR"],"Rotate selection clockwise");var Un="jsdraw.tools.SelectionTool.shrink.x";H.registerDefaultKeyboardShortcut(Un,["KeyI"],"Decrease width");var qn="jsdraw.tools.SelectionTool.stretch.x";H.registerDefaultKeyboardShortcut(qn,["Shift+KeyI"],"Increase width");var Kn="jsdraw.tools.SelectionTool.shrink.y";H.registerDefaultKeyboardShortcut(Kn,["KeyO"],"Decrease height");var Gn="jsdraw.tools.SelectionTool.stretch.y";H.registerDefaultKeyboardShortcut(Gn,["Shift+KeyO"],"Increase height");var _n="jsdraw.tools.SelectionTool.shrink.xy";H.registerDefaultKeyboardShortcut(_n,["Comma"],"Decrease selection size");var jn="jsdraw.tools.SelectionTool.stretch.xy";H.registerDefaultKeyboardShortcut(jn,["Period"],"Increase selection size");var Mo="jsdraw.tools.undo",Zn="jsdaw.tools.redo";H.registerDefaultKeyboardShortcut(Mo,["CtrlOrMeta+KeyZ"],"Undo");H.registerDefaultKeyboardShortcut(Zn,["CtrlOrMeta+Shift+KeyZ","CtrlOrMeta+KeyY"],"Redo");var Bo="jsdraw.tools.increaseSize";H.registerDefaultKeyboardShortcut(Bo,["Equal","Shift+Equal"],"Increase pen/eraser size");var Do="jsdraw.tools.decreaseSize";H.registerDefaultKeyboardShortcut(Do,["Minus","Shift+Minus"],"Decrease pen/eraser size");var _t="jsdraw.tools.snapToGrid";H.registerDefaultKeyboardShortcut(_t,["Control","Meta"],"Snap to grid (press and hold)");var Yn="jsdraw.tools.lockToLine";H.registerDefaultKeyboardShortcut(Yn,["Shift"],"Snap to XY axes (press and hold)");var Br="js-draw.tools.FindTool.toggleVisible";H.registerDefaultKeyboardShortcut(Br,["CtrlOrMeta+KeyF"],"Shows/hides the find tool");var Xn="jsdraw.tools.PanZoom.moveLeft";H.registerDefaultKeyboardShortcut(Xn,["ArrowLeft","KeyH","KeyA"],"Pan left");var Qn="jsdraw.tools.PanZoom.moveRight";H.registerDefaultKeyboardShortcut(Qn,["ArrowRight","KeyL","KeyD"],"Pan right");var Jn="jsdraw.tools.PanZoom.moveUp";H.registerDefaultKeyboardShortcut(Jn,["ArrowUp","KeyK","KeyQ"],"Pan up");var ei="jsdraw.tools.PanZoom.moveDown";H.registerDefaultKeyboardShortcut(ei,["ArrowDown","KeyJ","KeyE"],"Pan down");var ti="jsdraw.tools.PanZoom.rotateViewClockwise";H.registerDefaultKeyboardShortcut(ti,["Shift+KeyR"],"Rotate viewport clockwise");var oi="jsdraw.tools.PanZoom.rotateViewCounterClockwise";H.registerDefaultKeyboardShortcut(oi,["KeyR"],"Rotate viewport counter-clockwise");var ri="jsdraw.tools.PanZoom.zoomIn";H.registerDefaultKeyboardShortcut(ri,["KeyW"],"Zoom in");var ni="jsdraw.tools.PanZoom.zoomOut";H.registerDefaultKeyboardShortcut(ni,["KeyS"],"Zoom out");var ii=class{constructor(o,e,r){this.initialVelocity=o;this.scrollBy=e;this.onComplete=r;this.running=!1;this.start()}async start(){if(this.running)return;this.currentVelocity=this.initialVelocity;let o=performance.now();this.running=!0;let e=5e3,r=200;for(this.currentVelocity.magnitude()>e&&(this.currentVelocity=this.currentVelocity.normalized().times(e));this.running&&this.currentVelocity.magnitude()>r;){let n=performance.now(),i=(n-o)/1e3;this.currentVelocity=this.currentVelocity.times(Math.pow(1/8,i)),this.scrollBy(this.currentVelocity.times(i)),await tt(),o=n}this.running&&this.stop()}getCurrentVelocity(){return this.running?this.currentVelocity:null}stop(){this.running&&(this.running=!1,this.onComplete())}},Ie=class extends _{constructor(e,r,n){super(e.notifier,n);this.editor=e;this.mode=r;this.transform=null;this.initialRotationSnapAngle=.22;this.afterRotationStartSnapAngle=.07;this.pinchZoomStartThreshold=1.08;this.lastPointerDownTimestamp=0;this.initialTouchAngle=0;this.initialViewportRotation=0;this.initialViewportScale=0;this.isScaling=!1;this.isRotating=!1;this.inertialScroller=null;this.velocity=null}canReceiveInputInReadOnlyEditor(){return!0}computePinchData(e,r){if(e.id<r.id){let d=e;e=r,r=d}let n=r.screenPos.minus(e.screenPos),i=n.angle(),a=n.magnitude(),l=r.canvasPos.plus(e.canvasPos).times(.5),c=r.screenPos.plus(e.screenPos).times(.5);return{canvasCenter:l,screenCenter:c,angle:i,dist:a}}allPointersAreOfType(e,r){return e.every(n=>n.device===r)}onPointerDown({allPointers:e,current:r}){let n=!1,i=this.inertialScroller?.getCurrentVelocity()??T.zero;this.inertialScroller?.stop(),this.velocity=i,this.lastPointerDownTimestamp=r.timeStamp;let a=this.allPointersAreOfType(e,4),l=this.allPointersAreOfType(e,2),c=this.allPointersAreOfType(e,5);if((l||c)&&e.length===2&&this.mode&2){let{screenCenter:p,angle:u,dist:h}=this.computePinchData(e[0],e[1]);this.lastTouchDist=h,this.startTouchDist=h,this.lastScreenCenter=p,this.initialTouchAngle=u,this.initialViewportRotation=this.editor.viewport.getRotationAngle(),this.initialViewportScale=this.editor.viewport.getScaleFactor(),this.isScaling=!1,this.isRotating=Math.abs(Math.sin(this.initialViewportRotation*2))>.001,n=!0}else e.length===1&&(this.mode&1&&l||a&&this.mode&4||this.mode&8)&&(this.lastScreenCenter=e[0].screenPos,this.isScaling=!1,n=!0);return n&&(this.lastTimestamp=performance.now(),this.transform??=Le.transformBy(k.identity),this.editor.display.setDraftMode(!0)),n}updateVelocity(e){let r=e.minus(this.lastScreenCenter),n=(performance.now()-this.lastTimestamp)/1e3;if(r.magnitude()===0&&n<.1||n===0)return;n=Math.max(n,.01);let i=r.times(1/n),a=i;this.velocity&&(a=this.velocity.lerp(i,.5)),this.velocity=a}getCenterDelta(e){return this.editor.viewport.screenToCanvasTransform.transformVec3(e.minus(this.lastScreenCenter))}toSnappedRotationDelta(e){let n=e-this.initialTouchAngle+this.initialViewportRotation,i=Math.PI/2,a=Math.round(n/i)*i,l=this.isRotating?this.afterRotationStartSnapAngle:this.initialRotationSnapAngle;return Math.abs(n-a)<l&&(n=a,n!==0&&(n+=1e-4)),n-this.editor.viewport.getRotationAngle()}toSnappedScaleFactor(e){let r=this.initialViewportScale*e/this.startTouchDist,n=this.editor.viewport.getScaleFactor(),i=Math.log(r)/Math.log(10),a=Math.round(i);return Math.abs(a-i)<.04?Math.pow(10,a)/n:e/this.lastTouchDist}handleTwoFingerMove(e){let{screenCenter:r,canvasCenter:n,angle:i,dist:a}=this.computePinchData(e[0],e[1]),l=this.getCenterDelta(r),c;if(this.isRotationLocked()?c=0:c=this.toSnappedRotationDelta(i),Math.abs(c)>1e-8&&(this.isRotating=!0),this.updateVelocity(r),!this.isScaling){let u=a/this.startTouchDist,h=this.pinchZoomStartThreshold,f=1/this.pinchZoomStartThreshold;(u>h||u<f)&&(this.isScaling=!0)}let d=1;this.isScaling&&(d=this.toSnappedScaleFactor(a),this.lastTouchDist=a);let p=k.translation(l).rightMul(k.scaling2D(d,n)).rightMul(k.zRotation(c,n));return this.lastScreenCenter=r,this.transform=Le.transformBy(this.transform.transform.rightMul(p)),p}handleOneFingerMove(e){let r=this.getCenterDelta(e.screenPos),n=k.translation(r);return this.transform=Le.transformBy(this.transform.transform.rightMul(n)),this.updateVelocity(e.screenPos),this.lastScreenCenter=e.screenPos,n}onPointerMove({allPointers:e}){this.transform??=Le.transformBy(k.identity);let r=k.identity;e.length===2?r=this.handleTwoFingerMove(e):e.length===1&&(r=this.handleOneFingerMove(e[0])),Le.transformBy(r).apply(this.editor),this.lastTimestamp=performance.now()}onPointerUp(e){let r=()=>{this.transform&&(this.transform.unapply(this.editor),this.editor.dispatch(this.transform,!1)),this.editor.display.setDraftMode(!1),this.transform=null,this.velocity=T.zero};if(e.current.device===2&&e.allPointers.length===1&&this.velocity!==null&&e.current.timeStamp-this.lastPointerDownTimestamp>30&&this.velocity!==null){let a=this.velocity;this.updateVelocity(e.current.screenPos),a.magnitude()<this.velocity.magnitude()&&(this.velocity=a),this.inertialScroller?.stop(),this.inertialScroller=new ii(this.velocity,l=>{if(!this.transform)return;let c=this.editor.viewport.screenToCanvasTransform.transformVec3(l);this.transform.unapply(this.editor),this.transform=Le.transformBy(this.transform.transform.rightMul(k.translation(c))),this.transform.apply(this.editor)},r)}else r()}onGestureCancel(){this.inertialScroller?.stop(),this.velocity=T.zero,this.transform?.unapply(this.editor),this.editor.display.setDraftMode(!1),this.transform=null}updateTransform(e,r=!1){let n=e;this.transform&&(n=this.transform.transform.rightMul(e)),this.transform?.unapply(this.editor),this.transform=Le.transformBy(n),this.transform.apply(this.editor),r&&this.editor.announceForAccessibility(this.transform.description(this.editor,this.editor.localization))}applyAndFinalizeTransform(e){this.updateTransform(e,!0),this.transform=null}onWheel({delta:e,screenPos:r}){this.inertialScroller?.stop(),this.transform=Le.transformBy(k.identity);let n=this.editor.viewport.screenToCanvas(r),a=this.editor.viewport.screenToCanvasTransform.transformVec3(N.of(-e.x,-e.y,0)),l=e.z;l=Math.atan(l/2)*2;let d=k.scaling2D(Math.max(.4,Math.min(Math.pow(1.04,-l),4)),n).rightMul(k.translation(a));return this.applyAndFinalizeTransform(d),!0}onKeyPress(e){if(this.inertialScroller?.stop(),!(this.mode&16))return!1;this.transform=Le.transformBy(k.identity);let r=T.zero,n=1,i=0,a=this.editor.shortcuts;if(a.matchesShortcut(Xn,e))r=T.of(-1,0);else if(a.matchesShortcut(Qn,e))r=T.of(1,0);else if(a.matchesShortcut(Jn,e))r=T.of(0,-1);else if(a.matchesShortcut(ei,e))r=T.of(0,1);else if(a.matchesShortcut(ri,e))n=1/2;else if(a.matchesShortcut(ni,e))n=2;else if(a.matchesShortcut(ti,e))i=1;else if(a.matchesShortcut(oi,e))i=-1;else return!1;r=r.times(30),i*=Math.PI/8,r=r.times(-1),i=i*-1,n=1/n,i!==0&&(i+=1e-4),this.isRotationLocked()&&(i=0),r=this.editor.viewport.screenToCanvasTransform.transformVec3(r);let c=this.editor.viewport.visibleRect.center,d=k.scaling2D(n,c).rightMul(k.zRotation(i,c)).rightMul(k.translation(r));return this.applyAndFinalizeTransform(d),!0}isRotationLocked(){return!!(this.mode&32)}setModeEnabled(e,r){let n=this.mode;r?n|=e:n&=~e,this.setMode(n)}setMode(e){e!==this.mode&&(this.mode=e,this.editor.notifier.dispatch(2,{kind:2,tool:this}))}getMode(){return this.mode}};var Is=s=>({fill:s.fill,stroke:s.stroke?{...s.stroke}:void 0}),Dr=(s,o)=>(s===o||s.fill.eq(o.fill)&&s.stroke==null==(o.stroke==null)&&(s.stroke?.color?.eq(o.stroke?.color)??!0)&&s.stroke?.width===o.stroke?.width)??!1,Ar=s=>{let o=s.stroke?{color:s.stroke.color.toHexString(),width:s.stroke.width}:void 0;return{fill:s.fill.toHexString(),stroke:o}},Vr=s=>{let o=s.stroke?{color:M.fromHex(s.stroke.color),width:s.stroke.width}:void 0;return{fill:M.fromHex(s.fill),stroke:o}};var si=s=>({...s,renderingStyle:Is(s.renderingStyle)}),Or=s=>{if(typeof s=="string"&&(s=JSON.parse(s)),typeof s.fontFamily!="string")throw new Error("Serialized textStyle missing string fontFamily attribute!");return{renderingStyle:Vr(s.renderingStyle),size:s.size,fontWeight:s.fontWeight,fontVariant:s.fontVariant,fontFamily:s.fontFamily}},Fr=s=>({...s,renderingStyle:Ar(s.renderingStyle)});var Rs=s=>{let o={};return s.color&&(o.color=s.color.toHexString()),s.textStyle&&(o.textStyle=Fr(s.textStyle)),o},zs=s=>{let o=s.color?M.fromHex(s.color):void 0,e=s.textStyle?Or(s.textStyle):void 0;return{color:o,textStyle:e}},Lt=(s,o,e)=>new ai(s,o,e.getId(),e),Hr=s=>!(!("getStyle"in s&&"updateStyle"in s&&"forceStyle"in s)||!("isRestylableComponent"in s)||!s.isRestylableComponent),Ms="default-restyle-element",ai=class s extends Et{constructor(e,r,n,i){super(Ms,n,i);this.originalStyle=e;this.newStyle=r}getComponent(e){this.resolveComponent(e.image);let r=this.component;if(!r||!r.forceStyle||!r.updateStyle)throw new Error("this.component is missing forceStyle and/or updateStyle methods!");return r}apply(e){this.getComponent(e).forceStyle(this.newStyle,e)}unapply(e){this.getComponent(e).forceStyle(this.originalStyle,e)}description(e,r){return r.restyledElement(this.getComponent(e).description(r))}serializeToJSON(){return{id:this.componentID,originalStyle:Rs(this.originalStyle),newStyle:Rs(this.newStyle)}}static{K.register(Ms,(e,r)=>{let n=zs(e.originalStyle),i=zs(e.newStyle),a=e.id;if(typeof e.id!="string")throw new Error(`json.id is of type ${typeof e.id}, not string.`);return new s(n,i,a)})}};var It=s=>s.path?s.path:new W(s.startPoint,s.commands),Q=(s,o)=>({startPoint:s.startPoint,style:o,commands:s.parts,path:s}),jl=(s,o)=>s.path?s:{...s,path:o},Nr=(s,o,e={fastCheck:!0,expensiveCheck:!0})=>{let r=It(s),n=s.style.stroke?.width??0,i=n>0&&s.style.fill.a===0,a=r.bbox.grownBy(n),l=i&&n>o.maxDimension&&a.containsRect(o);if(e.fastCheck&&l&&s.style.stroke){let c=n/2;for(let d of r.startEndPoints())if(o.isWithinRadiusOf(c,d))return{rectangle:o,path:Q(W.fromRect(o),{fill:s.style.stroke.color}),fullScreen:!0}}if(e.expensiveCheck&&l&&s.style.stroke&&n>o.maxDimension*3){let c=r.signedDistance(o.center,n/2),d=n/6;if(c<-o.maxDimension/2-d)return{path:Q(W.fromRect(o),{fill:s.style.stroke.color}),rectangle:o,fullScreen:!0};if(c>o.maxDimension/2+d)return{path:Q(W.empty,{fill:M.transparent}),rectangle:R.empty,fullScreen:!1}}return null},li=(s,o)=>{let e=It(s),r=s.style.stroke?.width??0,n=r>0&&s.style.fill.a===0,i=e.bbox.grownBy(r),a=Nr(s,o,{fastCheck:!0,expensiveCheck:!1});if(a)return a.path;if(o.grownBy(r).transformedBoundingBox(k.scaling2D(4,o.center)).containsRect(i))return jl(s,e);let c=[],d=e.startPoint;for(let h of e.parts){let f=W.computeBBoxForSegment(d,h).grownBy(r),b;h.kind===0||h.kind===1?b=h.point:b=h.endPoint,f.intersects(o)?c.push(h):n||h.kind===1?c.push({kind:1,point:b}):c.push({kind:0,point:b}),d=b}let p=new W(e.startPoint,c),u=s.style;return a=Nr(s,o,{fastCheck:!1,expensiveCheck:!0}),a?a.path:Q(p,u)};var ae=class s extends J{constructor(e,r){super("stroke",r);this.isRestylableComponent=!0;this.simplifiedPath=null;this.approximateRenderingTime=0,this.parts=[];for(let n of e){let i=It(n),a=this.bboxForPart(i.bbox,n.style);this.contentBBox?this.contentBBox=this.contentBBox.union(a):this.contentBBox=a,this.parts.push({path:i,startPoint:i.startPoint,style:n.style,commands:i.parts}),this.approximateRenderingTime+=i.parts.length}this.contentBBox??=R.empty}static fromStroked(e,r){return typeof e=="string"&&(e=W.fromString(e)),new s([Q(e,{fill:M.transparent,stroke:r})])}static fromFilled(e,r){return typeof e=="string"&&(e=W.fromString(e)),new s([Q(e,{fill:r})])}getStyle(){if(this.parts.length===0)return{};let e=this.parts[0];return e.style.stroke===void 0||e.style.stroke.width===0?{color:e.style.fill}:{color:e.style.stroke.color}}updateStyle(e){return Lt(this.getStyle(),e,this)}forceStyle(e,r){e.color&&(this.parts=this.parts.map(n=>{let i={...n.style,stroke:n.style.stroke?{...n.style.stroke}:void 0};return i.stroke&&i.stroke.width>0?i.stroke.color=e.color:i.fill=e.color,{path:n.path,startPoint:n.startPoint,commands:n.commands,style:i}}),r&&(r.image.queueRerenderOf(this),r.queueRerender()))}withRegionErased(e,r){let n=e.polylineApproximation(),i=c=>e.closedContainsPoint(c),a=[],l=!1;for(let c of this.parts){let d=c.path,p=g=>{if(c.style.fill.a>0){if(g.parts.length<1||g.parts.length===1&&g.parts[0].kind===0)return null;g=g.asClosed()}return isNaN(g.getExactBBox().area)?(console.warn("Prevented creating a stroke with NaN area"),l=!0,null):new s([Q(g,c.style)],this.getZIndex())},u=[];for(let g of n)u.push(...d.intersection(g));let h=!1;if(u.length===0&&c.style.stroke&&c.style.stroke.width>e.bbox.minDimension*.3&&c.style.stroke.width<e.bbox.maxDimension*30){for(let g of n)u.push(...d.intersection(g,c.style.stroke.width/2));h=!0}u.sort(Sr);let b=(()=>{if(u.length===0)return!1;if(h)return u[0].curveIndex===0&&u[0].parameterValue<=0;let g=Rn(u[0],-1e-10);return i(d.at(g))})()?1:0,v=(g,y)=>{let m=p(g),w=b%2===1;b++,y!==void 0&&(w=y),y===void 0&&!w&&e.closedContainsPoint(g.getExactBBox().center)&&(w=!w),m&&(l||=w&&g.getExactBBox().maxDimension>e.getExactBBox().maxDimension*2,w||a.push(m))};if(c.style.fill.a===0){if(!(e.getExactBBox().maxDimension/10>d.getExactBBox().maxDimension)){let y=d.splitAt(u,{mapNewPoint:m=>r.roundPoint(m)});for(let m of y)v(m)}}else if(u.length>=2&&u.length%2===0){let g=d.splitAt(u,{mapNewPoint:y=>r.roundPoint(y)});for(let y=0;y<Math.floor(g.length/2);y++)v(g[y].union(g[g.length-y-1]).asClosed());g.length%2!==0&&v(g[Math.floor(g.length/2)].asClosed())}else v(d,!1)}return l?[this]:a}intersects(e){for(let r of this.parts){let n=r.style.stroke?.width,i=n?n/2:void 0;if(r.path.intersection(e,i).length>0)return!0}return!1}keyPoints(){return this.parts.map(e=>e.startPoint).flat()}intersectsRect(e){if(!e.intersects(this.getBBox()))return!1;for(let r of this.parts){let n=e.grownBy(-(r.style.stroke?.width??0));if(n.area!==0){for(let i of r.path.startEndPoints())if(n.containsPoint(i))return!0}}return super.intersectsRect(e)}computeSimplifiedPathFor(e){let r=[],n=!1,i=!1;for(let a of this.parts){if(i||!a.style.stroke||a.style.stroke.color.a<.99){r.push(a);continue}let l=Nr(a,e);l?(r.push(l.path),l.fullScreen&&(n=!0,i=!0)):r.push(a)}return{forVisibleRect:e,parts:r,occludes:n}}occludesEverythingBelowWhenRenderedInRect(e){return this.getBBox().containsRect(e)?((!this.simplifiedPath||!this.simplifiedPath.forVisibleRect.eq(e))&&(this.simplifiedPath=this.computeSimplifiedPathFor(e)),this.simplifiedPath.occludes):!1}render(e,r){e.startObject(this.getBBox());let n=this.parts;r&&this.simplifiedPath?.forVisibleRect?.containsRect(r)?n=this.simplifiedPath.parts:this.simplifiedPath=null;for(let i of n){let a=this.bboxForPart(i.path.bbox,i.style);r&&(!a.intersects(r)||(a.size.x>r.size.x*3||a.size.y>r.size.y*3)&&!i.path.roughlyIntersects(r,i.style.stroke?.width??0))||e.drawPath(i)}e.endObject(this.getLoadSaveData())}getProportionalRenderingTime(){return this.approximateRenderingTime}bboxForPart(e,r){return r.stroke?e.grownBy(r.stroke.width/2):e}getExactBBox(){let e=null;for(let{path:r,style:n}of this.parts){let i=this.bboxForPart(r.getExactBBox(),n);e??=i,e=e.union(i)}return e??R.empty}applyTransformation(e){this.contentBBox=R.empty;let r=!0;this.parts=this.parts.map(n=>{let i=n.path.transformedBy(e),a={...n.style,stroke:n.style.stroke?{...n.style.stroke}:void 0};if(a.stroke){let c=e.getScaleFactor();a.stroke.width*=c}let l=this.bboxForPart(i.bbox,a);return r?(this.contentBBox=l,r=!1):this.contentBBox=this.contentBBox.union(l),{path:i,startPoint:i.startPoint,commands:i.parts,style:a}})}getParts(){return[...this.parts]}getPath(){let e=null;for(let r of this.parts)e?e=e.union(r.path):e??=r.path;return e??W.empty}description(e){return e.stroke}createClone(){return new s(this.parts)}serializeToJSON(){return this.parts.map(e=>({style:Ar(e.style),path:e.path.serialize()}))}static deserializeFromJSON(e){if(typeof e=="string"&&(e=JSON.parse(e)),typeof e!="object"||typeof e.length!="number")throw new Error(`${e} is missing required field, parts, or parts is of the wrong type.`);let r=e.map(n=>{let i=Vr(n.style);return Q(W.fromString(n.path),i)});return new s(r)}};J.registerComponent("stroke",ae.deserializeFromJSON);var jt=class{constructor(o,e,r,n){this.startPoint=o;this.minFitAllowed=e;this.maxFitAllowed=r;this.onCurveAdded=n;this.isFirstSegment=!0;this.lastExitingVec=null;this.currentCurve=null;this.lastPoint=this.startPoint,this.buffer=[this.startPoint.pos],this.momentum=T.zero,this.currentCurve=null,this.curveStartWidth=o.width,this.bbox=new R(this.startPoint.pos.x,this.startPoint.pos.y,0,0)}getBBox(){return this.bbox}preview(){return this.currentCurve?this.currentSegmentToPath():null}approxCurrentCurveLength(){if(!this.currentCurve)return 0;let o=this.currentCurve.p0,e=this.currentCurve.p1,r=this.currentCurve.p2,n=o.distanceTo(e),i=r.distanceTo(e);return n+i}finalizeCurrentCurve(){if(!this.currentCurve)return;this.onCurveAdded(this.currentSegmentToPath());let o=this.buffer[this.buffer.length-1];this.lastExitingVec=this.currentCurve.p2.minus(this.currentCurve.p1),console.assert(this.lastExitingVec.magnitude()!==0,"lastExitingVec has zero length!"),this.buffer=[this.buffer[this.buffer.length-2],o],this.currentCurve=null,this.isFirstSegment=!1}currentSegmentToPath(){if(this.currentCurve==null)throw new Error("Invalid State: currentCurve is null!");let o=this.currentCurve.normal(0).normalized();if(!isFinite(o.magnitude()))throw new Error(`startVec(${o}) is NaN or \u221E`);let e=this.currentCurve.at(0),r=this.currentCurve.at(1),n=this.currentCurve.p1;return{startPoint:e,controlPoint:n,endPoint:r,startWidth:this.curveStartWidth,endWidth:this.curveEndWidth}}computeExitingVec(){return this.momentum.normalized().times(this.lastPoint.width/2)}addPoint(o){if(this.lastPoint){let w=o.time-this.lastPoint.time;if(o.pos.eq(this.lastPoint.pos,1e-10)||w===0)return;if(isNaN(o.pos.magnitude())){console.warn("Discarding NaN point.",o);return}let C=Math.min(this.lastPoint.width,o.width)/3;if(this.startPoint.pos.distanceTo(o.pos)<C&&this.isFirstSegment)return;let P=w/1e3,S=o.pos.minus(this.lastPoint.pos).times(1/P);this.momentum=S}let e=this.lastPoint??o;this.lastPoint=o,this.buffer.push(o.pos);let r=o.width,n=this.curveEndWidth;if(this.curveEndWidth=r,this.bbox=this.bbox.grownToPoint(o.pos,r),this.currentCurve===null){let m=e.pos,w=e.pos.plus(this.lastExitingVec??T.unitX),C=o.pos;this.currentCurve=new $e(m,w,C),console.assert(!isNaN(m.magnitude())&&!isNaN(w.magnitude())&&!isNaN(C.magnitude()),"Expected !NaN"),this.isFirstSegment?this.curveStartWidth=(this.curveStartWidth+r)/2:this.curveStartWidth=n}let i=this.lastExitingVec;if(!i){let m=Math.ceil(this.buffer.length/2);(m===0||m>=this.buffer.length)&&(m=this.buffer.length-1),i=this.buffer[m].minus(this.buffer[0])}let a=this.computeExitingVec(),l=1.7,c=this.buffer[0],d=o.pos,p=d.distanceTo(c),u=l*p;if(u===0||a.magnitude()===0||!isFinite(a.magnitude()))return;console.assert(isFinite(i.magnitude()),"Pre-normalized enteringVec has NaN or \u221E magnitude!"),i=i.normalized(),a=a.normalized(),console.assert(isFinite(i.magnitude()),"Normalized enteringVec has NaN or \u221E magnitude!");let h=new ge(c,c.plus(i.times(u))),b=new ge(d.minus(a.times(u)),d).intersection(h),v=null;b&&(v=b.point),v||(v=c.lerp(d,.5).lerp(c.plus(i.times(p)),.1)),(c.eq(v)||d.eq(v))&&(v=c.plus(i.times(p/5))),console.assert(!c.eq(v,1e-11),"Start and control points are equal!"),console.assert(!v.eq(d,1e-11),"Control and end points are equal!");let g=this.currentCurve;this.currentCurve=new $e(c,v,d),isNaN(this.currentCurve.normal(0).magnitude())&&(console.error("NaN normal at 0. Curve:",this.currentCurve),this.currentCurve=g);let y=m=>{let w=Math.min(Math.max(Math.min(this.curveStartWidth,this.curveEndWidth)/4,this.minFitAllowed),this.maxFitAllowed),C=w,E=0;for(let P of this.buffer){let S=m.approximateDistance(P);if(S>w&&(S=m.distance(P),E+=Math.max(0,S-w),E>C))return!1}return!0};if(this.buffer.length>3&&this.approxCurrentCurveLength()>this.curveStartWidth/2&&!y(this.currentCurve)){this.currentCurve=g,this.curveEndWidth=n,this.lastPoint=e,this.finalizeCurrentCurve();return}}};var Zl=s=>(o,e)=>new ci(s,o,e),Zt=Zl,Bs=(s,o,e)=>({points:[s,o[o.length-1]]}),Ds=(s,o,e)=>({points:[...e.corners,e.corners[0]]}),ci=class{constructor(o,e,r){this.sourceFactory=o;this.startPoint=e;this.viewport=r;this.builder=o(e,r),this.points=[e],this.builder.inkTrailStyle&&(this.inkTrailStyle=this.builder.inkTrailStyle.bind(this.builder))}getBBox(){return this.builder.getBBox()}build(){return this.builder.build()}preview(o){this.builder.preview(o)}addPoint(o){this.points.push(o),this.builder.addPoint(o)}async autocorrectShape(){let o=this.viewport.canvasToScreen(this.startPoint.pos),e=this.points.map(E=>this.viewport.canvasToScreen(E.pos)),r=R.bboxOf(e),n=this.viewport.canvasToScreen(this.viewport.snapToGrid(this.startPoint.pos)),i=this.points.map(E=>this.viewport.canvasToScreen(this.viewport.snapToGrid(E.pos))),a=R.bboxOf(i);if(r.maxDimension<32)return null;let l=Math.min(30,r.maxDimension/4),c=[{...Bs(n,i,a),toleranceMultiplier:.5},Bs(o,e,r),{...Ds(n,i,a),toleranceMultiplier:.6},Ds(o,e,r)],p=(E=>{for(let P of c){let S=P.points,B=E*E*(P.toleranceMultiplier??1),V=te=>{for(;te<0;)te+=S.length;return te%=S.length,S[te]},F=null,U=1/0,j=0;for(let te=0;te<S.length;te++){let ve=S[te],ye=ve.squareDistanceTo(o);(!F||ye<U)&&(U=ye,F=ve,j=te)}let Z=0,se=j;for(let te of e){let ve=1/0,ye=se,qe=6;for(let st=-qe;st<=qe;st++){let Fe=se+st,Tt=V(Fe-1),Nt=V(Fe),Ke=V(Fe+1),cr=new ge(Tt,Nt),dr=new ge(Nt,Ke),xn=cr.distance(te),Qe=dr.distance(te),pr=Math.min(xn,Qe),So=pr*pr;So<ve&&(ve=So,ye=Fe)}if(se=ye,Z=Math.max(ve,Z),Z>B)break}if(Z<B)return S}return null})(l);if(!p)return null;let u=this.points[this.points.length-1],h=this.startPoint.width,f=u.width,b=this.startPoint.color,v=u.color,g=this.startPoint.time,y=u.time,m=E=>{let P=p[Math.max(0,Math.floor(E))],S=p[Math.min(Math.ceil(E),p.length-1)],B=P.lerp(S,E-Math.floor(E)),V=E/p.length;return{pos:this.viewport.screenToCanvas(B),width:h*(1-V)+f*V,color:b.mix(v,V),time:g*(1-V)+y*V}},w=this.sourceFactory(m(0),this.viewport),C=p.length<10;for(let E=0;E<p.length;E++)C&&w.addPoint(m(E-.001)),w.addPoint(m(E)),C&&w.addPoint(m(E+.001));return w.build()}};var ht=Zt((s,o)=>{let e=o.getSizeOfPixelOnCanvas()*3,r=o.getSizeOfPixelOnCanvas();return new $r(s,r,e,o)}),$r=class{constructor(o,e,r,n){this.startPoint=o;this.minFitAllowed=e;this.viewport=n;this.isFirstSegment=!0;this.parts=[];this.widthAverageNumSamples=1;this.curveFitter=new jt(o,e,r,i=>this.addCurve(i)),this.averageWidth=o.width,this.bbox=new R(this.startPoint.pos.x,this.startPoint.pos.y,0,0)}getBBox(){return this.bbox}getRenderingStyle(){return{fill:M.transparent,stroke:this.inkTrailStyle()}}inkTrailStyle(){return{color:this.startPoint.color,width:this.roundDistance(this.averageWidth)}}previewCurrentPath(){let e=[...this.parts.slice(),...this.curveToPathCommands(this.curveFitter.preview())];return{startPoint:this.startPoint.pos,commands:e,style:this.getRenderingStyle()}}previewFullPath(){let o=this.previewCurrentPath();return o?[o]:null}previewStroke(){let o=this.previewFullPath();return o?new ae(o):null}preview(o){let e=this.previewFullPath();if(e){let r=this.viewport.visibleRect;o.startObject(r);for(let n of e)o.drawPath(n);o.endObject()}}build(){return this.curveFitter.finalizeCurrentCurve(),this.previewStroke()}getMinFit(){let o=Math.min(this.minFitAllowed,this.averageWidth/3);return o<1e-10&&(o=this.minFitAllowed),o}roundPoint(o){let e=this.getMinFit();return q.roundPoint(o,e)}roundDistance(o){let e=this.getMinFit();return q.roundPoint(o,e)}curveToPathCommands(o){if(!o){if(!this.isFirstSegment)return[];let r=q.roundPoint(this.averageWidth/10,Math.min(this.minFitAllowed,this.averageWidth/10)),n=this.roundPoint(this.startPoint.pos);return[{kind:3,controlPoint:n.plus(T.of(r,r)),endPoint:n.plus(T.of(0,r))},{kind:3,controlPoint:n.plus(T.of(-r,r)),endPoint:n.plus(T.of(-r,0))},{kind:3,controlPoint:n.plus(T.of(-r,-r)),endPoint:n.plus(T.of(0,-r))},{kind:3,controlPoint:n.plus(T.of(r,-r)),endPoint:n.plus(T.of(r,0))}]}let e=[];return this.isFirstSegment&&e.push({kind:1,point:this.roundPoint(o.startPoint)}),e.push({kind:3,controlPoint:this.roundPoint(o.controlPoint),endPoint:this.roundPoint(o.endPoint)}),e}addCurve(o){let e=this.curveToPathCommands(o);this.parts.push(...e),this.isFirstSegment&&(this.isFirstSegment=!1)}addPoint(o){this.curveFitter.addPoint(o),this.widthAverageNumSamples++,this.averageWidth=this.averageWidth*(this.widthAverageNumSamples-1)/this.widthAverageNumSamples+o.width/this.widthAverageNumSamples}};var Ae=class{#e=null;constructor(){}setEmitListener(o){o&&typeof o=="object"?this.#e=e=>o.onEvent(e)??!1:this.#e=o}emit(o){return this.#e?.(o)??!1}};var Yl={kind:0,mass:.4,springConstant:100,frictionCoefficient:.28,maxPointDist:10,inertiaFraction:.75,minSimilarityToFinalize:0,velocityDecayFactor:.1},di=class{constructor(o,e,r){this.updatePointer=e;this.options=r;this.runLoop=!0;this.lastUpdateTime=0;this.velocity=T.zero;this.strokePoint=o,this.targetPoint=o,this.targetInterval=10,this.loop()}async loop(){for(this.lastUpdateTime=performance.now();this.runLoop;)this.update(!1),await tt()}setTarget(o){this.targetPoint=o}getNextVelocity(o){let e=this.targetPoint.minus(this.strokePoint),r=e.times(this.options.springConstant),i=this.options.mass*10,a=this.velocity.normalizedOrZero().times(-this.options.frictionCoefficient*i),l=r.plus(a).times(1/this.options.mass),c=this.options.velocityDecayFactor,d=this.velocity.times(1-c).plus(l.times(o/1e3));return e.normalizedOrZero().times(d.length()).lerp(d,this.options.inertiaFraction)}update(o){let e=performance.now(),r=e-this.lastUpdateTime,n=this.strokePoint.eq(this.targetPoint);if(r>this.targetInterval||o){if(!n){let i,a,l=1;do i=this.getNextVelocity(r/l),a=i.times(r/1e3),l++;while(a.magnitude()>this.options.maxPointDist&&l<10);for(let c=0;c<l;c++)this.velocity=this.getNextVelocity(r/l),a=this.velocity.times(r/1e3),this.strokePoint=this.strokePoint.plus(a),c<l-1&&this.updatePointer(this.strokePoint,e)}if(this.lastUpdateTime=e,o||!n)return this.updatePointer(this.strokePoint,e)}return!1}finish(){this.runLoop=!1;let o=this.targetPoint.minus(this.strokePoint);this.velocity.dot(o)>this.options.minSimilarityToFinalize&&this.updatePointer(this.targetPoint,performance.now())}cancel(){this.runLoop=!1}},Rt=class s extends Ae{constructor(e,r=Yl){super();this.viewport=e;this.options=r;this.stabilizer=null;this.lastPointerEvent=null}mapPointerEvent(e){return zo(e)&&e.kind!==2&&(this.lastPointerEvent=e),e.kind===3||e.allPointers.length>1||this.stabilizer===null?this.emit(e):(this.stabilizer.setTarget(e.current.screenPos),e.kind===1?this.stabilizer.update(!0):e.kind===2?(this.stabilizer.finish(),this.emit(e)):this.emit(e))}emitPointerMove(e,r){if(!this.lastPointerEvent)return!1;let n=this.lastPointerEvent.current.withScreenPosition(e,this.viewport).withTimestamp(r),i={kind:1,current:n,allPointers:[n]};return this.emit(i)}onEvent(e){if(zo(e)||e.kind===3){e.kind===0&&(e.allPointers.length>1?(this.stabilizer?.cancel(),this.stabilizer=null):(this.stabilizer?.cancel(),this.stabilizer=new di(e.current.screenPos,(n,i)=>this.emitPointerMove(n,i),this.options)));let r=this.mapPointerEvent(e);return(e.kind===2||e.kind===3)&&(this.stabilizer?.cancel(),this.stabilizer=null),r}return this.emit(e)}static fromEditor(e){return new s(e.viewport)}};var Wr={maxSpeed:8.5,maxRadius:11,minTimeSeconds:.5},zt=class{constructor(o,e,r){this.config=e;this.onStationary=r;this.timeout=null;this.stationaryStartPointer=o,this.lastPointer=o,this.averageVelocity=T.zero,this.setStationaryTimeout(this.config.minTimeSeconds*1e3)}onPointerMove(o){if(!this.stationaryStartPointer)return;if(o.id!==this.stationaryStartPointer.id)return!1;let e=o.screenPos.minus(this.lastPointer.screenPos),r=o.screenPos.minus(this.stationaryStartPointer.screenPos),n=(o.timeStamp-this.lastPointer.timeStamp)/1e3;n===0&&(n=1);let i=e.times(1/n);this.averageVelocity=this.averageVelocity.lerp(i,.5);let a=o.timeStamp-this.stationaryStartPointer.timeStamp,l=r.length()>this.config.maxRadius;if(this.hasMovedOutOfRadius||=l,l||this.averageVelocity.length()>this.config.maxSpeed||a<this.config.minTimeSeconds)return this.stationaryStartPointer=o,this.lastPointer=o,this.setStationaryTimeout(this.config.minTimeSeconds*1e3),!1;let c=this.config.minTimeSeconds*1e3-a;return this.lastPointer=o,c<=0}onPointerUp(o){o.id!==this.stationaryStartPointer?.id&&this.cancelStationaryTimeout()}destroy(){this.cancelStationaryTimeout(),this.stationaryStartPointer=null}getHasMovedOutOfRadius(){return this.hasMovedOutOfRadius}cancelStationaryTimeout(){this.timeout!==null&&(clearTimeout(this.timeout),this.timeout=null)}setStationaryTimeout(o){this.timeout===null&&(o<=0?this.onStationary(this.lastPointer):this.timeout=setTimeout(()=>{if(this.timeout=null,!this.stationaryStartPointer)return;let e=performance.now()-this.stationaryStartPointer.timeStamp,r=this.config.minTimeSeconds*1e3-e;r<=0?this.onStationary(this.lastPointer):this.setStationaryTimeout(r)},o))}};var _e=class extends _{constructor(e,r,n){super(e.notifier,r);this.editor=e;this.builder=null;this.lastPoint=null;this.startPoint=null;this.currentDeviceType=null;this.currentPointerId=null;this.shapeAutocompletionEnabled=!1;this.pressureSensitivityEnabled=!0;this.autocorrectedShape=null;this.lastAutocorrectedShape=null;this.removedAutocorrectedShapeTime=0;this.stationaryDetector=null;this.styleValue=Y.fromInitialValue({factory:ht,color:M.blue,thickness:4,...n}),this.styleValue.onUpdateAndNow(i=>{this.style=i,this.noteUpdated()}),this.wetInkRenderer=this.editor.display.getWetInkRenderer()}getPressureMultiplier(){let e=this.style.thickness;return 1/this.editor.viewport.getScaleFactor()*e}toStrokePoint(e){let i=Math.max(e.pressure??1,.3);isFinite(i)||(console.warn("Non-finite pressure!",e),i=.3),console.assert(isFinite(e.canvasPos.length()),"Non-finite canvas position!"),console.assert(isFinite(e.screenPos.length()),"Non-finite screen position!"),console.assert(isFinite(e.timeStamp),"Non-finite timeStamp on pointer!");let a=e.canvasPos;return this.getPressureSensitivityEnabled()||(i=.5),{pos:a,width:i*this.getPressureMultiplier(),color:this.style.color,time:e.timeStamp}}previewStroke(){if(this.editor.clearWetInk(),this.autocorrectedShape){let e=this.editor.viewport.visibleRect;this.autocorrectedShape.render(this.wetInkRenderer,e)}else if(this.builder&&(this.builder.preview(this.wetInkRenderer),this.builder.inkTrailStyle)){let e=this.builder.inkTrailStyle();this.wetInkRenderer.getDraftInkPresenter().updateStyle(e)}}addPointToStroke(e){if(!this.builder)throw new Error("No stroke is currently being generated.");this.builder.addPoint(e),this.lastPoint=e,this.previewStroke()}onPointerDown(e){if(this.builder&&!this.eventCanCancelStroke(e))return!0;let{current:r,allPointers:n}=e,i=r.device===1,a=r.device===0;return n.length===1&&!i||a?(this.startPoint=this.toStrokePoint(r),this.builder=this.style.factory(this.startPoint,this.editor.viewport),this.currentDeviceType=r.device,this.currentPointerId=r.id,this.shapeAutocompletionEnabled?this.stationaryDetector=new zt(r,Wr,l=>this.autocorrectShape(l)):this.stationaryDetector=null,this.lastAutocorrectedShape=null,this.removedAutocorrectedShapeTime=0,this.builder.inkTrailStyle&&this.wetInkRenderer.getDraftInkPresenter().setEnabled(r.id,!0),!0):!1}eventCanCancelStroke(e){let r=this.lastPoint?.time??0;if(e.current.timeStamp-r>1e3)return!0;let n=this.currentDeviceType===0,i=e.current.device===2;return!(n&&i)}eventCanBeDeliveredToNonActiveTool(e){return this.eventCanCancelStroke(e)}onPointerMove({current:e}){if(!this.builder||e.device!==this.currentDeviceType||e.id!==this.currentPointerId)return;this.stationaryDetector?.onPointerMove(e)||(this.addPointToStroke(this.toStrokePoint(e)),this.autocorrectedShape&&(this.removedAutocorrectedShapeTime=performance.now(),this.autocorrectedShape=null,this.editor.announceForAccessibility(this.editor.localization.autocorrectionCanceled)))}onPointerUp({current:e}){if(!this.builder)return!1;if(e.id!==this.currentPointerId)return!0;this.stationaryDetector?.onPointerUp(e);let r=this.toStrokePoint(e),n={...r,width:this.lastPoint?.width??r.width};return this.addPointToStroke(n),this.finalizeStroke(),!1}postGestureCleanup(){this.currentPointerId!==null&&this.wetInkRenderer.getDraftInkPresenter().setEnabled(this.currentPointerId,!1),this.builder=null,this.lastPoint=null,this.autocorrectedShape=null,this.lastAutocorrectedShape=null,this.editor.clearWetInk(),this.stationaryDetector?.destroy(),this.stationaryDetector=null}onGestureCancel(){this.postGestureCleanup()}removedAutocorrectedShapeRecently(){return this.removedAutocorrectedShapeTime>performance.now()-320}async autocorrectShape(e){if(!this.builder||!this.builder.autocorrectShape||!this.shapeAutocompletionEnabled||this.autocorrectedShape)return;let r=await this.builder.autocorrectShape();if(!this.builder||!r)return;let n=r.getBBox().area;if(n===0||!isFinite(n))return;let i=r.description(this.editor.localization);this.editor.announceForAccessibility(this.editor.localization.autocorrectedTo(i)),this.autocorrectedShape=r,this.lastAutocorrectedShape=r,this.previewStroke()}finalizeStroke(){if(this.builder){this.lastAutocorrectedShape&&this.removedAutocorrectedShapeRecently()&&(this.autocorrectedShape=this.lastAutocorrectedShape);let e=this.autocorrectedShape??this.builder.build();if(this.previewStroke(),e.getBBox().area>0){e===this.autocorrectedShape&&this.editor.announceForAccessibility(this.editor.localization.autocorrectedTo(e.description(this.editor.localization)));let n=X.addComponent(e,!0);this.editor.dispatch(n)}else console.warn("Pen: Not adding empty stroke",e,"to the canvas.")}this.postGestureCleanup()}noteUpdated(){this.editor.notifier.dispatch(2,{kind:2,tool:this})}setColor(e){e.toHexString()!==this.style.color.toHexString()&&this.styleValue.set({...this.style,color:e})}setThickness(e){e!==this.style.thickness&&this.styleValue.set({...this.style,thickness:e})}setStrokeFactory(e){e!==this.style.factory&&this.styleValue.set({...this.style,factory:e})}setHasStabilization(e){let r=!!this.getInputMapper();e!==r&&(r?this.setInputMapper(null):this.setInputMapper(new Rt(this.editor.viewport)),this.noteUpdated())}setStrokeAutocorrectEnabled(e){e!==this.shapeAutocompletionEnabled&&(this.shapeAutocompletionEnabled=e,this.noteUpdated())}getStrokeAutocorrectionEnabled(){return this.shapeAutocompletionEnabled}setPressureSensitivityEnabled(e){e!==this.pressureSensitivityEnabled&&(this.pressureSensitivityEnabled=e,this.noteUpdated())}getPressureSensitivityEnabled(){return this.pressureSensitivityEnabled}getThickness(){return this.style.thickness}getColor(){return this.style.color}getStrokeFactory(){return this.style.factory}getStyleValue(){return this.styleValue}onKeyPress(e){let r=this.editor.shortcuts,n=r.matchesShortcut(Mo,e);if(this.builder&&n)return this.finalizeStroke(),!1;let i;return r.matchesShortcut(Do,e)?i=this.getThickness()*2/3:r.matchesShortcut(Bo,e)&&(i=this.getThickness()*3/2),i!==void 0?(i=Math.min(Math.max(1,i),256),this.setThickness(i),!0):!1}};var Mt=class{constructor(){}notifyEnabled(o){o!==this.activeTool&&(this.activeTool?.setEnabled(!1),this.activeTool=o)}};var Ur=(s,o)=>{if(o.length===0)return null;let e=o[0].description(s);for(let r of o)if(r.description(s)!==e)return null;return e};var ie=class s extends K{constructor(o){super("erase"),this.toRemove=o.map(e=>e),this.applied=!1}apply(o){for(let e of this.toRemove){let r=o.image.findParent(e);r&&(r.remove(),o.image.onDestroyElement(e))}this.applied=!0,o.queueRerender()}unapply(o){for(let e of this.toRemove)o.image.findParent(e)||X.addComponent(e).apply(o);this.applied=!1,o.queueRerender()}onDrop(o){if(this.applied)for(let e of this.toRemove)o.image.onDestroyElement(e)}description(o,e){if(this.toRemove.length===0)return e.erasedNoElements;let r=Ur(e,this.toRemove)??e.elements;return e.eraseAction(r,this.toRemove.length)}serializeToJSON(){return this.toRemove.map(e=>e.serialize())}static{K.register("erase",(o,e)=>{if(!Array.isArray(o))throw new Error("seralized erase data must be an array");let r=o.map(n=>{let i=typeof n=="string"?n:`${n.id}`;return e.image.lookupElement(i)??J.deserialize(n)});return new s(r)})}};var Xl=s=>{if(s.some(o=>o&&o.then))return Promise.all(s).then(()=>{})},pi=Xl;var qr=class extends Ne{constructor(e,r,n){super();this.commands=e;this.applyChunkSize=r;this.descriptionOverride=n}apply(e){if(this.applyChunkSize===void 0){let r=this.commands.map(n=>n.apply(e));return pi(r)}else return e.asyncApplyCommands(this.commands,this.applyChunkSize)}unapply(e){let r=[...this.commands];if(r.reverse(),this.applyChunkSize===void 0){let n=r.map(i=>i.unapply(e));return pi(n)}else return e.asyncUnapplyCommands(r,this.applyChunkSize,!1)}onDrop(e){this.commands.forEach(r=>r.onDrop(e))}description(e,r){if(this.descriptionOverride)return this.descriptionOverride;let n=[],i=null,a=0,l=0;for(let c of this.commands){let d=c.description(e,r);if(d!==i&&i!==null&&(n.push(r.unionOf(i,a)),i=null,a=0),a++,l++,i??=d,n.length>12)break}return a>1?n.push(r.unionOf(i,a)):a===1&&n.push(i),l<this.commands.length&&n.push(r.andNMoreCommands(this.commands.length-l)),n.join(", ")}},ui=class extends K{constructor(e,r,n){super("union");this.commands=e;this.applyChunkSize=r;this.descriptionOverride=n;this.nonserializableCommand=new qr(e,r,n)}serializeToJSON(){return this.serializedData?this.serializedData:{applyChunkSize:this.applyChunkSize,data:this.commands.map(e=>e.serialize()),description:this.descriptionOverride}}apply(e){return this.serializedData=this.serializeToJSON(),this.nonserializableCommand.apply(e)}unapply(e){return this.nonserializableCommand.unapply(e)}onDrop(e){this.nonserializableCommand.onDrop(e)}description(e,r){return this.nonserializableCommand.description(e,r)}},As=(s,o)=>{let e=!0;for(let i of s)if(!(i instanceof K)){e=!1;break}let r,n;if(typeof o=="number"?r=o:(r=o?.applyChunkSize,n=o?.description),e){let i=s;return new ui(i,r,n)}else return new qr(s,r,n)};K.register("union",(s,o)=>{if(typeof s.data.length!="number")throw new Error("Unions of commands must serialize to lists of serialization data.");let e=s.applyChunkSize;if(typeof e!="number"&&e!==void 0)throw new Error("serialized applyChunkSize is neither undefined nor a number.");let r=typeof s.description=="string"?s.description:void 0,n=[];for(let i of s.data)n.push(K.deserialize(i,o));return As(n,{applyChunkSize:e,description:r})});var he=As;var Bt=(e=>(e.PartialStroke="partial-stroke",e.FullStroke="full-stroke",e))(Bt||{}),hi=class extends _{constructor(e,r){super(e.notifier,e.localization.changeTool);this.editor=e;this.eraser=r}onPointerDown(e){if(e.allPointers.length===1&&e.current.device===1){let n=this.editor.toolController.getPrimaryTools().filter(i=>i.isEnabled());if(n.length?this.previousEnabledTool=n[0]:this.previousEnabledTool=null,this.previousEraserEnabledState=this.eraser.isEnabled(),this.eraser.setEnabled(!0),this.eraser.onPointerDown(e))return!0;this.restoreOriginalTool()}return!1}onPointerMove(e){this.eraser.onPointerMove(e)}restoreOriginalTool(){this.eraser.setEnabled(this.previousEraserEnabledState),this.previousEnabledTool&&this.previousEnabledTool.setEnabled(!0)}onPointerUp(e){this.eraser.onPointerUp(e),this.restoreOriginalTool()}onGestureCancel(e){this.eraser.onGestureCancel(e),this.restoreOriginalTool()}},mt=class extends _{constructor(e,r,n){super(e.notifier,r);this.editor=e;this.lastPoint=null;this.isFirstEraseEvt=!0;this.toAdd=new Set;this.eraseCommands=[];this.addCommands=[];this.thickness=n?.thickness??10,this.thicknessValue=Y.fromInitialValue(this.thickness),this.thicknessValue.onUpdate(i=>{this.thickness=i,this.editor.notifier.dispatch(2,{kind:2,tool:this})}),this.modeValue=Y.fromInitialValue(n?.mode??"full-stroke"),this.modeValue.onUpdate(i=>{this.editor.notifier.dispatch(2,{kind:2,tool:this})})}makeEraserSwitcherTool(){return new hi(this.editor,this)}clearPreview(){this.editor.clearWetInk()}getSizeOnCanvas(){return this.thickness/this.editor.viewport.getScaleFactor()}drawPreviewAt(e){this.clearPreview();let r=this.getSizeOnCanvas(),n=this.editor.display.getWetInkRenderer(),i=this.getEraserRect(e),a=this.getEraserRect(this.lastPoint??e),l={fill:M.transparent,stroke:{width:r/10,color:M.gray}};n.drawPath(Q(W.fromConvexHullOf([...i.corners,...a.corners]),l))}getEraserRect(e){let r=this.getSizeOnCanvas(),n=T.of(r/2,r/2);return R.fromCorners(e.minus(n),e.plus(n))}eraseTo(e){if(!this.isFirstEraseEvt&&e.distanceTo(this.lastPoint)===0)return;this.isFirstEraseEvt=!1;let r=this.getEraserRect(e),n=new ge(this.lastPoint,e),i=R.union(n.bbox,r),l=this.editor.image.getComponentsIntersecting(i).filter(c=>c.intersects(n)||c.intersectsRect(r)).filter(c=>c.isSelectable());if(this.modeValue.get()==="full-stroke"){this.toRemove.push(...l);let c=l.map(d=>new ie([d]));c.forEach(d=>d.apply(this.editor)),this.eraseCommands.push(...c)}else{let c=[],d=[];for(let f of l){if(c.push(f),!f.withRegionErased||r.grownBy(r.maxDimension/3).containsRect(f.getExactBBox()))continue;let v=W.fromConvexHullOf([...r.corners,...this.getEraserRect(this.lastPoint??e).corners].map(g=>this.editor.viewport.roundPoint(g)));d.push(...f.withRegionErased(v,this.editor.viewport))}let p=new ie(c),u=d.map(f=>X.addComponent(f));p.apply(this.editor),u.forEach(f=>f.apply(this.editor));let h=[];for(let f of c)this.toAdd.has(f)?this.toAdd.delete(f):h.push(f);this.toRemove.push(...h);for(let f of d)this.toAdd.add(f);this.eraseCommands.push(new ie(h)),this.addCommands.push(...u)}this.drawPreviewAt(e),this.lastPoint=e}onPointerDown(e){return e.allPointers.length===1||e.current.device===1?(this.lastPoint=e.current.canvasPos,this.toRemove=[],this.toAdd.clear(),this.isFirstEraseEvt=!0,this.drawPreviewAt(e.current.canvasPos),!0):!1}onPointerMove(e){let r=e.current.canvasPos;this.eraseTo(r)}onPointerUp(e){this.eraseTo(e.current.canvasPos);let r=[];if(this.addCommands.length>0){this.addCommands.forEach(n=>n.unapply(this.editor));for(let n of this.toAdd)this.toRemove.includes(n)&&(this.toAdd.delete(n),this.toRemove=this.toRemove.filter(i=>i!==n));for(let n of this.toRemove)this.toAdd.has(n)&&(this.toAdd.delete(n),this.toRemove=this.toRemove.filter(i=>i!==n));r.push(...[...this.toAdd].map(n=>X.addComponent(n))),this.addCommands=[]}if(this.eraseCommands.length>0){this.eraseCommands.forEach(i=>i.unapply(this.editor)),this.eraseCommands=[];let n=new ie(this.toRemove);r.push(n)}r.length===1?this.editor.dispatch(r[0]):this.editor.dispatch(he(r)),this.clearPreview()}onGestureCancel(e){this.addCommands.forEach(r=>r.unapply(this.editor)),this.eraseCommands.forEach(r=>r.unapply(this.editor)),this.eraseCommands=[],this.addCommands=[],this.clearPreview()}onKeyPress(e){let r=this.editor.shortcuts,n;return r.matchesShortcut(Do,e)?n=this.getThickness()*2/3:r.matchesShortcut(Bo,e)&&(n=this.getThickness()*3/2),n!==void 0?(n=Math.min(Math.max(1,n),200),this.setThickness(n),!0):!1}getThickness(){return this.thickness}setThickness(e){this.thicknessValue.set(e)}getThicknessValue(){return this.thicknessValue}getModeValue(){return this.modeValue}};var Vs="text";var Ql={fontFamily:"sans",size:12,renderingStyle:{fill:M.purple}},ue=class s extends J{constructor(e,r,n=Ql,i=0){super(Vs);this.textObjects=e;this.transform=r;this.style=n;this.transformMode=i;this.isRestylableComponent=!0;this.recomputeBBox(),!e.some(l=>typeof l=="string")&&e.length>0&&(this.style=e[0].getTextStyle())}static applyTextStyles(e,r){let n=r.fontFamily.match(/\s/),i=r.fontFamily.match(/^".*"$/),a=n&&!i?`"${r.fontFamily.replace(/["]/g,'\\"')}"`:r.fontFamily;e.font=[r.fontStyle??"",r.fontWeight??"",(r.size??12)+"px",`${a}`].join(" "),e.textAlign="left"}static{this.textMeasuringCtx=null}static estimateTextDimens(e,r){let n=e.length*r.size,i=r.size;return new R(0,-i*2/3,n,i)}static getTextMetrics(e,r){if(s.textMeasuringCtx??=document.createElement("canvas").getContext("2d")??null,!s.textMeasuringCtx)return null;let n=s.textMeasuringCtx;return s.applyTextStyles(n,r),n.measureText(e)}static getTextDimens(e,r){let n=this.getTextMetrics(e,r);if(!n)return this.estimateTextDimens(e,r);let i=-n.actualBoundingBoxAscent,a=n.actualBoundingBoxAscent+n.actualBoundingBoxDescent;return new R(0,i,n.width,a)}static getFontHeight(e){return e.size}computeUntransformedBBoxOfPart(e){return typeof e=="string"?s.getTextDimens(e,this.style):e.contentBBox}recomputeBBox(){let e=null,r=new s.TextCursor(this.transform,this.style);for(let n of this.textObjects){let i=r.update(n).transform,a=this.computeUntransformedBBoxOfPart(n).transformedBoundingBox(i);e??=a,e=e.union(a)}this.contentBBox=e??R.empty}renderInternal(e,r,n=k.identity){let i=new s.TextCursor(this.transform,this.style);for(let a of this.textObjects){let{transform:l,bbox:c}=i.update(a);r&&!r.intersects(c.transformedBoundingBox(n))||(typeof a=="string"?e.drawText(a,l,this.style):(e.pushTransform(l),a.renderInternal(e,r,n.rightMul(l)),e.popTransform()))}}render(e,r){e.startObject(this.contentBBox),this.renderInternal(e,r),e.endObject(this.getLoadSaveData())}getProportionalRenderingTime(){return this.textObjects.length}intersects(e){let r=new s.TextCursor(this.transform,this.style);for(let n of this.textObjects){let i=r.update(n).transform.inverse(),a=e.transformedBy(i);if(typeof n=="string"){if(s.getTextDimens(n,this.style).getEdges().some(c=>a.intersection(c)!==null))return!0}else if(n.intersects(a))return!0}return!1}getStyle(){return{color:this.style.renderingStyle.fill,textStyle:{...this.style,renderingStyle:{...this.style.renderingStyle}}}}updateStyle(e){return Lt(this.getStyle(),e,this)}forceStyle(e,r){if(e.textStyle)this.style=si(e.textStyle);else if(e.color)this.style={...this.style,renderingStyle:{...this.style.renderingStyle,fill:e.color}};else return;for(let n of this.textObjects)n instanceof s&&n.forceStyle(e,r);r&&(r.image.queueRerenderOf(this),r.queueRerender())}getTextStyle(){return si(this.style)}getBaselinePos(){return this.transform.transformVec2(T.zero)}getTransform(){return this.transform}applyTransformation(e){this.transform=e.rightMul(this.transform),this.recomputeBBox()}createClone(){let e=this.textObjects.map(r=>typeof r=="string"?r:r.createClone());return new s(e,this.transform,this.style)}getText(){let e=[];for(let r of this.textObjects)typeof r=="string"?e.push(r):e.push(r.getText());return e.join(`
`)}description(e){return e.text(this.getText())}serializeToJSON(){let e=Fr(this.style);return{textObjects:this.textObjects.map(n=>typeof n=="string"?{text:n}:{json:n.serializeToJSON()}),transform:this.transform.toArray(),style:e}}static deserializeFromString(e){typeof e=="string"&&(e=JSON.parse(e));let r=Or(e.style),n=e.textObjects.map(l=>(l.text??null)!==null?l.text:s.deserializeFromString(l.json));if(e.transform=e.transform.filter(l=>typeof l=="number"),e.transform.length!==9)throw new Error(`Unable to deserialize transform, ${e.transform}.`);let i=e.transform,a=new k(...i);return new s(n,a,r)}static fromLines(e,r,n){let i=null,a=[],l=Math.round(this.getFontHeight(n)),c=T.zero;for(let d of e){i&&(c=c.plus(T.unitY.times(l)));let p=new s([d],k.translation(c),n);a.push(p),i=p}return new s(a,r,n)}static{this.TextCursor=class{constructor(e=k.identity,r){this.parentTransform=e;this.parentStyle=r;this.transform=k.identity}update(e){let r=k.identity,n=k.identity,i;typeof e=="string"?i=s.getTextDimens(e,this.parentStyle):(n=e.transform,i=e.getBBox());let a=typeof e=="string"?1:e.transformMode;a===1?r=this.transform.rightMul(r):(a===2||a===3)&&(r=this.transform.mapEntries((p,[u,h])=>{if(a===2)return u===1&&h===2?0:p;if(a===3)return u===0&&h===2?0:p;throw new Error("Unreachable")}).rightMul(r));let l=k.translation(T.of(i.width,0));this.transform=r.rightMul(n).rightMul(l);let c=this.parentTransform.rightMul(r);return{transform:c,bbox:i.transformedBoundingBox(c)}}}}};J.registerComponent(Vs,s=>ue.deserializeFromString(s));var Jl={setEnabled:()=>{},updateStyle:()=>{}},Ve=class{constructor(o){this.viewport=o;this.selfTransform=null;this.transformStack=[];this.objectLevel=0;this.currentPaths=null}getViewport(){return this.viewport}setDraftMode(o){}getDraftInkPresenter(){return Jl}flushPath(){if(!this.currentPaths)return;let o=null;for(let e of this.currentPaths){let{startPoint:r,commands:n,style:i}=e;!o||!Dr(o,i)?(o&&this.endPath(o),this.beginPath(r),o=i):this.moveTo(r);for(let a of n)a.kind===0?this.lineTo(a.point):a.kind===1?this.moveTo(a.point):a.kind===2?this.traceCubicBezierCurve(a.controlPoint1,a.controlPoint2,a.endPoint):a.kind===3&&this.traceQuadraticBezierCurve(a.controlPoint,a.endPoint)}o&&this.endPath(o),this.currentPaths=[]}drawPath(o){this.objectLevel===0||this.currentPaths===null?(this.currentPaths=[o],this.flushPath(),this.currentPaths=null):this.currentPaths.push(o)}drawRect(o,e,r){let n=W.fromRect(o,e);this.drawPath(Q(n,r))}fillRect(o,e){let r=W.fromRect(o);this.drawPath(Q(r,{fill:e}))}startObject(o,e){this.objectLevel>0&&this.flushPath(),this.currentPaths=[],this.objectLevel++}endObject(o,e){if(this.flushPath(),this.currentPaths=null,this.objectLevel--,this.objectLevel<0)throw new Error("More objects have ended than have been started (negative object nesting level)!")}getNestingLevel(){return this.objectLevel}canRenderFromWithoutDataLoss(o){return!1}renderFromOtherOfSameType(o,e){throw new Error(`Unable to render from ${e}: Not implemented`)}setTransform(o){this.selfTransform=o}pushTransform(o){this.flushPath(),this.transformStack.push(this.selfTransform),this.setTransform(this.getCanvasToScreenTransform().rightMul(o))}popTransform(){if(this.transformStack.length===0)throw new Error("Unable to pop more transforms than have been pushed!");this.flushPath(),this.setTransform(this.transformStack.pop()??null)}getCanvasToScreenTransform(){return this.selfTransform?this.selfTransform:this.viewport.canvasToScreenTransform}canvasToScreen(o){return this.getCanvasToScreenTransform().transformVec2(o)}getSizeOfCanvasPixelOnScreen(){return this.getCanvasToScreenTransform().transformVec3(T.unitX).length()}overrideVisibleRect(o){this.visibleRectOverride=o}getVisibleRect(){return this.visibleRectOverride??this.viewport.visibleRect}};var Re=class s extends Ve{constructor(e,r){super(r);this.ctx=e;this.ignoreObjectsAboveLevel=null;this.ignoringObject=!1;this.currentObjectBBox=null;this.clipLevels=[];this.setDraftMode(!1)}transformBy(e){this.ctx.transform(e.a1,e.b1,e.a2,e.b2,e.a3,e.b3)}canRenderFromWithoutDataLoss(e){return e instanceof s}renderFromOtherOfSameType(e,r){if(!(r instanceof s))throw new Error(`${r} cannot be rendered onto ${this}`);e=this.getCanvasToScreenTransform().rightMul(e),this.ctx.save(),this.transformBy(e),this.ctx.drawImage(r.ctx.canvas,0,0),this.ctx.restore()}setDraftMode(e){e?(this.minSquareCurveApproxDist=9,this.minRenderSizeBothDimens=1,this.minRenderSizeAnyDimen=.1):(this.minSquareCurveApproxDist=.5,this.minRenderSizeBothDimens=.1,this.minRenderSizeAnyDimen=1e-6)}displaySize(){return T.of(this.ctx.canvas.clientWidth,this.ctx.canvas.clientHeight)}clear(){this.ctx.save(),this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}beginPath(e){e=this.canvasToScreen(e),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y)}endPath(e){e.fill.a>0&&(this.ctx.fillStyle=e.fill.toHexString(),this.ctx.fill()),e.stroke&&(this.ctx.strokeStyle=e.stroke.color.toHexString(),this.ctx.lineWidth=this.getSizeOfCanvasPixelOnScreen()*e.stroke.width,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.stroke(),this.ctx.lineWidth=1),this.ctx.closePath()}lineTo(e){e=this.canvasToScreen(e),this.ctx.lineTo(e.x,e.y)}moveTo(e){e=this.canvasToScreen(e),this.ctx.moveTo(e.x,e.y)}traceCubicBezierCurve(e,r,n){e=this.canvasToScreen(e),r=this.canvasToScreen(r),n=this.canvasToScreen(n);let i=r.minus(e),a=n.minus(r);i.magnitudeSquared()<this.minSquareCurveApproxDist&&a.magnitudeSquared()<this.minSquareCurveApproxDist?this.ctx.lineTo(n.x,n.y):this.ctx.bezierCurveTo(e.x,e.y,r.x,r.y,n.x,n.y)}traceQuadraticBezierCurve(e,r){e=this.canvasToScreen(e),r=this.canvasToScreen(r),e.minus(r).magnitudeSquared()<this.minSquareCurveApproxDist?this.ctx.lineTo(r.x,r.y):this.ctx.quadraticCurveTo(e.x,e.y,r.x,r.y)}drawPath(e){if(this.ignoringObject)return;let r=this.getVisibleRect();this.currentObjectBBox?.containsRect(r)&&(e=li(e,r)),super.drawPath(e)}drawText(e,r,n){this.ctx.save(),r=this.getCanvasToScreenTransform().rightMul(r),this.transformBy(r),ue.applyTextStyles(this.ctx,n),n.renderingStyle.fill.a!==0&&(this.ctx.fillStyle=n.renderingStyle.fill.toHexString(),this.ctx.fillText(e,0,0)),n.renderingStyle.stroke&&(this.ctx.strokeStyle=n.renderingStyle.stroke.color.toHexString(),this.ctx.lineWidth=n.renderingStyle.stroke.width,this.ctx.strokeText(e,0,0)),this.ctx.restore()}drawImage(e){if(e.image.width===0||e.image.height===0)return;this.ctx.save();let r=this.getCanvasToScreenTransform().rightMul(e.transform);this.transformBy(r),this.ctx.drawImage(e.image,0,0),this.ctx.restore()}startObject(e,r){if(this.isTooSmallToRender(e)&&(this.ignoreObjectsAboveLevel=this.getNestingLevel(),this.ignoringObject=!0),super.startObject(e),this.currentObjectBBox=e,!this.ignoringObject&&r&&!e.containsRect(this.getVisibleRect())){this.clipLevels.push(this.objectLevel),this.ctx.save(),this.ctx.beginPath();for(let i of e.corners){let a=this.canvasToScreen(i);this.ctx.lineTo(a.x,a.y)}this.ctx.clip()}}endObject(){let e=this.objectLevel;this.currentObjectBBox=null,super.endObject(),!this.ignoringObject&&this.clipLevels.length>0&&this.clipLevels[this.clipLevels.length-1]===e&&(this.ctx.restore(),this.clipLevels.pop()),this.ignoreObjectsAboveLevel!==null&&this.getNestingLevel()<=this.ignoreObjectsAboveLevel&&(this.ignoreObjectsAboveLevel=null,this.ignoringObject=!1)}drawWithRawRenderingContext(e){this.ctx.save(),this.transformBy(this.getCanvasToScreenTransform()),e(this.ctx),this.ctx.restore()}drawPoints(...e){for(let n=0;n<e.length;n++){let i=this.canvasToScreen(e[n]);this.ctx.beginPath(),this.ctx.arc(i.x,i.y,10,0,Math.PI*2),this.ctx.fillStyle=M.ofRGBA(.5+Math.sin(n)/2,1,.5+Math.cos(n*.2)/4,.5).toHexString(),this.ctx.lineWidth=2,this.ctx.fill(),this.ctx.stroke(),this.ctx.closePath(),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.ctx.fillText(`${n}`,i.x,i.y,10*2)}}isTooSmallToRender(e){let r=e.size.times(this.getSizeOfCanvasPixelOnScreen()),n=this.minRenderSizeBothDimens,i=Math.abs(r.x)<n&&Math.abs(r.y)<n,a=this.minRenderSizeAnyDimen,l=Math.abs(r.x)<a||Math.abs(r.y)<a;return i||l}static fromViewport(e,r={}){let n=document.createElement("canvas"),i=e.getScreenRectSize(),a=r.canvasSize??i;r.maxCanvasDimen&&a.maximumEntryMagnitude()>r.maxCanvasDimen&&(a=a.times(r.maxCanvasDimen/a.maximumEntryMagnitude())),n.width=a.x,n.height=a.y;let l=n.getContext("2d"),c=Math.min(a.x/i.x,a.y/i.y);return l.scale(c,c),{renderer:new s(l,e),element:n}}};var Yt="js-draw-image-background",Kr="js-draw-image-background-grid-",mi="js-draw-image-background-non-automatic-secondary-color",fi={1:"js-draw-image-background-grid",0:Yt,2:""},me=class s extends J{constructor(e,r){super("image-background",0);this.backgroundType=e;this.mainColor=r;this.viewportSizeChangeListener=null;this.autoresizeChangedListener=null;this.fillsScreen=!1;this.gridSize=q.getGridSize(2);this.gridStrokeWidth=.7;this.secondaryColor=null;this.isRestylableComponent=!0;this.contentBBox=R.empty}static ofGrid(e,r,n,i){let a=new s(1,e);return r!==void 0&&(a.gridSize=r),n!==void 0&&(a.secondaryColor=n),i!==void 0&&(a.gridStrokeWidth=i),a}getBackgroundType(){return this.backgroundType}getMainColor(){return this.mainColor}getSecondaryColor(){return this.secondaryColor}getGridSize(){return this.gridSize}getStyle(){let e=this.mainColor;return this.backgroundType===2&&(e=void 0),{color:e}}updateStyle(e){return Lt(this.getStyle(),e,this)}forceStyle(e,r){let n=e.color;n&&(this.mainColor=n,n.eq(M.transparent)&&this.backgroundType===0?this.backgroundType=2:this.backgroundType===2&&(this.backgroundType=0),r&&(r.image.queueRerenderOf(this),r.queueRerender()))}onAddToImage(e){this.viewportSizeChangeListener&&(console.warn("onAddToImage called when background is already in an image"),this.onRemoveFromImage()),this.viewportSizeChangeListener=e.notifier.on(0,()=>{this.recomputeBBox(e)}),this.autoresizeChangedListener=e.notifier.on(1,()=>{this.recomputeBBox(e)}),this.recomputeBBox(e)}onRemoveFromImage(){this.viewportSizeChangeListener?.remove(),this.autoresizeChangedListener?.remove(),this.viewportSizeChangeListener=null,this.autoresizeChangedListener=null}recomputeBBox(e){let r=e.getImportExportViewport().visibleRect,n=!1;this.contentBBox.eq(r)||(this.contentBBox=r,n||=!this.fillsScreen);let i=e.getAutoresizeEnabled();i!==this.fillsScreen&&(this.fillsScreen=i,n=!0),n&&e.queueRerenderOf(this)}generateGridPath(e){let r=this.getFullBoundingBox(e),n=(e?.intersection(r)??r).grownBy(this.gridStrokeWidth/2),i=y=>Math.floor(y/this.gridSize)*this.gridSize,a=y=>Math.ceil(y/this.gridSize)*this.gridSize,l=a(n.y),c=i(n.y+n.h),d=a(n.x),p=i(n.x+n.w),u=[],h=(c-l)/this.gridSize,f=(p-d)/this.gridSize;if(h>1e3||f>1e3)return W.empty;let g=T.of(n.x,l);for(let y=l;y<=c;y+=this.gridSize)u.push({kind:1,point:T.of(n.x,y)}),u.push({kind:0,point:T.of(n.x+n.w,y)});for(let y=d;y<=p;y+=this.gridSize)u.push({kind:1,point:T.of(y,n.y)}),u.push({kind:0,point:T.of(y,n.y+n.h)});return new W(g,u)}getFullBoundingBox(e){return(this.fillsScreen?e:this.contentBBox)??this.contentBBox}render(e,r){if(this.backgroundType===2)return;let n=!r;this.fillsScreen&&(r??=e.getVisibleRect());let i=this.backgroundType===1,a=this.getFullBoundingBox(r);if(e.startObject(a,i),this.backgroundType===0||this.backgroundType===1){let d=r?.intersection(a);d?e.fillRect(d,this.mainColor):n&&e.fillRect(a,this.mainColor)}if(this.backgroundType===1){let d=this.secondaryColor;d??=M.ofRGBA(1-this.mainColor.r,1-this.mainColor.g,1-this.mainColor.b,.2),this.mainColor.a===0&&(d=M.ofRGBA(.5,.5,.5,.2));let p={fill:M.transparent,stroke:{width:this.gridStrokeWidth,color:d}};e.drawPath(Q(this.generateGridPath(r),p))}let l=fi[this.backgroundType],c=[Yt];if(l!==Yt){c.push(l);let d=be(this.gridSize).replace(/[.]/g,"p");c.push(Kr+d)}this.secondaryColor!==null&&c.push(mi),e.endObject(this.getLoadSaveData(),c)}intersects(e){return this.contentBBox.getEdges().some(r=>r.intersects(e))}isSelectable(){return!1}isBackground(){return!0}getSizingMode(){return this.fillsScreen?1:0}serializeToJSON(){return{mainColor:this.mainColor.toHexString(),secondaryColor:this.secondaryColor?.toHexString(),backgroundType:this.backgroundType,gridSize:this.gridSize,gridStrokeWidth:this.gridStrokeWidth}}applyTransformation(e){}description(e){return this.backgroundType===0?e.filledBackgroundWithColor(this.mainColor.toString()):this.backgroundType===2?e.emptyBackground:this.backgroundType===1?e.gridBackground:this.backgroundType}createClone(){return new s(this.backgroundType,this.mainColor)}static deserializeFromJSON(e){if(typeof e=="string"&&(e=JSON.parse(e)),typeof e.mainColor!="string")throw new Error("Error deserializing \u2014 mainColor must be of type string.");let r,n=e.backgroundType;if(n===2||n===1||n===0)r=n;else return n;let i=M.fromHex(e.mainColor),a=e.secondaryColor?M.fromHex(e.secondaryColor):null,l=e.gridSize??void 0,c=e.gridStrokeWidth??void 0,d=new s(r,i);return d.secondaryColor=a,l&&(d.gridSize=l),c&&(d.gridStrokeWidth=c),d}};J.registerComponent("image-background",me.deserializeFromJSON);var tc=async s=>{s.complete||await new Promise((o,e)=>{s.onload=r=>o(r),s.onerror=r=>e(r),s.onabort=r=>e(r)})},Os=tc;var Se=class s extends J{constructor(o){super("image-component"),this.image={...o,label:o.label??o.image.getAttribute("alt")??o.image.getAttribute("aria-label")??void 0},(r=>r.getAttribute("src")!==void 0)(o.image)&&!o.image.complete&&(o.image.onload=()=>this.recomputeBBox()),this.recomputeBBox()}getImageRect(){return new R(0,0,this.image.image.width,this.image.image.height)}recomputeBBox(){this.contentBBox=this.getImageRect(),this.contentBBox=this.contentBBox.transformedBoundingBox(this.image.transform)}static async fromImage(o,e){await Os(o);let r,n;typeof o.width=="number"&&typeof o.height=="number"&&o.width!==0&&o.height!==0?(r=o.width,n=o.height):(r=o.clientWidth,n=o.clientHeight);let i,a=o.src??"";if(a.startsWith("data:image/"))i=new Image,i.src=a,i.width=r,i.height=n;else{let l=document.createElement("canvas");l.width=r,l.height=n,l.getContext("2d").drawImage(o,0,0,l.width,l.height),a=l.toDataURL(),i=l}return i.setAttribute("alt",o.getAttribute("alt")??""),i.setAttribute("aria-label",o.getAttribute("aria-label")??""),new s({image:i,base64Url:a,transform:e})}render(o,e){o.startObject(this.contentBBox),o.drawImage(this.image),o.endObject(this.getLoadSaveData())}getProportionalRenderingTime(){return 10}intersects(o){let r=this.getImageRect().getEdges().map(n=>n.transformedBy(this.image.transform));for(let n of r)if(n.intersects(o))return!0;return!1}applyTransformation(o){this.image.transform=o.rightMul(this.image.transform),this.recomputeBBox()}description(o){return this.image.label?o.imageNode(this.image.label):o.unlabeledImageNode}getAltText(){return this.image.label}getURL(){return this.image.base64Url}getTransformation(){return this.image.transform}createClone(){return new s({...this.image})}serializeToJSON(){return{src:this.image.base64Url,label:this.image.label,width:this.image.image.width,height:this.image.image.height,transform:this.image.transform.toArray()}}static deserializeFromJSON(o){if(typeof o.src!="string")throw new Error(`${o} has invalid format! Expected src property.`);dt(o.transform),et(o.width),et(o.height);let e=new Image;e.src=o.src,e.width=o.width,e.height=o.height;let r=new k(...o.transform);return new s({image:e,base64Url:o.src,label:o.label,transform:r})}};J.registerComponent("image-component",Se.deserializeFromJSON);var Fs="svg-global-attributes",Xt=class s extends J{constructor(o){super(Fs),this.contentBBox=R.empty;let e=["viewBox","width","height"];this.attrs=o.filter(([r,n])=>!e.includes(r))}render(o,e){if(o instanceof we)for(let[r,n]of this.attrs)o.setRootSVGAttribute(r,n)}intersects(o){return!1}applyTransformation(o){}isSelectable(){return!1}getSizingMode(){return 2}createClone(){return new s(this.attrs)}description(o){return o.svgObject}serializeToJSON(){return JSON.stringify(this.attrs)}static deserializeFromString(o){return new s([])}};J.registerComponent(Fs,Xt.deserializeFromString);var Hs="unknown-svg-object",Dt=class s extends J{constructor(e){super(Hs);this.svgObject=e;this.contentBBox=R.of(e.getBoundingClientRect())}render(e,r){e instanceof we&&(e.startObject(this.contentBBox),e.drawSVGElem(this.svgObject),e.endObject(this.getLoadSaveData()))}intersects(e){return this.contentBBox.getEdges().some(r=>r.intersection(e)!==null)}applyTransformation(e){}isSelectable(){return!1}getSizingMode(){return 2}createClone(){return new s(this.svgObject.cloneNode(!0))}description(e){return e.svgObject}serializeToJSON(){return JSON.stringify({html:this.svgObject.outerHTML})}};J.registerComponent(Hs,null);var oc=(s,o,e)=>{let r=/^([-0-9.e]+)px/i,n=r.exec(s.style?.fontSize??"");!n&&s.tagName.toLowerCase()==="tspan"&&s.parentElement&&(n=r.exec(s.parentElement.style?.fontSize??"")),!n&&o&&(n=r.exec(o.fontSize));let i=12;return n&&(e.add("fontSize"),i=parseFloat(n[1])),i},Ns=oc;var rc=new R(0,0,500,500),vi="svgAttrs",yi="svgStyleAttrs",xi="svgContainerID",Gr="js-draw--autoresize";var gi=["stroke","fill","stroke-width"],ft=class s{constructor(o,e,r){this.source=o;this.onFinish=e;this.onAddComponent=null;this.onProgress=null;this.onDetermineExportRect=null;this.processedCount=0;this.totalToProcess=0;this.containerGroupIDs=[];this.encounteredIDs=[];this.plugins=r.plugins??[],this.storeUnknown=!(r.sanitize??!1),this.disableUnknownObjectWarnings=!!r.disableUnknownObjectWarnings}getStyle(o,e){let r=M.transparent,n,i=o.getAttribute("fill")??(e?.fill||o.style?.fill);if(i)try{r=M.fromString(i)}catch{console.error("Unknown fill color,",i)}let a=o.getAttribute("stroke")??e?.stroke??o.style?.stroke??"",l=o.getAttribute("stroke-width")??e?.strokeWidth??o.style?.strokeWidth??"";if(a&&l)try{let d=parseFloat(l??"1");isFinite(d)||(d=0);let p=M.fromString(a);p.a>0&&(n={width:d,color:p})}catch(d){console.error("Error parsing stroke data:",d)}return{fill:r,stroke:n}}strokeDataFromElem(o){let e=[],r=o.getAttribute("d")??"",n=this.getStyle(o),i=r.split("M"),a=!0;for(let l of i){let c=/^[0-9., \t\n]+$/.exec(l);if(l!==""&&!c){let d=a?l:`M${l}`,p=W.fromString(d),u=Q(p,n);e.push(u)}a=!1}return e}attachUnrecognisedAttrs(o,e,r,n){if(this.storeUnknown){for(let i of e.getAttributeNames())r.has(i)||i==="style"&&n||o.attachLoadSaveData(vi,[i,e.getAttribute(i)]);if(n&&e.style)for(let i=0;i<e.style.length;i++){let a=e.style[i];a===""||!a||n.has(a)||o.attachLoadSaveData(yi,{key:a,value:e.style.getPropertyValue(a),priority:e.style.getPropertyPriority(a)})}}}async addPath(o){let e;try{let r=this.strokeDataFromElem(o);e=new ae(r),this.attachUnrecognisedAttrs(e,o,new Set([...gi,"d"]),new Set(gi))}catch(r){if(console.error("Invalid path in node",o,`
Error:`,r,`
Adding as an unknown object.`),this.storeUnknown)e=new Dt(o);else return}await this.addComponent(e)}async addBackground(o){if(o.classList.contains(fi[1])){let e,r,n;if(o.tagName.toLowerCase()==="g"){if(o.children.length!==2){await this.addUnknownNode(o);return}let p=o.children[0],u=o.children[1];r=p.getAttribute("fill"),e=u.getAttribute("stroke"),n=u.getAttribute("stroke-width")}else r=o.getAttribute("fill"),e=o.getAttribute("stroke"),n=o.getAttribute("stroke-width");if(r??=M.transparent.toHexString(),!e){await this.addUnknownNode(o);return}let i;for(let p of o.classList)if(p.startsWith(Kr)){let u=p.substring(Kr.length);i=parseFloat(u.replace(/p/g,"."))}let a;n&&(a=parseFloat(n));let l=M.fromString(r),c=M.fromString(e);o.classList.contains(mi)||(c=void 0);let d=me.ofGrid(l,i,c,a);await this.addComponent(d)}else if(o.tagName.toLowerCase()==="path"){let e=M.fromString(o.getAttribute("fill")??o.style.fill??"black"),r=new me(0,e);await this.addComponent(r)}else await this.addUnknownNode(o)}getComputedStyle(o){try{return window.getComputedStyle(o)}catch(e){console.warn("Error computing style",e);return}}getTransform(o,e,r){let n="data-highp-transform",i=o.getAttribute(n),a;if(i)try{a=k.fromCSSMatrix(i),e?.push(n)}catch(l){console.warn(`Unable to parse raw transform data, ${i}. Falling back to CSS data. Error:`,l)}if(!a){r??=this.getComputedStyle(o);let l=r?.transform;(!l||l==="none")&&(l=o.style?.transform||"none");try{a=k.fromCSSMatrix(o.style.transform)}catch(p){console.warn("matrix parse error",p),a=k.fromCSSMatrix(l)}let c=o.getAttribute("x"),d=o.getAttribute("y");if(c||d){let p=parseFloat(c??"0"),u=parseFloat(d??"0");!isNaN(p)&&!isNaN(u)&&(e?.push("x","y"),a=a.rightMul(k.translation(T.of(p,u))))}}return a}makeText(o){let e=[];for(let h of o.childNodes)if(h.nodeType===Node.TEXT_NODE)e.push(h.nodeValue??"");else if(h.nodeType===Node.ELEMENT_NODE){let f=h;if(f.tagName.toLowerCase()==="tspan")e.push(this.makeText(f));else throw new Error(`Unrecognized text child element: ${f}`)}else throw new Error(`Unrecognized text child node: ${h}.`);e.length===0&&e.push("");let r=this.getComputedStyle(o),n=new Set(["fontFamily","transform",...gi]),i={size:Ns(o,r,n),fontFamily:r?.fontFamily||o.style?.fontFamily||"sans-serif",fontWeight:r?.fontWeight||o.style?.fontWeight||void 0,fontStyle:r?.fontStyle||o.style?.fontStyle||void 0,renderingStyle:this.getStyle(o,r)},a=[],l=this.getTransform(o,a,r),c=0,d=o.getAttribute("dx");d&&(c=2,l=l.rightMul(k.translation(T.of(parseFloat(d),0))),a.push("dx"));let p=o.getAttribute("dy");p&&(c===2?c=1:c=3,l=l.rightMul(k.translation(T.of(0,parseFloat(p)))),a.push("dy"));let u=new ue(e,l,i,c);return this.attachUnrecognisedAttrs(u,o,new Set(a),new Set(n)),u}async addText(o){try{let e=this.makeText(o);await this.addComponent(e)}catch(e){console.error("Invalid text object in node",o,". Continuing.... Error:",e),this.addUnknownNode(o)}}async addImage(o){let e=new Image;e.src=o.getAttribute("xlink:href")??o.href.baseVal,e.setAttribute("alt",o.getAttribute("aria-label")??"");try{let r=[],n=this.getTransform(o,r),i=await Se.fromImage(e,n);this.attachUnrecognisedAttrs(i,o,new Set(r),new Set(["transform"])),await this.addComponent(i)}catch(r){console.error("Error loading image:",r,". Element: ",o,". Continuing..."),await this.addUnknownNode(o)}}async addUnknownNode(o){if(this.storeUnknown){let e=new Dt(o);await this.addComponent(e)}}async startGroup(o){o=o.cloneNode(!1);let e=o.id||`id-${this.encounteredIDs.length}`,r=0,n="";for(;this.encounteredIDs.includes(e+n);)r++,n="--"+r;e+=n,o.replaceChildren(),o.id=e;let i=new Dt(o);this.addComponent(i),this.containerGroupIDs.push(o.id),this.encounteredIDs.push(o.id)}async endGroup(){this.containerGroupIDs.pop()}async addComponent(o){this.containerGroupIDs.length>0&&o.attachLoadSaveData(xi,[...this.containerGroupIDs]),await this.onAddComponent?.(o)}updateViewBox(o){let e=o.getAttribute("viewBox");if(this.rootViewBox||!e)return;let r=e.split(/[ \t\n,]+/),n=parseFloat(r[0]),i=parseFloat(r[1]),a=parseFloat(r[2]),l=parseFloat(r[3]);if(isNaN(n)||isNaN(i)||isNaN(a)||isNaN(l)){console.warn(`node ${o} has an unparsable viewbox. Viewbox: ${e}. Match: ${r}.`);return}let c=o.classList.contains(Gr);this.rootViewBox=new R(n,i,a,l),this.onDetermineExportRect?.(this.rootViewBox,{autoresize:c})}async updateSVGAttrs(o){this.storeUnknown&&await this.onAddComponent?.(new Xt(this.getSourceAttrs(o)))}async visit(o){this.totalToProcess+=o.childElementCount;let e=!0,r=async()=>{for(let i of this.plugins)if(await i.visit(o,{addComponent:l=>this.onAddComponent?.(l)}))return e=!1,!0;return!1},n=async()=>{switch(o.tagName.toLowerCase()){case"g":o.classList.contains(Yt)?(await this.addBackground(o),e=!1):await this.startGroup(o);break;case"path":o.classList.contains(Yt)?await this.addBackground(o):await this.addPath(o);break;case"text":await this.addText(o),e=!1;break;case"image":await this.addImage(o),e=!1;break;case"svg":this.updateViewBox(o),this.updateSVGAttrs(o);break;case"style":o.getAttribute("id")!==Ao&&await this.addUnknownNode(o);break;default:this.disableUnknownObjectWarnings||(console.warn("Unknown SVG element,",o,o.tagName),o instanceof SVGElement||console.warn("Element",o,"is not an SVGElement!",this.storeUnknown?"Continuing anyway.":"Skipping.")),await this.addUnknownNode(o);return}};if(await r()?e=!1:await n(),e){for(let i of o.children)await this.visit(i);o.tagName.toLowerCase()==="g"&&await this.endGroup()}this.processedCount++,await this.onProgress?.(this.processedCount,this.totalToProcess)}getSourceAttrs(o){return o.getAttributeNames().map(e=>[e,o.getAttribute(e)])}async start(o,e,r=null){this.onAddComponent=o,this.onProgress=e,this.onDetermineExportRect=r,this.totalToProcess=this.source.childElementCount,this.processedCount=0,this.rootViewBox=null,await this.visit(this.source),this.rootViewBox||this.onDetermineExportRect?.(rc),this.onFinish?.(),this.onFinish=null}static fromString(o,e=!1){let r=typeof e!="boolean"&&e?.loadMethod==="domparser",{svgElem:n,cleanUp:i}=(()=>{if(!r)try{let b=document.createElement("iframe");if(b.src="about:blank",b.setAttribute("sandbox","allow-same-origin"),b.setAttribute("csp","default-src 'about:blank'"),b.style.display="none",document.body.appendChild(b),!b.hasAttribute("sandbox"))throw b.remove(),new Error("SVG loading iframe is not sandboxed.");let v=b.contentWindow?.document??b.contentDocument;if(v==null)throw new Error("Unable to open a sandboxed iframe!");v.open(),v.write(`
						<!DOCTYPE html>
						<html>
							<head>
								<title>SVG Loading Sandbox</title>
								<meta name='viewport' conent='width=device-width,initial-scale=1.0'/>
								<meta charset='utf-8'/>
							</head>
							<body style='font-size: 12px;'>
								<script>
									console.error('JavaScript should not be able to run here!');
									throw new Error(
										'The SVG sandbox is broken! Please double-check the sandboxing setting.'
									);
								<\/script>
							</body>
						</html>
					`),v.close();let g=v.createElementNS("http://www.w3.org/2000/svg","svg");return g.innerHTML=o,v.body.appendChild(g),{svgElem:g,cleanUp:()=>{g.remove(),b.remove(),b.src=""}}}catch(b){console.warn("Failed loading SVG via a sandboxed iframe. Some styles may not be loaded correctly. Error: ",b)}let p=new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg">${o}</svg>`,"text/html"),u=p.querySelector("svg"),h=p.querySelector("parsererror");if(h)throw new Error("Parse error: "+h.textContent);return{svgElem:u,cleanUp:()=>{}}})(),a,l,c;return typeof e=="boolean"?(a=e,l=!1,c=[]):(a=e.sanitize??!1,l=e.disableUnknownObjectWarnings??!1,c=e.plugins),new s(n,i,{sanitize:a,disableUnknownObjectWarnings:l,plugins:c})}};var nc=(s,o)=>{let e=s.length<o.length?s:o,r=e===s?o:s;for(let n=0;n<e.length;n++)if(e[n]!==r[n])return!1;return!0},$s=nc;var Ao="js-draw-style-sheet",At="http://www.w3.org/2000/svg",wi={fontWeight:"400",fontStyle:"normal"},we=class s extends Ve{constructor(e,r,n=!1){super(r);this.elem=e;this.sanitize=n;this.lastPathStyle=null;this.lastPathString=[];this.lastContainerIDList=[];this.objectElems=null;this.overwrittenAttrs={};this.textContainer=null;this.textContainerTransform=null;this.textParentStyle=wi;this.clear(),this.addStyleSheet()}addStyleSheet(){if(!this.elem.querySelector(`#${Ao}`)){let e=document.createElementNS("http://www.w3.org/2000/svg","style");e.appendChild(document.createTextNode(`
				path {
					stroke-linecap: round;
					stroke-linejoin: round;
				}

				text {
					white-space: pre;
				}
			`.replace(/\s+/g,""))),e.setAttribute("id",Ao),this.elem.appendChild(e)}}setRootSVGAttribute(e,r){this.sanitize||(e in this.overwrittenAttrs||(this.overwrittenAttrs[e]=this.elem.getAttribute(e)),r!==null?this.elem.setAttribute(e,r):this.elem.removeAttribute(e))}displaySize(){return T.of(this.elem.clientWidth,this.elem.clientHeight)}clear(){if(this.lastPathString=[],this.lastContainerIDList=[],!this.sanitize){for(let e in this.overwrittenAttrs){let r=this.overwrittenAttrs[e];r?this.elem.setAttribute(e,r):this.elem.removeAttribute(e)}this.overwrittenAttrs={}}}addPathToSVG(){if(!this.lastPathStyle||this.lastPathString.length===0)return null;let e=document.createElementNS(At,"path");e.setAttribute("d",this.lastPathString.join(" "));let r=this.lastPathStyle;return r.fill.a>0?e.setAttribute("fill",r.fill.toHexString()):e.setAttribute("fill","none"),r.stroke&&(e.setAttribute("stroke",r.stroke.color.toHexString()),e.setAttribute("stroke-width",be(r.stroke.width*this.getSizeOfCanvasPixelOnScreen()))),this.elem.appendChild(e),this.objectElems?.push(e),e}drawPath(e){let r=e.style,n=It(e).transformedBy(this.getCanvasToScreenTransform());(this.lastPathString.length===0||!this.lastPathStyle||!Dr(this.lastPathStyle,r))&&(this.addPathToSVG(),this.lastPathStyle=r,this.lastPathString=[]),this.lastPathString.push(n.toString())}transformFrom(e,r,n=!1){let i=n?e:this.getCanvasToScreenTransform().rightMul(e);if(i.eq(k.identity))r.style.transform="";else{let a=i.toCSSMatrix();r.style.transform=a,r.setAttribute("data-highp-transform",a)}}drawText(e,r,n){let i=(a,l)=>{l.fontFamily!==this.textParentStyle?.fontFamily&&(a.style.fontFamily=l.fontFamily),l.fontVariant!==this.textParentStyle?.fontVariant&&(a.style.fontVariant=l.fontVariant??""),l.fontWeight!==this.textParentStyle?.fontWeight&&(a.style.fontWeight=l.fontWeight??""),l.fontStyle!==this.textParentStyle?.fontStyle&&(a.style.fontStyle=l.fontStyle??""),l.size!==this.textParentStyle?.size&&(a.style.fontSize=l.size+"px");let c=l.renderingStyle.fill.toHexString();if(a.style.fill=c,l.renderingStyle.stroke){let d=l.renderingStyle.stroke;a.style.stroke=d.color.toHexString(),a.style.strokeWidth=d.width+"px"}};if(r=this.getCanvasToScreenTransform().rightMul(r),this.textContainer){let a=document.createElementNS(At,"tspan");a.appendChild(document.createTextNode(e)),this.textContainer.appendChild(a),r=this.textContainerTransform.inverse().rightMul(r);let l=r.transformVec2(T.zero);a.setAttribute("x",`${be(l.x)}`),a.setAttribute("y",`${be(l.y)}`),i(a,n)}else{let a=document.createElementNS(At,"text");a.appendChild(document.createTextNode(e)),this.transformFrom(r,a,!0),i(a,n),this.elem.appendChild(a),this.objectElems?.push(a),this.objectLevel>0&&(this.textContainer=a,this.textContainerTransform=r,this.textParentStyle={...wi,...n})}}drawImage(e){let r=e.label??e.image.getAttribute("aria-label")??"";r===""&&(r=e.image.getAttribute("alt")??"");let n=document.createElementNS(At,"image");n.setAttribute("href",e.base64Url),n.setAttribute("width",e.image.getAttribute("width")??""),n.setAttribute("height",e.image.getAttribute("height")??""),n.setAttribute("aria-label",r),this.transformFrom(e.transform,n),this.elem.appendChild(n),this.objectElems?.push(n)}startObject(e){super.startObject(e),this.lastPathString=[],this.lastPathStyle=null,this.textContainer=null,this.textParentStyle=wi,this.objectElems=[]}endObject(e,r){if(super.endObject(e),this.addPathToSVG(),!!this.objectElems){if(e&&!this.sanitize){for(let a of this.objectElems){let l=e[vi],c=e[yi];if(l)for(let[d,p]of l)a.setAttribute(d,p);if(c)for(let d of c)a.style.setProperty(d.key,d.value,d.priority)}let n=e[xi],i=[];if(n&&n[0]&&n[0].length&&(i=n[0]),i.length>0&&$s(this.lastContainerIDList,i)&&this.lastContainerIDList.length>=i.length-1){let a=i[i.length-1],l=this.elem.querySelectorAll(`g#${a}`);if(l.length>=1){let c=l[0];if(c.children.length===0||this.lastContainerIDList.length>=i.length)for(let d of this.objectElems)d.remove(),c.appendChild(d);else i=[]}}else i=[];this.lastContainerIDList=i}if(r&&this.objectElems)if(this.objectElems.length===1)this.objectElems[0].classList.add(...r);else{let n=document.createElementNS(At,"g");n.classList.add(...r);for(let i of this.objectElems)i.remove(),n.appendChild(i);this.elem.appendChild(n)}}}unimplementedMessage(){throw new Error("Not implemenented!")}beginPath(e){this.unimplementedMessage()}endPath(e){this.unimplementedMessage()}lineTo(e){this.unimplementedMessage()}moveTo(e){this.unimplementedMessage()}traceCubicBezierCurve(e,r,n){this.unimplementedMessage()}traceQuadraticBezierCurve(e,r){this.unimplementedMessage()}drawPoints(...e){e.map(r=>{let n=document.createElementNS(At,"circle");n.setAttribute("cx",`${r.x}`),n.setAttribute("cy",`${r.y}`),n.setAttribute("r","15"),this.elem.appendChild(n)})}drawSVGElem(e){if(this.sanitize||e.tagName.toLowerCase()==="style"&&e.getAttribute("id")===Ao)return;let r=e.cloneNode(!0);this.elem.appendChild(r),this.objectElems?.push(r)}drawWithSVGParent(e){let r=document.createElementNS(At,"g");this.transformFrom(k.identity,r,!0),e(r,{sanitize:this.sanitize}),this.elem.appendChild(r),this.objectElems?.push(r)}isTooSmallToRender(e){return!1}static fromViewport(e,r=!0){let n,i;typeof r=="boolean"?(n=r,i=!1):(n=r.sanitize??!0,i=r.useViewBoxForPositioning??!1);let a="http://www.w3.org/2000/svg",l=document.createElementNS(a,"svg"),c=e.getScreenRectSize(),d=e.visibleRect,p;if(i){let h=e.visibleRect;p=[h.x,h.y,h.w,h.h],e=e.getTemporaryClone(),e.resetTransform(k.identity)}else p=[0,0,c.x,c.y];l.setAttribute("viewBox",p.map(h=>be(h)).join(" ")),l.setAttribute("width",be(c.x)),l.setAttribute("height",be(c.y)),l.setAttribute("version","1.1"),l.setAttribute("baseProfile","full"),l.setAttribute("xmlns",a);let u=new s(l,e,n);return d.eq(e.visibleRect)||u.overrideVisibleRect(d),{element:l,renderer:u}}};var Qt=30,Jt=class{constructor(o,e,r,n,i,a){this.presentation=o;this.parent=e;this.viewport=r;this.onDragStart=n;this.onDragUpdate=i;this.onDragEnd=a;this.dragLastPos=null;this.element=document.createElement("div"),this.element.classList.add(`${Ce}handle`,`${Ce}${o.action}`);let l=document.createElement("div");l.classList.add(`${Ce}content`),this.element.appendChild(l),this.parentSide=o.side;let c=o.icon;switch(c&&(l.appendChild(c),c.classList.add("icon")),o.action==="rotate"?this.shape=0:this.shape=1,this.shape){case 0:this.element.classList.add(`${Ce}circle`);break;case 1:this.element.classList.add(`${Ce}square`);break;default:ps(this.shape)}this.updatePosition()}addTo(o){o.appendChild(this.element)}remove(){this.element.remove()}getBBoxParentCoords(){let o=this.parent.getScreenRegion(),e=T.of(Qt,Qt),r=o.size.scale(this.parentSide).minus(e.times(1/2));return new R(r.x,r.y,e.x,e.y)}getBBoxCanvasCoords(){let o=this.parent.region,e=T.of(Qt,Qt).times(1/this.viewport.getScaleFactor()),r=o.size.scale(this.parentSide).minus(e.times(.5));return new R(r.x,r.y,e.x,e.y).translatedBy(o.topLeft)}updatePosition(){let o=this.getBBoxParentCoords();this.element.style.marginLeft=`${o.topLeft.x}px`,this.element.style.marginTop=`${o.topLeft.y}px`,this.element.style.width=`${o.w}px`,this.element.style.height=`${o.h}px`}containsPoint(o){let e=this.getBBoxCanvasCoords(),r=o.minus(e.center),n=e.size.x/2,i;return this.shape===0?i=r.magnitude()<=n:i=Math.abs(r.x)<=n&&Math.abs(r.y)<=n,i}handleDragStart(o){return this.onDragStart(o.canvasPos),this.dragLastPos=o.canvasPos,!0}handleDragUpdate(o){this.dragLastPos&&this.onDragUpdate(o.canvasPos)}handleDragEnd(){if(this.dragLastPos)return this.onDragEnd()}setSnapToGrid(o){this.snapToGrid=o}isSnappingToGrid(){return this.snapToGrid}};var eo=class s extends K{constructor(e,r){super("duplicate");this.toDuplicate=e;this.duplicates=e.map((n,i)=>r&&r[i]?n.cloneWithId(r[i]):n.clone()),this.reverse=new ie(this.duplicates)}apply(e){this.reverse.unapply(e)}unapply(e){this.reverse.apply(e)}onDrop(e){this.reverse.onDrop(e)}description(e,r){return this.duplicates.length===0?r.duplicatedNoElements:r.duplicateAction(Ur(r,this.duplicates)??r.elements,this.duplicates.length)}serializeToJSON(){return{originalIds:this.toDuplicate.map(e=>e.getId()),cloneIds:this.duplicates.map(e=>e.getId())}}static{K.register("duplicate",(e,r)=>{let n,i;Array.isArray(e)?(n=e,i=[]):(n=e.originalIds,i=e.cloneIds),Io(n),Io(i);let a=[],l=[];for(let c=0;c<n.length;c++){let d=n[c],p=r.image.lookupElement(d);p?(l.push(i[c]),a.push(p)):console.warn("Duplicate command: Could not find element with ID",d)}return new s(a,l)})}};var ot=(e=>(e.Lasso="lasso",e.Rectangle="rect",e))(ot||{});var _r=class{constructor(o,e){this.editor=o;this.selection=e}onDragStart(o){this.selection.setTransform(k.identity),this.dragStartPoint=o}onDragUpdate(o){let e=this.editor.viewport.roundPoint(o.minus(this.dragStartPoint));this.selection.setTransform(k.translation(e))}onDragEnd(){return this.selection.finalizeTransform()}},jr=class{constructor(o,e){this.editor=o;this.selection=e;this.mode=0}onDragStart(o,e){this.selection.setTransform(k.identity),this.mode=e,this.dragStartPoint=o,this.computeOriginAndScaleRate()}computeOriginAndScaleRate(){let o=this.selection.preTransformRegion,e=o.corners,r=0;for(let a=0;a<e.length;a++){let l=e[a],c=this.dragStartPoint.minus(l).magnitudeSquared();c>r&&(r=c,this.transformOrigin=l)}let n=1,i=1;this.transformOrigin.x>o.center.x&&(n=-1),this.transformOrigin.y>o.center.y&&(i=-1),this.scaleRate=T.of(n,i)}onDragUpdate(o){let e=o.minus(this.dragStartPoint),r=this.selection.preTransformRegion.width,n=this.selection.preTransformRegion.height,i=T.of(1,1);if(this.mode===1){let a=r+e.x*this.scaleRate.x;i=T.of(a/r,i.y)}if(this.mode===2){let a=n+e.y*this.scaleRate.y;i=T.of(i.x,a/n)}if(this.mode===0){let a=Math.abs(e.x)>Math.abs(e.y)?e.x:e.y,l=r+a;i=T.of(l/r,l/r)}if(i=i.map(a=>q.roundScaleRatio(a,2)),i.x!==0&&i.y!==0){let a=this.editor.viewport.roundPoint(this.transformOrigin);this.selection.setTransform(k.scaling2D(i,a))}}onDragEnd(){return this.selection.finalizeTransform()}},Zr=class{constructor(o,e){this.editor=o;this.selection=e;this.startAngle=0;this.targetRotation=0;this.maximumDistFromStart=0}getAngle(o){let e=this.selection.preTransformRegion.center;return o.minus(e).angle()}roundAngle(o){let e=8/Math.PI;return Math.round(o*e)/e}onDragStart(o){this.startPoint=o,this.selection.setTransform(k.identity),this.startAngle=this.getAngle(o),this.targetRotation=0,this.maximumDistFromStart=0,this.startTime=performance.now()}setRotationTo(o){let e=this.editor.viewport.roundPoint(this.selection.preTransformRegion.center),n=k.zRotation(o).mapEntries(a=>q.roundScaleRatio(a)),i=k.translation(e).rightMul(n).rightMul(k.translation(e.times(-1)));this.selection.setTransform(i)}onDragUpdate(o){this.targetRotation=this.roundAngle(this.getAngle(o)-this.startAngle),this.setRotationTo(this.targetRotation);let e=o.minus(this.startPoint).magnitude();e>this.maximumDistFromStart&&(this.maximumDistFromStart=e)}onDragEnd(){return(performance.now()-this.startTime)/1e3<.4&&this.maximumDistFromStart<10&&this.targetRotation===0&&this.setRotationTo(-Math.PI/2),this.selection.finalizeTransform()}};var Ws=(s,o,e="html")=>{let r;if(e==="html")r=document.createElement(s);else if(e==="svg")r=document.createElementNS("http://www.w3.org/2000/svg",s);else throw new Error(`Unknown element type ${e}`);for(let[n,i]of Object.entries(o))if(n!=="children"){if(typeof i!="string"&&typeof i!="number")throw new Error(`Unsupported value type ${typeof i}`);r.setAttribute(n,i.toString())}if(o.children)for(let n of o.children)r.appendChild(n);return r},je=(s,o)=>Ws(s,o,"svg"),Yr=(s,o)=>o.map(e=>je(s,e)),Vo=(...s)=>Yr("path",s),Xr=Ws;var sc=({onClick:s,text:o,classList:e=[]}={})=>{let r=Xr("button",{type:"button"});s&&(r.onclick=s),o&&(r.textContent=o);for(let n of e)r.classList.add(n);return r},G=sc;var Ti=40,Oo=class{constructor(o,e,r,n,i){this.parent=o;this.viewport=e;this.icon=r;this.localization=i;this.lastDragPointer=null;this.element=document.createElement("div"),this.element.classList.add(`${Ce}handle`,`${Ce}selection-menu`),this.element.style.setProperty("--vertical-offset",`${Ti}px`),this.onClick=()=>{this.button?.focus({preventScroll:!0});let a=this.getBBoxCanvasCoords().center;n(a)},this.initUI(),this.updatePosition()}initUI(){let o=G({classList:["icon"]});o.replaceChildren(this.icon),o.ariaLabel=this.localization.selectionMenu__show,o.title=o.ariaLabel,this.button=o,o.onkeydown=e=>{e.key==="Enter"&&(e.preventDefault(),this.onClick())},this.element.appendChild(o),requestAnimationFrame(()=>{this.updatePosition()})}addTo(o){o.appendChild(this.element)}remove(){this.element.remove()}getElementScreenSize(){return T.of(this.element.clientWidth,this.element.clientHeight)}getBBoxParentCoords(){let o=T.of(0,-Ti),e=this.getElementScreenSize();return new R(o.x,o.y,e.x,e.y)}getBBoxCanvasCoords(){let o=this.parent.region,e=this.viewport.getSizeOfPixelOnCanvas(),r=this.getElementScreenSize().times(e),n=Ti/this.viewport.getScaleFactor(),i=T.of(o.x,o.y-n),a=T.of(48,48).times(e);return new R(i.x,i.y,r.x,r.y).grownToSize(a)}updatePosition(){let o=this.getBBoxParentCoords();this.element.style.marginLeft=`${o.topLeft.x}px`,this.element.style.marginTop=`${o.topLeft.y}px`}containsPoint(o){return this.getBBoxCanvasCoords().containsPoint(o)}handleDragStart(o){return this.lastDragPointer=o,!0}handleDragUpdate(o){this.lastDragPointer=o}handleDragEnd(){this.lastDragPointer&&this.containsPoint(this.lastDragPointer.canvasPos)&&this.onClick(),this.lastDragPointer=null}};var Si=100,Us=500,Fo=class s{constructor(o,e,r){this.editor=e;this.selectionTightBoundingBox=null;this.transform=k.identity;this.selectedElems=[];this.hasParent=!0;this.removedFromImage={};this.activeHandle=null;this.backgroundDragging=!1;this.selectionDuplicatedAnimationTimeout=null;o=[...o],this.selectedElems=o,this.originalRegion=R.empty,this.transformers={drag:new _r(e,this),resize:new jr(e,this),rotate:new Zr(e,this)},this.outerContainer=document.createElement("div"),this.outerContainer.classList.add(`${Ce}selection-outer-container`),this.innerContainer=document.createElement("div"),this.innerContainer.classList.add(`${Ce}selection-inner-container`),this.backgroundElem=document.createElement("div"),this.backgroundElem.classList.add(`${Ce}selection-background`),this.innerContainer.appendChild(this.backgroundElem),this.outerContainer.appendChild(this.innerContainer);let n=(p,u)=>{let h={0:"resize-xy",1:"resize-x",2:"resize-y"};return new Jt({action:h[p],side:u},this,this.editor.viewport,f=>this.transformers.resize.onDragStart(f,p),f=>this.transformers.resize.onDragUpdate(f),()=>this.transformers.resize.onDragEnd())},i=[n(1,T.of(0,.5)),n(1,T.of(1,.5))],a=n(2,T.of(.5,1)),l=n(0,T.of(1,1)),c=new Jt({action:"rotate",side:T.of(.5,0),icon:this.editor.icons.makeRotateIcon()},this,this.editor.viewport,p=>this.transformers.rotate.onDragStart(p),p=>this.transformers.rotate.onDragUpdate(p),()=>this.transformers.rotate.onDragEnd()),d=new Oo(this,this.editor.viewport,this.editor.icons.makeOverflowIcon(),r,this.editor.localization);this.childwidgets=[d,l,...i,a,c];for(let p of this.childwidgets)p.addTo(this.backgroundElem);this.recomputeRegion(),this.updateUI()}getBackgroundElem(){return this.backgroundElem}getTransform(){return this.transform}get preTransformRegion(){return this.originalRegion}get region(){let o=k.zRotation(this.regionRotation,this.originalRegion.center),e=this.transform.rightMul(o.inverse());return this.originalRegion.transformedBoundingBox(e)}computeTightBoundingBox(){return this.selectedElems.reduce((e,r)=>(e??r.getBBox()).union(r.getBBox()),null)??R.empty}get regionRotation(){return this.transform.transformVec3(T.unitX).angle()}get preTransformedScreenRegion(){let o=e=>this.editor.viewport.canvasToScreen(e);return R.fromCorners(o(this.preTransformRegion.topLeft),o(this.preTransformRegion.bottomRight))}get preTransformedScreenRegionRotation(){return this.editor.viewport.getRotationAngle()}getScreenRegion(){let o=this.editor.viewport.canvasToScreenTransform,e=this.editor.viewport.getScaleFactor(),r=o.transformVec2(this.region.center);return new R(r.x,r.y,e*this.region.width,e*this.region.height).translatedBy(this.region.size.times(-e/2))}get screenRegionRotation(){return this.regionRotation+this.editor.viewport.getRotationAngle()}setTransform(o,e=!0){this.transform=o,e&&this.hasParent&&this.previewTransformCmds()}getDeltaZIndexToMoveSelectionToTop(){if(this.selectedElems.length===0)return 0;let o=this.selectedElems[0].getZIndex(),e=this.editor.image.getComponentsIntersecting(this.region);return(e[e.length-1]?.getZIndex()??o)+1-o}finalizeTransform(){let o=this.transform,e=this.selectedElems;this.originalRegion=this.originalRegion.transformedBoundingBox(this.transform),this.transform=k.identity,this.scrollTo();let r;if(this.selectedElems.length>0){let n=this.getDeltaZIndexToMoveSelectionToTop();r=this.editor.dispatch(new s.ApplyTransformationCommand(this,e,this.originalRegion.center,o,n))}return r}sendToBack(){let e=this.editor.image.getComponentsIntersecting(this.editor.viewport.visibleRect)[0]?.getZIndex()??0,r=this.selectedElems[this.selectedElems.length-1]?.getZIndex()??0,i=e-1-r;if(i!==0){let a=this.selectedElems.map(l=>l.setZIndex(l.getZIndex()+i));return he(a,Si)}return null}static{K.register("selection-tool-transform",(o,e)=>{let r=o.transform,n=o.selectionCenter??[0,0],i=o.elems??[];dt(r),dt(n),Io(i);let a=new k(...r),l=i,c=parseInt(o.deltaZIndex??0),d=T.of(n[0]??0,n[1]??0);return new this.ApplyTransformationCommand(null,l,d,a,c)})}static{this.ApplyTransformationCommand=class extends K{constructor(e,r,n,i,a){super("selection-tool-transform");this.selection=e;this.selectionCenter=n;this.fullTransform=i;this.deltaZIndex=a;(c=>typeof c[0]=="string")(r)?this.selectedElemIds=r:(this.selectedElemIds=r.map(c=>c.getId()),this.transformCommands=r.map(c=>c.setZIndexAndTransformBy(this.fullTransform,c.getZIndex()+a)))}resolveToElems(e,r){this.transformCommands||(this.transformCommands=this.selectedElemIds.map(n=>{let i=e.image.lookupElement(n);if(!i)return console.warn(`Unable to find element with ID, ${n}.`),null;let a=i.getZIndex(),l=i.getZIndex()+this.deltaZIndex;return r&&(l=i.getZIndex(),a=i.getZIndex()-this.deltaZIndex),i.setZIndexAndTransformBy(this.fullTransform,l,a)}).filter(n=>n!==null))}async apply(e){this.resolveToElems(e,!1),this.selection?.setTransform(this.fullTransform,!1),this.selection?.updateUI(),await e.asyncApplyCommands(this.transformCommands,Si),this.selection?.setTransform(k.identity,!1),this.selection?.recomputeRegion(),this.selection?.updateUI()}async unapply(e){this.resolveToElems(e,!0),this.selection?.setTransform(this.fullTransform.inverse(),!1),this.selection?.updateUI(),await e.asyncUnapplyCommands(this.transformCommands,Si,!0),this.selection?.setTransform(k.identity,!1),this.selection?.recomputeRegion(),this.selection?.updateUI()}serializeToJSON(){return{elems:this.selectedElemIds,transform:this.fullTransform.toArray(),deltaZIndex:this.deltaZIndex,selectionCenter:this.selectionCenter.asArray()}}description(e,r){return r.transformedElements(this.selectedElemIds.length,Kt(this.selectionCenter,this.fullTransform,!1,r))}}}previewTransformCmds(){if(this.selectedElems.length===0)return;if(this.selectedElems.length>Us){this.updateUI();return}let o=this.editor.display.getWetInkRenderer();o.clear(),o.pushTransform(this.transform);let r=this.editor.viewport.visibleRect.union(this.region).transformedBoundingBox(this.transform.inverse());for(let n of this.selectedElems)n.render(o,r);o.popTransform(),this.updateUI()}recomputeRegion(){let o=this.computeTightBoundingBox();return this.selectionTightBoundingBox=o,o?(this.originalRegion=o,this.padRegion(),!0):(this.cancelSelection(),!1)}padRegion(){let o=this.selectionTightBoundingBox??this.originalRegion,e=this.getMinCanvasSize();if(o.w<e||o.h<e){let r=e/2;this.originalRegion=R.bboxOf(o.corners,r),this.updateUI()}}getMinCanvasSize(){return Qt/this.editor.viewport.getScaleFactor()*2}getSelectedItemCount(){return this.selectedElems.length}updateUI(){if(!this.hasParent)return;let o=this.getScreenRegion();this.backgroundElem.style.marginLeft=`${o.topLeft.x}px`,this.backgroundElem.style.marginTop=`${o.topLeft.y}px`,this.backgroundElem.style.width=`${o.width}px`,this.backgroundElem.style.height=`${o.height}px`;let e=this.screenRegionRotation*180/Math.PI;this.backgroundElem.style.transform=`rotate(${e}deg)`,this.backgroundElem.style.transformOrigin="center";let r=`${Ce}rotated-near-perpendicular`;Math.abs(Math.sin(this.screenRegionRotation))>.5?this.innerContainer.classList.add(r):this.innerContainer.classList.remove(r),o.width===0&&o.height===0?this.innerContainer.classList.add("-empty"):this.innerContainer.classList.remove("-empty");for(let n of this.childwidgets)n.updatePosition(this.getScreenRegion())}addRemoveSelectionFromImage(o){if(!(!o&&this.selectedElems.length>Us)){for(let e of this.selectedElems){let r=this.editor.image.findParent(e);!o&&r?(this.removedFromImage[e.getId()]=!0,r.remove()):!r&&this.removedFromImage[e.getId()]&&(X.addComponent(e).apply(this.editor),this.removedFromImage[e.getId()]=!1,delete this.removedFromImage[e.getId()])}this.editor.queueRerender().then(()=>{o?this.editor.display.getWetInkRenderer().clear():this.previewTransformCmds()})}}removeDeletedElemsFromSelection(){this.selectedElems=this.selectedElems.filter(o=>{let e=!!this.editor.image.findParent(o),r=this.removedFromImage[o.getId()];return e||r})}onDragStart(o){if(this.selectedElems.length===0)return!1;document.getSelection()?.removeAllRanges(),this.activeHandle=null;let e=!1;this.backgroundDragging=!1,this.region.containsPoint(o.canvasPos)&&(this.backgroundDragging=!0,e=!0);for(let r of this.childwidgets)r.containsPoint(o.canvasPos)&&(this.activeHandle=r,this.backgroundDragging=!1,e=!0);return e&&(this.removeDeletedElemsFromSelection(),this.addRemoveSelectionFromImage(!1)),this.activeHandle&&this.activeHandle.handleDragStart(o),this.backgroundDragging&&this.transformers.drag.onDragStart(o.canvasPos),e}onDragUpdate(o){this.backgroundDragging&&this.transformers.drag.onDragUpdate(o.canvasPos),this.activeHandle&&this.activeHandle.handleDragUpdate(o)}onDragEnd(){this.backgroundDragging?this.transformers.drag.onDragEnd():this.activeHandle&&this.activeHandle.handleDragEnd(),this.addRemoveSelectionFromImage(!0),this.backgroundDragging=!1,this.activeHandle=null,this.updateUI()}onDragCancel(){this.backgroundDragging=!1,this.activeHandle=null,this.setTransform(k.identity),this.addRemoveSelectionFromImage(!0),this.updateUI()}scrollTo(){if(this.selectedElems.length===0)return!1;let o=this.editor.viewport.getScreenRectSize(),e=new R(0,0,o.x,o.y),r=this.getScreenRegion();if(!e.containsPoint(r.center)){let n=r.center,i=e.getClosestPointOnBoundaryTo(n),a=this.editor.viewport.screenToCanvas(i),l=this.region.center,c=a.minus(l);return this.editor.dispatchNoAnnounce(q.transformBy(k.translation(c.times(.5))),!1),this.editor.queueRerender().then(()=>{this.previewTransformCmds()}),!0}return!1}deleteSelectedObjects(){return(this.backgroundDragging||this.activeHandle)&&this.onDragEnd(),new ie(this.selectedElems)}runSelectionDuplicatedAnimation(){this.selectionDuplicatedAnimationTimeout&&clearTimeout(this.selectionDuplicatedAnimationTimeout);let o=400;this.backgroundElem.style.animation=`${o}ms ease selection-duplicated-animation`,this.selectionDuplicatedAnimationTimeout=setTimeout(()=>{this.backgroundElem.style.animation="",this.selectionDuplicatedAnimationTimeout=null},o)}async duplicateSelectedObjects(){let o=this.backgroundDragging||this.activeHandle,e=null;o||this.runSelectionDuplicatedAnimation();let r;if(o){let i=this.getDeltaZIndexToMoveSelectionToTop();e=new s.ApplyTransformationCommand(null,this.selectedElems,this.region.center,this.transform,i),await e.apply(this.editor),this.addRemoveSelectionFromImage(!0),r=he(this.selectedElems.map(a=>X.addComponent(a.clone()))),await e?.unapply(this.editor),this.addRemoveSelectionFromImage(!1),this.previewTransformCmds(),this.updateUI()}else r=new eo(this.selectedElems);return r}snapSelectedObjectsToGrid(){let o=this.editor.viewport,e=this.computeTightBoundingBox().topLeft,n=o.snapToGrid(e).minus(e),i=this.getTransform();this.setTransform(i.rightMul(k.translation(n))),this.finalizeTransform()}setHandlesVisible(o){o?this.innerContainer.classList.remove("-hide-handles"):this.innerContainer.classList.add("-hide-handles")}addTo(o){this.outerContainer.parentElement&&this.outerContainer.remove(),o.appendChild(this.outerContainer),this.hasParent=!0}setToPoint(o){this.originalRegion=this.originalRegion.grownToPoint(o),this.selectionTightBoundingBox=null,this.updateUI()}cancelSelection(){this.outerContainer.parentElement&&this.outerContainer.remove(),this.originalRegion=R.empty,this.selectionTightBoundingBox=null,this.hasParent=!1}getSelectedObjects(){return[...this.selectedElems]}};var Ho=class{constructor(o,e){this.viewport=o;this.scrollByCanvasDelta=e;this.started=!1;this.updateLoopId=0;this.updateLoopRunning=!1;this.targetPoint=null;this.scrollRate=1e3}getScrollForPoint(o){let e=this.viewport.getScreenRectSize(),r=new R(0,0,e.x,e.y),n=44,i=r.grownBy(-n);if(i.containsPoint(o))return T.zero;let a=i.getClosestPointOnBoundaryTo(o),l=a.distanceTo(o),c=a.minus(o),p=Math.min(l/n,1.25);return c.normalizedOrZero().times(p)}start(){this.started=!0}onPointerMove(o){this.started&&(this.getScrollForPoint(o)===T.zero?this.stopUpdateLoop():(this.targetPoint=o,this.startUpdateLoop()))}stop(){this.targetPoint=null,this.started=!1,this.stopUpdateLoop()}startUpdateLoop(){this.updateLoopRunning||(async()=>{this.updateLoopId++;let o=this.updateLoopId,e=performance.now();for(;this.updateLoopId===o&&this.targetPoint;){this.updateLoopRunning=!0;let r=performance.now(),n=r-e,a=this.getScrollForPoint(this.targetPoint).times(this.scrollRate*n/1e3);this.scrollByCanvasDelta(this.viewport.screenToCanvasTransform.transformVec3(a)),e=r,await tt()}this.updateLoopRunning=!1})()}stopUpdateLoop(){this.updateLoopId++}};var ac=s=>new Promise(o=>{setTimeout(()=>o(),s)}),Qr=ac;var lc=0,cc=async(s,o,e)=>{let r=document.createElement("div"),{remove:n}=s.createHTMLOverlay(r),i=document.createElement("dialog");i.classList.add("editor-popup-menu");let a=240;i.style.setProperty("--hide-menu-animation-timeout",`${a}ms`);let l=()=>{let u=s.getOutputBBoxInDOM(),h=s.viewport.canvasToScreen(o).plus(u.topLeft);i.style.setProperty("--anchor-x",`${h.x}px`),i.style.setProperty("--anchor-y",`${h.y}px`)};l();let c=s.notifier.on(7,l);r.appendChild(i);let d=!1,p=async()=>{d||(d=!0,c.remove(),i.classList.add("-hide"),await Qr(a),i.close())};return new Promise(u=>{let h=!1,f=null,b=()=>{h||(u(f),h=!0)};i.onclose=()=>{n(),b()};let v=m=>{f=m,p(),b()};s.handlePointerEventsExceptClicksFrom(i,(m,w)=>w.target===i&&m==="pointerdown"?(p(),!0):!!d,(m,w)=>w.target===i);let g=document.createElement("div");g.classList.add("content"),g.role="menu";let y=[];g.addEventListener("keydown",m=>{let w=y.findIndex(E=>E===document.activeElement);if(w===-1)return;let C=w;m.key==="ArrowDown"?C++:m.key==="ArrowUp"?C--:m.key==="End"?C=y.length-1:m.key==="Home"&&(C=0),C<0&&(C+=y.length),C%=y.length,C!==w&&(m.preventDefault(),y[C].focus())});for(let m of e){let w=G({classList:["option","editor-popup-menu-option"],onClick:C=>{C.defaultPrevented||v(m.key)}});w.id=`menu-overlay-option-${lc++}`,w.role="menuitem",w.replaceChildren(m.icon(),document.createTextNode(m.text)),g.appendChild(w),y.length===0&&(w.autofocus=!0),y.push(w)}i.appendChild(g),i.showModal(),g.scrollIntoView({block:"nearest"})})},qs=cc;var dc=async(s,o={})=>{try{let e=new FileReader;return await new Promise((r,n)=>{e.onload=()=>r(e.result),e.onerror=n,e.onabort=n,e.onprogress=i=>{o.onprogress?.(i)},e.readAsDataURL(s)})}catch(e){(o.onWarning??console.warn)("Unable to convert file to base64 with a FileReader: ",e);let r=await s.arrayBuffer(),n=new Uint8Array(r),i=30,a=[];for(let l=0;l<n.length;l+=i){let c=String.fromCharCode(...n.slice(l,l+i));a.push(btoa(c))}return`data:${s.type??"image/*"};base64,${a.join("")}`}},Jr=dc;var Ks=s=>s.endsWith("+xml")||s.startsWith("text/"),Oe=class{constructor(o,e){this.editor=o;this.callbacks=e}#e=!1;paste(o){let e=r=>{if(this.callbacks?.onPasteError)return this.callbacks.onPasteError(r),Promise.resolve(!1);throw r};try{return this.pasteInternal(o).catch(e)}catch(r){return e(r)}}async pasteInternal(o){let e=this.editor,r=o?.dataTransfer??o?.clipboardData??null,n=!!r,i=(u,h)=>h&&e.toolController.dispatchInputEvent({kind:8,mime:u,data:h}),a=["image/svg+xml","text/html","image/png","image/jpeg","text/plain"],l=[],c=new Map,d=e.getCurrentSettings();if(n){l=[...r.files];for(let u of a){let h=r.getData(u);h&&c.set(u,h)}}else if(d.clipboardApi){let u=await d.clipboardApi.read();for(let[h,f]of u.entries())if(typeof f=="string")c.set(h,f);else{let b=f;b.type!==h&&(b=new Blob([b],{type:h})),l.push(b)}}else{let u=await navigator.clipboard.read();for(let h of u)for(let f of h.types)a.includes(f)&&l.push(await h.getType(f))}let p=async u=>{let h=Ks(u);if(h){let f=c.get(u);if(i(u,f))return o?.preventDefault(),!0}for(let f of l)if(f?.type?.toLowerCase()===u)if(h){let v=await f.text();if(i(u,v))return o?.preventDefault(),!0}else{e.showLoadingWarning(0);let v=g=>{e.showLoadingWarning(g.loaded/g.total)};try{let g=await Jr(f,{onprogress:v});if(i(u,g))return o?.preventDefault(),e.hideLoadingWarning(),!0}catch(g){console.error("Error reading image:",g)}e.hideLoadingWarning()}return!1};for(let u of a)if(await p(u))return!0;return!1}copy(o){let e=r=>{if(this.callbacks?.onCopyError)return this.callbacks.onCopyError(r),Promise.resolve();throw r};try{return this.copyInternal(o).catch(e)}catch(r){return e(r)}}copyInternal(o){let e=new Map;this.editor.toolController.dispatchInputEvent({kind:7,setData:(p,u)=>{e.set(p,u)}})&&o?.preventDefault();let n=[...e.keys()].some(p=>!Ks(p)),i=p=>{if(!o)throw new Error(`Unable to copy -- no event provided${p?`. Original error: ${p}`:""}`);for(let[u,h]of e.entries())typeof h=="string"&&("clipboardData"in o?o.clipboardData?.setData(u,h):o.dataTransfer?.setData(u,h))},a=()=>{let h=(f=>{let b=Object.create(null);for(let[v,g]of Object.entries(f))"supports"in ClipboardItem&&typeof ClipboardItem.supports=="function"&&!ClipboardItem.supports(v)||(b[v]=g);return b})((f=>{let b=Object.create(null);for(let[v,g]of f.entries()){if(typeof g=="string"){let y=new Blob([new TextEncoder().encode(g)],{type:v});b[v]=y}else b[v]=g;v==="image/svg+xml"&&(b["text/html"]??=b[v])}return b})(e));return navigator.clipboard.write([new ClipboardItem(h)])},l=typeof ClipboardItem<"u"&&typeof navigator?.clipboard?.write<"u",c=!this.#e&&l&&(n||!o),d=this.editor.getCurrentSettings();if(c&&d.clipboardApi)return d.clipboardApi.write(e)??Promise.resolve();if(c){let p=null,u=h=>{console.warn("Unable to copy to the clipboard API. Future calls to .copy will use ClipboardEvents if possible.",h),this.#e=!0,i(h)};try{p=a()}catch(h){u(h)}if(p)return p.catch(u)}else i();return Promise.resolve()}};var pc=(s,o)=>{let e=document.createElement("div"),{remove:r}=s.createHTMLOverlay(e);e.classList.add("dialog-container","message-dialog-container",...o.classNames??[]);let n=document.createElement("dialog"),i=document.createElement("div");i.classList.add("message-dialog-content",...o.contentClassNames??[]);let a=document.createElement("h1");a.textContent=o.title,a.setAttribute("autofocus","true");let l=G({text:s.localization.closeDialog,classList:["close"]}),c=document.createElement("div");c.classList.add("scroll"),c.onwheel=h=>h.stopPropagation(),i.replaceChildren(a,c,l),n.replaceChildren(i),e.replaceChildren(n);let d=300;n.style.setProperty("--close-delay",`${d}ms`);let p=async()=>{n.classList.add("-closing"),await Qr(d),n.close()};return(()=>{n.addEventListener("pointerdown",h=>{h.target===n&&p()}),n.onclose=()=>{r()},l.onclick=()=>p()})(),n.showModal(),{close:()=>p(),appendChild:h=>{c.appendChild(h)}}},en=pc;var uc=s=>{let o=e=>{let r=en(s,{title:s.localization.copyPasteError__heading,classNames:["clipboard-error-dialog"]});r.appendChild(document.createTextNode(s.localization.copyPasteError__description));let n=document.createElement("details"),i=document.createElement("summary");return i.textContent=s.localization.copyPasteError__errorDetails,n.appendChild(i),n.appendChild(document.createTextNode(`Error: ${e}`)),r.appendChild(n),r};return{onCopyError(e){let r=o(e),n=document.createElement("label");n.textContent=s.localization.copyPasteError__copyRetry;let i=document.createElement("textarea");n.appendChild(i);let a=new Oe(s),l=c=>(c.preventDefault(),a.copy(c).then(()=>{r.close()}));i.oncopy=l,i.ondragstart=l,i.value=s.localization.copyPasteError__copyMe,r.appendChild(n),i.select(),document.execCommand("copy")},onPasteError(e){let r=o(e),n=document.createElement("label");n.textContent=s.localization.copyPasteError__pasteRetry;let i=document.createElement("textarea");n.appendChild(i);let a=new Oe(s),l=c=>(c.preventDefault(),a.paste(c).then(d=>{d&&r.close()}));i.onpaste=l,i.ondrop=l,r.appendChild(n),i.focus(),document.execCommand("paste")}}},Ci=uc;var hc=async(s,o,e,r,n)=>{let i=o.localization,a=s?.getSelectedItemCount()&&r,l=[{text:i.selectionMenu__paste,icon:()=>o.icons.makePasteIcon(),key:()=>{new Oe(o,Ci(o)).paste()}}];(await qs(o,e,a?[{text:i.selectionMenu__duplicate,icon:()=>o.icons.makeDuplicateSelectionIcon(),key:async()=>{await o.dispatch(await s.duplicateSelectedObjects())}},{text:i.selectionMenu__delete,icon:()=>o.icons.makeDeleteSelectionIcon(),key:async()=>{await o.dispatch(s.deleteSelectedObjects()),n()}},{text:i.selectionMenu__copyToClipboard,icon:()=>o.icons.makeCopyIcon(),key:()=>{new Oe(o,Ci(o)).copy()}},...l]:l))?.()},Gs=hc;var Vt=class{render(o,e){o.drawPath(Q(this.previewPath(),{fill:e}))}resolve(o,e){let r=this.previewPath(),n=c=>c.filter(d=>d.isSelectable()),i,a=e.getSizeOfPixelOnCanvas()*3;if(r.bbox.maxDimension<=a){let c=e.visibleRect.maxDimension/200,d=r.bbox.grownBy(c);i=o.getComponentsIntersecting(d).filter(p=>d.containsRect(p.getBBox())||p.intersectsRect(d)),i=n(i),i.length>1&&(i=[i[0]])}else i=n(this.resolveInternal(o));return i}};var No=class extends Vt{constructor(e,r){super();this.viewport=r;this.boundaryPoints=[];this.boundaryPoints.push(e),this.lastPoint=e}onPointerMove(e){let r=this.boundaryPoints[this.boundaryPoints.length-1],n=this.viewport.getSizeOfPixelOnCanvas()*8;r.distanceTo(e)>=n&&this.boundaryPoints.push(e),this.lastPoint=e}previewPath(){let e=this.boundaryPoints.map(r=>({kind:0,point:r}));return e.push({kind:0,point:this.lastPoint}),new W(this.boundaryPoints[0],e).asClosed()}resolveInternal(e){let r=this.previewPath(),n=r.polylineApproximation(),i=e.getComponentsIntersecting(r.bbox),a=l=>{if(r.closedContainsRect(l.getExactBBox()))return!0;let c=!1;for(let d of l.keyPoints())if(r.closedContainsPoint(d)){c=!0;break}if(!c)return!1;for(let d of n)if(l.intersects(d))return!1;return!0};return i.filter(a)}};var $o=class extends Vt{constructor(o){super(),this.rect=R.fromCorners(o,o)}onPointerMove(o){this.rect=this.rect.grownToPoint(o)}previewPath(){return W.fromRect(this.rect)}resolveInternal(o){return o.getComponentsIntersecting(this.rect).filter(e=>e.intersectsRect(this.rect))}};var Ce="selection-tool-";var Ee=class extends _{constructor(e,r){super(e.notifier,r);this.editor=e;this.removeSelectionScheduled=!1;this.startPoint=null;this.expandingSelectionBox=!1;this.shiftKeyPressed=!1;this.snapToGrid=!1;this.lastPointer=null;this.showContextMenu=async(e,r=!0)=>{await Gs(this.selectionBox,this.editor,e,r,()=>this.clearSelection())};this.selectionBoxHandlingEvt=!1;this.lastSelectedObjects=[];this.hasUnfinalizedTransformFromKeyPress=!1;this.modeValue=de.fromInitialValue("rect"),this.modeValue.onUpdate(()=>{this.editor.notifier.dispatch(2,{kind:2,tool:this})}),this.autoscroller=new Ho(e.viewport,n=>{if(e.dispatch(q.transformBy(k.translation(n)),!1),this.lastPointer){let i=this.lastPointer.withScreenPosition(this.lastPointer.screenPos,e.viewport);this.onMainPointerUpdated(i)}}),this.handleOverlay=document.createElement("div"),e.createHTMLOverlay(this.handleOverlay),this.handleOverlay.style.display="none",this.handleOverlay.classList.add("handleOverlay"),e.notifier.on(7,n=>{this.editor.clearWetInk(),this.expandingSelectionBox||this.selectionBox?.padRegion(),this.selectionBox?.updateUI()}),this.editor.handleKeyEventsFrom(this.handleOverlay),this.editor.handlePointerEventsFrom(this.handleOverlay)}getSelectionColor(){let e=getComputedStyle(this.handleOverlay).getPropertyValue("--selection-background-color");return M.fromString(e).withAlpha(.5)}makeSelectionBox(e){this.prevSelectionBox=this.selectionBox,this.selectionBox=new Fo(e,this.editor,this.showContextMenu),this.expandingSelectionBox||this.prevSelectionBox?.cancelSelection(),this.selectionBox.addTo(this.handleOverlay)}onContextMenu(e){let r=this.selectionBox?.getScreenRegion()?.containsPoint(e.screenPos);return this.showContextMenu(e.canvasPos,r),!0}onPointerDown({allPointers:e,current:r}){let n=this.snapToGrid;if(n&&(r=r.snappedToGrid(this.editor.viewport)),e.length===1){this.startPoint=r.canvasPos;let i=!1;return this.selectionBox&&(n&&this.selectionBox.snapSelectedObjectsToGrid(),this.selectionBox.onDragStart(r)&&(i=!0,this.selectionBoxHandlingEvt=!0,this.expandingSelectionBox=!1)),i?this.autoscroller.start():(this.expandingSelectionBox=this.shiftKeyPressed,this.removeSelectionScheduled=!this.expandingSelectionBox,this.modeValue.get()==="lasso"?this.selectionBuilder=new No(r.canvasPos,this.editor.viewport):this.selectionBuilder=new $o(r.canvasPos)),!0}return!1}onPointerMove(e){this.onMainPointerUpdated(e.current)}onMainPointerUpdated(e){if(this.lastPointer=e,this.removeSelectionScheduled&&(this.removeSelectionScheduled=!1,this.handleOverlay.replaceChildren(),this.prevSelectionBox=this.selectionBox,this.selectionBox=null),this.autoscroller.onPointerMove(e.screenPos),!this.expandingSelectionBox&&this.shiftKeyPressed&&this.startPoint){let r=this.editor.viewport.canvasToScreen(this.startPoint);e=e.lockedToXYAxesScreen(r,this.editor.viewport)}this.snapToGrid&&(e=e.snappedToGrid(this.editor.viewport)),this.selectionBoxHandlingEvt?this.selectionBox?.onDragUpdate(e):(this.selectionBuilder?.onPointerMove(e.canvasPos),this.editor.clearWetInk(),this.selectionBuilder?.render(this.editor.display.getWetInkRenderer(),this.getSelectionColor()))}onPointerUp(e){if(this.onMainPointerUpdated(e.current),this.autoscroller.stop(),this.selectionBoxHandlingEvt)this.selectionBox?.onDragEnd();else if(this.selectionBuilder){let r=this.selectionBuilder.resolve(this.editor.image,this.editor.viewport);this.selectionBuilder=null,this.editor.clearWetInk(),this.expandingSelectionBox&&this.selectionBox?this.setSelection([...this.selectionBox.getSelectedObjects(),...r]):this.setSelection(r)}this.expandingSelectionBox=!1,this.removeSelectionScheduled=!1,this.selectionBoxHandlingEvt=!1,this.lastPointer=null}onGestureCancel(){this.selectionBuilder&&(this.selectionBuilder=null,this.editor.clearWetInk()),this.autoscroller.stop(),this.selectionBoxHandlingEvt?this.selectionBox?.onDragCancel():this.removeSelectionScheduled||(this.selectionBox?.cancelSelection(),this.selectionBox=this.prevSelectionBox,this.selectionBox?.addTo(this.handleOverlay),this.selectionBox?.recomputeRegion(),this.prevSelectionBox=null),this.removeSelectionScheduled=!1,this.expandingSelectionBox=!1,this.lastPointer=null,this.selectionBoxHandlingEvt=!1}onSelectionUpdated(){let e=this.selectionBox?.getSelectedItemCount()??0,r=this.selectionBox?.getSelectedObjects()??[];(this.lastSelectedObjects.length!==e||r.some((i,a)=>this.lastSelectedObjects[a]!==i))&&(this.lastSelectedObjects=r,this.editor.notifier.dispatch(2,{kind:2,tool:this}),this.editor.notifier.dispatch(9,{kind:9,selectedComponents:r,tool:this}),e>0&&(this.editor.announceForAccessibility(this.editor.localization.selectedElements(e)),this.zoomToSelection())),e===0&&this.selectionBox&&(this.selectionBox.cancelSelection(),this.prevSelectionBox=this.selectionBox,this.selectionBox=null)}zoomToSelection(){if(this.selectionBox){let e=this.selectionBox.region;this.editor.dispatchNoAnnounce(this.editor.viewport.zoomTo(e,!1),!1)}}onKeyPress(e){let r=this.editor.shortcuts;if(r.matchesShortcut(_t,e))return this.snapToGrid=!0,!0;if(this.selectionBox&&(r.matchesShortcut(zr,e)||r.matchesShortcut(Mr,e)))return!0;if(r.matchesShortcut(Gt,e))return this.setSelection(this.editor.image.getAllComponents()),!0;if(e.ctrlKey)return!1;if((e.shiftKey||e.key==="Shift")&&(this.shiftKeyPressed=!0,e.key==="Shift"))return!0;let n=0,i=0,a=0,l=0,c=0;r.matchesShortcut(On,e)?i-=1:r.matchesShortcut(Fn,e)?i+=1:r.matchesShortcut(Hn,e)?a-=1:r.matchesShortcut(Nn,e)?a+=1:r.matchesShortcut(Wn,e)?n+=1:r.matchesShortcut($n,e)?n-=1:r.matchesShortcut(Un,e)?l-=1:r.matchesShortcut(qn,e)?l+=1:r.matchesShortcut(Kn,e)?c-=1:r.matchesShortcut(Gn,e)?c+=1:r.matchesShortcut(_n,e)?(l-=1,c-=1):r.matchesShortcut(jn,e)&&(l+=1,c+=1);let d=i!==0||a!==0||n!==0||l!==0||c!==0;if(!this.selectionBox)d=!1;else if(d){let p=10*this.editor.viewport.getSizeOfPixelOnCanvas(),u=Math.PI/8,h=5/4,f=this.selectionBox.region,b=T.of(h**l,h**c),g=k.zRotation(n*u).mapEntries(C=>q.roundScaleRatio(C)),y=this.editor.viewport.roundPoint(f.center),m=k.scaling2D(b,this.editor.viewport.roundPoint(f.topLeft)).rightMul(k.translation(y).rightMul(g).rightMul(k.translation(y.times(-1)))).rightMul(k.translation(this.editor.viewport.roundPoint(T.of(i,a).times(p)))),w=this.selectionBox.getTransform();this.selectionBox.setTransform(w.rightMul(m)),this.selectionBox.scrollTo(),this.hasUnfinalizedTransformFromKeyPress=!0}return this.selectionBox&&!d&&(e.key==="Delete"||e.key==="Backspace")&&(this.editor.dispatch(this.selectionBox.deleteSelectedObjects()),this.clearSelection(),d=!0),d}onKeyUp(e){let r=this.editor.shortcuts;if(r.matchesShortcut(_t,e))return this.snapToGrid=!1,!0;if(r.matchesShortcut(Gt,e))return!0;if(this.selectionBox&&r.matchesShortcut(zr,e))return this.selectionBox.duplicateSelectedObjects().then(n=>{this.editor.dispatch(n)}),!0;if(this.selectionBox&&r.matchesShortcut(Mr,e)){let n=this.selectionBox.sendToBack();return n&&this.editor.dispatch(n),!0}return e.shiftKey===!1&&(this.shiftKeyPressed=!1),e.key==="Shift"?(this.shiftKeyPressed=!1,!0):this.hasUnfinalizedTransformFromKeyPress?this.selectionBox?(this.selectionBox.finalizeTransform(),this.hasUnfinalizedTransformFromKeyPress=!1,!0):!1:!0}onCopy(e){if(!this.selectionBox)return!1;let r=this.selectionBox.getSelectedObjects(),n=this.selectionBox.region;if(r.length===0)return!1;let i=new q(()=>{}),l=this.selectionBox.getScreenRegion().size.times(this.editor.display.getDevicePixelRatio()).maximumEntryMagnitude()/(n.size.maximumEntryMagnitude()||1);l=Math.pow(2,Math.ceil(Math.log2(l))),i.updateScreenSize(n.size.times(l)),i.resetTransform(k.scaling2D(l).rightMul(k.translation(n.topLeft.times(-1))));let{element:c,renderer:d}=we.fromViewport(i,{sanitize:!0,useViewBoxForPositioning:!0}),{element:p,renderer:u}=Re.fromViewport(i,{maxCanvasDimen:4096}),h=[];for(let f of r)f.render(d),f.render(u),f instanceof ue&&h.push(f.getText());return e.setData("image/svg+xml",c.outerHTML),e.setData("text/html",c.outerHTML),e.setData("image/png",new Promise((f,b)=>{p.toBlob(v=>{v?f(v):b(new Error("Failed to convert canvas to blob."))},"image/png")})),h.length>0&&e.setData("text/plain",h.join(`
`)),!0}setEnabled(e){let r=this.isEnabled();super.setEnabled(e),r!==e&&(this.selectionBox?.cancelSelection(),this.onSelectionUpdated(),this.handleOverlay.replaceChildren(),this.selectionBox=null,this.shiftKeyPressed=!1,this.snapToGrid=!1,this.handleOverlay.style.display=e?"block":"none",e?(this.handleOverlay.tabIndex=0,this.handleOverlay.role="group",this.handleOverlay.ariaLabel=this.editor.localization.selectionToolKeyboardShortcuts):this.handleOverlay.tabIndex=-1)}getSelection(){return this.selectionBox}isSelecting(){return!!this.selectionBuilder}getSelectedObjects(){return this.selectionBox?.getSelectedObjects()??[]}setSelection(e){e=e.filter(n=>n.isSelectable()),e.sort((n,i)=>n.getZIndex()-i.getZIndex()),e=e.filter((n,i)=>i>0?n!==e[i-1]:!0);let r=null;for(let n of e)r?r=r.union(n.getBBox()):r=n.getBBox();this.clearSelectionNoUpdateEvent(),r&&this.makeSelectionBox(e),this.onSelectionUpdated()}clearSelectionNoUpdateEvent(){this.handleOverlay.replaceChildren(),this.prevSelectionBox=this.selectionBox,this.selectionBox=null}clearSelection(){this.clearSelectionNoUpdateEvent(),this.onSelectionUpdated()}};var to=class extends _{constructor(e){super(e.notifier,e.localization.undoRedoTool);this.editor=e}onKeyPress(e){return this.editor.shortcuts.matchesShortcut(Mo,e)?(this.editor.history.undo(),!0):this.editor.shortcuts.matchesShortcut(Zn,e)?(this.editor.history.redo(),!0):!1}};var _s="textEditorOverlay",Ze=class extends _{constructor(e,r,n){super(e.notifier,r);this.editor=e;this.localizationTable=n;this.textInputElem=null;this.textMeasuringCtx=null;this.removeExistingCommand=null;let i=e.getCurrentSettings().text?.fonts??[];this.textStyleValue=Y.fromInitialValue({size:32,fontFamily:i.length>0?i[0]:"sans-serif",renderingStyle:{fill:M.purple}}),this.textStyleValue.onUpdateAndNow(()=>{this.textStyle=this.textStyleValue.get(),this.updateTextInput(),this.editor.notifier.dispatch(2,{kind:2,tool:this})}),this.contentTransform=Y.fromInitialValue(k.identity),this.textEditOverlay=document.createElement("div"),this.textEditOverlay.classList.add(_s),this.editor.addStyleSheet(`
			.${_s} textarea {
				background-color: rgba(0, 0, 0, 0);

				white-space: pre;
				overflow: hidden;

				padding: 0;
				margin: 0;
				border: none;
				padding: 0;

				min-width: 100px;
				min-height: 1.1em;
			}
		`),this.anchorControl=this.editor.anchorElementToCanvas(this.textEditOverlay,this.contentTransform)}initTextMeasuringCanvas(){this.textMeasuringCtx??=document.createElement("canvas").getContext("2d")}getTextAscent(e,r){if(this.initTextMeasuringCanvas(),this.textMeasuringCtx){this.textMeasuringCtx.textBaseline="alphabetic",ue.applyTextStyles(this.textMeasuringCtx,r);let n=this.textMeasuringCtx.measureText(e);return n.fontBoundingBoxAscent??n.actualBoundingBoxAscent}return r.size*2/3}flushInput(e=!0){if(!this.textInputElem)return;let r=this.textEditOverlay.parentElement,n=T.of(r?.scrollLeft??0,r?.scrollTop??0),i=this.textInputElem.value.trimEnd();if(this.textInputElem.value="",e){let a=this.textInputElem;this.textInputElem=null,a.remove()}if(i!==""){let a=n.times(-1),l=this.editor.viewport.screenToCanvasTransform.transformVec3(a),c=k.translation(l),d=ue.fromLines(i.split(`
`),c.rightMul(this.contentTransform.get()),this.textStyle),p=X.addComponent(d);this.removeExistingCommand?(this.removeExistingCommand.unapply(this.editor),this.editor.dispatch(he([this.removeExistingCommand,p])),this.removeExistingCommand=null):this.editor.dispatch(p)}}updateTextInput(){if(!this.textInputElem)return;this.textInputElem.placeholder=this.localizationTable.enterTextToInsert,this.textInputElem.style.fontFamily=this.textStyle.fontFamily,this.textInputElem.style.fontStyle=this.textStyle.fontStyle??"",this.textInputElem.style.fontVariant=this.textStyle.fontVariant??"",this.textInputElem.style.fontWeight=this.textStyle.fontWeight??"",this.textInputElem.style.fontSize=`${this.textStyle.size}px`,this.textInputElem.style.color=this.textStyle.renderingStyle.fill.toHexString(),this.textInputElem.style.margin="0",this.textInputElem.style.width=`${this.textInputElem.scrollWidth}px`,this.textInputElem.style.height=`${this.textInputElem.scrollHeight}px`;let n=this.getTextAscent("Testing!",this.textStyle);this.textInputElem.style.transform=`translate(0, ${-n}px)`,this.textInputElem.style.transformOrigin="top left";let i=Math.floor(this.textStyle.size);this.textInputElem.style.lineHeight=`${i}px`}startTextInput(e,r){this.flushInput(),this.textInputElem=document.createElement("textarea"),this.textInputElem.value=r,this.textInputElem.style.display="inline-block";let n=this.editor.viewport.roundPoint(e),i=-this.editor.viewport.getRotationAngle(),a=T.of(1,1).times(this.editor.viewport.getSizeOfPixelOnCanvas());this.contentTransform.set(k.translation(n).rightMul(k.zRotation(i)).rightMul(k.scaling2D(a))),this.updateTextInput(),setTimeout(()=>this.updateTextInput(),0),this.textInputElem.oninput=()=>{this.textInputElem&&(this.textInputElem.style.width=`${this.textInputElem.scrollWidth}px`,this.textInputElem.style.height=`${this.textInputElem.scrollHeight}px`)},this.textInputElem.onblur=()=>{let l=this.textInputElem;this.flushInput(!1),this.textInputElem=null,l&&l.classList.add("-hiding"),setTimeout(()=>{l?.remove()},0)},this.textInputElem.onkeyup=l=>{l.isComposing||(l.key==="Enter"&&!l.shiftKey?(this.flushInput(),this.editor.focus()):l.key==="Escape"&&(this.textInputElem?.remove(),this.textInputElem=null,this.editor.focus(),this.removeExistingCommand?.unapply(this.editor),this.removeExistingCommand=null))},this.textEditOverlay.replaceChildren(this.textInputElem),setTimeout(()=>this.textInputElem?.focus(),0)}setEnabled(e){super.setEnabled(e),this.isEnabled()||this.flushInput(),this.textEditOverlay.style.display=e?"block":"none"}onPointerDown({current:e,allPointers:r}){if(e.device===1)return!1;if(r.length===1){let n=e.canvasPos,i=T.of(4,4).times(this.editor.viewport.getSizeOfPixelOnCanvas()),a=R.fromCorners(n.minus(i),n.plus(i)),c=this.editor.image.getComponentsIntersecting(a).filter(p=>p instanceof ue),d=this.editor.viewport.visibleRect;if(c=c.filter(p=>!p.getBBox().containsRect(d)),this.flushInput(),c.length>0){let p=c[c.length-1];this.setTextStyle(p.getTextStyle()),this.removeExistingCommand=new ie([p]),this.removeExistingCommand.apply(this.editor),this.startTextInput(p.getBaselinePos(),p.getText()),this.contentTransform.set(p.getTransform()),this.updateTextInput()}else this.removeExistingCommand=null,this.startTextInput(e.canvasPos,"");return!0}return!1}onGestureCancel(){this.flushInput(),this.editor.focus()}setFontFamily(e){e!==this.textStyle.fontFamily&&this.textStyleValue.set({...this.textStyle,fontFamily:e})}setColor(e){e.eq(this.textStyle.renderingStyle.fill)||this.textStyleValue.set({...this.textStyle,renderingStyle:{...this.textStyle.renderingStyle,fill:e}})}setFontSize(e){e!==this.textStyle.size&&this.textStyleValue.set({...this.textStyle,size:e})}getTextStyle(){return this.textStyle}getStyleValue(){return this.textStyleValue}setTextStyle(e){this.textStyleValue.set(e)}onDestroy(){super.onDestroy(),this.anchorControl.remove()}};var Ot=class extends _{constructor(e,r){super(e.notifier,r);this.editor=e;this.colorPreviewListener=null;this.colorSelectListener=null;this.enabledValue().onUpdateAndNow(()=>{this.updateSelectingStatus()})}canReceiveInputInReadOnlyEditor(){return!0}updateSelectingStatus(){let e="pipette--color-selection-in-progress";this.isEnabled()&&this.colorSelectListener&&this.colorPreviewListener?this.editor.getRootElement().classList.add(e):this.editor.getRootElement().classList.remove(e)}setColorListener(e,r){this.colorPreviewListener=e,this.colorSelectListener=r,this.updateSelectingStatus()}clearColorListener(){this.colorPreviewListener=null,this.colorSelectListener=null,this.updateSelectingStatus()}onPointerDown({current:e,allPointers:r}){return this.colorPreviewListener&&r.length===1?(this.colorPreviewListener(this.editor.display.getColorAt(e.screenPos)),!0):!1}onPointerMove({current:e}){this.colorPreviewListener?.(this.editor.display.getColorAt(e.screenPos))}onPointerUp({current:e}){this.colorSelectListener?.(this.editor.display.getColorAt(e.screenPos))}onGestureCancel(){this.colorSelectListener?.(null)}};var oo=class extends _{constructor(e){super(e.notifier,e.localization.changeTool);this.editor=e}canReceiveInputInReadOnlyEditor(){return!0}onKeyPress({key:e}){let n=this.editor.toolController.getPrimaryTools(),i=/^[0-9]$/.exec(e),a;if(i){let l=parseInt(i[0],10)-1;a=n[l]}return a?(a.setEnabled(!0),!0):!1}};var ro=class extends _{constructor(e){super(e.notifier,e.localization.pasteHandler);this.editor=e}onPaste(e,r){let n=e.mime.toLowerCase(),i=(()=>{if(n==="image/svg+xml")return e.data;if(n==="text/plain"){let c=e.data.trim();if(c.startsWith("<svg")&&c.endsWith("</svg>"))return c}if(n!=="text/html"||!e.data.match(/^[^]{0,200}<svg.*/i))return!1;let l=e.data.toLowerCase().lastIndexOf("</svg>");return l===-1&&(l=e.data.length),e.data.substring(e.data.search(/<svg/i),l)})();return i?(this.doSVGPaste(i).then(r),!0):n==="text/plain"?(this.doTextPaste(e.data).then(r),!0):n==="image/png"||n==="image/jpeg"?(this.doImagePaste(e.data).then(r),!0):!1}async addComponentsFromPaste(e){await this.editor.addAndCenterComponents(e,!0,this.editor.localization.pasted(e.length))}async doSVGPaste(e){this.editor.showLoadingWarning(0);try{let r=ft.fromString(e,{sanitize:!0,plugins:this.editor.getCurrentSettings().svg?.loaderPlugins??[]}),n=[];await r.start(i=>{n.push(i)},(i,a)=>null),await this.addComponentsFromPaste(n)}finally{this.editor.hideLoadingWarning()}}async doTextPaste(e){let r=this.editor.toolController.getMatchingTools(Ze);r.sort((l,c)=>!l.isEnabled()&&c.isEnabled()?-1:!c.isEnabled()&&l.isEnabled()?1:0);let n={size:12,fontFamily:"sans",renderingStyle:{fill:M.red}},i=r[0]?.getTextStyle()??n;if(e.trim()==="")return;let a=e.split(`
`);await this.addComponentsFromPaste([ue.fromLines(a,k.identity,i)])}async doImagePaste(e){let r=new Image;r.src=e;let n=await Se.fromImage(r,k.identity);await this.addComponentsFromPaste([n])}};var gt=class extends _{constructor(e){super(e.notifier,e.localization.changeTool);this.listeners=new Set([])}registerListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}onKeyPress(e){let r=Array.from(this.listeners.values());for(let n of r)if(n(e))return!0;return!1}};var no=Zt((s,o)=>{let e=o.getSizeOfPixelOnCanvas()*3,r=o.getSizeOfPixelOnCanvas();return new tn(s,r,e,o)}),tn=class{constructor(o,e,r,n){this.startPoint=o;this.minFitAllowed=e;this.viewport=n;this.isFirstSegment=!0;this.pathStartConnector=null;this.mostRecentConnector=null;this.nextCurveStartConnector=null;this.lastUpperBezier=null;this.lastLowerBezier=null;this.parts=[];this.upperSegments=[],this.lowerSegments=[],this.curveFitter=new jt(o,e,r,i=>this.addCurve(i)),this.curveStartWidth=o.width,this.bbox=new R(this.startPoint.pos.x,this.startPoint.pos.y,0,0)}getBBox(){return this.bbox}getRenderingStyle(){return{fill:this.startPoint.color??null}}previewCurrentPath(o=!0){let e=this.upperSegments.slice(),r=this.lowerSegments.slice(),n,i,a=this.curveFitter.preview();if(a&&o){let{upperCurveCommand:d,lowerToUpperConnector:p,upperToLowerConnector:u,lowerCurveCommand:h}=this.segmentToPath(a);e.push(d),r.push(h),n=p,i=this.pathStartConnector??[u]}else{if(this.mostRecentConnector===null||this.pathStartConnector===null)return null;n=this.mostRecentConnector,i=this.pathStartConnector}let l,c=r[r.length-1];return c.kind===0||c.kind===1?l=c.point:l=c.endPoint,{startPoint:l,commands:[n,...e.reverse(),...i,...r],style:this.getRenderingStyle()}}previewFullPath(){let o=this.previewCurrentPath();return o?[...this.parts,o]:null}preview(o){let e=this.previewFullPath();if(e){let r=this.viewport.visibleRect;o.startObject(r);for(let n of e)o.drawPath(n);o.endObject()}}build(){return this.curveFitter.finalizeCurrentCurve(),this.isFirstSegment&&this.addCurve(null),new ae(this.previewFullPath())}roundPoint(o){let e=Math.min(this.minFitAllowed,this.curveStartWidth/3);return e<1e-10&&(e=this.minFitAllowed),q.roundPoint(o,e)}shouldStartNewSegment(o,e){if(!this.lastLowerBezier||!this.lastUpperBezier)return!1;let r=(c,d)=>{let p=c.intersectsBezier(d);return p.length?p[0].point:null},n=c=>c.p2.minus(c.p1).normalized(),i=c=>c.p1.minus(c.p0).normalized();if(i(e).dot(n(this.lastUpperBezier))<.35||i(o).dot(n(this.lastLowerBezier))<.35||i(e).dot(n(e))<0||i(o).dot(n(o))<0)return!0;let a=r(o,this.lastUpperBezier),l=r(e,this.lastLowerBezier);return!!(a||l)}getCurrentRadius(){return q.roundPoint(this.startPoint.width/2.2,Math.min(this.minFitAllowed,this.startPoint.width/4))}addCurve(o){if(!o){if(!this.isFirstSegment)return;let p=this.getCurrentRadius(),u=this.roundPoint(this.startPoint.pos),h=this.startPoint.pos.plus(T.of(p,0));this.lowerSegments.push({kind:3,controlPoint:u.plus(T.of(p,p)),endPoint:u.plus(T.of(0,p))},{kind:3,controlPoint:u.plus(T.of(-p,p)),endPoint:u.plus(T.of(-p,0))},{kind:3,controlPoint:u.plus(T.of(-p,-p)),endPoint:u.plus(T.of(0,-p))},{kind:3,controlPoint:u.plus(T.of(p,-p)),endPoint:u.plus(T.of(p,0))});let f={kind:0,point:h};this.pathStartConnector=[f],this.mostRecentConnector=f;return}let{upperCurveCommand:e,lowerToUpperConnector:r,upperToLowerConnector:n,lowerCurveCommand:i,lowerCurve:a,upperCurve:l,nextCurveStartConnector:c}=this.segmentToPath(o),d=this.shouldStartNewSegment(a,l);if(d){let p=this.previewCurrentPath(!1);p?(this.parts.push(p),this.upperSegments=[],this.lowerSegments=[]):d=!1}(this.isFirstSegment||d)&&(this.pathStartConnector=this.nextCurveStartConnector??[n],this.isFirstSegment=!1),this.mostRecentConnector=r,this.nextCurveStartConnector=c,this.lowerSegments.push(i),this.upperSegments.push(e),this.lastLowerBezier=a,this.lastUpperBezier=l,this.curveStartWidth=o.startWidth}segmentToPath(o){let e=new $e(o.startPoint,o.controlPoint,o.endPoint),r=e.normal(0),n=e.normal(1);r=r.times(o.startWidth/2),n=n.times(o.endWidth/2),isFinite(r.magnitude())||(console.error("Warning: startVec is NaN or \u221E",r,n,o),r=n);let i=o.startPoint,a=o.endPoint,l=o.controlPoint,d=e.nearestPointTo(l).parameterValue,p=e.normal(d).times(o.startWidth/2*d+o.endWidth/2*(1-d)),u=this.roundPoint(i.plus(r)),h=this.roundPoint(l.plus(p)),f=this.roundPoint(a.plus(n)),b=this.roundPoint(l.minus(p)),v=this.roundPoint(a.minus(n)),g=this.roundPoint(i.minus(r)),y={kind:3,controlPoint:h,endPoint:f},m={kind:0,point:u},w={kind:0,point:v},C=[{kind:0,point:v},{kind:0,point:f}],E={kind:3,controlPoint:b,endPoint:g},P=new $e(v,b,g),S=new $e(u,h,f);return{upperCurveCommand:E,upperToLowerConnector:m,lowerToUpperConnector:w,lowerCurveCommand:y,upperCurve:P,lowerCurve:S,nextCurveStartConnector:C}}addPoint(o){this.curveFitter.addPoint(o)}};var js="find-tool",Wo=class extends _{constructor(e){super(e.notifier,e.localization.findLabel);this.editor=e;this.currentMatchIdx=0;this.overlay=document.createElement("div"),this.fillOverlay(),e.createHTMLOverlay(this.overlay),this.overlay.style.display="none",this.overlay.classList.add(`${js}-overlay`)}canReceiveInputInReadOnlyEditor(){return!0}getMatches(e){let r=e.toLocaleLowerCase();return this.editor.image.getAllComponents().filter(i=>{let a="";if(i instanceof ue)a=i.getText();else if(i instanceof Se)a=i.getAltText()??"";else return!1;let l=a.toLocaleLowerCase().indexOf(r)!==-1,c=a.indexOf(e)!==-1;return l||c}).map(i=>i.getBBox())}focusCurrentMatch(){let e=this.getMatches(this.searchInput.value),r=this.currentMatchIdx%e.length;r<0&&(r=e.length+r),r<e.length&&(this.editor.dispatch(this.editor.viewport.zoomTo(e[r],!0,!0),!1),this.editor.announceForAccessibility(this.editor.localization.focusedFoundText(r+1,e.length)))}toNextMatch(){this.currentMatchIdx++,this.focusCurrentMatch()}toPrevMatch(){this.currentMatchIdx--,this.focusCurrentMatch()}fillOverlay(){let e=document.createElement("label");this.searchInput=document.createElement("input");let r=G(),n=G();this.searchInput.setAttribute("id",`${js}-searchInput-${Math.random()}`),e.htmlFor=this.searchInput.getAttribute("id"),e.innerText=this.editor.localization.findLabel,r.innerText=this.editor.localization.toNextMatch,n.innerText=this.editor.localization.closeDialog,this.searchInput.onkeydown=i=>{i.key==="Enter"?i.shiftKey?this.toPrevMatch():this.toNextMatch():i.key==="Escape"?this.setVisible(!1):this.editor.shortcuts.matchesShortcut(Br,i)&&(i.preventDefault(),this.toggleVisible())},r.onclick=()=>{this.toNextMatch()},n.onclick=()=>{this.setVisible(!1)},this.overlay.replaceChildren(e,this.searchInput,r,n)}isVisible(){return this.overlay.style.display!=="none"}setVisible(e){e!==this.isVisible()&&(this.overlay.style.display=e?"block":"none",e?(this.searchInput.focus(),this.editor.announceForAccessibility(this.editor.localization.findDialogShown)):(this.editor.focus(),this.editor.announceForAccessibility(this.editor.localization.findDialogHidden)))}toggleVisible(){this.setVisible(!this.isVisible())}onKeyPress(e){return this.editor.shortcuts.matchesShortcut(Br,e)?(this.toggleVisible(),!0):!1}setEnabled(e){super.setEnabled(e),this.isEnabled()&&this.setVisible(!1)}};var io=class extends _{constructor(e){super(e.notifier,e.localization.selectAllTool);this.editor=e}canReceiveInputInReadOnlyEditor(){return!0}onKeyPress(e){if(this.editor.shortcuts.matchesShortcut(Gt,e)){let r=this.editor.toolController.getMatchingTools(Ee);if(r.length>0){let n=r[0];return n.setEnabled(!0),n.setSelection(this.editor.image.getAllComponents()),!0}}return!1}};var Ei=class{constructor(){this.closed=!1;if(!window.AudioContext){console.warn("Accessibility sound UI: Unable to open AudioContext."),this.closed=!0;return}this.ctx=new AudioContext,this.colorOscHue=this.ctx.createOscillator(),this.colorOscValue=this.ctx.createOscillator(),this.colorOscSaturation=this.ctx.createOscillator(),this.colorOscHue.type="triangle",this.colorOscSaturation.type="sine",this.colorOscValue.type="sawtooth",this.valueGain=this.ctx.createGain(),this.colorOscValue.connect(this.valueGain),this.valueGain.gain.setValueAtTime(.18,this.ctx.currentTime),this.colorGain=this.ctx.createGain(),this.colorOscHue.connect(this.colorGain),this.valueGain.connect(this.colorGain),this.colorOscSaturation.connect(this.colorGain),this.colorGain.connect(this.ctx.destination),this.boundaryGain=this.ctx.createGain(),this.boundaryOsc=this.ctx.createOscillator(),this.boundaryOsc.type="sawtooth",this.boundaryGain.gain.setValueAtTime(0,this.ctx.currentTime),this.boundaryOsc.connect(this.boundaryGain),this.boundaryGain.connect(this.ctx.destination),this.colorOscHue.start(),this.colorOscSaturation.start(),this.colorOscValue.start(),this.boundaryOsc.start(),this.pause()}pause(){this.closed||(this.colorGain.gain.setValueAtTime(0,this.ctx.currentTime),this.ctx.suspend())}play(){this.closed||this.ctx.resume()}setColor(o){let e=o.asHSV(),r=-Math.cos(e.x/2)*220+440,n=e.y*440+220,i=(e.z+.1)*440,a=.25*Math.min(1,o.a)/(1+Math.exp(-(e.z-.5)*3));this.colorOscHue.frequency.setValueAtTime(r,this.ctx.currentTime),this.colorOscSaturation.frequency.setValueAtTime(n,this.ctx.currentTime),this.colorOscValue.frequency.setValueAtTime(i,this.ctx.currentTime),this.valueGain.gain.setValueAtTime((1-e.z)*.4,this.ctx.currentTime),this.colorGain.gain.setValueAtTime(a,this.ctx.currentTime)}announceBoundaryCross(o){this.boundaryGain.gain.cancelScheduledValues(this.ctx.currentTime),this.boundaryGain.gain.setValueAtTime(0,this.ctx.currentTime),this.boundaryGain.gain.linearRampToValueAtTime(.018,this.ctx.currentTime+.1),this.boundaryOsc.frequency.setValueAtTime(440+Math.atan(o/2)*100,this.ctx.currentTime),this.boundaryGain.gain.linearRampToValueAtTime(0,this.ctx.currentTime+.25)}close(){this.ctx.close(),this.closed=!0}},so=class extends _{constructor(e,r){super(e.notifier,r);this.editor=e;this.soundFeedback=null;this.toggleButtonContainer=document.createElement("div"),this.toggleButtonContainer.classList.add("js-draw-sound-ui-toggle"),this.toggleButton=G({onClick:()=>{this.setEnabled(!this.isEnabled())}}),this.toggleButtonContainer.appendChild(this.toggleButton),this.updateToggleButtonText(),e.createHTMLOverlay(this.toggleButtonContainer)}canReceiveInputInReadOnlyEditor(){return!0}updateToggleButtonText(){let e="sound-ui-tool-enabled";this.isEnabled()?(this.toggleButton.innerText=this.editor.localization.disableAccessibilityExploreTool,this.toggleButtonContainer.classList.add(e)):(this.toggleButton.innerText=this.editor.localization.enableAccessibilityExploreTool,this.toggleButtonContainer.classList.remove(e))}setEnabled(e){super.setEnabled(e),this.isEnabled()?this.editor.announceForAccessibility(this.editor.localization.soundExplorerUsageAnnouncement):(this.soundFeedback?.close(),this.soundFeedback=null),this.updateToggleButtonText()}onKeyPress(e){return e.code==="Escape"?(this.setEnabled(!1),!0):!1}onPointerDown({current:e,allPointers:r}){return this.soundFeedback||(this.soundFeedback=new Ei),r.length>=2?!1:(this.soundFeedback?.play(),this.soundFeedback?.setColor(this.editor.display.getColorAt(e.screenPos)??M.black),this.lastPointerPos=e.canvasPos,!0)}onPointerMove({current:e}){this.soundFeedback?.setColor(this.editor.display.getColorAt(e.screenPos)??M.black);let r=new ge(this.lastPointerPos,e.canvasPos),n=this.editor.image.getComponentsIntersecting(r.bbox).filter(i=>i.intersects(r));this.lastPointerPos=e.canvasPos,n.length>0&&this.soundFeedback?.announceBoundaryCross(n.length)}onPointerUp(e){this.soundFeedback?.pause()}onGestureCancel(){this.soundFeedback?.pause()}};var Uo=class extends Ae{#e=null;#t=null;onEvent(o){return this.#e===null?this.emit(o):this.#e.onEvent(o)}addToTail(o){this.#t?(this.#t.setEmitListener(o),this.#t=o):(this.#e=o,this.#t=this.#e),this.#t.setEmitListener(e=>this.emit(e))}};var qo=class extends _{constructor(e){super(e.notifier,"scrollbar");this.editor=e;this.fadeOutTimeout=null;this.scrollbarOverlay=document.createElement("div"),this.scrollbarOverlay.classList.add("ScrollbarTool-overlay"),this.verticalScrollbar=document.createElement("div"),this.verticalScrollbar.classList.add("vertical-scrollbar"),this.horizontalScrollbar=document.createElement("div"),this.horizontalScrollbar.classList.add("horizontal-scrollbar"),this.scrollbarOverlay.replaceChildren(this.verticalScrollbar,this.horizontalScrollbar);let r=null,n=null;this.enabledValue().onUpdateAndNow(i=>{r?.remove(),n?.remove(),n=null,r=null,i&&(n=e.notifier.on(7,a=>{this.updateScrollbars()}),this.updateScrollbars(),r=e.createHTMLOverlay(this.scrollbarOverlay))})}updateScrollbars(){let e=this.editor.viewport,r=e.getScreenRectSize(),n=new R(0,0,r.x,r.y),i=this.editor.getImportExportRect().transformedBoundingBox(e.canvasToScreenTransform).union(n),a=n.width/i.width*r.x,l=n.height/i.height*r.y,c=(n.x-i.x)/i.width*r.x,d=(n.y-i.y)/i.height*r.y;this.horizontalScrollbar.style.width=`${a}px`,this.verticalScrollbar.style.height=`${l}px`,this.horizontalScrollbar.style.marginLeft=`${c}px`,this.verticalScrollbar.style.marginTop=`${d}px`;let p=(h,f,b)=>{let v="represents-no-scroll";Math.abs(f-b)<1e-8?h.classList.add(v):h.classList.remove(v)};p(this.horizontalScrollbar,a,r.x),p(this.verticalScrollbar,l,r.y),this.fadeOutTimeout!==null&&clearTimeout(this.fadeOutTimeout);let u=3e3;this.fadeOutTimeout=setTimeout(()=>{this.scrollbarOverlay.classList.remove("just-updated")},u),this.scrollbarOverlay.classList.add("just-updated")}};var ao=class{constructor(o,e){this.activeTool=null;this.isEditorReadOnly=o.isReadOnlyReactiveValue(),this.inputPipeline=new Uo,this.inputPipeline.setEmitListener(u=>this.onEventInternal(u));let r=new Mt;this.primaryToolGroup=r;let n=new Ie(o,6,e.touchPanTool),i=new Ie(o,16,e.keyboardPanZoom),a=new _e(o,e.penTool(1),{color:M.purple,thickness:8}),l=new _e(o,e.penTool(2),{color:M.clay,thickness:4});l.setInputMapper(new Rt(o.viewport));let c=new mt(o,e.eraserTool),d=[a,l,new _e(o,e.penTool(3),{color:M.ofRGBA(1,1,0,.5),thickness:40,factory:no}),c,new Ee(o,e.selectionTool),new Ze(o,e.textTool,e),new Ie(o,8,e.anyDevicePanning)],p=new so(o,e.soundExplorer);p.setEnabled(!1),this.tools=[new qo(o),new Ot(o,e.pipetteTool),p,n,...d,i,new to(o),new gt(o),new oo(o),c.makeEraserSwitcherTool(),new Wo(o),new ro(o),new io(o)],d.forEach(u=>u.setToolGroup(r)),n.setEnabled(!0),a.setEnabled(!0),o.notifier.on(0,u=>{u.kind===0&&o.announceForAccessibility(e.toolEnabledAnnouncement(u.tool.description))}),o.notifier.on(1,u=>{u.kind===1&&o.announceForAccessibility(e.toolDisabledAnnouncement(u.tool.description))}),this.activeTool=null}setTools(o,e){this.tools=o,this.primaryToolGroup=e??new Mt}addPrimaryTool(o){o.setToolGroup(this.primaryToolGroup),o.isEnabled()&&this.primaryToolGroup.notifyEnabled(o),this.tools.includes(o)||this.addTool(o)}getPrimaryTools(){return this.tools.filter(o=>o.getToolGroup()===this.primaryToolGroup)}addTool(o,e){this.tools.includes(o)||(e?.addToFront?this.tools.splice(0,0,o):this.tools.push(o))}removeAndDestroyTools(o){let e=[];for(let r of this.tools)o.includes(r)?(this.activeTool===r&&(this.activeTool=null),r.onDestroy()):e.push(r);this.tools=e}insertTools(o,e,r){this.tools=this.tools.filter(i=>!e.includes(i));let n=[];for(let i of this.tools)r==="after"&&n.push(i),i===o&&n.push(...e),r==="before"&&n.push(i);this.tools=n}insertToolsAfter(o,e){this.insertTools(o,e,"after")}insertToolsBefore(o,e){this.insertTools(o,e,"before")}onEventInternal(o){let e=this.isEditorReadOnly.get(),r=i=>i.isEnabled()&&(!e||i.canReceiveInputInReadOnlyEditor()),n=!1;if(o.kind===0){let i=!1;this.activeTool&&!this.activeTool.eventCanBeDeliveredToNonActiveTool(o)&&(i=!0);for(let a of this.tools)if(!(i&&a!==this.activeTool)&&r(a)&&a.onEvent(o)){this.activeTool!==a&&this.activeTool?.onEvent({kind:3}),this.activeTool=a,n=!0;break}}else if(o.kind===2)this.activeTool?.onEvent(o)&&o.allPointers.length>1||(this.activeTool=null),n=!0;else if(o.kind===1)this.activeTool!==null&&(this.activeTool.onEvent(o),n=!0);else if(o.kind===3)this.activeTool!==null&&(this.activeTool.onEvent(o),this.activeTool=null);else for(let i of this.tools)if(r(i)&&(n=i.onEvent(o),n))break;return n}onEvent(o){return this.dispatchInputEvent(o)}dispatchInputEvent(o){return this.inputPipeline.onEvent(o)}addInputMapper(o){this.inputPipeline.addToTail(o)}getMatchingTools(o){return this.tools.filter(e=>e instanceof o)}onEditorDestroyed(){for(let o of this.tools)o.onDestroy()}};var Pi=class{constructor(o,e,r){this.editor=o;this.announceRedoCallback=e;this.announceUndoCallback=r;this.maxUndoRedoStackSize=700;this.#e=[],this.#t=[]}#e;#t;fireUpdateEvent(o,e){this.editor.notifier.dispatch(3,{kind:3,undoStackSize:this.#e.length,redoStackSize:this.#t.length,command:e,stackUpdateType:o})}push(o,e=!0){e&&o.apply(this.editor),this.#e.push(o);for(let r of this.#t)r.onDrop(this.editor);if(this.#t=[],this.#e.length>this.maxUndoRedoStackSize){let r=Math.ceil(this.maxUndoRedoStackSize/100);this.#e.splice(0,r).forEach(i=>i.onDrop(this.editor))}this.fireUpdateEvent(0,o),this.editor.notifier.dispatch(4,{kind:4,command:o})}undo(){let o=this.#e.pop();if(o){this.#t.push(o);let e=o.unapply(this.editor);return this.announceUndoCallback(o),this.fireUpdateEvent(1,o),this.editor.notifier.dispatch(5,{kind:5,command:o}),e}}redo(){let o=this.#t.pop();if(o){this.#e.push(o);let e=o.apply(this.editor);return this.announceRedoCallback(o),this.fireUpdateEvent(2,o),this.editor.notifier.dispatch(4,{kind:4,command:o}),e}}get undoStackSize(){return this.#e.length}get redoStackSize(){return this.#t.length}},ki=Pi;var bt=class s extends Ve{constructor(e){super(e);this.clearedCount=0;this.renderedPathCount=0;this.lastFillStyle=null;this.lastPoint=null;this.objectNestingLevel=0;this.lastText=null;this.lastImage=null;this.pointBuffer=[]}displaySize(){let e=this.getViewport().getScreenRectSize();return e.x===0||e.y===0?T.of(640,480):e}clear(){if(this.clearedCount++,this.renderedPathCount=0,this.pointBuffer=[],this.lastText=null,this.lastImage=null,this.objectNestingLevel>0)throw new Error(`Within an object while clearing! Nesting level: ${this.objectNestingLevel}`)}beginPath(e){this.lastPoint=e,this.pointBuffer.push(e)}endPath(e){this.renderedPathCount++,this.lastFillStyle=e}lineTo(e){e=this.canvasToScreen(e),this.lastPoint=e,this.pointBuffer.push(e)}moveTo(e){e=this.canvasToScreen(e),this.lastPoint=e,this.pointBuffer.push(e)}traceCubicBezierCurve(e,r,n){e=this.canvasToScreen(e),r=this.canvasToScreen(r),n=this.canvasToScreen(n),this.lastPoint=n,this.pointBuffer.push(e,r,n)}traceQuadraticBezierCurve(e,r){e=this.canvasToScreen(e),r=this.canvasToScreen(r),this.lastPoint=r,this.pointBuffer.push(e,r)}drawPoints(...e){}drawText(e,r,n){this.lastText=e}drawImage(e){this.lastImage=e}startObject(e,r){super.startObject(e),this.objectNestingLevel+=1}endObject(){super.endObject(),this.objectNestingLevel-=1}isTooSmallToRender(e){return!1}canRenderFromWithoutDataLoss(e){return e instanceof s}renderFromOtherOfSameType(e,r){if(!(r instanceof s))throw new Error(`${r} cannot be rendered onto ${this}`);this.renderedPathCount+=r.renderedPathCount,this.lastFillStyle=r.lastFillStyle,this.lastPoint=r.lastPoint,this.pointBuffer.push(...r.pointBuffer.map(n=>e.transformVec2(n)))}toString(){return"[DummyRenderer]"}};var rt=3,Ko=class s{constructor(o,e){this.region=o;this.cacheState=e;this.instantiatedChildren=[];this.parent=null;this.cachedRenderer=null;this.renderedIds=[];this.renderedMaxZIndex=null}generateParent(){if(this.parent)return this.parent;let o=R.fromCorners(this.region.topLeft.minus(this.region.size),this.region.bottomRight.plus(this.region.size)),e=new s(o,this.cacheState);e.generateChildren();let r=this.region.maxDimension/100,n=(e.instantiatedChildren.length-1)/2;if(!e.instantiatedChildren[n].region.eq(this.region,r))throw console.error(e.instantiatedChildren[n].region,"\u2260",this.region),new Error("Logic error: [this] is not contained within its parent's center child");return e.instantiatedChildren[n]=this,this.parent=e,e}generateChildren(){if(this.instantiatedChildren.length===0){if(this.region.size.x/rt===0||this.region.size.y/rt===0){console.warn("Cache element has zero size! Not generating children.");return}let o=this.region.divideIntoGrid(rt,rt);console.assert(o.length===rt*rt,"Warning: divideIntoGrid created the wrong number of subrectangles!");for(let e of o){let r=new s(e,this.cacheState);r.parent=this,this.instantiatedChildren.push(r)}}this.checkRep()}getChildren(){return this.checkRep(),this.generateChildren(),this.instantiatedChildren}smallestChildContaining(o){let e=o.maxDimension>this.region.maxDimension/rt;if(!this.region.containsRect(o)||e)return null;for(let r of this.getChildren())if(r.region.containsRect(o))return r.smallestChildContaining(o)??r;return null}renderingWouldBeHighEnoughResolution(o){let e=this.region.w/this.cacheState.props.blockResolution.x;return!(o.getScaleFactor()*e>this.cacheState.props.maxScale)}allChildrenCanRender(o,e){if(this.instantiatedChildren.length===0)return!1;for(let r of this.instantiatedChildren)if(r.region.intersects(o.visibleRect)&&!r.renderingIsUpToDate(this.idsOfIntersecting(e)))return!1;return!0}computeSortedByLeafIds(o){let e=o.slice();return e.sort((r,n)=>r.getId()-n.getId()),e}idsOfIntersecting(o){let e=[];for(let r of o)r.getBBox().intersects(this.region)&&e.push(r.getId());return e}allRenderedIdsIn(o){if(this.renderedIds.length>o.length)return!1;for(let e=0;e<this.renderedIds.length;e++)if(o[e]!==this.renderedIds[e])return!1;return!0}renderingIsUpToDate(o){return this.cachedRenderer===null||o.length!==this.renderedIds.length?!1:this.allRenderedIdsIn(o)}renderItems(o,e,r){if(!r.visibleRect.intersects(this.region)||e.length===0)return;if(e=(a=>{let l=[];for(let c of a){let d=c.getBBox();d.intersects(this.region)&&(d.maxDimension>=this.region.maxDimension?l.push(...c.getChildrenOrSelfIntersectingRegion(this.region)):l.push(c))}return l})(e),!this.cacheState.props.isOfCorrectType(o)){for(let a of e)a.render(o,r.visibleRect);return}if(this.cacheState.debugMode&&o.drawRect(this.region,r.getSizeOfPixelOnCanvas(),{fill:M.yellow}),this.renderingWouldBeHighEnoughResolution(r)){let a=u=>u.w/this.region.w<1/this.cacheState.props.blockResolution.x,l=[];for(let u of e)l.push(...u.getLeavesIntersectingRegion(this.region,a));Pt(l);let c=this.computeSortedByLeafIds(l);if(c.length===0)return;let d=c.map(u=>u.getId()),p;if(this.renderingIsUpToDate(d))p=this.cachedRenderer.startRender();else{if(this.allChildrenCanRender(r,c)){for(let h of this.getChildren())h.renderItems(o,e,r);return}let u=0;for(let h of c)a(h.getBBox())||(u+=h.getContent().getProportionalRenderingTime());if(u>this.cacheState.props.minProportionalRenderTimePerCache){let h=!0;if(!this.cachedRenderer)this.cachedRenderer=this.cacheState.recordManager.allocCanvas(this.region,()=>this.onRegionDealloc());else if(c.length>this.renderedIds.length&&this.allRenderedIdsIn(d)&&this.renderedMaxZIndex!==null){let f=[],b=null;for(let v=0;v<c.length;v++){let g=c[v],m=g.getContent().getZIndex();(v>=this.renderedIds.length||g.getId()!==this.renderedIds[v])&&(f.push(g),(b===null||m<b)&&(b=m))}if(b!==null&&b>this.renderedMaxZIndex){h=!1,p=this.cachedRenderer.startRender();for(let v=0;v<l.length;v++){let g=l[v],y=g.getContent().getZIndex();y>this.renderedMaxZIndex&&(g.render(p,this.region),this.renderedMaxZIndex=y)}this.cacheState.debugMode&&o.drawRect(this.region,2*r.getSizeOfPixelOnCanvas(),{fill:M.clay})}}else this.cacheState.debugMode&&console.log("Decided on a full re-render. Reason: At least one of the following is false:",`
 leafIds.length > this.renderedIds.length: `,d.length>this.renderedIds.length,`
 this.allRenderedIdsIn(leafIds): `,this.allRenderedIdsIn(d),`
 this.renderedMaxZIndex !== null: `,this.renderedMaxZIndex!==null,`

this.rerenderedIds: `,this.renderedIds,", leafIds: ",d);if(h){p=this.cachedRenderer.startRender(),p.clear(),this.renderedMaxZIndex=null;let f=An(l,this.region);for(let b=f;b<l.length;b++){let v=l[b],g=v.getContent();this.renderedMaxZIndex??=g.getZIndex(),this.renderedMaxZIndex=Math.max(this.renderedMaxZIndex,g.getZIndex()),v.render(p,this.region)}this.cacheState.debugMode&&o.drawRect(this.region,3*r.getSizeOfPixelOnCanvas(),{fill:M.red})}this.renderedIds=d}else{this.cachedRenderer?.dealloc();let h=r.getSizeOfPixelOnCanvas(),f=new R(this.region.x,this.region.y,this.region.w+h,this.region.h+h);o.startObject(f,!0);for(let v of l)v.render(o,this.region.intersection(r.visibleRect));o.endObject(),this.cacheState.debugMode&&o.drawRect(this.region,2*r.getSizeOfPixelOnCanvas(),{fill:M.green})}}if(p){let u=this.cachedRenderer.getTransform(this.region).inverse();o.renderFromOtherOfSameType(u,p)}this.instantiatedChildren.every(u=>u.isEmpty())&&(this.instantiatedChildren=[])}else for(let a of this.getChildren())a.renderItems(o,e.filter(l=>l.getBBox().intersects(a.region)),r);this.checkRep()}isEmpty(){return this.cachedRenderer!==null?!1:this.instantiatedChildren.every(o=>o.isEmpty())}onRegionDealloc(){this.cachedRenderer=null,this.isEmpty()&&(this.instantiatedChildren=[])}checkRep(){if(this.instantiatedChildren.length!==rt*rt&&this.instantiatedChildren.length!==0)throw new Error(`Repcheck: Wrong number of children. Got ${this.instantiatedChildren.length}`);if(this.renderedIds[1]!==void 0&&this.renderedIds[0]>=this.renderedIds[1])throw console.error(this.renderedIds),new Error("Repcheck: First two ids are not in ascending order!");for(let o of this.instantiatedChildren)if(o.parent!==this)throw new Error("Children should be linked to their parents!");if(this.cachedRenderer&&!this.cachedRenderer.isAllocd())throw new Error("this' cachedRenderer != null, but is dealloc'd")}};var Go=class{constructor(o,e){this.onBeforeDeallocCallback=o;this.cacheState=e;this.allocd=!1;this.allocCount=0;this.renderer=e.props.createRenderer(),this.lastUsedCycle=-1,this.allocd=!0}startRender(){if(this.lastUsedCycle=this.cacheState.currentRenderingCycle,!this.allocd)throw new Error("Only alloc'd canvases can be rendered to");return this.renderer}dealloc(){this.onBeforeDeallocCallback?.(),this.allocd=!1,this.onBeforeDeallocCallback=null,this.lastUsedCycle=0}isAllocd(){return this.allocd}realloc(o){this.allocd&&this.dealloc(),this.allocd=!0,this.onBeforeDeallocCallback=o,this.lastUsedCycle=this.cacheState.currentRenderingCycle,this.allocCount++}getLastUsedCycle(){return this.lastUsedCycle}getTransform(o){return k.scaling2D(this.cacheState.props.blockResolution.x/o.size.x).rightMul(k.translation(o.topLeft.times(-1)))}setRenderingRegion(o){let e=this.getTransform(o);this.renderer.setTransform(e),this.renderer.overrideVisibleRect(o.grownBy(1/e.getScaleFactor()))}};var on=class{constructor(o){this.cacheRecords=[];this.maxCanvases=Math.ceil(o.cacheSize/4/o.blockResolution.x/o.blockResolution.y)}setSharedState(o){this.cacheState=o}allocCanvas(o,e){if(this.cacheRecords.length<this.maxCanvases){let r=new Go(e,this.cacheState);return r.setRenderingRegion(o),this.cacheRecords.push(r),this.cacheState.debugMode&&console.log("[Cache] Cache spaces used: ",this.cacheRecords.length," of ",this.maxCanvases),r}else{let r=this.getLeastRecentlyUsedRecord();return this.cacheState.debugMode&&console.log("[Cache] Re-alloc. Times allocated: ",r.allocCount,`
Last used cycle: `,r.getLastUsedCycle(),`
Current cycle: `,this.cacheState.currentRenderingCycle),r.realloc(e),r.setRenderingRegion(o),this.cacheState.debugMode&&(console.log("[Cache] Now re-alloc'd. Last used cycle: ",r.getLastUsedCycle()),console.assert(r.cacheState===this.cacheState,"[Cache] Unequal cache states! cacheState should be a shared object!")),r}}getLeastRecentlyUsedRecord(){return this.cacheRecords.sort((o,e)=>o.getLastUsedCycle()-e.getLastUsedCycle()),this.cacheRecords[0]}getDebugInfo(){let o=0,e=0;for(let n of this.cacheRecords)e+=n.allocCount,n.isAllocd()&&o++;return e/=Math.max(this.cacheRecords.length,1),[`${this.cacheRecords.length} cache records (max ${this.maxCanvases})`,`${o} assigned to screen regions`,`Average number of times reassigned: ${Math.round(e*100)/100}`].join(`
`)}};var _o=class{constructor(o){this.recordManager=new on(o),this.sharedState={props:o,currentRenderingCycle:0,recordManager:this.recordManager,debugMode:!1},this.recordManager.setSharedState(this.sharedState)}render(o,e,r){let n=r.visibleRect;if(this.sharedState.currentRenderingCycle++,!this.sharedState.props.isOfCorrectType(o)){e.render(o,n);return}if(!this.rootNode){let l=this.sharedState.props.blockResolution,c=n.topLeft;this.rootNode=new Ko(new R(c.x,c.y,l.x,l.y),this.sharedState)}for(;!this.rootNode.region.containsRect(n);)this.rootNode=this.rootNode.generateParent();this.rootNode=this.rootNode.smallestChildContaining(n)??this.rootNode;let i=e.getLeavesIntersectingRegion(r.visibleRect,l=>o.isTooSmallToRender(l)),a=0;for(let l of i)a+=l.getContent().getProportionalRenderingTime();a>this.sharedState.props.minProportionalRenderTimeToUseCache?this.rootNode.renderItems(o,[e],r):e.render(o,n)}getDebugInfo(){return this.recordManager.getDebugInfo()}setIsDebugMode(o){this.sharedState.debugMode=o}};var jo=class extends Ve{constructor(e,r){super(e);this.localizationTable=r;this.descriptionBuilder=[];this.pathCount=0;this.textNodeCount=0;this.imageNodeCount=0}displaySize(){return T.of(500,500)}clear(){this.descriptionBuilder=[],this.pathCount=0,this.textNodeCount=0,this.imageNodeCount=0}getDescription(){return[this.localizationTable.pathNodeCount(this.pathCount),...this.textNodeCount>0?[this.localizationTable.textNodeCount(this.textNodeCount)]:[],...this.imageNodeCount>0?[this.localizationTable.imageNodeCount(this.imageNodeCount)]:[],...this.descriptionBuilder].join(`
`)}beginPath(e){}endPath(e){this.pathCount++}lineTo(e){}moveTo(e){}traceCubicBezierCurve(e,r,n){}traceQuadraticBezierCurve(e,r){}drawText(e,r,n){this.descriptionBuilder.push(this.localizationTable.textNode(e)),this.textNodeCount++}drawImage(e){let r=e.label?this.localizationTable.imageNode(e.label):this.localizationTable.unlabeledImageNode;this.descriptionBuilder.push(r),this.imageNodeCount++}isTooSmallToRender(e){return e.maxDimension<15/this.getSizeOfCanvasPixelOnScreen()}drawPoints(...e){}};var Li=class{constructor(o,e){this.viewport=e;this.enabled=new Map;this.presenter=null;this.style={color:"black",diameter:2};"ink"in navigator&&navigator.ink&&navigator.ink.requestPresenter({presentationArea:o}).then(n=>{this.presenter=n})}setEnabled(o,e){this.enabled.set(o,e)}updateStyle(o){let e=o.color.toString();this.style={color:e,diameter:Math.ceil(o.width/this.viewport.getSizeOfPixelOnCanvas())}}onEvent(o){this.presenter&&this.enabled.get(o.pointerId)&&o.isTrusted&&this.presenter.updateInkTrailStartPoint(o,this.style)}},lo=class extends Re{constructor(o,e){super(o,e),this.inkPresenter=new Li(o.canvas,e)}getDraftInkPresenter(){return this.inkPresenter}onEvent(o){this.inkPresenter.onEvent(o)}};var co=class{constructor(o,e,r){this.editor=o;this.parent=r;this.textRerenderOutput=null;this.devicePixelRatio=window.devicePixelRatio??1;this.getColorAt=o=>null;if(e===1)this.initializeCanvasRendering();else if(e===0)this.dryInkRenderer=new bt(o.viewport),this.wetInkRenderer=new bt(o.viewport);else throw new Error(`Unknown rendering mode, ${e}!`);this.textRenderer=new jo(o.viewport,o.localization),this.initializeTextRendering();let n=T.of(600,600);this.cache=new _o({createRenderer:()=>{if(e===0)return new bt(o.viewport);if(e!==1)throw new Error("Unspported rendering mode");let i=document.createElement("canvas");i.width=n.x+1,i.height=n.y+1;let a=i.getContext("2d");return new Re(a,o.viewport)},isOfCorrectType:i=>this.dryInkRenderer.canRenderFromWithoutDataLoss(i),blockResolution:n,cacheSize:600*600*4*90,maxScale:Math.max(1,1.3/window.devicePixelRatio),minProportionalRenderTimePerCache:20*4,minProportionalRenderTimeToUseCache:105*4}),this.editor.notifier.on(8,i=>{if(i.kind!==8)throw new Error("Mismatched event.kinds!");this.resizeSurfacesCallback?.()})}get width(){return this.dryInkRenderer.displaySize().x}get height(){return this.dryInkRenderer.displaySize().y}getCache(){return this.cache}initializeCanvasRendering(){let o=document.createElement("canvas"),e=document.createElement("canvas"),r=o.getContext("2d"),n=e.getContext("2d");this.dryInkRenderer=new Re(r,this.editor.viewport),this.wetInkRenderer=new lo(n,this.editor.viewport),o.className="dryInkCanvas",e.className="wetInkCanvas",this.parent&&(this.parent.appendChild(o),this.parent.appendChild(e)),this.resizeSurfacesCallback=()=>{let i=c=>Math.ceil(c.clientWidth*this.devicePixelRatio)||c.width,a=c=>Math.ceil(c.clientHeight*this.devicePixelRatio)||c.height,l=c=>a(c)!==c.height||i(c)!==c.width;(l(o)||l(e))&&(o.width=i(o),o.height=a(o),e.width=i(e),e.height=a(e),n.resetTransform(),r.resetTransform(),r.scale(this.devicePixelRatio,this.devicePixelRatio),n.scale(this.devicePixelRatio,this.devicePixelRatio),this.editor.notifier.dispatch(8,{kind:8,newSize:T.of(this.width,this.height)}))},this.resizeSurfacesCallback(),this.flattenCallback=()=>{r.save(),r.resetTransform(),r.drawImage(e,0,0),r.restore()},this.getColorAt=i=>{let a=i.times(this.devicePixelRatio),c=r.getImageData(a.x,a.y,1,1)?.data;return c?M.ofRGBA(c[0]/255,c[1]/255,c[2]/255,c[3]/255):null}}initializeTextRendering(){let o=document.createElement("div");o.classList.add("textRendererOutputContainer");let e=G({classList:["rerenderButton"],text:this.editor.localization.rerenderAsText});this.textRerenderOutput=document.createElement("div"),this.textRerenderOutput.setAttribute("aria-live","polite"),e.onclick=()=>{this.rerenderAsText()},o.replaceChildren(e,this.textRerenderOutput),this.editor.createHTMLOverlay(o)}setDevicePixelRatio(o){if(isFinite(o)&&o>=.001&&o<=10&&o!==this.devicePixelRatio)return this.devicePixelRatio=o,this.resizeSurfacesCallback?.(),this.editor.queueRerender()}getDevicePixelRatio(){return this.devicePixelRatio}onPointerEvent(o){this.wetInkRenderer instanceof lo&&this.wetInkRenderer.onEvent(o)}rerenderAsText(){this.textRenderer.clear(),this.editor.image.render(this.textRenderer,this.editor.viewport),this.textRerenderOutput&&(this.textRerenderOutput.innerText=this.textRenderer.getDescription())}startRerender(){return this.resizeSurfacesCallback?.(),this.dryInkRenderer.clear(),this.dryInkRenderer}setDraftMode(o){this.dryInkRenderer.setDraftMode(o)}getDryInkRenderer(){return this.dryInkRenderer}getWetInkRenderer(){return this.wetInkRenderer}flatten(){this.flattenCallback?.()}};var Ft=Zt((s,o)=>{let e=o.getSizeOfPixelOnCanvas()*.65;return new rn(s,e,o)}),rn=class{constructor(o,e,r){this.minFitAllowed=e;this.viewport=r;this.parts=[];this.widthAverageNumSamples=1;this.lastLineSegment=null;this.averageWidth=o.width,this.startPoint={...o,pos:this.roundPoint(o.pos)},this.lastPoint=this.startPoint.pos,this.bbox=new R(this.startPoint.pos.x,this.startPoint.pos.y,0,0),this.parts=[{kind:1,point:this.startPoint.pos}]}getBBox(){return this.bbox.grownBy(this.averageWidth)}getRenderingStyle(){return{fill:M.transparent,stroke:this.inkTrailStyle()}}inkTrailStyle(){return{color:this.startPoint.color,width:this.roundDistance(this.averageWidth)}}previewCurrentPath(){let o=this.startPoint.pos,e=[...this.parts];return e.length<=1&&e.push({kind:0,point:o.plus(T.of(this.averageWidth/4,0))}),{startPoint:o,commands:e,style:this.getRenderingStyle()}}previewFullPath(){return[this.previewCurrentPath()]}preview(o){let e=this.previewFullPath();if(e){let r=this.viewport.visibleRect;o.startObject(r);for(let n of e)o.drawPath(n);o.endObject()}}build(){return new ae(this.previewFullPath())}getMinFit(){let o=Math.min(this.minFitAllowed,this.averageWidth/4);return o<1e-10&&(o=this.minFitAllowed),o}roundPoint(o){let e=this.getMinFit();return q.roundPoint(o,e)}roundDistance(o){let e=this.getMinFit();return q.roundPoint(o,e)}addPoint(o){this.widthAverageNumSamples++,this.averageWidth=this.averageWidth*(this.widthAverageNumSamples-1)/this.widthAverageNumSamples+o.width/this.widthAverageNumSamples;let e=this.roundPoint(o.pos);e.eq(this.lastPoint)||(this.lastLineSegment&&this.lastLineSegment.direction.dot(e.minus(this.lastPoint).normalized())>.997&&(this.parts.pop(),this.lastPoint=this.lastLineSegment.p1),this.parts.push({kind:0,point:this.roundPoint(o.pos)}),this.bbox=this.bbox.grownToPoint(e),this.lastLineSegment=new ge(this.lastPoint,e),this.lastPoint=e)}};var le="http://www.w3.org/2000/svg",mc=0,nn=()=>{let s=`checkerboard-${mc++}`,o=je("pattern",{id:s,viewBox:"0,0,10,10",width:"20%",height:"20%",patternUnits:"userSpaceOnUse",children:Yr("rect",[{x:0,y:0,width:10,height:10,fill:"white"},{x:0,y:0,width:5,height:5,fill:"gray"},{x:5,y:5,width:5,height:5,fill:"gray"}])}),e=`url(#${s})`;return{patternDefElement:o,get patternDef(){return o.innerHTML},patternRef:e}},Ys=s=>{let o=document.createElementNS(le,"svg");o.innerHTML=`
		<style>
			.toolbar-svg-undo-redo-icon {
				stroke: var(--icon-color);
				stroke-width: 12;
				stroke-linejoin: round;
				stroke-linecap: round;
				fill: none;

				transform-origin: center;
			}
		</style>
	`;let e=document.createElementNS(le,"path");return e.setAttribute("d","M20,20 A15,15 0 0 1 70,80 L80,90 L60,70 L65,90 L87,90 L65,80"),e.classList.add("toolbar-svg-undo-redo-icon"),s&&(e.style.transform="scale(-1, 1)"),o.appendChild(e),o.setAttribute("viewBox","0 0 100 100"),o},Ye=class{makeUndoIcon(){return Ys(!0)}makeRedoIcon(){return Ys(!1)}makeDropdownIcon(){let o=this.makeIconFromPath("M5,10 L50,90 L95,10 Z");return o.setAttribute("viewBox","-10 -10 110 110"),o}makeEraserIcon(o,e){o??=10;let r=o/4,n="#ff70af";return je("svg",{viewBox:"0 0 120 120",children:[je("defs",{children:[je("linearGradient",{id:"dash-pattern",children:Yr("stop",[{offset:"80%","stop-color":n},{offset:"85%","stop-color":"white"},{offset:"90%","stop-color":n}])})]}),je("path",{fill:e==="partial-stroke"?"url(#dash-pattern)":n,stroke:"black",transform:"rotate(41.35)",d:`
						M 52.5 27
						C 50 28.9 48.9 31.7 48.9 34.8
						L 48.9 39.8
						C 48.9 45.3 53.4 49.8 58.9 49.8
						L 103.9 49.8
						C 105.8 49.8 107.6 49.2 109.1 48.3
						L 110.2 ${r+49.5} L 159.7 ${r+5}
						L 157.7 ${-r+5.2} L 112.4 ${49.5-r}
						C 113.4 43.5 113.9 41.7 113.9 39.8
						L 113.9 34.8
						C 113.9 29.3 109.4 24.8 103.9 24.8
						L 58.9 24.8
						C 56.5 24.8 54.3 25.7 52.5 27
						z
					`}),je("rect",{stroke:"#cc8077",fill:"var(--icon-color)",width:65,height:75,x:48.9,y:-38.7,transform:"rotate(41.35)"})]})}makeSelectionIcon(o="rect"){let e=document.createElementNS(le,"svg");return o==="rect"?e.innerHTML=`
			<g>
				<rect x="10" y="10" width="70" height="70" fill="pink" stroke="black" stroke-dasharray="32 9"/>
				<rect x="75" y="75" width="10" height="10" fill="white" stroke="black"/>
			</g>
			`:e.innerHTML=`
			<g>
				<rect x="10" y="10" width="76" height="76" rx="50" stroke-dasharray="32 9" fill="pink" stroke="black"/>
				<rect x="71" y="71" width="10" height="10" fill="white" stroke="black"/>
			</g>
			`,e.setAttribute("viewBox","0 0 100 100"),e}makeRotateIcon(){let o=document.createElementNS(le,"svg");return o.innerHTML=`
			<defs>
				<marker
					id="arrow-marker"
					viewBox="0 0 10 10"
					refX="3" refY="5"
					markerWidth="3" markerHeight="3"
					orient="auto-start-reverse"
				>
					<path
						d="M0,0 L8,5 L0,10z"
						fill="var(--icon-color)"
					/>
				</marker>
			</defs>

			<path
				marker-start="url(#arrow-marker)"
				d="
					M20,20
					A30,30 0 1 1 80 80
				"
				fill="none"
				stroke="var(--icon-color)"
				stroke-width="12"
			/>
			<path
				d="
					M80,80
					A30,30 0 1 1 20 20
				"
				fill="none"
				stroke="var(--icon-color)"
				stroke-width="12"
				stroke-dasharray="30 10 20 10 20 10 10"
				style="stroke-linecap: butt;"
			/>
		`,o.setAttribute("viewBox","-5 -5 110 110"),o}makeHandToolIcon(){return this.makeIconFromPath(`
			m 10,60
				5,30
			H 90
			V 30
			C 90,20 75,20 75,30
			V 60
				20
			C 75,10 60,10 60,20
			V 60
				15
			C 60,5 45,5 45,15
			V 60
				25
			C 45,15 30,15 30,25
			V 60
				75
			L 25,60
			C 20,45 10,50 10,60
			Z
		`,"none","var(--icon-color)","3")}makeTouchPanningIcon(){return this.makeIconFromPath(`
			M 5,5.5
			V 17.2
			L 16.25,5.46
			Z
	
			m 33.75,0
			L 50,17
			V 5.5
			Z
	
			M 5,40.7
			v 11.7
			h 11.25
			z
	
			M 26,19
			C 19.8,19.4 17.65,30.4 21.9,34.8
			L 50,70
			H 27.5
			c -11.25,0 -11.25,17.6 0,17.6
			H 61.25
			C 94.9,87.8 95,87.6 95,40.7 78.125,23 67,29 55.6,46.5
			L 33.1,23
			C 30.3125,20.128192 27.9,19 25.830078,19.119756
			Z
		`,"none","var(--icon-color)","3")}makeAllDevicePanningIcon(){return this.makeIconFromPath(`
			M 5 5
			L 5 17.5
				17.5 5
				5 5
			z
	
			M 42.5 5
			L 55 17.5
				55 5
				42.5 5
			z
	
			M 70 10
			L 70 21
				61 15
				55.5 23
				66 30
				56 37
				61 45
				70 39
				70 50
				80 50
				80 39
				89 45
				95 36
				84 30
				95 23
				89 15
				80 21
				80 10
				70 10
			z
	
			M 27.5 26.25
			L 27.5 91.25
			L 43.75 83.125
			L 52 99
			L 68 91
			L 60 75
			L 76.25 66.875
			L 27.5 26.25
			z
	
			M 5 42.5
			L 5 55
			L 17.5 55
			L 5 42.5
			z
		`,"none","var(--icon-color)","3")}makeZoomIcon(){let o=document.createElementNS(le,"svg");o.setAttribute("viewBox","0 0 100 100");let e=(r,n,i)=>{let a=document.createElementNS(le,"text");a.appendChild(document.createTextNode(r)),a.setAttribute("x",n.toString()),a.setAttribute("y",i.toString()),a.style.textAlign="center",a.style.textAnchor="middle",a.style.fontSize="55px",a.style.fill="var(--icon-color)",a.style.fontFamily="monospace",o.appendChild(a)};return e("+",40,45),e("-",70,75),o}makeRotationLockIcon(){let o=this.makeIconFromPath(`
			M 40.1 25.1 
			C 32.5 25 27.9 34.1 27.9 34.1 
			L 25.7 30 
			L 28 44.7 
			L 36.6 40.3 
			L 32.3 38.3 
			C 33.6 28 38.1 25.2 45.1 31.8 
			L 49.4 29.6 
			C 45.9 26.3 42.8 25.1 40.1 25.1 
			z

			M 51.7 34.2 
			L 43.5 39.1 
			L 48 40.8 
			C 47.4 51.1 43.1 54.3 35.7 48.2 
			L 31.6 50.7 
			C 45.5 62.1 52.6 44.6 52.6 44.6 
			L 55.1 48.6 
			L 51.7 34.2 
			z

			M 56.9 49.9 
			C 49.8 49.9 49.2 57.3 49.3 60.9 
			L 47.6 60.9 
			L 47.6 73.7 
			L 66.1 73.7 
			L 66.1 60.9 
			L 64.4 60.9 
			C 64.5 57.3 63.9 49.9 56.9 49.9 
			z

			M 56.9 53.5 
			C 60.8 53.5 61 58.2 60.8 60.9 
			L 52.9 60.9 
			C 52.7 58.2 52.9 53.5 56.9 53.5 
			z
		`);return o.setAttribute("viewBox","10 10 70 70"),o}makeInsertImageIcon(){return this.makeIconFromPath(`
			M 5 10 L 5 90 L 95 90 L 95 10 L 5 10 z
			M 10 15 L 90 15 L 90 50 L 70 75 L 40 50 L 10 75 L 10 15 z
			M 22.5 25 A 7.5 7.5 0 0 0 15 32.5 A 7.5 7.5 0 0 0 22.5 40 A 7.5 7.5 0 0 0 30 32.5 A 7.5 7.5 0 0 0 22.5 25 z 
		`)}makeUploadFileIcon(){return this.makeIconFromPath(`
			M 48,10 32,34 43,33 42,68
			H 54
			L 53,33 64,34 Z
	
			M 8,66 V 86 H 88 V 66 H 78 V 76 H 18 V 66 Z
		`)}makeTextIcon(o){let e=document.createElementNS(le,"svg");e.setAttribute("viewBox","0 0 100 100");let r=document.createElementNS(le,"text");return r.appendChild(document.createTextNode("T")),r.style.fontFamily=o.fontFamily,r.style.fontWeight=o.fontWeight??"",r.style.fontVariant=o.fontVariant??"",r.style.fill=o.renderingStyle.fill.toHexString(),r.style.textAnchor="middle",r.setAttribute("x","50"),r.setAttribute("y","75"),r.style.fontSize="65px",r.style.filter="drop-shadow(0px 0px 10px var(--shadow-color))",e.appendChild(r),e}makePenIcon(o){let e=Math.round(Math.sqrt(o.thickness)*4),r=o.color,n=this.isRoundedTipPen(o),i=e/2,a=`
			M ${15-i},${80-i}
			  ${15-i},${80+i}
			  30,83
			  15,65
			Z
		`,l=80+i,c=`
			m ${15-i*1.1},${l}
			c 35,10 55,15 60,30
			l ${35+i*1.2},${-10-i}
			C 80.47,98.32 50.5,${90+i} 20,${l} Z
		`,d=`
			M 72.45,35.67
			A 10,15 41.8 0 1 55,40.2 10,15 41.8 0 1 57.55,22.3 10,15 41.8 0 1 75,17.8 10,15 41.8 0 1 72.5,35.67
			Z
		`,p="M 85,-25 25,35 h 10 v 10 h 10 v 10 h 10 v 10 h 10 l -5,10 60,-60 z",u="M 25,35 H 35 L 90,-15 85,-25 Z",h="M 60,75 65,65 H 55 l 55,-55 10,5 z";n&&(p="M 85,-25 25,35 c 15,0 40,30 35,40 l 60,-60 z",u="m 25,35 c 3.92361,0.384473 7.644275,0.980572 10,3 l 55,-53 -5,-10 z",h="M 60,75 C 61,66 59,65 56,59 l 54,-54 10,10 z");let f=`M 25,35 ${10-i/4},${70-i/2} 20,75 25,85 60,75 70,55 45,25 Z`,v=M.fromHex("#f4d7d7").mix(r,i/40-.1).toHexString(),g=nn(),y=r.toHexString(),m=Vo({fill:g.patternRef,d:a},{fill:g.patternRef,d:c},{fill:y,d:a},{fill:y,d:c}),w=Vo({fill:g.patternRef,d:f},{fill:v,stroke:y,d:f}),C=Vo({fill:"var(--icon-color)",stroke:"var(--icon-color)",d:p},{fill:"rgba(150, 150, 150, 0.3)",d:u},{fill:"rgba(100, 100, 100, 0.2)",d:h},{fill:g.patternRef,d},{fill:y,d}),E=document.createElementNS(le,"svg");E.setAttribute("viewBox","0 0 100 100");let P=je("g",{children:[m,w,C].flat()}),S=je("defs",{children:[g.patternDefElement]});return E.replaceChildren(S,P),E}makeIconFromFactory(o){let e=Math.sqrt(o.thickness)*3,r=performance.now(),n={pos:T.of(10,10),width:e,color:o.color,time:r-100},i={pos:T.of(90,90),width:e,color:o.color,time:r},a=new q(()=>{}),l=o.factory(n,a);l.addPoint(i);let c=document.createElementNS(le,"svg");c.setAttribute("viewBox","0 0 100 100"),a.updateScreenSize(T.of(100,100));let d;if(o.color.a<1){let h=nn(),f=document.createElementNS(le,"defs");f.appendChild(h.patternDefElement),c.appendChild(f);let b=document.createElementNS(le,"g");c.appendChild(b),d=new class extends we{constructor(){super(c,a)}addPathToSVG(){let v=super.addPathToSVG();if(v){let g=v.cloneNode(!0);g.style.zIndex="-1",g.hasAttribute("stroke")?g.setAttribute("stroke",h.patternRef):g.hasAttribute("fill")&&g.setAttribute("fill",h.patternRef),b.appendChild(g)}return v}}}else d=new we(c,a);l.preview(d);let u=l.getBBox();return c.setAttribute("viewBox",`${u.x} ${u.y} ${u.w} ${u.h}`),c}makePipetteIcon(o){let e=document.createElementNS(le,"svg"),r=document.createElementNS(le,"g");r.style.rotate="45deg",r.style.transformOrigin="center";let n=document.createElementNS(le,"g");if(n.innerHTML=`
		<path
			style="fill: var(--icon-color); stroke-linecap:round; stroke-linejoin:round;"
			d="
				m 32,12 v 68
				c 0,1 0.5,2 1.33,2.5 1.67,1.15 3.67,2.1 5.17,3.2 1.4,1.1 2.3,2.1 2.5,3.1 0.6,2.1 1,4.6 1,6.2 0,3.7 5.45,4.1 6,0.4 l 0.9,-6.8
				c 0.3,-0.9 1.1,-1.9 2.6,-2.9 1.5,-1.1 3.4,-2 5.1,-3.2
				C 57.5,82 58,81 58,80
				V 12 Z m 20,25 v 41.3
				c 0,1.7 -2.5,1.6 -4,2.7 -1,0.76 -2.1,1.5 -3,2.6
				C 44,82.5 43.02,81.75 42,81 40.51,79.92 38,80 38,78.34
				V 51 Z
			"
		/>
		<rect
			style="fill: var(--icon-color);"
			width="32"
			height="9"
			x="29"
			y="2"
			ry="4.5"
		/>
		<path
			style="fill: var(--icon-color);"
			d="m 45,-25 c -5.54,0 -11,4.26 -11,9 V 0 h 22 v -16 c 0,-4.74 -5.46,-9 -11,-9 z"
		/>
		`,o){let i=nn(),a=document.createElementNS(le,"defs");a.appendChild(i.patternDefElement),e.appendChild(a);let l=document.createElementNS(le,"path"),c=document.createElementNS(le,"path"),d=`
				M 35,36 H 55 V 78.678012 83 L 45,87 35,83 Z
			`;c.setAttribute("d",d),l.setAttribute("d",d),c.style.fill=o.toHexString(),l.style.fill=i.patternRef,r.appendChild(l),r.appendChild(c)}return r.appendChild(n),e.appendChild(r),e.setAttribute("viewBox","5 -40 140 140"),e}makeShapeAutocorrectIcon(){return this.makeIconFromPath(`
			m 79.129476,33.847107 9.967823,-0.03218 v 55 h -55 l 0.03218,-9.96782
			M 71.1,40.8 a 30,30 0 0 1 -30,30 30,30 0 0 1 -30,-30 30,30 0 0 1 30,-30 30,30 0 0 1 30,30 L 71.1,40.8
			M 34.1,58.8 v -25 h 25 v 0
		`,"none","var(--icon-color)","7px")}makeStrokeSmoothingIcon(){return this.makeIconFromPath(`
			m 31,83.2 c -50,0 30,-65 -20,-65
			M 75,17.3 40,59.7 38.2,77.6 55.5,72.4 90.5,30 Z
		`,"none","var(--icon-color)","7px")}makePressureSensitivityIcon(){let o=document.createElementNS(le,"svg");return o.setAttribute("viewBox","4 -10 100 100"),o.replaceChildren(...Vo({d:`
					M 39.7,77.7
					C 39.7,77.7 3.4,78.1 4.2,60 4.7,45.2 33.2,30.5 40,25 55.9,12.1 7.4,4.8 7.4,4.8
					c 0,0 40.2,5.5 40.2,15.4
					C 47.6,29.1 21.2,35.1 23.9,60 25,70 39.7,77.7 39.7,77.7
					Z`,fill:"var(--icon-color)",stroke:"var(--icon-color)","stroke-width":"2px"},{d:"M 86.4,15.6 101.4,28.8 65,70 47.5,74.6 50,56.7Z",fill:"transparent",stroke:"var(--icon-color)","stroke-width":"6px"})),o}makeFormatSelectionIcon(){return this.makeIconFromPath(`
			M 5 10
			L 5 20 L 10 20 L 10 15 L 20 15 L 20 40 L 15 40 L 15 45 L 35 45 L 35 40 L 30 40 L 30 15 L 40 15 L 40 20 L 45 20 L 45 15 L 45 10 L 5 10 z
			M 90 10 C 90 10 86.5 13.8 86 14 C 86 14 76.2 24.8 76 25 L 60 25 L 60 65 C 75 70 85 70 90 65 L 90 25 L 80 25 L 76.7 25 L 90 10 z
			M 60 25 L 55 25 L 50 30 L 60 25 z
			M 10 55 L 10 90 L 41 90 L 41 86 L 45 86 L 45 55 L 10 55 z
			M 42 87 L 42 93 L 48 93 L 48 87 L 42 87 z 
		`)}makeResizeImageToSelectionIcon(){return this.makeIconFromPath(`
			M 75 5 75 10 90 10 90 25 95 25 95 5 75 5 z
			M 15 15 15 30 20 30 20 20 30 20 30 15 15 15 z
			M 84 15 82 17 81 16 81 20 85 20 84 19 86 17 84 15 z
			M 26 24 24 26 26 28 25 29 29 29 29 25 28 26 26 24 z
			M 25 71 26 72 24 74 26 76 28 74 29 75 29 71 25 71 z
			M 15 75 15 85 25 85 25 80 20 80 20 75 15 75 z
			M 90 75 90 90 75 90 75 95 95 95 95 75 90 75 z
			M 81 81 81 85 82 84 84 86 86 84 84 82 85 81 81 81 z
		`)}makeResizeViewportIcon(){return this.makeResizeImageToSelectionIcon()}makeDuplicateSelectionIcon(){return this.makeIconFromPath(`
			M 45,10 45,55 90,55 90,10 45,10 z
			M 10,25 10,90 70,90 70,60 40,60 40,25 10,25 z 
		`)}makeCopyIcon(){return this.makeIconFromPath(`
			M 45,10 45,55 90,55 90,10 45,10 z
			M 10,25 10,90 70,90 70,60 40,60 40,25 10,25 z 
		`)}makePasteIcon(){let o=this.makeIconFromPath(`
			M 50 0 L 50 5 L 35 5 L 40 24.75 L 20 25 L 20 100 L 85 100 L 100 90 L 100 24 L 75.1 24.3 L 80 5 L 65 5 L 65 0 L 50 0 z
			M 10 15 L 10 115 L 110 115 L 110 15 L 85 15 L 83 20 L 105 20 L 105 110 L 15 110 L 15 20 L 32 20 L 30 15 L 10 15 z
			M 25 35 L 90 35 L 90 40 L 25 40 L 25 35 z
			M 25 45 L 90 45 L 90 50 L 25 50 L 25 45 z
			M 25 55 L 85 55 L 85 60 L 25 60 L 25 55 z
			M 25 65 L 90 65 L 90 70 L 25 70 L 25 65 z 
		`);return o.setAttribute("viewBox","0 0 120 120"),o}#e(){return this.makeIconFromPath(`
			M 15,15 85,85
			M 15,85 85,15
		`,"none","var(--icon-color)","6px")}makeDeleteSelectionIcon(){return this.#e()}makeCloseIcon(){return this.#e()}makeSaveIcon(){let o=document.createElementNS("http://www.w3.org/2000/svg","svg");return o.innerHTML=`
			<style>
				.toolbar-save-icon {
					stroke: var(--icon-color);
					stroke-width: 6;
					stroke-linejoin: round;
					stroke-linecap: round;
					fill: none;
				}
			</style>
			<path
				d='
					M 15,55 30,70 85,20
				'
				class='toolbar-save-icon'
			/>
		`,o.setAttribute("viewBox","0 0 100 100"),o}makeConfigureDocumentIcon(){let o=document.createElementNS("http://www.w3.org/2000/svg","svg");return o.innerHTML=`
			<path
				d='
					M 5,5 V 95 H 95 V 5 Z m 5,5 H 90 V 90 H 10 Z
					m 5,10 V 30 H 50 V 25 H 20 v -5 z
					m 40,0 V 50 H 85 V 20 Z
					m 2,2 H 83 V 39 L 77,28 70,42 64,35 57,45 Z
					m 8.5,5 C 64.67,27 64,27.67 64,28.5 64,29.33 64.67,30 65.5,30 66.33,30 67,29.33 67,28.5 67,27.67 66.33,27 65.5,27 Z
					M 15,40 v 5 h 35 v -5 z
					m 0,15 v 5 h 70 v -5 z
					m 0,15 v 5 h 70 v -5 z
				'
				style='fill: var(--icon-color);'
			/>
		`,o.setAttribute("viewBox","0 0 100 100"),o}makeOverflowIcon(){return this.makeIconFromPath(`
			M 15 40
			A 12.5 12.5 0 0 0 2.5 52.5
			A 12.5 12.5 0 0 0 15 65
			A 12.5 12.5 0 0 0 27.5 52.5
			A 12.5 12.5 0 0 0 15 40
			z
	
			M 50 40
			A 12.5 12.5 0 0 0 37.5 52.5
			A 12.5 12.5 0 0 0 50 65
			A 12.5 12.5 0 0 0 62.5 52.5
			A 12.5 12.5 0 0 0 50 40
			z
			
			M 85 40
			A 12.5 12.5 0 0 0 72.5 52.5
			A 12.5 12.5 0 0 0 85 65
			A 12.5 12.5 0 0 0 97.5 52.5
			A 12.5 12.5 0 0 0 85 40
			z
		`)}makeHelpIcon(){let o=document.createElementNS("http://www.w3.org/2000/svg","svg");return o.innerHTML=`
			<circle
				style="stroke-width:1.587; stroke: var(--icon-color);"
				fill="none"
				cx="13.23"
				cy="13.23"
				r="11.9"
			/>
			<path
				style="stroke-width: 3; stroke-linecap: butt; stroke: var(--icon-color);"
				fill="none"
				d="M 9.26,6.61 C 18.7,3.25 19.95,10.4 14.3,13.4 c -1.15,0.61 -1.32,1.32 -1.32,2.65 v 2.12"
			/>
			<circle
				style="fill: var(--icon-color);"
				cx="13"
				cy="21.32"
				r="1.9"
			/>
		`,o.setAttribute("viewBox","0 0 26.46 26.46"),o.setAttribute("width","100"),o.setAttribute("height","100"),o}makeIconFromPath(o,e="var(--icon-color)",r="none",n="0px"){let i=document.createElementNS(le,"svg"),a=document.createElementNS(le,"path");return a.setAttribute("d",o),a.style.fill=e,a.style.stroke=r,a.style.strokeWidth=n,i.appendChild(a),i.setAttribute("viewBox","0 0 100 100"),i}makeCheckerboardPattern(){return nn()}isRoundedTipPen(o){return o.factory===ht||o.factory===Ft}isPolylinePen(o){return o.factory===Ft}licenseInfo(){return null}};var fc=s=>{let o=0,e=s.map(r=>r.id);e.sort();for(let r of e)o===r&&(o=r+1);return o},Ii=fc;var gc=(s,o,e,r,n=0)=>{let i=Ii(r??[]),a=Ue.ofCanvasPoint(e,o!==2,s.viewport,i,n);return s.toolController.dispatchInputEvent({kind:o,allPointers:r??[a],current:a}),a},Ri=gc;var A="toolbar-";var zi=class{constructor(o,e,r){this.parent=o;this.notifier=e;this.onDestroy=r;this.dropdownToggleListener=null;this.hideDropdownTimeout=null;this.visible=Y.fromInitialValue(!1),this.dropdownContainer=document.createElement("div"),this.dropdownContainer.classList.add(`${A}dropdown`),this.dropdownContainer.classList.add("hidden"),o.target.insertAdjacentElement("afterend",this.dropdownContainer),this.dropdownToggleListener=this.notifier.on(0,n=>{n.dropdown!==this&&n.fromToplevelDropdown&&this.setVisible(!1)})}onActivated(){}repositionDropdown(){let o=this.dropdownContainer.getBoundingClientRect(),e=document.scrollingElement?.clientWidth??document.body.clientHeight,r=document.scrollingElement?.clientHeight??document.body.clientHeight,n,i;o.left>e/2&&(n=`calc(${this.parent.target.clientWidth+"px"} - 100%)`),o.bottom>r&&o.top-o.height>0&&(i=`calc(-${this.parent.target.clientHeight}px - 100%)`),n||i?this.dropdownContainer.style.translate=`${n??"0"} ${i??"0"}`:this.dropdownContainer.style.translate=""}setVisible(o){if(this.visible.get()===o)return;this.hideDropdownTimeout&&(clearTimeout(this.hideDropdownTimeout),this.hideDropdownTimeout=null,this.dropdownContainer.classList.remove("hiding"),this.repositionDropdown());let r=150;if(this.visible.set(o),o)this.dropdownContainer.classList.remove("hidden"),this.notifier.dispatch(0,{dropdown:this,fromToplevelDropdown:this.parent.isToplevel()}),this.repositionDropdown();else{this.notifier.dispatch(1,{dropdown:this,fromToplevelDropdown:this.parent.isToplevel()}),this.dropdownContainer.classList.add("hiding");let i=r*.95;this.hideDropdownTimeout=setTimeout(()=>{this.dropdownContainer.classList.add("hidden"),this.dropdownContainer.classList.remove("hiding"),this.repositionDropdown()},i)}let n=`var(--dropdown-${o?"show":"hide"}-animation)`;this.dropdownContainer.style.animation=`${r}ms ease ${n}`}requestShow(){this.setVisible(!0)}requestHide(){this.setVisible(!1)}appendChild(o){this.dropdownContainer.appendChild(o)}clearChildren(){this.dropdownContainer.replaceChildren()}destroy(){this.setVisible(!1),this.dropdownContainer.remove(),this.dropdownToggleListener?.remove(),this.clearChildren(),this.onDestroy()}},Zo=class{constructor(o,e){this.localization=e;this.dropdowns=new Set;this.listeners=[];this.connectedNotifiers=[];this.notifier=new Be,this.notifier.on(0,({dropdown:r,fromToplevelDropdown:n})=>{r&&(o(this.localization.dropdownShown(r.parent.getTitle())),this.connectedNotifiers.forEach(i=>{i.dispatch(13,{kind:13,fromToplevelDropdown:n,layoutManager:this})}))}),this.notifier.on(1,({dropdown:r})=>{r&&o(this.localization.dropdownHidden(r.parent.getTitle()))})}connectToEditorNotifier(o){this.connectedNotifiers.push(o),this.refreshListeners()}createToolMenu(o){let e=new zi(o,this.notifier,()=>{this.dropdowns.delete(e),this.refreshListeners()});return this.dropdowns.add(e),this.refreshListeners(),e}refreshListeners(){let o=()=>{this.listeners.forEach(e=>e.remove()),this.listeners=[]};this.dropdowns.size===0?o():this.listeners.length!==this.connectedNotifiers.length&&(o(),this.listeners=this.connectedNotifiers.map(e=>e.on(13,r=>{r.kind!==13||r.layoutManager===this||this.notifier.dispatch(0,{fromToplevelDropdown:r.fromToplevelDropdown})})))}};var bc=(s,o)=>{let e=new Map,r=null,n=!1,i=()=>{if(e.size===0)n?(n=!1,o.onEnd()):r!==null&&(clearTimeout(r),r=null);else{let l=Date.now(),c=0;for(let u of e.values()){let h=l-u.timeEnter;c=Math.max(h,c)}let d=o.longPressTimeout??700;r!==null&&(clearTimeout(r),r=null);let p=d-c;p<=0?(o.onStart(),n=!0):r=setTimeout(()=>{r=null,i()},p)}},a=l=>{let c={timeEnter:Date.now()};l.type==="pointerenter"?e.set(l.pointerId,c):(l.type==="pointerleave"||l.type==="pointercancel")&&e.clear(),i()};return s.addEventListener("pointerenter",a),s.addEventListener("pointerleave",a),s.addEventListener("pointercancel",a),{removeListeners:()=>{s.removeEventListener("pointerenter",a),s.removeEventListener("pointerleave",a),s.removeEventListener("pointercancel",a)}}},Xs=bc;var vc=(s,o)=>{let e="has-long-press-or-hover",r="no-long-press-or-hover";s.classList.add("no-long-press-or-hover");let{removeListeners:n}=Xs(s,{onStart(){s.classList.remove(r),s.classList.add(e)},onEnd(){s.classList.add(r),s.classList.remove(e)},longPressTimeout:o?.timeout});return{removeEventListeners:()=>{s.classList.remove(r),n()}}},vt=vc;var yc=(s,o)=>{let e=[...o.draggableChildElements,s],r=0,n=0,i=0,a=0,l=!1,c=null,d=g=>{if(!g)return!1;if(e.includes(g))return!0;let y=["INPUT","SELECT","IMG"],m=!1,w=g.parentElement;for(;w&&!y.includes(w.tagName);){if(e.includes(w)){m=!0;break}w=w.parentElement}return!y.includes(g.tagName)&&m},p=[],u=(g,y,m)=>{s.addEventListener(g,y,m),p.push(()=>{s.removeEventListener(g,y)})},h=5,f=()=>Math.hypot(r-i,n-a)<h,b=!1;u("pointerdown",g=>{g.defaultPrevented||!d(g.target)||g.isPrimary&&(b=!1,r=g.clientX,n=g.clientY,i=g.clientX,a=g.clientY,c=null,l=!0)},{passive:!0});let v=g=>{l&&(c!==null&&(s.releasePointerCapture(c),c=null),o.onDragEnd({roughlyClick:f(),endTimestamp:performance.now(),displacement:T.of(r-i,n-a)}),l=!1,b=!1)};return u("pointermove",g=>{if(!g.isPrimary||!l)return;if(g.pointerType==="mouse"&&g.buttons===0){v(g);return}c===null&&!f()&&(s.setPointerCapture(g.pointerId),c=g.pointerId);let y=g.clientX,m=g.clientY,w=y-r,C=m-n;(!(Math.abs(y-i)<=h&&Math.abs(m-a)<=h)||b)&&(o.onDrag(w,C,T.of(y-i,m-a)),r=y,n=m,b=!0)}),u("pointerleave",g=>{c===null&&l&&g.isPrimary&&(s.setPointerCapture(g.pointerId),c=g.pointerId)}),u("pointerup",v),u("pointercancel",v),{removeListeners:()=>{for(let g of p)g()}}},sn=yc;var xc=s=>{let o=(r,n)=>{let i=getComputedStyle(r);for(let a=0;a<i.length;a++){let l=i.item(a),c=i.getPropertyValue(l);n.style?.setProperty(l,c)}for(let a=0;a<r.children.length;a++){let l=r.children.item(a),c=n.children.item(a);l&&c?o(l,c):console.warn("CloneElement: Missing child")}},e=s.cloneNode(!0);return o(s,e),e},Qs=xc;var wc=(s,o,e,r)=>{let n=document.createElement("div");n.classList.add("help-page-container");let i=document.createElement("div");i.classList.add("label","-space-above"),i.setAttribute("aria-live","polite");let a=0,l=s[0]??null,c=[];n.addEventListener("click",v=>{v.target===n&&e()});let d=()=>{if(!l)return R.empty;let v=l.targetElements.map(g=>R.of(g.getBoundingClientRect()));return R.union(...v)},p=()=>{let v=d();for(let g=0;g<c.length;g++)for(let{container:y,bbox:m}of c[g])if(g===a)y.classList.add("-active"),y.classList.remove("-clickable","-background"),y.onclick=()=>{};else{m.containsRect(v)?(y.classList.add("-background"),y.classList.remove("-active","-clickable")):(y.classList.add("-clickable"),y.classList.remove("-active","-background"));let w=g;y.onclick=()=>{o(w)}}},u=()=>{let v=R.of(i.getBoundingClientRect()),g=d();if(v.intersects(g)){let y=R.of(n.getBoundingClientRect()),m=g.topLeft.y,w=y.bottomLeft.y-g.bottomLeft.y;m>w&&m>v.height/3&&(i.classList.remove("-small-space-above","-large-space-above"),i.classList.add("-large-space-below")),m<w&&w>v.height&&(i.classList.add("-large-space-above"),i.classList.remove("-large-space-below"))}},h=()=>{n.replaceChildren(),i.classList.remove("-large-space-above"),i.classList.add("-small-space-above","-large-space-below"),n.appendChild(i);let v=new R(0,0,window.innerWidth,window.innerHeight);c=[];for(let g=0;g<s.length;g++){let y=s[g],m=[];for(let w of y.targetElements){let C=R.of(w.getBoundingClientRect());if(!v.intersects(C)){let S=v.bottomLeft.lerp(v.bottomRight,.5),B=C.bottomLeft.lerp(C.bottomRight,.5),V=S.minus(B);C=C.translatedBy(V)}let E=Qs(w);for(let S of E.querySelectorAll("input"))S.disabled=!0;E.style.margin="0";let P=document.createElement("div");P.classList.add("cloned-element-container"),P.role="group",P.ariaLabel=r.localization.helpControlsAccessibilityLabel,P.style.position="absolute",P.style.left=`${C.topLeft.x}px`,P.style.top=`${C.topLeft.y}px`,P.replaceChildren(E),vt(P,{timeout:0}),m.push({container:P,bbox:C}),n.appendChild(P)}c.push(m)}p()},f=()=>{h(),u()},b=()=>{let v=document.createElement("div");v.textContent=l?.helpText??"",v.classList.add("current-item-help");let g=document.createElement("div");g.textContent=r.localization.helpScreenNavigationHelp,g.classList.add("navigation-help"),i.replaceChildren(v,...a===0?[g]:[]),p()};return b(),{addToParent:v=>{h(),v.appendChild(n),u()},refresh:f,setPageIndex:v=>{a=v,l=s[v],b()}}},Yo=class{constructor(o,e){this.createOverlay=o;this.context=e}#e=[];showHelpOverlay(){let o=document.createElement("dialog");o.setAttribute("autofocus","true"),o.classList.add("toolbar-help-overlay");let e=!1,r=()=>{if(e)return;let m=250;o.classList.add("-hiding"),setTimeout(()=>o.close(),m)},n=0,i=()=>{performance.now()-n<100||r()},a=()=>{let m=G();m.classList.add("close-button"),m.appendChild(this.context.icons.makeCloseIcon());let w=this.context.localization.close;return m.setAttribute("aria-label",w),m.setAttribute("title",w),m.onclick=()=>{r()},m},l=()=>{let m=de.fromInitialValue(0),w=document.createElement("div");w.classList.add("navigation-content");let C=wc(this.#e,S=>m.set(S),i,this.context);C.addToParent(w);let E=S=>{S>=this.#e.length||S<0?(console.warn("Help screen: Navigated to out-of-bounds page",S),w.style.display="none"):(w.style.display="",C.setPageIndex(S))};m.onUpdateAndNow(E);let P={content:w,currentPage:m,toNext:()=>{P.hasNext()&&m.set(m.get()+1)},toPrevious:()=>{P.hasPrevious()&&m.set(m.get()-1)},hasNext:()=>m.get()+1<this.#e.length,hasPrevious:()=>m.get()>0,refreshCurrent:()=>{C.refresh()}};return P},c=m=>{let w=document.createElement("div");w.classList.add("navigation-buttons");let C=G(),E=G();C.textContent=this.context.localization.next,E.textContent=this.context.localization.previous,C.classList.add("next"),E.classList.add("previous");let P=()=>{w.classList.remove("-has-next","-has-previous"),m.hasNext()?(w.classList.add("-has-next"),C.disabled=!1):(w.classList.remove("-has-next"),C.disabled=!0),m.hasPrevious()?(w.classList.add("-has-previous"),E.disabled=!1):(w.classList.remove("-has-previous"),E.disabled=!0)};return m.currentPage.onUpdateAndNow(P),C.onclick=()=>{m.toNext()},E.onclick=()=>{m.toPrevious()},w.replaceChildren(E,C),w},d=l(),p=c(d);o.replaceChildren(a(),p,d.content),this.createOverlay(o),o.showModal();let u=30,h=m=>{m>0&&!d.hasPrevious()&&(m=0),m<0&&!d.hasNext()&&(m=0),(m>u||m<-u)&&(m=u*Math.sign(m)),o.style.transform=`translate(${m}px, 0px)`,m>=u?p.classList.add("-highlight-previous"):p.classList.remove("-highlight-previous"),m<=-u?p.classList.add("-highlight-next"):p.classList.remove("-highlight-next")},f=sn(o,{draggableChildElements:[d.content],onDrag:(m,w,C)=>{o.classList.add("-dragging"),h(C.x)},onDragEnd:m=>{if(o.classList.remove("-dragging"),h(0),!m.roughlyClick){let w=m.displacement.x;w>u?d.toPrevious():w<-u&&d.toNext(),n=m.endTimestamp}}}),b;window.ResizeObserver&&(b=new ResizeObserver(()=>{d.refreshCurrent()}),b.observe(o));let v=()=>{requestAnimationFrame(()=>d.refreshCurrent())},g=window.matchMedia?.("(prefers-color-scheme: dark)");g?.addEventListener("change",v);let y=[d.content,p,o];o.onclick=m=>{y.includes(m.target)&&i()},o.onkeyup=m=>{m.code==="Escape"?(r(),m.preventDefault()):m.code==="ArrowRight"?(d.toNext(),m.preventDefault()):m.code==="ArrowLeft"&&(d.toPrevious(),m.preventDefault())},o.addEventListener("close",()=>{this.context.announceForAccessibility(this.context.localization.helpHidden),g?.removeEventListener("change",v),f.removeListeners(),b?.disconnect(),o.remove()})}registerTextHelpForElement(o,e){this.registerTextHelpForElements([o],e)}registerTextHelpForElements(o,e){this.#e.push({targetElements:[...o],helpText:e})}hasHelpText(){return this.#e.length>0}createToggleButton(){let o=document.createElement("div");o.classList.add("toolbar-help-overlay-button");let e=G();e.classList.add("button");let r=this.context.icons.makeHelpIcon();return r.classList.add("icon"),e.appendChild(r),e.setAttribute("aria-label",this.context.localization.help),e.onclick=()=>{this.showHelpOverlay()},o.appendChild(e),o}};var pe=class s{constructor(o,e,r){this.editor=o;this.id=e;this.dropdown=null;this.disabled=!1;this.#t=!1;this.#o=[];this.subWidgets={};this.toplevel=!0;this.#r=null;this.localizationTable=r??o.localization;let n=new Zo(i=>this.editor.announceForAccessibility(i),this.localizationTable);n.connectToEditorNotifier(o.notifier),this.layoutManager=n,this.icon=null,this.container=document.createElement("div"),this.container.classList.add(`${A}toolContainer`,`${A}toolButtonContainer`,`${A}internalWidgetId--${e.replace(/[^a-zA-Z0-9_]/g,"-")}`),this.dropdownContent=document.createElement("div"),this.#e=!1,this.button=document.createElement("div"),this.button.classList.add(`${A}button`),this.label=document.createElement("label"),this.button.setAttribute("role","button"),this.button.tabIndex=0,this.button.oncontextmenu=i=>{i.preventDefault()},vt(this.button)}#e;#t;#o;#r;#n(){this.#r?.();let o=this.editor.toolController.getMatchingTools(gt),e=null;if(o.length>0&&this.onKeyPress!==s.prototype.onKeyPress){let n=a=>this.onKeyPress(a),i=o[0];i.registerListener(n),e=()=>{i.removeListener(n)}}let r=this.editor.isReadOnlyReactiveValue().onUpdateAndNow(n=>{n&&this.shouldAutoDisableInReadOnlyEditor()&&!this.disabled?(this.setDisabled(!0),this.#t=!0,this.#e&&this.dropdown?.requestHide()):!n&&this.#t&&(this.#t=!1,this.setDisabled(!1))});this.#r=()=>{r.remove(),e?.(),this.#r=null}}shouldAutoDisableInReadOnlyEditor(){return!0}getId(){return this.id}setTags(o){let e=r=>`toolwidget-tag--${r}`;for(let r of this.#o)this.container.classList.remove(e(r));this.#o=[...o];for(let r of this.#o)this.container.classList.add(e(r))}getTags(){return[...this.#o]}getUniqueIdIn(o){let e=this.getId(),r=0;for(;e in o&&o[e]!==this;)e=this.getId()+"-"+r.toString(),r++;return e}fillDropdown(o,e){if(Object.keys(this.subWidgets).length===0)return!1;for(let r in this.subWidgets){let n=this.subWidgets[r],i=n.addTo(o);n.setIsToplevel(!1);let a=n.getHelpText();a&&e?.registerTextHelpForElement(i,a)}return!0}getHelpText(){}setupActionBtnClickListener(o){return this.setUpButtonEventListeners(o)}setUpButtonEventListeners(o){let e={Enter:!0," ":!0};o.onkeydown=r=>{let n=!1;if(r.key in e&&(this.disabled||(this.handleClick(),n=!0)),!n){let i=Lr(r);n=this.editor.toolController.dispatchInputEvent(i)}n&&r.preventDefault()},o.onkeyup=r=>{if(r.key in e)return;let n=kr(r);this.editor.toolController.dispatchInputEvent(n)&&r.preventDefault()},o.onclick=()=>{this.disabled||this.handleClick()},o.ondblclick=r=>{r.preventDefault()}}onKeyPress(o){return!1}get hasDropdown(){return this.#e}addSubWidget(o){let e=o.getUniqueIdIn(this.subWidgets);this.subWidgets[e]=o}setLayoutManager(o){o!==this.layoutManager&&(this.layoutManager=o,this.container.parentElement&&this.addTo(this.container.parentElement))}addTo(o){this.icon=null,this.updateIcon(),this.label.innerText=this.getTitle();let e="long-label";this.label.innerText.length>7?this.label.classList.add(e):this.label.classList.remove(e),this.setUpButtonEventListeners(this.button),this.container.replaceChildren(),this.button.replaceChildren(this.icon,this.label),this.container.appendChild(this.button);let r=new Yo(i=>this.editor.createHTMLOverlay(i),this.editor),n=this.getHelpText();return n&&r.registerTextHelpForElement(this.dropdownContent,[this.getTitle(),n].join(`

`)),this.dropdownContent.replaceChildren(),this.#e=this.fillDropdown(this.dropdownContent,r),this.#e&&(this.button.classList.add("has-dropdown"),this.dropdown?.destroy(),this.dropdownIcon=this.createDropdownIcon(),this.button.appendChild(this.dropdownIcon),this.dropdown=this.layoutManager.createToolMenu({target:this.button,getTitle:()=>this.getTitle(),isToplevel:()=>this.toplevel}),this.dropdown.visible.onUpdate(i=>{i?this.container.classList.add("dropdownVisible"):this.container.classList.remove("dropdownVisible"),i||this.focus()}),r.hasHelpText()&&this.dropdown.appendChild(r.createToggleButton()),this.dropdown.appendChild(this.dropdownContent)),this.setDropdownVisible(!1),this.container.parentElement&&this.container.remove(),this.#n(),o.appendChild(this.container),this.container}remove(){this.container.remove(),this.#r?.()}focus(){this.button.focus()}addCSSClassToContainer(o){this.container.classList.add(o)}removeCSSClassFromContainer(o){this.container.classList.remove(o)}updateIcon(){let o=this.createIcon();o?this.container.classList.remove("no-icon"):(o=document.createElement("div"),this.container.classList.add("no-icon")),this.icon?.replaceWith(o),this.icon=o,this.icon.classList.add(`${A}icon`)}setDisabled(o){this.disabled=o,this.#t=!1,this.disabled?(this.button.classList.add("disabled"),this.button.setAttribute("aria-disabled","true")):(this.button.classList.remove("disabled"),this.button.removeAttribute("aria-disabled"))}setSelected(o){this.isSelected()!==o&&(this.button.setAttribute("role","switch"),o?(this.container.classList.add("selected"),this.button.setAttribute("aria-checked","true")):(this.container.classList.remove("selected"),this.button.setAttribute("aria-checked","false")))}setDropdownVisible(o){o?this.dropdown?.requestShow():this.dropdown?.requestHide()}activateDropdown(){this.dropdown?.onActivated()}mustBeInToplevelMenu(){return!1}canBeInOverflowMenu(){return!this.mustBeInToplevelMenu()}getButtonWidth(){return this.button.clientWidth}isHidden(){return this.container.style.display==="none"}setHidden(o){this.container.style.display=o?"none":""}setIsToplevel(o){this.toplevel=o}isDropdownVisible(){return this.dropdown?.visible?.get()??!1}isSelected(){return this.container.classList.contains("selected")}createDropdownIcon(){let o=this.editor.icons.makeDropdownIcon();return o.classList.add(`${A}showHideDropdownIcon`),o}serializeState(){let o={};for(let e in this.subWidgets)o[e]=this.subWidgets[e].serializeState();return{subwidgetState:o}}deserializeFrom(o){if(o.subwidgetState){Cr(o.subwidgetState);for(let e in o.subwidgetState)if(e in this.subWidgets){let r=o.subwidgetState[e];r&&this.subWidgets[e].deserializeFrom(r)}}}};var Xo=class{constructor(o,e,r,n,i){this.setSidebarContent=o;this.sidebarTitle=e;this.sidebarVisibility=r;this.announceForAccessibility=n;this.localization=i;this.visibleWidgetContent=Y.fromInitialValue(null)}createToolMenu(o){let e=document.createElement("div"),r=null,n=Y.fromCallback(()=>this.visibleWidgetContent.get()===r&&this.sidebarVisibility.get(),[this.visibleWidgetContent,this.sidebarVisibility]);return r={visible:n,requestShow:()=>{this.setSidebarContent(e),this.sidebarTitle.set(o.getTitle()),this.visibleWidgetContent.set(r),this.sidebarVisibility.set(!0),this.announceForAccessibility(this.localization.dropdownShown(o.getTitle()))},onActivated:()=>{},requestHide:()=>{n.get()&&this.sidebarVisibility.set(!1)},appendChild:i=>{e.appendChild(i)},clearChildren:()=>{e.replaceChildren()},destroy:()=>{r?.requestHide(),e.parentElement&&e.remove(),this.visibleWidgetContent.get()===r&&this.visibleWidgetContent.set(null)}},r}};var yt=(()=>{return((s,o,e,r)=>{let n=o.createElement("canvas").getContext("2d"),i={r:0,g:0,b:0,h:0,s:0,v:0,a:1},a,l,c,d,p,u,h,f,b,v,g,y,m,w,C,E,P={},S={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:()=>r,a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},B={},V="",F={},U=!1;function j(x){if(typeof x=="object")for(let L in x)switch(L){case"el":ye(x.el),x.wrap!==!1&&st(x.el);break;case"parent":a=o.querySelector(x.parent),a&&(a.appendChild(l),S.parent=x.parent,a===o.body&&(a=r));break;case"themeMode":S.themeMode=x.themeMode,x.themeMode==="auto"&&s.matchMedia&&s.matchMedia("(prefers-color-scheme: dark)").matches&&(S.themeMode="dark");case"theme":x.theme&&(S.theme=x.theme),l.className=`clr-picker clr-${S.theme} clr-${S.themeMode}`,S.inline&&qe();break;case"rtl":S.rtl=!!x.rtl,o.querySelectorAll(".clr-field").forEach(O=>O.classList.toggle("clr-rtl",S.rtl));break;case"margin":x.margin*=1,S.margin=isNaN(x.margin)?S.margin:x.margin;break;case"wrap":x.el&&x.wrap&&st(x.el);break;case"formatToggle":S.formatToggle=!!x.formatToggle,xe("clr-format").style.display=S.formatToggle?"block":"none",S.formatToggle&&(S.format="auto");break;case"swatches":if(Array.isArray(x.swatches)){let O=[];x.swatches.forEach(($,re)=>{O.push(`<button type="button" id="clr-swatch-${re}" aria-labelledby="clr-swatch-label clr-swatch-${re}" style="color: ${$};">${$}</button>`)}),xe("clr-swatches").innerHTML=O.length?`<div>${O.join("")}</div>`:"",S.swatches=x.swatches.slice()}break;case"swatchesOnly":S.swatchesOnly=!!x.swatchesOnly,l.setAttribute("data-minimal",S.swatchesOnly);break;case"alpha":S.alpha=!!x.alpha,l.setAttribute("data-alpha",S.alpha);break;case"inline":if(S.inline=!!x.inline,l.setAttribute("data-inline",S.inline),S.inline){let O=x.defaultColor||S.defaultColor;w=Nt(O),qe(),Tt(O)}break;case"clearButton":typeof x.clearButton=="object"&&(x.clearButton.label&&(S.clearLabel=x.clearButton.label,h.innerHTML=S.clearLabel),x.clearButton=x.clearButton.show),S.clearButton=!!x.clearButton,h.style.display=S.clearButton?"block":"none";break;case"clearLabel":S.clearLabel=x.clearLabel,h.innerHTML=S.clearLabel;break;case"closeButton":S.closeButton=!!x.closeButton,S.closeButton?l.insertBefore(f,p):p.appendChild(f);break;case"closeLabel":S.closeLabel=x.closeLabel,f.innerHTML=S.closeLabel;break;case"a11y":let I=x.a11y,D=!1;if(typeof I=="object")for(let O in I)I[O]&&S.a11y[O]&&(S.a11y[O]=I[O],D=!0);if(D){let O=xe("clr-open-label"),$=xe("clr-swatch-label");O.innerHTML=S.a11y.open,$.innerHTML=S.a11y.swatch,f.setAttribute("aria-label",S.a11y.close),h.setAttribute("aria-label",S.a11y.clear),b.setAttribute("aria-label",S.a11y.hueSlider),g.setAttribute("aria-label",S.a11y.alphaSlider),u.setAttribute("aria-label",S.a11y.input),c.setAttribute("aria-label",S.a11y.instruction)}break;default:S[L]=x[L]}}function Z(x,L){typeof x=="string"&&typeof L=="object"&&(B[x]=L,U=!0)}function se(x){delete B[x],Object.keys(B).length===0&&(U=!1,x===V&&ve())}function te(x){if(U){let L=["el","wrap","rtl","inline","defaultColor","a11y"];for(let I in B){let D=B[I];if(x.matches(I)){V=I,F={},L.forEach(O=>delete D[O]);for(let O in D)F[O]=Array.isArray(S[O])?S[O].slice():S[O];j(D);break}}}}function ve(){Object.keys(F).length>0&&(j(F),V="",F={})}function ye(x){oe(o,"click",x,L=>{S.inline||(te(L.target),m=L.target,C=m.value,w=Nt(C),l.classList.add("clr-open"),qe(),Tt(C),(S.focusInput||S.selectInput)&&(u.focus({preventScroll:!0}),u.setSelectionRange(m.selectionStart,m.selectionEnd)),S.selectInput&&u.select(),(E||S.swatchesOnly)&&es().shift().focus(),m.dispatchEvent(new Event("open",{bubbles:!0})))}),oe(o,"input",x,L=>{let I=L.target.parentNode;I.classList.contains("clr-field")&&(I.style.color=L.target.value)})}function qe(){if(!l||!m&&!S.inline)return;let x=a,L=s.scrollY,I=l.offsetWidth,D=l.offsetHeight,O={left:!1,top:!1},$,re,He,ce={x:0,y:0};if(x&&($=s.getComputedStyle(x),re=parseFloat($.marginTop),He=parseFloat($.borderTopWidth),ce=x.getBoundingClientRect(),ce.y+=He+L),!S.inline){let Te=m.getBoundingClientRect(),at=Te.x,St=L+Te.y+Te.height+S.margin;x?(at-=ce.x,St-=ce.y,at+I>x.clientWidth&&(at+=Te.width-I,O.left=!0),St+D>x.clientHeight-re&&D+S.margin<=Te.top-(ce.y-L)&&(St-=Te.height+D+S.margin*2,O.top=!0),St+=x.scrollTop):(at+I>o.documentElement.clientWidth&&(at+=Te.width-I,O.left=!0),St+D-L>o.documentElement.clientHeight&&D+S.margin<=Te.top&&(St=L+Te.y-D-S.margin,O.top=!0)),l.classList.toggle("clr-left",O.left),l.classList.toggle("clr-top",O.top),l.style.left=`${at}px`,l.style.top=`${St}px`,ce.x+=l.offsetLeft,ce.y+=l.offsetTop}P={width:c.offsetWidth,height:c.offsetHeight,x:c.offsetLeft+ce.x,y:c.offsetTop+ce.y}}function st(x){o.querySelectorAll(x).forEach(L=>{let I=L.parentNode;if(!I.classList.contains("clr-field")){let D=o.createElement("div"),O="clr-field";(S.rtl||L.classList.contains("clr-rtl"))&&(O+=" clr-rtl"),D.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',I.insertBefore(D,L),D.setAttribute("class",O),D.style.color=L.value,D.appendChild(L)}})}function Fe(x){if(m&&!S.inline){let L=m;x&&(m=r,C!==L.value&&(L.value=C,L.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout(()=>{C!==L.value&&L.dispatchEvent(new Event("change",{bubbles:!0}))}),l.classList.remove("clr-open"),U&&ve(),L.dispatchEvent(new Event("close",{bubbles:!0})),S.focusInput&&L.focus({preventScroll:!0}),m=r}}function Tt(x){let L=yl(x),I=vl(L);dr(I.s,I.v),ur(L,I),b.value=I.h,l.style.color=`hsl(${I.h}, 100%, 50%)`,v.style.left=`${I.h/360*100}%`,d.style.left=`${P.width*I.s/100}px`,d.style.top=`${P.height-P.height*I.v/100}px`,g.value=I.a*100,y.style.left=`${I.a*100}%`}function Nt(x){let L=x.substring(0,3).toLowerCase();return L==="rgb"||L==="hsl"?L:"hex"}function Ke(x){x=x!==r?x:u.value,m&&(m.value=x,m.dispatchEvent(new Event("input",{bubbles:!0}))),S.onChange&&S.onChange.call(s,x,m),o.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:x,currentEl:m}}))}function cr(x,L){let I={h:b.value*1,s:x/P.width*100,v:100-L/P.height*100,a:g.value/100},D=gl(I);dr(I.s,I.v),ur(D,I),Ke()}function dr(x,L){let I=S.a11y.marker;x=x.toFixed(1)*1,L=L.toFixed(1)*1,I=I.replace("{s}",x),I=I.replace("{v}",L),d.setAttribute("aria-label",I)}function xn(x){return{pageX:x.changedTouches?x.changedTouches[0].pageX:x.pageX,pageY:x.changedTouches?x.changedTouches[0].pageY:x.pageY}}function Qe(x){let L=xn(x),I=L.pageX-P.x,D=L.pageY-P.y;a&&(D+=a.scrollTop),So(I,D),x.preventDefault(),x.stopPropagation()}function pr(x,L){let I=d.style.left.replace("px","")*1+x,D=d.style.top.replace("px","")*1+L;So(I,D)}function So(x,L){x=x<0?0:x>P.width?P.width:x,L=L<0?0:L>P.height?P.height:L,d.style.left=`${x}px`,d.style.top=`${L}px`,cr(x,L),d.focus()}function ur(x,L){x===void 0&&(x={}),L===void 0&&(L={});let I=S.format;for(let $ in x)i[$]=x[$];for(let $ in L)i[$]=L[$];let D=xl(i),O=D.substring(0,7);switch(d.style.color=O,y.parentNode.style.color=O,y.style.color=D,p.style.color=D,c.style.display="none",c.offsetHeight,c.style.display="",y.nextElementSibling.style.display="none",y.nextElementSibling.offsetHeight,y.nextElementSibling.style.display="",I==="mixed"?I=i.a===1?"hex":"rgb":I==="auto"&&(I=w),I){case"hex":u.value=D;break;case"rgb":u.value=wl(i);break;case"hsl":u.value=Tl(bl(i));break}o.querySelector(`.clr-format [value="${I}"]`).checked=!0}function ml(){let x=b.value*1,L=d.style.left.replace("px","")*1,I=d.style.top.replace("px","")*1;l.style.color=`hsl(${x}, 100%, 50%)`,v.style.left=`${x/360*100}%`,cr(L,I)}function fl(){let x=g.value/100;y.style.left=`${x*100}%`,ur({a:x}),Ke()}function gl(x){let L=x.s/100,I=x.v/100,D=L*I,O=x.h/60,$=D*(1-e.abs(O%2-1)),re=I-D;D=D+re,$=$+re;let He=e.floor(O)%6,ce=[D,$,re,re,$,D][He],Te=[$,D,D,$,re,re][He],at=[re,re,$,D,D,$][He];return{r:e.round(ce*255),g:e.round(Te*255),b:e.round(at*255),a:x.a}}function bl(x){let L=x.v/100,I=L*(1-x.s/100/2),D;return I>0&&I<1&&(D=e.round((L-I)/e.min(I,1-I)*100)),{h:x.h,s:D||0,l:e.round(I*100),a:x.a}}function vl(x){let L=x.r/255,I=x.g/255,D=x.b/255,O=e.max(L,I,D),$=e.min(L,I,D),re=O-$,He=O,ce=0,Te=0;return re&&(O===L&&(ce=(I-D)/re),O===I&&(ce=2+(D-L)/re),O===D&&(ce=4+(L-I)/re),O&&(Te=re/O)),ce=e.floor(ce*60),{h:ce<0?ce+360:ce,s:e.round(Te*100),v:e.round(He*100),a:x.a}}function yl(x){let L=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i,I,D;return n.fillStyle="#000",n.fillStyle=x,I=L.exec(n.fillStyle),I?(D={r:I[3]*1,g:I[4]*1,b:I[5]*1,a:I[6]*1},D.a=+D.a.toFixed(2)):(I=n.fillStyle.replace("#","").match(/.{2}/g).map(O=>parseInt(O,16)),D={r:I[0],g:I[1],b:I[2],a:1}),D}function xl(x){let L=x.r.toString(16),I=x.g.toString(16),D=x.b.toString(16),O="";if(x.r<16&&(L="0"+L),x.g<16&&(I="0"+I),x.b<16&&(D="0"+D),S.alpha&&(x.a<1||S.forceAlpha)){let $=x.a*255|0;O=$.toString(16),$<16&&(O="0"+O)}return"#"+L+I+D+O}function wl(x){return!S.alpha||x.a===1&&!S.forceAlpha?`rgb(${x.r}, ${x.g}, ${x.b})`:`rgba(${x.r}, ${x.g}, ${x.b}, ${x.a})`}function Tl(x){return!S.alpha||x.a===1&&!S.forceAlpha?`hsl(${x.h}, ${x.s}%, ${x.l}%)`:`hsla(${x.h}, ${x.s}%, ${x.l}%, ${x.a})`}function Sl(){o.getElementById("clr-picker")||(a=r,l=o.createElement("div"),l.setAttribute("id","clr-picker"),l.className="clr-picker",l.innerHTML=`<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="${S.a11y.input}"><div id="clr-color-area" class="clr-gradient" role="application" aria-label="${S.a11y.instruction}"><div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue"><input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="${S.a11y.hueSlider}"><div id="clr-hue-marker"></div></div><div class="clr-alpha"><input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="${S.a11y.alphaSlider}"><div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented"><legend>${S.a11y.format}</legend><input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div><button type="button" id="clr-clear" class="clr-clear" aria-label="${S.a11y.clear}">${S.clearLabel}</button><div id="clr-color-preview" class="clr-preview"><button type="button" id="clr-close" class="clr-close" aria-label="${S.a11y.close}">${S.closeLabel}</button></div><span id="clr-open-label" hidden>${S.a11y.open}</span><span id="clr-swatch-label" hidden>${S.a11y.swatch}</span>`,o.body.appendChild(l),c=xe("clr-color-area"),d=xe("clr-color-marker"),h=xe("clr-clear"),f=xe("clr-close"),p=xe("clr-color-preview"),u=xe("clr-color-value"),b=xe("clr-hue-slider"),v=xe("clr-hue-marker"),g=xe("clr-alpha-slider"),y=xe("clr-alpha-marker"),ye(S.el),st(S.el),oe(l,"mousedown",x=>{l.classList.remove("clr-keyboard-nav"),x.stopPropagation()}),oe(c,"mousedown",x=>{oe(o,"mousemove",Qe)}),oe(c,"touchstart",x=>{o.addEventListener("touchmove",Qe,{passive:!1})}),oe(d,"mousedown",x=>{oe(o,"mousemove",Qe)}),oe(d,"touchstart",x=>{o.addEventListener("touchmove",Qe,{passive:!1})}),oe(u,"change",x=>{let L=u.value;if(m||S.inline){let I=L===""?L:Tt(L);Ke(I)}}),oe(h,"click",x=>{Ke(""),Fe()}),oe(f,"click",x=>{Ke(),Fe()}),oe(xe("clr-format"),"click",".clr-format input",x=>{w=x.target.value,ur(),Ke()}),oe(l,"click",".clr-swatches button",x=>{Tt(x.target.textContent),Ke(),S.swatchesOnly&&Fe()}),oe(o,"mouseup",x=>{o.removeEventListener("mousemove",Qe)}),oe(o,"touchend",x=>{o.removeEventListener("touchmove",Qe)}),oe(o,"mousedown",x=>{E=!1,l.classList.remove("clr-keyboard-nav"),Fe()}),oe(o,"keydown",x=>{let L=x.key,I=x.target,D=x.shiftKey;if(L==="Escape"?Fe(!0):["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(L)&&(E=!0,l.classList.add("clr-keyboard-nav")),L==="Tab"&&I.matches(".clr-picker *")){let $=es(),re=$.shift(),He=$.pop();D&&I===re?(He.focus(),x.preventDefault()):!D&&I===He&&(re.focus(),x.preventDefault())}}),oe(o,"click",".clr-field button",x=>{U&&ve(),x.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))}),oe(d,"keydown",x=>{let L={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(L).includes(x.key)&&(pr(...L[x.key]),x.preventDefault())}),oe(c,"click",Qe),oe(b,"input",ml),oe(g,"input",fl))}function es(){return Array.from(l.querySelectorAll("input, button")).filter(I=>!!I.offsetWidth)}function xe(x){return o.getElementById(x)}function oe(x,L,I,D){let O=Element.prototype.matches||Element.prototype.msMatchesSelector;typeof I=="string"?x.addEventListener(L,$=>{O.call($.target,I)&&D.call($.target,$)}):(D=I,x.addEventListener(L,D))}function hr(x,L){L=L!==r?L:[],o.readyState!=="loading"?x(...L):o.addEventListener("DOMContentLoaded",()=>{x(...L)})}NodeList!==r&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function Cl(x,L){m=L,C=m.value,te(L),w=Nt(x),qe(),Tt(x),Ke(),C!==x&&m.dispatchEvent(new Event("change",{bubbles:!0}))}let wn=(()=>{let x={init:Sl,set:j,wrap:st,close:Fe,setInstance:Z,setColor:Cl,removeInstance:se,updatePosition:qe,ready:hr};function L(I){hr(()=>{I&&(typeof I=="string"?ye(I):j(I))})}for(let I in x)L[I]=function(){for(var D=arguments.length,O=new Array(D),$=0;$<D;$++)O[$]=arguments[$];hr(x[I],O)};return hr(()=>{s.addEventListener("resize",I=>{L.updatePosition()}),s.addEventListener("scroll",I=>{L.updatePosition()})}),L})();return wn.coloris=wn,wn})(window,document,Math)})(),Js=yt.coloris,ea=yt.init,OT=yt.set,FT=yt.wrap,Mi=yt.close,HT=yt.setInstance,NT=yt.removeInstance,$T=yt.updatePosition;var Tc=s=>(o,e)=>new Bi(s,o,e),nt=Tc,Bi=class{constructor(o,e,r){this.sourceFactory=o;this.startPoint=e;this.viewport=r;this.builder=o(e,r),this.points=[e],this.builder.inkTrailStyle&&(this.inkTrailStyle=this.builder.inkTrailStyle.bind(this.builder))}getBBox(){return this.builder.getBBox()}build(){return this.builder.build()}preview(o){this.builder.preview(o)}addPoint(o){this.points.push(o),this.builder.addPoint(o)}async autocorrectShape(){let o=i=>({...i,pos:this.viewport.snapToGrid(i.pos)}),e=o(this.startPoint),r=this.sourceFactory(e,this.viewport),n=this.points.map(i=>o(i));for(let i of n)r.addPoint(i);return r.build()}};var Di=nt((s,o)=>new an(s,o)),an=class{constructor(o,e){this.startPoint=o;this.viewport=e;this.endPoint=o}getLineWidth(){return Math.max(this.endPoint.width,this.startPoint.width)}getBBox(){return this.buildPreview().getBBox()}buildPreview(){let o=this.startPoint.pos,e=this.endPoint.pos,r=e.minus(o).normalized(),n=e.distanceTo(o),i=Math.min(this.getLineWidth(),n/2),a=this.startPoint.width/2,l=this.endPoint.width/2,c=e.minus(r.times(i)),d=r.orthog(),p=d.times(a),u=d.times(l),h=new W(c.minus(u),[{kind:0,point:o.minus(p)},{kind:0,point:o.plus(p)},{kind:0,point:c.plus(u)},{kind:0,point:c.plus(d.times(i).plus(u))},{kind:0,point:e.plus(r.times(l))},{kind:0,point:c.plus(d.times(-i).minus(u))},{kind:0,point:c.minus(u)}]).mapPoints(b=>this.viewport.roundPoint(b));return new ae([{startPoint:h.startPoint,commands:h.parts,style:{fill:this.startPoint.color}}])}build(){return this.buildPreview()}preview(o){this.buildPreview().render(o)}addPoint(o){this.endPoint=o}};var Ai=nt((s,o)=>new ln(s,o)),ln=class{constructor(o,e){this.startPoint=o;this.viewport=e;this.endPoint=o}getBBox(){return this.buildPreview().getBBox()}buildPreview(){let o=this.startPoint.pos,e=this.endPoint.pos,r=e.minus(o).normalized(),n=this.startPoint.width/2,i=this.endPoint.width/2,a=r.orthog(),l=a.times(n),c=a.times(i),d=o.minus(l),p=new W(d,[{kind:0,point:o.plus(l)},{kind:0,point:e.plus(c)},{kind:0,point:e.minus(c)},{kind:0,point:o.minus(l)}]).mapPoints(h=>this.viewport.roundPoint(h));return new ae([Q(p,{fill:this.startPoint.color})])}build(){return this.buildPreview()}preview(o){this.buildPreview().render(o)}addPoint(o){this.endPoint=o}};var Vi=nt((s,o)=>new Qo(s,!0,o)),Oi=nt((s,o)=>new Qo(s,!1,o)),Qo=class{constructor(o,e,r){this.startPoint=o;this.filled=e;this.viewport=r;this.endPoint=o}getBBox(){return this.buildPreview().getBBox()}buildPreview(){let o=this.viewport.getRotationAngle(),e=k.zRotation(-o),r=e.inverse().transformVec2(this.startPoint.pos),n=e.inverse().transformVec2(this.endPoint.pos),i=R.fromCorners(r,n),a=W.fromRect(i,this.filled?null:this.endPoint.width).transformedBy(e).mapPoints(c=>this.viewport.roundPoint(c));return new ae([Q(a,{fill:this.endPoint.color})])}build(){return this.buildPreview()}preview(o){this.buildPreview().render(o)}addPoint(o){this.endPoint=o}};var Hi=nt((s,o)=>new Fi(s,o)),Fi=class{constructor(o,e){this.startPoint=o;this.viewport=e;this.endPoint=o}getBBox(){return this.buildPreview().getBBox()}buildPreview(){let o=[],r=Math.PI*2/6,n=q.roundPoint(this.endPoint.width,5/this.viewport.getScaleFactor()),i=this.startPoint.pos.lerp(this.endPoint.pos,.5),l=this.endPoint.pos.minus(i).length()-n/2,c=i.plus(T.of(l,0));for(let u=r;u<=Math.PI*2;u+=r){let h=T.of(l*Math.cos(u),-l*Math.sin(u)).plus(i),b=T.of(Math.cos(u-r/2),-Math.sin(u-r/2)).times(l*1.141).plus(i);o.push({kind:3,controlPoint:b,endPoint:h})}o.push({kind:0,point:c});let d=new W(c,o).mapPoints(u=>this.viewport.roundPoint(u));return new ae([Q(d,{fill:M.transparent,stroke:{width:n,color:this.endPoint.color}})])}build(){return this.buildPreview()}preview(o){this.buildPreview().render(o)}addPoint(o){this.endPoint=o}};var Sc=(s,o)=>{let e=document.createElement("span"),r=document.createElement("span"),n=document.createElement("input");n.type="button",n.classList.add("coloris_input"),e.classList.add("color-input-container"),r.classList.add("color-input-wrapper"),r.appendChild(n),e.appendChild(r);let i=Cc(s,e,h=>{n.value=h.toHexString(),c();let f=n.parentElement;f&&f.classList.contains("clr-field")&&(f.style.color=n.value)}),a,l=()=>{a=M.fromHex(n.value)},c=()=>{l(),a&&(s.announceForAccessibility(s.localization.colorChangedAnnouncement(a.toHexString())),o(a),s.notifier.dispatch(12,{kind:12,color:a}))};n.oninput=l;let d=!1;n.addEventListener("open",()=>{d=!0,s.notifier.dispatch(11,{kind:11,open:!0}),i.cancel(),e.classList.add("picker-open"),document.querySelector("#clr-picker #clr-hue-slider")?.focus()});let p=()=>{d=!1,s.notifier.dispatch(11,{kind:11,open:!1}),c(),n.focus(),e.classList.remove("picker-open")};return n.addEventListener("close",()=>{p()}),{input:n,container:e,setValue:h=>{typeof h=="object"&&(h=h.toHexString()),n.value=h,n.dispatchEvent(new Event("input",{bubbles:!0}))},closePicker:()=>{d&&c()},registerWithHelpTextDisplay:h=>{h.registerTextHelpForElement(r,s.localization.colorPickerToggleHelpText),i.registerWithHelpTextDisplay(h)}}},Cc=(s,o,e)=>{let r=G();r.classList.add("pipetteButton"),r.title=s.localization.pickColorFromScreen,r.setAttribute("alt",r.title);let n=document.createElement("span");n.classList.add("pickColorInstructions"),n.innerText=s.localization.clickToPickColorAnnouncement;let i=p=>{r.replaceChildren(s.icons.makePipetteIcon(p),n)};i();let a=s.toolController.getMatchingTools(Ot)[0],l=()=>{a?.clearColorListener(),i(),r.classList.remove("active")},c=p=>{l(),p&&e(p)},d=p=>{p?i(p):i()};return r.onclick=()=>{if(r.classList.contains("active")){l(),s.announceForAccessibility(s.localization.colorSelectionCanceledAnnouncement);return}a?.setColorListener(d,c),a&&(r.classList.add("active"),s.announceForAccessibility(s.localization.clickToPickColorAnnouncement))},o.appendChild(r),{cancel:()=>{l()},registerWithHelpTextDisplay:p=>{p.registerTextHelpForElement(r,s.localization.colorPickerPipetteHelpText)}}},xt=Sc;var Ec=()=>{let s=[...document.querySelectorAll("*:focus")];return s.length&&s.some(o=>o.classList.contains(`${A}button`))},Pe=class extends pe{constructor(e,r,n,i){super(e,n,i);this.targetTool=r;this.targetTool.enabledValue().onUpdateAndNow(a=>{a?(this.setSelected(!0),Ec()&&this.focus()):(this.setSelected(!1),this.setDropdownVisible(!1))})}shouldAutoDisableInReadOnlyEditor(){return!this.targetTool.canReceiveInputInReadOnlyEditor()}handleClick(){this.hasDropdown?this.targetTool.isEnabled()?this.setDropdownVisible(!this.isDropdownVisible()):(this.targetTool.setEnabled(!0),this.activateDropdown()):this.targetTool.setEnabled(!this.targetTool.isEnabled())}onKeyPress(e){return this.isSelected()&&e.code==="Space"&&this.hasDropdown?(this.handleClick(),!0):!1}addTo(e){let r=super.addTo(e);return this.setSelected(this.targetTool.isEnabled()),r}};var Ni="jsdraw.toolbar.SelectionTool.resizeImageToSelection";H.registerDefaultKeyboardShortcut(Ni,["ctrlOrMeta+r"],"Resize image to selection");var Jo=[1,2,3,4,5,6,7,8,9].map(s=>`jsdraw.toolbar.PenTool.select-pen-${s}`);for(let s=0;s<Jo.length;s++){let o=Jo[s];H.registerDefaultKeyboardShortcut(o,[`CtrlOrMeta+Digit${s+1}`],"Select pen style "+(s+1))}var $i="jsdraw.toolbar.SaveActionWidget.save";H.registerDefaultKeyboardShortcut($i,["ctrlOrMeta+KeyS"],"Save");var Wi="jsdraw.toolbar.ExitActionWidget.exit";H.registerDefaultKeyboardShortcut(Wi,["Alt+KeyQ"],"Exit");var Pc=0,kc=(s,o)=>{let e=document.createElement("div"),r=document.createElement("label"),n=document.createElement("input");e.classList.add(`${A}thicknessSliderContainer`),n.id=`${A}thicknessInput${Pc++}`,r.innerText=s.localization.thicknessLabel,r.setAttribute("for",n.id);let i=c=>Math.log10(c),a=c=>10**c;n.type="range",n.oninput=()=>{o(a(parseFloat(n.value)))},e.appendChild(r),e.appendChild(n);let l=(c,d)=>{let p=(f,b)=>(b?Math.ceil:Math.floor)(f*100)/100,u=p(i(c),!1),h=p(i(d),!0);n.min=`${u}`,n.max=`${h}`,n.step=`${be((h-u)/20)}`};return l(2,262),{container:e,addTo:c=>{c.appendChild(e)},setBounds:l,setValue:c=>{n.value=i(c).toString()}}},cn=kc;var Lc=s=>{let o=(e,r,n,i)=>{let a=r!==i&&e!==0,l=n+e<=0,d=n+r+e>i;return a&&!l&&!d};s.onwheel=e=>{let r=o(e.deltaX,s.clientWidth,s.scrollLeft,s.scrollWidth),n=o(e.deltaY,s.clientHeight,s.scrollTop,s.scrollHeight);(r||n)&&e.stopPropagation()}},po=Lc;var Ui=0,Ic=(s,o,e)=>{let r=document.createElement("div");r.classList.add(`${A}grid-selector`);let n=de.fromInitialValue(o),i=document.createElement("div");i.role="group",i.id=`${A}-grid-select-id-${Ui++}`,po(i);let a=document.createElement("label");a.textContent=s,a.htmlFor=i.id,r.appendChild(a);let l=`${A}-grid-selector-${Ui++}`,c=u=>{let h=document.createElement("div");h.classList.add("choice-button");let f=document.createElement("input");f.type="radio",f.id=`${A}-grid-select-button-${Ui++}`,vt(h);let b=document.createElement("label"),v=()=>{b.setAttribute("title",u.title);let C=document.createElement("span");C.classList.add("button-label-text");let E=u.makeIcon();E.classList.add("icon"),C.innerText=u.title,b.htmlFor=f.id,b.replaceChildren(E,C)};v();let g=()=>{f.name=l};g();let y=()=>{f.checked?h.classList.add("checked"):h.classList.remove("checked")};f.oninput=()=>{f.checked&&n.set(u.id),y()},f.onfocus=()=>{h.querySelector(":focus-visible")&&h.classList.add("focus-visible")},f.onblur=()=>{h.classList.remove("focus-visible")},h.oncontextmenu=C=>{C.preventDefault()},h.replaceChildren(f,b),i.appendChild(h);let m=C=>{f.checked=C,y()};return m(!1),{choiceRecord:u,setChecked:m,updateIcon:()=>{v()},updateButtonRadiogroupName:g}},d=[];for(let u of e)d.push(c(u));r.appendChild(i),n.onUpdateAndNow(u=>{for(let h=0;h<d.length;h++)d[h].setChecked(d[h].choiceRecord.id===u)});let p={value:n,_radiogroupName:l,linkWith:u=>{p._radiogroupName=u._radiogroupName,l=u._radiogroupName;for(let h of d)h.updateButtonRadiogroupName()},updateIcons:()=>{d.forEach(u=>u.updateIcon())},getRootElement(){return r},addTo:u=>{u.appendChild(r)}};return p},qi=Ic;var uo=class s extends Pe{constructor(e,r,n){super(e,r,"pen",n);this.tool=r;this.updateInputs=()=>{};this.shapelikeIDs=["pressure-sensitive-pen","freehand-pen"];let i=e.getCurrentSettings().pens?.additionalPenTypes??[],a=e.getCurrentSettings().pens?.filterPenTypes??(()=>!0);this.penTypes=[{name:this.localizationTable.flatTipPen,id:"pressure-sensitive-pen",factory:no},{name:this.localizationTable.roundedTipPen,id:"freehand-pen",factory:ht},{name:this.localizationTable.roundedTipPen2,id:"polyline-pen",factory:Ft},...i.filter(l=>!l.isShapeBuilder),{name:this.localizationTable.arrowPen,id:"arrow",isShapeBuilder:!0,factory:Di},{name:this.localizationTable.linePen,id:"line",isShapeBuilder:!0,factory:Ai},{name:this.localizationTable.filledRectanglePen,id:"filled-rectangle",isShapeBuilder:!0,factory:Vi},{name:this.localizationTable.outlinedRectanglePen,id:"outlined-rectangle",isShapeBuilder:!0,factory:Oi},{name:this.localizationTable.outlinedCirclePen,id:"outlined-circle",isShapeBuilder:!0,factory:Hi},...i.filter(l=>l.isShapeBuilder)].filter(a),this.editor.notifier.on(2,l=>{if(l.kind!==2)throw new Error("Invalid event type!");l.tool===this.tool&&(this.updateIcon(),this.updateInputs())})}static{this.idCounter=0}getTitle(){return this.targetTool.description}getCurrentPenTypeIdx(){let e=this.tool.getStrokeFactory();for(let r=0;r<this.penTypes.length;r++)if(this.penTypes[r].factory===e)return r;return-1}getCurrentPenType(){for(let e of this.penTypes)if(e.factory===this.tool.getStrokeFactory())return e;return null}createIconForRecord(e){let r={...this.tool.getStyleValue().get()};e?.factory&&(r.factory=e.factory);let n=e?.factory;return!n||n===ht||n===no||n===Ft?this.editor.icons.makePenIcon(r):this.editor.icons.makeIconFromFactory(r)}createIcon(){return this.createIconForRecord(this.getCurrentPenType())}createPenTypeSelector(e){let r=this.penTypes.map((d,p)=>({id:p,makeIcon:()=>this.createIconForRecord(d),title:d.name,isShapeBuilder:d.isShapeBuilder??!1})),n=r.filter(d=>!d.isShapeBuilder),i=qi(this.localizationTable.selectPenType,this.getCurrentPenTypeIdx(),n),a=r.filter(d=>d.isShapeBuilder),l=qi(this.localizationTable.selectShape,this.getCurrentPenTypeIdx(),a),c=d=>{this.tool.setStrokeFactory(this.penTypes[d].factory)};return i.value.onUpdate(c),l.value.onUpdate(c),e?.registerTextHelpForElements([i.getRootElement(),l.getRootElement()],this.localizationTable.penDropdown__penTypeHelpText),{setValue:d=>{i.value.set(d),l.value.set(d)},updateIcons:()=>{i.updateIcons(),l.updateIcons()},addTo:d=>{n.length&&i.addTo(d),a.length&&l.addTo(d)}}}createStrokeCorrectionOptions(e){let r=document.createElement("div");r.classList.add("action-button-row",`${A}-pen-tool-toggle-buttons`);let n=(c,d)=>{let p=Xr("button",{type:"button"});p.classList.add(`${A}-toggle-button`);let u=d.cloneNode(!0);u.classList.add("icon");let h=document.createElement("span");h.innerText=c,p.replaceChildren(u,h),p.setAttribute("role","switch"),r.appendChild(p);let f=!1,b=g=>{},v={setChecked(g){f=g,p.setAttribute("aria-checked",`${f}`),b(f)},setOnInputListener(g){b=g},addHelpText(g){e?.registerTextHelpForElement(p,g)}};return p.onclick=()=>{v.setChecked(!f)},v},i=n(this.localizationTable.inputStabilization,this.editor.icons.makeStrokeSmoothingIcon());i.setOnInputListener(c=>{this.tool.setHasStabilization(c)});let a=n(this.localizationTable.strokeAutocorrect,this.editor.icons.makeShapeAutocorrectIcon());a.setOnInputListener(c=>{this.tool.setStrokeAutocorrectEnabled(c)});let l=n(this.localizationTable.pressureSensitivity,this.editor.icons.makePressureSensitivityIcon());return l.setOnInputListener(c=>{this.tool.setPressureSensitivityEnabled(c)}),a.addHelpText(this.localizationTable.penDropdown__autocorrectHelpText),i.addHelpText(this.localizationTable.penDropdown__stabilizationHelpText),l.addHelpText(this.localizationTable.penDropdown__pressureSensitivityHelpText),{update:()=>{i.setChecked(!!this.tool.getInputMapper()),a.setChecked(this.tool.getStrokeAutocorrectionEnabled()),l.setChecked(this.tool.getPressureSensitivityEnabled())},addTo:c=>{c.appendChild(r)}}}getHelpText(){return this.localizationTable.penDropdown__baseHelpText}fillDropdown(e,r){let n=document.createElement("div");n.classList.add(`${A}spacedList`,`${A}nonbutton-controls-main-list`);let{container:i,setValue:a}=cn(this.editor,b=>{this.tool.setThickness(b)}),l=document.createElement("div"),c=document.createElement("label"),d=xt(this.editor,b=>{this.tool.setColor(b)}),{input:p,container:u}=d;p.id=`${A}colorInput${s.idCounter++}`,c.innerText=this.localizationTable.colorLabel,c.setAttribute("for",p.id),l.appendChild(c),l.appendChild(u);let h=this.createStrokeCorrectionOptions(r),f=this.createPenTypeSelector(r);return r?.registerTextHelpForElement(l,this.localizationTable.penDropdown__colorHelpText),r&&d.registerWithHelpTextDisplay(r),r?.registerTextHelpForElement(i,this.localizationTable.penDropdown__thicknessHelpText),this.updateInputs=()=>{d.setValue(this.tool.getColor()),a(this.tool.getThickness()),f.updateIcons(),f.setValue(this.getCurrentPenTypeIdx()),h.update()},this.updateInputs(),n.replaceChildren(l,i),f.addTo(n),e.replaceChildren(n),h.addTo(e),!0}onKeyPress(e){if(!this.isSelected())return!1;for(let r=0;r<Jo.length;r++){let n=Jo[r];if(this.editor.shortcuts.matchesShortcut(n,e)){let i=r;if(i<this.penTypes.length)return this.tool.setStrokeFactory(this.penTypes[i].factory),!0}}return!!super.onKeyPress(e)}serializeState(){return{...super.serializeState(),color:this.tool.getColor().toHexString(),thickness:this.tool.getThickness(),strokeFactoryId:this.getCurrentPenType()?.id,inputStabilization:!!this.tool.getInputMapper(),strokeAutocorrect:this.tool.getStrokeAutocorrectionEnabled(),pressureSensitivity:this.tool.getPressureSensitivityEnabled()}}deserializeFrom(e){super.deserializeFrom(e);let r=(n,i)=>{let a=typeof e[n];if(a!==i)throw new Error(`Deserializing property ${n}: Invalid type. Expected ${i}, was ${a}.`)};if(e.color&&(r("color","string"),this.tool.setColor(M.fromHex(e.color))),e.thickness&&(r("thickness","number"),this.tool.setThickness(e.thickness)),e.strokeFactoryId){r("strokeFactoryId","string");let n=e.strokeFactoryId;for(let i of this.penTypes)if(n===i.id){this.tool.setStrokeFactory(i.factory);break}}e.inputStabilization!==void 0&&this.tool.setHasStabilization(!!e.inputStabilization),e.strokeAutocorrect!==void 0&&this.tool.setStrokeAutocorrectEnabled(!!e.strokeAutocorrect),e.pressureSensitivity!==void 0&&this.tool.setPressureSensitivityEnabled(!!e.pressureSensitivity)}};var ho=class s extends Pe{constructor(e,r,n){super(e,r,"eraser-tool-widget",n);this.tool=r;this.updateInputs=()=>{};this.editor.notifier.on(2,i=>{i.kind===2&&i.tool===this.tool&&(this.updateInputs(),this.updateIcon())})}getHelpText(){return this.localizationTable.eraserDropdown__baseHelpText}getTitle(){return this.localizationTable.eraser}makeIconForType(e){return this.editor.icons.makeEraserIcon(this.tool.getThickness(),e)}createIcon(){return this.makeIconForType(this.tool.getModeValue().get())}static{this.idCounter=0}makeEraserTypeSelector(e){let r=document.createElement("div"),n=document.createElement("label"),i=document.createElement("input");i.id=`${A}eraserToolWidget-${s.idCounter++}`,n.htmlFor=i.id,n.innerText=this.localizationTable.fullStrokeEraser,i.type="checkbox",i.oninput=()=>{this.tool.getModeValue().set(i.checked?"full-stroke":"partial-stroke")};let a=()=>{i.checked=this.tool.getModeValue().get()==="full-stroke"};return r.replaceChildren(n,i),e?.registerTextHelpForElement(r,this.localizationTable.eraserDropdown__fullStrokeEraserHelpText),{addTo:l=>{l.appendChild(r)},updateValue:a}}fillDropdown(e,r){let n=document.createElement("div");n.classList.add(`${A}spacedList`,`${A}nonbutton-controls-main-list`);let i=cn(this.editor,l=>{this.tool.setThickness(l)});i.setBounds(10,55),r?.registerTextHelpForElement(i.container,this.localizationTable.eraserDropdown__thicknessHelpText);let a=this.makeEraserTypeSelector(r);return this.updateInputs=()=>{i.setValue(this.tool.getThickness()),a.updateValue()},this.updateInputs(),n.replaceChildren(i.container),a.addTo(n),e.replaceChildren(n),!0}serializeState(){return{...super.serializeState(),thickness:this.tool.getThickness(),mode:this.tool.getModeValue().get()}}deserializeFrom(e){if(super.deserializeFrom(e),e.thickness){let r=parseFloat(e.thickness);if(typeof r!="number"||!isFinite(r))throw new Error(`Deserializing property ${r} is not a number or is not finite.`);this.tool.setThickness(r)}if(e.mode){let r=e.mode;Object.values(Bt).includes(r)&&this.tool.getModeValue().set(r)}}};var Rc=(s="")=>{let o=document.createElement("div");return o.classList.add("tool-dropdown-separator"),o.innerText=s,{addTo:e=>{e.appendChild(o)}}},er=Rc;var zc=(s,o)=>{let e=document.createElement("div");e.classList.add("toolbar-button-grid"),e.style.setProperty("--column-count",`${o}`);let r=n=>{let i=G();i.classList.add("button");let a=n.icon();a.classList.add("icon");let l=document.createElement("label");return l.textContent=n.label,l.classList.add("button-label-text"),i.onclick=n.onClick,n.enabled&&n.enabled.onUpdateAndNow(c=>{i.disabled=!c}),i.replaceChildren(a,l),e.appendChild(i),vt(i),n.onCreated?.(i),i};return s.map(r),{container:e}},ta=zc;var Mc=(s,o,e)=>{let r=document.createElement("div");r.classList.add("selection-format-menu",`${A}spacedList`,`${A}indentedList`);let n=document.createElement("div"),i=document.createElement("label"),a=xt(s,p=>{let u=o.getSelection();if(u){let h=[];for(let b of u.getSelectedObjects())Hr(b)&&h.push(b.updateStyle({color:p}));let f=he(h);s.dispatch(f)}}),{input:l,container:c}=a;i.innerText=e.colorLabel;let d=()=>{let p=o.getSelection();if(p&&p.getSelectedItemCount()>0){l.disabled=!1,r.classList.remove("disabled");let u=[];for(let h of p.getSelectedObjects())if(Hr(h)){let f=h.getStyle().color;f&&u.push(f)}a.setValue(M.average(u))}else l.disabled=!0,r.classList.add("disabled"),a.setValue(M.transparent)};return n.replaceChildren(i,c),r.replaceChildren(n),{addTo:p=>{p.appendChild(r)},update:d,registerHelpText:p=>{p.registerTextHelpForElement(n,e.selectionDropdown__changeColorHelpText),a.registerWithHelpTextDisplay(p)}}},Ki=class extends pe{constructor(e,r,n){super(e,"selection-mode-toggle",n);this.tool=r;e.notifier.on(2,i=>{i.kind===2&&i.tool===r&&this.setSelected(r.modeValue.get()==="lasso")}),this.setSelected(!1)}shouldAutoDisableInReadOnlyEditor(){return!1}setModeFlag(e){this.tool.modeValue.set(e?"lasso":"rect")}handleClick(){this.setModeFlag(!this.isSelected())}getTitle(){return this.localizationTable.selectionTool__lassoSelect}createIcon(){return this.editor.icons.makeSelectionIcon("lasso")}fillDropdown(e){return!1}getHelpText(){return this.localizationTable.selectionTool__lassoSelect__help}},mo=class extends Pe{constructor(e,r,n){super(e,r,"selection-tool-widget",n);this.tool=r;this.updateFormatMenu=()=>{};this.addSubWidget(new Ki(e,r,this.localizationTable));let i=()=>{let a=this.tool.getSelection();return!!a&&a.getSelectedItemCount()>0};this.hasSelectionValue=de.fromInitialValue(i()),this.editor.notifier.on(2,a=>{if(a.kind!==2)throw new Error("Invalid event type!");a.tool===this.tool&&(this.hasSelectionValue.set(i()),this.updateFormatMenu())}),r.modeValue.onUpdate(()=>{this.updateIcon()})}resizeImageToSelection(){let e=this.tool.getSelection();e&&this.editor.dispatch(this.editor.setImportExportRect(e.region))}onKeyPress(e){return this.editor.shortcuts.matchesShortcut(Ni,e)?(this.resizeImageToSelection(),!0):!!super.onKeyPress(e)}getTitle(){return this.localizationTable.select}createIcon(){return this.editor.icons.makeSelectionIcon(this.tool.modeValue.get())}getHelpText(){return this.localizationTable.selectionDropdown__baseHelpText}createSelectionActions(e){let r=this.editor.icons;return{container:ta([{icon:()=>r.makeDeleteSelectionIcon(),label:this.localizationTable.deleteSelection,onCreated:i=>{e?.registerTextHelpForElement(i,this.localizationTable.selectionDropdown__deleteHelpText)},onClick:()=>{let i=this.tool.getSelection();this.editor.dispatch(i.deleteSelectedObjects()),this.tool.clearSelection()},enabled:this.hasSelectionValue},{icon:()=>r.makeDuplicateSelectionIcon(),label:this.localizationTable.duplicateSelection,onCreated:i=>{e?.registerTextHelpForElement(i,this.localizationTable.selectionDropdown__duplicateHelpText)},onClick:async()=>{let a=await this.tool.getSelection()?.duplicateSelectedObjects();a&&this.editor.dispatch(a)},enabled:this.hasSelectionValue},{icon:()=>r.makeResizeImageToSelectionIcon(),label:this.localizationTable.resizeImageToSelection,onCreated:i=>{e?.registerTextHelpForElement(i,this.localizationTable.selectionDropdown__resizeToHelpText)},onClick:()=>{this.resizeImageToSelection()},enabled:this.hasSelectionValue}],3).container}}fillDropdown(e,r){super.fillDropdown(e,r);let n=document.createElement("div");n.classList.add(`${A}nonbutton-controls-main-list`),e.appendChild(n),er().addTo(n);let i=this.createSelectionActions(r);n.appendChild(i.container),er(this.localizationTable.reformatSelection).addTo(n);let a=Mc(this.editor,this.tool,this.localizationTable);return a.addTo(n),this.updateFormatMenu=()=>a.update(),r&&a.registerHelpText(r),a.update(),!0}serializeState(){return{...super.serializeState(),selectionMode:this.tool.modeValue.get()}}deserializeFrom(e){super.deserializeFrom(e),Object.values(ot).includes(e.selectionMode)&&this.tool.modeValue.set(e.selectionMode)}};var fo=class s extends Pe{constructor(e,r,n){super(e,r,"text-tool-widget",n);this.tool=r;this.updateDropdownInputs=null;e.notifier.on(2,i=>{i.kind===2&&i.tool===r&&(this.updateIcon(),this.updateDropdownInputs?.())})}getTitle(){return this.targetTool.description}createIcon(){let e=this.tool.getTextStyle();return this.editor.icons.makeTextIcon(e)}static{this.idCounter=0}fillDropdown(e){let r=document.createElement("div");r.classList.add(`${A}spacedList`,`${A}nonbutton-controls-main-list`);let n=document.createElement("div"),i=document.createElement("div"),a=document.createElement("div"),l=document.createElement("select"),c=document.createElement("label"),d=document.createElement("input"),p=document.createElement("label"),{input:u,container:h,setValue:f}=xt(this.editor,m=>{this.tool.setColor(m)}),b=document.createElement("label"),v=new Set,g=m=>{let w=document.createElement("option");w.value=m,w.textContent=m,l.appendChild(w),v.add(m)};d.setAttribute("type","number"),d.min="1",d.max="128",c.innerText=this.localizationTable.fontLabel,b.innerText=this.localizationTable.colorLabel,p.innerText=this.localizationTable.textSize,u.id=`${A}-text-color-input-${s.idCounter++}`,b.setAttribute("for",u.id),d.id=`${A}-text-size-input-${s.idCounter++}`,p.setAttribute("for",d.id);let y=this.editor.getCurrentSettings().text?.fonts??[];for(let m of y)g(m);return l.classList.add("font-selector"),l.id=`${A}-text-font-input-${s.idCounter++}`,c.setAttribute("for",l.id),l.onchange=()=>{this.tool.setFontFamily(l.value)},d.onchange=()=>{let m=parseInt(d.value);!isNaN(m)&&m>0&&this.tool.setFontSize(m)},i.appendChild(b),i.appendChild(h),n.appendChild(c),n.appendChild(l),a.appendChild(p),a.appendChild(d),this.updateDropdownInputs=()=>{let m=this.tool.getTextStyle();f(m.renderingStyle.fill),v.has(m.fontFamily)||g(m.fontFamily),l.value=m.fontFamily,d.value=`${m.size}`},this.updateDropdownInputs(),r.replaceChildren(i,a,n),e.appendChild(r),!0}serializeState(){let e=this.tool.getTextStyle();return{...super.serializeState(),fontFamily:e.fontFamily,textSize:e.size,color:e.renderingStyle.fill.toHexString()}}deserializeFrom(e){e.fontFamily&&typeof e.fontFamily=="string"&&this.tool.setFontFamily(e.fontFamily),e.color&&typeof e.color=="string"&&this.tool.setColor(M.fromHex(e.color)),e.textSize&&typeof e.textSize=="number"&&this.tool.setFontSize(e.textSize),super.deserializeFrom(e)}};var Bc=(s,o,e)=>{let r=document.createElement("div"),n=G(),i=G(),a=G(),l=document.createElement("span");n.innerText="+",i.innerText="-",a.innerText=s.resetView,r.replaceChildren(l,n,i,a),r.classList.add(`${A}zoomLevelEditor`),l.classList.add("zoomDisplay");let c,d=()=>{let u=o.viewport.getScaleFactor()*100;u>.1?u=Math.round(u*10)/10:u=Math.round(u*1e3)/1e3,u!==c&&(l.textContent=s.zoomLevel(u),c=u)};d(),o.notifier.on(7,u=>{u.kind===7&&(d(),a.disabled=u.newTransform.eq(k.identity))});let p=u=>{let h=o.viewport.visibleRect.center,f=k.scaling2D(u,h);o.dispatch(q.transformBy(f),!1)};return n.onclick=()=>{p(5/4)},i.onclick=()=>{p(4/5)},a.onclick=()=>{o.dispatch(q.transformBy(o.viewport.canvasToScreenTransform.inverse()),!1)},e?.registerTextHelpForElement(n,s.handDropdown__zoomInHelpText),e?.registerTextHelpForElement(i,s.handDropdown__zoomOutHelpText),e?.registerTextHelpForElement(a,s.handDropdown__resetViewHelpText),e?.registerTextHelpForElement(l,s.handDropdown__zoomDisplayHelpText),r},dn=class extends pe{constructor(e,r,n,i,a,l,c){super(e,`pan-mode-${n}`,c);this.tool=r;this.flag=n;this.makeIcon=i;this.title=a;this.helpText=l;e.notifier.on(2,d=>{if(d.kind===2&&d.tool===r){let p=!!(r.getMode()&8);this.setSelected(!!(r.getMode()&n)||p),this.setDisabled(p&&n!==8)}}),this.setSelected(!1)}shouldAutoDisableInReadOnlyEditor(){return!1}setModeFlag(e){this.tool.setModeEnabled(this.flag,e)}handleClick(){this.setModeFlag(!this.isSelected())}getTitle(){return this.title}createIcon(){return this.makeIcon()}fillDropdown(e){return!1}getHelpText(){return this.helpText}},go=class s extends Pe{constructor(o,e,r){let n=o.toolController.getPrimaryTools().includes(e),i=(n?e:s.getPrimaryHandTool(o.toolController))??e;super(o,i,"hand-tool-widget",r),this.overridePanZoomTool=(n?s.getOverrideHandTool(o.toolController):e)??e,this.allowTogglingBaseTool=i!==null,this.allowTogglingBaseTool||this.container.classList.add("dropdownShowable");let a=new dn(o,this.overridePanZoomTool,1,()=>this.editor.icons.makeTouchPanningIcon(),r.touchPanning,r.handDropdown__touchPanningHelpText,r),l=new dn(o,this.overridePanZoomTool,32,()=>this.editor.icons.makeRotationLockIcon(),r.lockRotation,r.handDropdown__lockRotationHelpText,r);this.addSubWidget(a),this.addSubWidget(l)}static getPrimaryHandTool(o){return o.getPrimaryTools().filter(n=>n instanceof Ie)[0]}static getOverrideHandTool(o){return o.getMatchingTools(Ie)[0]}shouldAutoDisableInReadOnlyEditor(){return!1}getTitle(){return this.localizationTable.handTool}createIcon(){return this.editor.icons.makeHandToolIcon()}handleClick(){this.allowTogglingBaseTool?super.handleClick():this.setDropdownVisible(!this.isDropdownVisible())}getHelpText(){return this.localizationTable.handDropdown__baseHelpText}fillDropdown(o,e){super.fillDropdown(o,e);let r=document.createElement("div");r.classList.add(`${A}nonbutton-controls-main-list`),er().addTo(r);let n=Bc(this.localizationTable,this.editor,e);return r.appendChild(n),o.appendChild(r),!0}setSelected(o){this.allowTogglingBaseTool&&super.setSelected(o)}serializeState(){let o=this.overridePanZoomTool.getMode();return{...super.serializeState(),touchPanning:o&1,rotationLocked:o&32}}deserializeFrom(o){o.touchPanning!==void 0&&this.overridePanZoomTool.setModeEnabled(1,!!o.touchPanning),o.rotationLocked!==void 0&&this.overridePanZoomTool.setModeEnabled(32,!!o.rotationLocked),super.deserializeFrom(o)}};var Xe=class extends pe{constructor(e,r,n,i,a,l,c=!1,d=!0){super(e,r,l);this.makeIcon=n;this.title=i;this.clickAction=a;this.mustBeToplevel=c;this.#e=d}#e;#t=void 0;setHelpText(e){this.#t=e}getHelpText(){return this.#t}shouldAutoDisableInReadOnlyEditor(){return this.#e}handleClick(){this.clickAction()}getTitle(){return this.title}createIcon(){return this.makeIcon()}fillDropdown(e){return!1}mustBeInToplevelMenu(){return this.mustBeToplevel}};var Dc=0,Ac=(s,o,{accepts:e="*",allowMultiSelect:r=!1,customPickerAction:n}={})=>{let i=document.createElement("div"),a=document.createElement("label"),l=document.createElement("input"),c=document.createElement("div");c.classList.add("toolbar--file-input-description");let d=document.createElement("span");i.classList.add("toolbar--file-input-container"),a.appendChild(document.createTextNode(s)),l.accept=e,l.type=n?"button":"file",l.classList.add("file-input"),l.multiple=r;let p=`js-draw-file-input-${Dc++}`;l.setAttribute("id",p),a.htmlFor=p;let u=o.icons.makeUploadFileIcon();u.classList.add("icon"),c.replaceChildren(u,d),a.appendChild(c),i.replaceChildren(a,l);let h=Rr.fromInitialValue([]),f=!1,b=null,v=()=>{let y=h.get();if(f){if(d.textContent=o.localization.fileInput__loading,b){let m=document.createElement("b");m.textContent=o.localization.cancel,m.classList.add("cancel-button"),d.appendChild(m)}u.style.display="none"}else if(y.length>0){let m=y.map(C=>C.name),w=5;if(m.length<=w)d.textContent=m.join(`
`);else{let C=m.slice(0,w-1);d.textContent=[...C,o.localization.fileInput__andNMoreFiles(m.length-C.length)].join(`
`)}u.style.display="none"}else{u.style.display="";let w=o.localization.dragAndDropHereOrBrowse.split(/[{]{2}(.*)[}]{2}/g);d.replaceChildren();for(let C=0;C<w.length;C++)if(C%2===1){let E=document.createElement("b");E.textContent=w[C],d.appendChild(E)}else d.appendChild(document.createTextNode(w[C]))}};if((()=>{a.addEventListener("dragover",y=>{y.preventDefault(),a.classList.add("drag-target")}),a.addEventListener("dragenter",y=>{y.preventDefault(),a.classList.add("drag-target")}),a.addEventListener("dragleave",y=>{y.preventDefault();let m=y.relatedTarget;(!m||!a.contains(m))&&a.classList.remove("drag-target")}),a.addEventListener("drop",y=>{y.preventDefault(),a.classList.remove("drag-target");let m=[];y.dataTransfer&&m.push(...y.dataTransfer.files),h.set(m)}),l.addEventListener("change",()=>{let y=l.files??[];h.set([...y])})})(),n){let y=async()=>{if(f){b?.();return}i.classList.add("-loading"),f=!0,v();try{let m=await n({setOnCancelCallback:w=>{if(!f)throw new Error("Task already completed. Can't register cancel handler.");b=()=>{b=null,v(),w()},v()}});m&&h.set(m)}finally{i.classList.remove("-loading"),f=!1,v()}};l.onclick=y}return h.onUpdate(y=>{y.length===0&&l.files&&l.files.length>0&&(l.value=""),b?.()}),h.onUpdateAndNow(v),{container:i,input:l,selectedFiles:h,addTo:y=>{y.appendChild(i)}}},oa=Ac;var Vc=s=>{let o=s/1024,e=o/1024,r=e/1024,n="B",i=s;return r>=1?(i=r,n="GiB"):e>=1?(i=e,n="MiB"):o>=1&&(i=o,n="KiB"),{size:i,units:n}},ra=Vc;var tr=class s{constructor(o,e,r){this.imageBase64Url=o;this.preview=e;this.onUrlUpdate=r;this.originalSrc=o,e.src=o}updateImageData(o){this.preview.src=o,this.imageBase64Url=o,this.onUrlUpdate()}decreaseSize(o=3/4){let e=document.createElement("canvas");e.width=this.preview.naturalWidth*o,e.height=this.preview.naturalHeight*o,e.getContext("2d")?.drawImage(this.preview,0,0,e.width,e.height);let n=this.originalSrc?.startsWith("data:image/jpeg;")?"image/jpeg":"image/png";this.updateImageData(e.toDataURL(n))}reset(){this.updateImageData(this.originalSrc)}isChanged(){return this.imageBase64Url!==this.originalSrc}isLarge(){return this.getBase64Url().length>125829.12}getBase64Url(){return this.imageBase64Url}getAltText(){return this.altText}setAltText(o){this.altText=o,this.preview.alt=o}static fromSrcAndPreview(o,e,r){return new s(o,e,r)}static fromRenderable(o,e){let r=new Image;r.src=o.base64Url;let n=new s(o.base64Url,r,e),i=o.label??o.image.getAttribute("alt");return i&&n.setAltText(i),{wrapper:n,preview:r}}};var Oc=s=>{let o=document.createElement("div");o.classList.add("toolbar-snapped-scroll-list");let e=document.createElement("div");e.classList.add("scroller");let r=de.fromInitialValue(0),n=null,i=()=>{let u=document.createElement("div");u.classList.add("page-markers"),u.setAttribute("tabindex","-1");let h=[];return Y.union([r,s]).onUpdateAndNow(([b,v])=>{let g=!1;for(;v.length<h.length;)h.pop(),g=!0;let y;for(let m=0;m<v.length;m++){let w;if(m>=h.length){w=document.createElement("div");let E=document.createElement("div");E.classList.add("content"),w.replaceChildren(E),h.push(w),g=!0}else w=h[m];w.classList.add("marker"),m===b?(w.classList.add("-active"),y=w):w.classList.remove("-active");let C=m;w.onclick=()=>{c.get()[C]?.element?.scrollIntoView({block:"nearest",behavior:"smooth"})}}g&&u.replaceChildren(...h),y&&u.scrollHeight>o.clientHeight&&y.scrollIntoView({block:"nearest"}),h.length===1?u.classList.add("-one-element"):u.classList.remove("-one-element")}),u},a=()=>{n=new IntersectionObserver(u=>{for(let h of u)if(h.isIntersecting&&h.intersectionRatio>.7){let f=h.target.getAttribute("data-item-index");if(f===null)throw new Error("Could not find attribute data-item-index");let b=Number(f);r.set(b);break}},{root:e,threshold:.9})},l=()=>{n&&(n.disconnect(),r.set(0),n=null)},c=Y.map(s,u=>u.map((h,f)=>{let b=document.createElement("div");return h.element.parentElement&&h.element.remove(),b.appendChild(h.element),b.classList.add("item"),b.setAttribute("data-item-index",`${f}`),{element:b,data:h.data}})),d=[];c.onUpdateAndNow(u=>{r.set(-1);for(let h of d)n?.unobserve(h.element);e.replaceChildren(),u.length>1?a():l(),u.length===0?o.classList.add("-empty"):o.classList.remove("-empty");for(let h of u)e.appendChild(h.element);if(r.set(0),n)for(let h of u)n.observe(h.element)});let p=Y.map(r,u=>{let h=s.get();return 0<=u&&u<h.length?h[u].data:null});return po(e),o.replaceChildren(i(),e),{container:o,visibleItem:p}},na=Oc;var Fc=async s=>{let o=[],e=new Image,r=await Jr(s);return r&&o.push({image:e,base64Url:r,transform:k.identity}),o},ia=Fc;var bo=class s extends pe{constructor(o,e){e??=o.localization,super(o,"insert-image-widget",e),this.container.classList.add("dropdownShowable"),o.notifier.on(9,r=>{r.kind===9&&this.isDropdownVisible()&&this.updateInputs()}),this.images=de.fromInitialValue([]),this.images.onUpdateAndNow(()=>{this.onImageDataUpdate()})}getTitle(){return this.localizationTable.image}createIcon(){return this.editor.icons.makeInsertImageIcon()}setDropdownVisible(o){super.setDropdownVisible(o),this.isDropdownVisible()?this.updateInputs():this.selectedFiles?.set([])}handleClick(){this.setDropdownVisible(!this.isDropdownVisible())}static{this.nextInputId=0}fillDropdown(o){let e=document.createElement("div");e.classList.add("insert-image-widget-dropdown-content",`${A}spacedList`,`${A}nonbutton-controls-main-list`);let{container:r,selectedFiles:n}=oa(this.localizationTable.chooseFile,this.editor,{accepts:"image/*",allowMultiSelect:!0,customPickerAction:this.editor.getCurrentSettings().image?.showImagePicker}),i=document.createElement("div");this.imagesPreview=na(this.images),this.statusView=document.createElement("div");let a=document.createElement("div");a.classList.add("action-button-row"),this.statusView.classList.add("insert-image-image-status-view"),this.submitButton=G(),this.selectedFiles=n,this.imageAltTextInput=document.createElement("input");let l=document.createElement("label"),c=`insert-image-alt-text-input-${s.nextInputId++}`;return this.imageAltTextInput.setAttribute("id",c),l.htmlFor=c,l.innerText=this.localizationTable.inputAltText,this.imageAltTextInput.type="text",this.imageAltTextInput.placeholder=this.localizationTable.describeTheImage,this.statusView.setAttribute("aria-live","polite"),this.submitButton.innerText=this.localizationTable.submit,this.imagesPreview.visibleItem.onUpdateAndNow(()=>this.onImageDataUpdate()),this.imageAltTextInput.oninput=()=>{let d=this.imagesPreview.visibleItem.get();d&&(d.setAltText(this.imageAltTextInput.value),this.submitButton.style.display="")},this.selectedFiles.onUpdateAndNow(async d=>{if(d.length===0){this.images.set([]);return}let p=(await Promise.all(d.map(async u=>{let h;try{h=await ia(u)}catch(f){console.error("Image load error",f);let b=this.localizationTable.imageLoadError(f);return this.statusView.innerText=b,[]}return h.map(f=>{let{wrapper:b,preview:v}=tr.fromRenderable(f,()=>this.onImageDataUpdate());return{data:b,element:v}})}))).flat();this.images.set(p)}),i.replaceChildren(l,this.imageAltTextInput),a.replaceChildren(this.submitButton),e.replaceChildren(r,i,this.imagesPreview.container,this.statusView,a),o.replaceChildren(e),!0}onImageDataUpdate(){if(!this.imagesPreview)return;let o=this.imagesPreview.visibleItem.get(),e=o?.getBase64Url();this.imageAltTextInput.value=o?.getAltText()??"",e?(this.submitButton.disabled=!1,this.submitButton.style.display="",this.updateImageSizeDisplay()):(this.submitButton.disabled=!0,this.submitButton.style.display="none",this.statusView.innerText="",this.submitButton.disabled=!0),this.images.get().length<=1?this.submitButton.innerText=this.localizationTable.submit:this.submitButton.innerText=this.localizationTable.addAll}hideDialog(){this.setDropdownVisible(!1)}updateImageSizeDisplay(){let o=this.imagesPreview.visibleItem.get(),e=o?.getBase64Url()??"",{size:r,units:n}=ra(e.length),i=document.createElement("span");i.innerText=this.localizationTable.imageSize(Math.round(r),n);let a=G({text:this.localizationTable.decreaseImageSize,onClick:()=>{o?.decreaseSize()}}),l=G({text:this.localizationTable.resetImage,onClick:()=>{o?.reset()}});this.statusView.replaceChildren(i),o?.isLarge()?this.statusView.appendChild(a):o?.isChanged()?this.statusView.appendChild(l):this.images.get().some(d=>d.data?.isChanged()||d.data?.isLarge())&&(a.disabled=!0,this.statusView.appendChild(a))}updateInputs(){(()=>{this.selectedFiles?.set([]),this.imageAltTextInput.value="",this.submitButton.disabled=!0,this.statusView.innerText="",this.submitButton.style.display=""})();let e=this.editor.toolController.getMatchingTools(Ee),r=e.map(i=>i.getSelectedObjects()).flat(),n=null;if(r.length===1&&r[0]instanceof Se){n=r[0];let i=new Image,a=tr.fromSrcAndPreview(n.getURL(),i,()=>this.onImageDataUpdate());a.setAltText(n.getAltText()??""),this.images.set([{data:a,element:i}])}else r.length>0&&e.forEach(i=>i.clearSelection());this.submitButton.style.display="none",this.submitButton.onclick=async()=>{let i=[],a=k.identity,l=null;for(let{data:c}of this.images.get()){if(!c)continue;let d=new Image;d.src=c.getBase64Url();let p=c.getAltText();p&&d.setAttribute("alt",p);let u;try{u=await Se.fromImage(d,a)}catch(b){console.error("Error loading image",b),this.statusView.innerText=this.localizationTable.imageLoadError(b);return}let h=u.getBBox();if(h.area===0){this.statusView.innerText=this.localizationTable.errorImageHasZeroSize;return}i.push(u),l??=h,l.union(h);let f=T.of(0,h.height);a=a.rightMul(k.translation(f))}if(i.length){if(!l)throw new Error("Logic error: Full bounding box must be calculated when components are to be added.");if(this.hideDialog(),n){let c=new ie([n]),d=n.getTransformation(),p=n.getBBox().width||1,u=l.transformedBoundingBox(d).width||1,h=k.scaling2D(p/u),f=[];for(let b of i)f.push(X.addComponent(b),b.transformBy(d.rightMul(h)),b.setZIndex(n.getZIndex()));this.editor.dispatch(he([...f,c])),e[0]?.setSelection(i)}else await this.editor.addAndCenterComponents(i)}}}};var vo=class s extends pe{constructor(e,r){super(e,"document-properties-widget",r);this.updateDropdownContent=()=>{};this.dropdownUpdateQueued=!1;this.container.classList.add("dropdownShowable"),this.editor.notifier.on(3,()=>{this.queueDropdownUpdate()}),this.editor.image.notifier.on(0,()=>{this.queueDropdownUpdate()})}getTitle(){return this.localizationTable.documentProperties}createIcon(){return this.editor.icons.makeConfigureDocumentIcon()}handleClick(){this.setDropdownVisible(!this.isDropdownVisible()),this.queueDropdownUpdate()}queueDropdownUpdate(){this.dropdownUpdateQueued||(requestAnimationFrame(()=>this.updateDropdown()),this.dropdownUpdateQueued=!0)}updateDropdown(){this.dropdownUpdateQueued=!1,this.isDropdownVisible()&&this.updateDropdownContent()}setBackgroundColor(e){this.editor.dispatch(this.editor.setBackgroundColor(e))}getBackgroundColor(){return this.editor.estimateBackgroundColor()}removeBackgroundComponents(){let e=[];for(let r of this.editor.image.getBackgroundComponents())r instanceof me&&e.push(r);return new ie(e)}setBackgroundType(e){let r=this.editor.estimateBackgroundColor(),n=new me(e,r),i=this.editor.image.addComponent(n);return he([this.removeBackgroundComponents(),i])}getBackgroundType(){let e=this.editor.image.getBackgroundComponents();for(let r=e.length-1;r>=0;r--){let n=e[r];if(n instanceof me)return n.getBackgroundType()}return 2}updateImportExportRectSize(e){let r=c=>(c!==void 0&&(!isFinite(c)||c<=0)&&(c=100),c),n=r(e.width),i=r(e.height),a=this.editor.getImportExportRect(),l=new R(a.x,a.y,n??a.w,i??a.h);this.editor.dispatch(this.editor.image.setImportExportRect(l)),this.editor.queueRerender()}getHelpText(){return this.localizationTable.pageDropdown__baseHelpText}static{this.idCounter=0}fillDropdown(e,r){let n=document.createElement("div");n.classList.add(`${A}spacedList`,`${A}nonbutton-controls-main-list`,`${A}document-properties-widget`);let i=()=>{let m=document.createElement("div"),w=document.createElement("label");w.innerText=this.localizationTable.backgroundColor;let{input:C,container:E,setValue:P,registerWithHelpTextDisplay:S}=xt(this.editor,V=>{V.eq(this.getBackgroundColor())||this.setBackgroundColor(V)});return C.id=`${A}docPropertiesColorInput-${s.idCounter++}`,w.htmlFor=C.id,m.replaceChildren(w,E),{setBgColorInputValue:P,backgroundColorRow:m,registerWithHelp:V=>{V&&(V?.registerTextHelpForElement(m,this.localizationTable.pageDropdown__backgroundColorHelpText),S(V))}}},{backgroundColorRow:a,setBgColorInputValue:l,registerWithHelp:c}=i(),d=(m,w)=>{let C=document.createElement("div"),E=document.createElement("label"),P=document.createElement("input");return P.id=`${A}docPropertiesCheckbox-${s.idCounter++}`,E.htmlFor=P.id,P.type="checkbox",E.innerText=m,P.oninput=()=>{w(P.checked)},C.replaceChildren(E,P),{container:C,checkbox:P}},{container:p,checkbox:u}=d(this.localizationTable.useGridOption,m=>{if(this.getBackgroundType()===1===m)return;let E=0;m&&(E=1),this.editor.dispatch(this.setBackgroundType(E))}),h=(m,w)=>{let C=document.createElement("div"),E=document.createElement("label"),P=document.createElement("input");return E.innerText=m,P.type="number",P.min="0",P.id=`${A}docPropertiesDimensionRow-${s.idCounter++}`,E.htmlFor=P.id,P.style.flexGrow="2",P.style.width="25px",P.oninput=()=>{w(parseFloat(P.value))},C.classList.add("js-draw-size-input-row"),C.replaceChildren(E,P),{setValue:S=>{if(document.activeElement===P&&P.value.match(/^0*$/)){let B=P.value;P.type="text",P.value=S.toString();let V=Math.max(1,P.value.length-B.length);P.setSelectionRange(0,V),P.type="number"}else P.value=S.toString()},setIsAutomaticSize:S=>{P.disabled=S;let B="size-input-row--automatic-size";S?C.classList.add(B):C.classList.remove(B)},element:C}},f=h(this.localizationTable.imageWidthOption,m=>{this.updateImportExportRectSize({width:m})}),b=h(this.localizationTable.imageHeightOption,m=>{this.updateImportExportRectSize({height:m})}),{container:v,checkbox:g}=d(this.localizationTable.enableAutoresizeOption,m=>{let w=this.editor.image;this.editor.dispatch(w.setAutoresizeEnabled(m))}),y=G({classList:["about-button"],text:this.localizationTable.about});return y.onclick=()=>{this.editor.showAboutDialog()},c(r),r?.registerTextHelpForElement(p,this.localizationTable.pageDropdown__gridCheckboxHelpText),r?.registerTextHelpForElement(v,this.localizationTable.pageDropdown__autoresizeCheckboxHelpText),r?.registerTextHelpForElement(y,this.localizationTable.pageDropdown__aboutButtonHelpText),this.updateDropdownContent=()=>{l(this.getBackgroundColor());let m=this.editor.image.getAutoresizeEnabled(),w=this.editor.getImportExportRect();f.setValue(w.width),b.setValue(w.height),g.checked=m,f.setIsAutomaticSize(m),b.setIsAutomaticSize(m),u.checked=this.getBackgroundType()===1},this.updateDropdownContent(),n.replaceChildren(a,p,f.element,b.element,v,y),e.replaceChildren(n),!0}};var Gi=class extends Xe{constructor(o,e,r,n={}){super(o,"save-button",()=>n.icon??o.icons.makeSaveIcon(),n.label??e.save,r),this.setTags(["save"])}shouldAutoDisableInReadOnlyEditor(){return!1}onKeyPress(o){return this.editor.shortcuts.matchesShortcut($i,o)?(this.clickAction(),!0):super.onKeyPress(o)}mustBeInToplevelMenu(){return!0}},sa=Gi;var _i=class extends Xe{constructor(o,e,r,n={}){super(o,"exit-button",()=>n.icon??o.icons.makeCloseIcon(),n.label??e.exit,r),this.setTags(["exit"])}shouldAutoDisableInReadOnlyEditor(){return!1}onKeyPress(o){return this.editor.shortcuts.matchesShortcut(Wi,o)?(this.clickAction(),!0):super.onKeyPress(o)}mustBeInToplevelMenu(){return!0}},aa=_i;var wt=class s{constructor(o,e){this.editor=o;this.#e=[];this.#t={};this.#o=[];this.#r=null;this.closeColorPickerOverlay=null;this.localizationTable=e??o.localization,s.colorisStarted||(ea(),s.colorisStarted=!0),this.setupColorPickers()}#e;#t;#o;static{this.colorisStarted=!1}#r;setupCloseColorPickerOverlay(){this.closeColorPickerOverlay||(this.closeColorPickerOverlay=document.createElement("div"),this.closeColorPickerOverlay.className=`${A}closeColorPickerOverlay`,this.editor.createHTMLOverlay(this.closeColorPickerOverlay),this.#e.push(this.editor.handlePointerEventsExceptClicksFrom(this.closeColorPickerOverlay,o=>(o==="pointerdown"&&Mi(),o==="pointerup"&&this.editor.focus(),!0))))}setupColorPickers(){if(this.#r){this.#r();return}this.setupCloseColorPickerOverlay();let o=12,e=[M.red.toHexString(),M.purple.toHexString(),M.blue.toHexString(),M.clay.toHexString(),M.black.toHexString(),M.white.toHexString()],r=e.length,n=!1,i=()=>{try{Js({el:".coloris_input",format:"hex",selectInput:!1,focusInput:!1,themeMode:"auto",swatches:e})}catch(l){console.warn("Failed to initialize Coloris. Error: ",l),n||(n=!0,document.addEventListener("load",()=>{i()},{once:!0}))}};i(),this.#r=i;let a=l=>{let c=!1;for(let d of e)d===l&&(c=!0);c||(e.push(l),e.length>o&&e.splice(r,1),i())};this.#e.push(this.editor.notifier.on(11,l=>{l.kind===11&&this.closeColorPickerOverlay&&(this.closeColorPickerOverlay.style.display=l.open?"block":"none")})),this.#e.push(this.editor.notifier.on(12,l=>{l.kind===12&&a(l.color.toHexString())}))}closeColorPickers(){Mi?.()}getWidgetUniqueId(o){return o.getUniqueIdIn(this.#t)}getWidgetFromId(o){return this.#t[o]}getAllWidgets(){return this.#o}addWidget(o){let e=o.getUniqueIdIn(this.#t);this.#t[e]=o,this.#o.push(o),this.addWidgetInternal(o),this.setupColorPickers()}removeWidget(o){let e=o.getUniqueIdIn(this.#t);this.removeWidgetInternal(o),delete this.#t[e],this.#o=this.#o.filter(r=>r!==o)}static{this.rootToolbarId="root-toolbar--"}serializeState(){let o={};for(let e in this.#t)o[e]=this.#t[e].serializeState();return o[s.rootToolbarId]=this.serializeInternal(),JSON.stringify(o)}deserializeState(o){let e=JSON.parse(o);Cr(e),hs(e);let r=s.rootToolbarId;r in e&&typeof e[r]<"u"&&this.deserializeInternal(e[r]);for(let n in e)if(n!==r){if(!(n in this.#t)){console.warn(`Unable to deserialize widget ${n} \xAD\u2014 no such widget.`);continue}typeof e[n]=="object"&&e[n]&&this.#t[n].deserializeFrom(e[n])}}serializeInternal(){}deserializeInternal(o){}makeActionButton(o,e,r=!0){typeof r=="boolean"&&(r={mustBeToplevel:r});let n=r.mustBeToplevel??!0,i=r.autoDisableInReadOnlyEditors??!0,a=typeof o=="string"?o:o.label,l="action-button",c=()=>typeof o=="string"?null:o.icon;return new Xe(this.editor,l,c,a,e,this.editor.localization,n,i)}addActionButton(o,e,r=!0){let n=this.makeActionButton(o,e,r);return this.addWidget(n),n}addTaggedActionButton(o,e,r,n=!0){let i=this.makeActionButton(e,r,n);return i.setTags(o),this.addWidget(i),i}addSaveButton(o,e={}){let r=new sa(this.editor,this.localizationTable,o,e);return this.addWidget(r),r}addExitButton(o,e={}){let r=new aa(this.editor,this.localizationTable,o,e);return this.addWidget(r),r}addUndoRedoButtons(o=!0){let e=()=>this.addTaggedActionButton(["undo"],{label:this.localizationTable.undo,icon:this.editor.icons.makeUndoIcon()},()=>{this.editor.history.undo()}),r=()=>this.addTaggedActionButton(["redo"],{label:this.localizationTable.redo,icon:this.editor.icons.makeRedoIcon()},()=>{this.editor.history.redo()}),n,i;o?(n=e(),i=r()):(i=r(),n=e()),n.setDisabled(!0),i.setDisabled(!0),this.editor.notifier.on(3,a=>{if(a.kind!==3)throw new Error("Wrong event type!");n.setDisabled(a.undoStackSize===0),i.setDisabled(a.redoStackSize===0)})}addWidgetsForPrimaryTools(o){for(let e of this.editor.toolController.getPrimaryTools())if(!(o&&!o?.(e)))if(e instanceof _e){let r=new uo(this.editor,e,this.localizationTable);this.addWidget(r)}else e instanceof mt?this.addWidget(new ho(this.editor,e,this.localizationTable)):e instanceof Ee?this.addWidget(new mo(this.editor,e,this.localizationTable)):e instanceof Ze?this.addWidget(new fo(this.editor,e,this.localizationTable)):e instanceof Ie&&this.addWidget(new go(this.editor,e,this.localizationTable))}addDefaultToolWidgets(){this.addWidgetsForPrimaryTools(),this.addDefaultEditorControlWidgets()}addDefaultEditorControlWidgets(){this.addWidget(new vo(this.editor,this.localizationTable)),this.addWidget(new bo(this.editor,this.localizationTable))}addDefaultActionButtons(){this.addUndoRedoButtons()}remove(){this.closeColorPickerOverlay?.remove();for(let o of this.#e)o.remove();this.#e=[],this.onRemove();for(let o of this.#o)o.remove()}manageListener(o){this.#e.push(o)}};var ji=s=>new yo(s,s.getRootElement(),s.localization),yo=class extends wt{constructor(e,r,n){super(e,n);this.clearDragListeners=null;this.toolbarContainer=document.createElement("div"),this.toolbarContainer.classList.add(`${A}root`),this.toolbarContainer.classList.add(`${A}element`),this.toolbarContainer.classList.add(`${A}edge-toolbar`),this.toolbarContainer.setAttribute("role","toolbar"),this.toolbarActionRow=document.createElement("div"),this.toolbarActionRow.classList.add("toolbar-element","toolbar-action-row"),this.toolbarToolRow=document.createElement("div"),this.toolbarToolRow.classList.add("toolbar-element","toolbar-tool-row"),po(this.toolbarToolRow),"ResizeObserver"in window?(this.toolRowResizeObserver=new ResizeObserver(a=>{this.onToolbarRowResize()}),this.toolRowResizeObserver.observe(this.toolbarToolRow)):console.warn("ResizeObserver not supported. Toolbar will not resize."),this.toolbarContainer.replaceChildren(this.toolbarActionRow,this.toolbarToolRow),r.appendChild(this.toolbarContainer),this.sidebarVisible=Y.fromInitialValue(!1),this.sidebarY=Y.fromInitialValue(0),this.menuContainer=document.createElement("div"),this.menuContainer.classList.add(`${A}edgemenu-container`),this.sidebarContainer=document.createElement("div"),this.sidebarContainer.classList.add(`${A}edgemenu`,`${A}element`),this.sidebarContainer.classList.add(`${A}tool-properties`),this.sidebarContent=document.createElement("div"),this.sidebarY.onUpdateAndNow(a=>{let l="dropdown-below-edge";a>0?(this.sidebarContainer.style.transform=`translate(0, ${a}px)`,this.sidebarContainer.style.paddingBottom="",this.menuContainer.classList.add(l)):(this.sidebarContainer.style.transform="",this.sidebarContainer.style.paddingBottom=`${-a}px`,this.menuContainer.classList.remove(l))}),this.closeButton=G(),this.closeButton.classList.add("drag-elem"),this.editor.handleKeyEventsFrom(this.closeButton,a=>a.code!=="Space"&&a.code!=="Enter"&&a.code!=="Tab"),this.sidebarContainer.addEventListener("keyup",a=>{!a.defaultPrevented&&a.code==="Escape"&&(this.sidebarVisible.set(!1),a.preventDefault())}),this.initDragListeners();let i=(...a)=>{this.sidebarContent.replaceChildren(...a),this.setupColorPickers()};this.sidebarTitle=de.fromInitialValue(""),this.layoutManager=new Xo(i,this.sidebarTitle,this.sidebarVisible,e.announceForAccessibility.bind(e),n),this.sidebarTitle.onUpdateAndNow(a=>{this.closeButton.setAttribute("aria-label",n.closeSidebar(a))}),this.listenForVisibilityChanges(),this.sidebarContainer.replaceChildren(this.closeButton,this.sidebarContent),this.menuContainer.replaceChildren(this.sidebarContainer),r.appendChild(this.menuContainer)}listenForVisibilityChanges(){let e=null,r=170;this.sidebarVisible.get()||(this.menuContainer.style.display="none",this.menuContainer.style.opacity="0");let n=window.matchMedia?.("(prefers-reduced-motion: reduce)")??"";this.sidebarVisible.onUpdate(i=>{let a=`${r}ms ease`,l=n.matches?"-reduce-motion":"";i?(this.sidebarY.set(this.snappedSidebarY()),e&&(clearTimeout(e),e=null),this.menuContainer.style.display="",this.sidebarContainer.style.animation=`${a} ${A}-edgemenu-transition-in${l}`,this.menuContainer.style.animation=`${a} ${A}-edgemenu-container-transition-in${l}`,this.menuContainer.style.opacity="1",this.closeButton.focus({preventScroll:!0})):(this.closeColorPickers(),e===null&&(this.sidebarContainer.style.animation=`${a} ${A}-edgemenu-transition-out${l}`,this.menuContainer.style.animation=`${a} ${A}-edgemenu-container-transition-out${l}`,this.menuContainer.style.opacity="0",this.editor.announceForAccessibility(this.localizationTable.dropdownHidden(this.sidebarTitle.get())),e=setTimeout(()=>{this.menuContainer.style.display="none",this.menuContainer.style.overflowY="",e=null},r)))})}onToolbarRowResize(){let e=()=>{let a=this.toolbarToolRow.clientWidth,l=0,c=0,d=0;for(let u of this.toolbarToolRow.children){let h=u.clientHeight;if(l+=h,d++,l>a){c=a-l+h/2,c<0&&(c+=h);break}}let p=Math.round(c/d*10)/10;this.toolbarToolRow.style.setProperty("--extra-left-right-padding",`${p}px`)},r=this.toolbarActionRow.getBoundingClientRect(),n=this.toolbarToolRow.getBoundingClientRect();r.y+r.height<=n.y?this.toolbarContainer.classList.remove("one-row"):this.toolbarContainer.classList.add("one-row"),this.toolbarToolRow.clientWidth<this.toolbarToolRow.scrollWidth?(this.toolbarToolRow.classList.add("has-scroll"),e()):this.toolbarToolRow.classList.remove("has-scroll","extra-padding")}addSpacer(e){}addUndoRedoButtons(){super.addUndoRedoButtons(!1)}addDefaults(){this.addDefaultActionButtons(),this.addDefaultToolWidgets()}updateWidgetCSSClasses(e){let r=e.getTags();e.removeCSSClassFromContainer("label-inline"),e.removeCSSClassFromContainer("label-left"),e.removeCSSClassFromContainer("label-right"),r.includes("save")&&(e.addCSSClassToContainer("label-inline"),e.addCSSClassToContainer("label-left")),r.includes("exit")&&(e.addCSSClassToContainer("label-inline"),e.addCSSClassToContainer("label-right"))}addWidgetInternal(e){this.updateWidgetCSSClasses(e),e.setLayoutManager(this.layoutManager),e.mustBeInToplevelMenu()?e.addTo(this.toolbarActionRow):e.addTo(this.toolbarToolRow)}removeWidgetInternal(e){e.remove()}onRemove(){this.toolbarContainer.remove(),this.menuContainer.remove(),this.toolRowResizeObserver.disconnect(),this.clearDragListeners?.()}initDragListeners(){let e=[this.closeButton,this.sidebarContainer,this.sidebarContent];this.manageListener(this.editor.handlePointerEventsExceptClicksFrom(this.menuContainer,(a,l)=>l.target===this.menuContainer?(a==="pointerdown"&&(this.sidebarVisible.set(!1),setTimeout(()=>this.editor.focus(),0)),!0):!this.sidebarVisible.get(),(a,l)=>l.target===this.menuContainer));let r=!0,n=0,i=sn(this.sidebarContainer,{draggableChildElements:e,onDrag:(a,l)=>this.handleDrag(a,l),onDragEnd:a=>{n=a.endTimestamp,r=a.roughlyClick,this.finalizeDrag()}});this.clearDragListeners=()=>i.removeListeners(),this.closeButton.onclick=()=>{let a=performance.now()-n<100;(a&&r||!a)&&this.sidebarVisible.set(!1)}}handleDrag(e,r){this.sidebarContainer.style.transition="none",this.sidebarY.set(this.sidebarY.get()+r)}snappedSidebarY(e){let r=e??this.sidebarY.get(),n=[-100,0];this.sidebarContainer.clientHeight>window.innerHeight&&n.push(100);let i=n[0];for(let a of n)Math.abs(a-r)<Math.abs(i-r)&&(i=a);return i}finalizeDrag(){this.sidebarContainer.style.transition="",this.sidebarY.get()>this.sidebarContainer.clientHeight/2?this.sidebarVisible.set(!1):this.sidebarY.set(this.snappedSidebarY())}serializeInternal(){return{menuSizeY:this.snappedSidebarY()}}deserializeInternal(e){typeof e=="object"&&typeof e.menuSizeY=="number"&&this.sidebarY.set(this.snappedSidebarY(e.menuSizeY))}};var or=class s extends Ae{constructor(e,r){super();this.shortcuts=e;this.viewport=r;this.snapToGridEnabled=!1;this.angleLockEnabled=!1;this.startPointCanvas=null}xyAxesSnap(e){if(!this.startPointCanvas)return e;let r=this.viewport.canvasToScreen(this.startPointCanvas);return e.lockedToXYAxesScreen(r,this.viewport)}mapPointerEvent(e){let r=n=>e.allPointers.length>1?n:this.snapToGridEnabled?n.snappedToGrid(this.viewport):this.angleLockEnabled&&this.startPointCanvas?this.xyAxesSnap(n):n;return{kind:e.kind,current:r(e.current),allPointers:e.allPointers.map(r)}}onEvent(e){let r=this.shortcuts;(e.kind===0||e.kind===1||e.kind===2)&&(e.kind===0&&(this.startPointCanvas=e.current.canvasPos),e=this.mapPointerEvent(e));let n=this.emit(e);if(e.kind===6||!n&&e.kind===5){let i=e.kind===5;r.matchesShortcut(_t,e)&&(this.snapToGridEnabled=i,n=!0),r.matchesShortcut(Yn,e)&&(this.angleLockEnabled=i,n=!0)}return n}static fromEditor(e){return new s(e.shortcuts,e.viewport)}};var la={Control:"ControlLeft","=":"Equal","-":"Minus",";":"Semicolon"," ":"Space"},Hc=s=>{let o=s.toUpperCase();return"A"<=o&&o<="Z"?`Key${o}`:"0"<=s&&s<="9"?`Digit${s}`:s in la?la[s]:s},ca=Hc;var Nc=(s,o)=>{let e=en(s,{title:s.localization.about,contentClassNames:["about-dialog-content"]});for(let r of o){let n=document.createElement(r.minimized?"details":"div");n.classList.add("about-entry");let i=document.createElement(r.minimized?"summary":"h2");if(typeof r.heading=="string")i.innerText=r.heading;else{let a=document.createElement("a");a.href=r.heading.href.replace(/^javascript:/i,""),a.text=r.heading.text,i.appendChild(a)}if(n.appendChild(i),r.text){let a=document.createElement("div");a.innerText=r.text,n.appendChild(a)}e.appendChild(n)}return{close:()=>e.close()}},da=Nc;var rr={number:"1.31.1"};var $c=(s,o,e)=>{let r=o.w,n=o.h;if(e?.minDimension&&r<e.minDimension){let i=e.minDimension;n*=i/(r||1),r=i}if(e?.minDimension&&n<e.minDimension){let i=e.minDimension;r*=i/(n||1),n=i}s.setAttribute("width",be(r)),s.setAttribute("height",be(n))},pa=$c;var ua=(s,o,e)=>{let r=s.getImportExportViewport().getTemporaryClone();if(e?.minDimension){let a=r.visibleRect,l=a;l.w<=0&&(l=new R(l.x,l.y,e.minDimension,l.h)),l.h<=0&&(l=new R(l.x,l.y,l.w,e.minDimension)),l.eq(a)||r.updateScreenSize(l.size)}let{element:n,renderer:i}=we.fromViewport(r,{sanitize:e.sanitize??!1,useViewBoxForPositioning:!0});return o(i,()=>{s.getAutoresizeEnabled()?n.classList.add(Gr):n.classList.remove(Gr);let a=r.visibleRect;return pa(n,a,e),n}),n},ha=(s,o)=>ua(s,(e,r)=>{s.renderAll(e),r()},o),ma=(s,o,e)=>new Promise(r=>{ua(s,async(n,i)=>{await s.renderAllAsync(n,o);let a=i();r(a)},e)});var Wc=(s,o)=>{let e=[],r=(c,d)=>c.key===d.key&&c.code===d.code,n=c=>e.some(d=>r(d,c)),i=c=>({code:c.code,key:c.key,ctrlKey:c.ctrlKey,altKey:c.altKey,shiftKey:c.shiftKey,metaKey:c.metaKey}),a=c=>{if(c.type==="keydown"){if(n(c)||e.push(i(c)),!o.filter(c))return;o.handleKeyDown(c)}else{if(console.assert(c.type==="keyup"),e=e.filter(d=>!r(d,c)),!o.filter(c))return;o.handleKeyUp(c)}};s.addEventListener("keydown",c=>{a(c)}),s.addEventListener("keyup",c=>{a(c)}),s.addEventListener("focusout",c=>{let d=!1;if(c.relatedTarget){let p=c.relatedTarget;d=s.contains(p)||o.getHandlesKeyEventsFrom(p)}if(!d){for(let p of e)o.handleKeyUp(new KeyboardEvent("keyup",{...p}));e=[]}});let l=c=>{let d=!1,p=!1,u=!1,h=!1;for(let v of e){let g=v.code;d||=!!g.match(/^Shift(Left|Right)$/),p||=!!g.match(/^Control(Left|Right)$/),u||=!!g.match(/^Alt(Left|Right)$/),h||=!!g.match(/^Meta(Left|Right)$/)}let f=v=>v?"keydown":"keyup",b={shiftKey:c.shiftKey,altKey:c.altKey,metaKey:c.metaKey,ctrlKey:c.ctrlKey};c.shiftKey!==d&&a(new KeyboardEvent(f(c.shiftKey),{...b,key:"Shift",code:"ShiftLeft"})),c.altKey!==u&&a(new KeyboardEvent(f(c.altKey),{...b,key:"Alt",code:"AltLeft"})),c.ctrlKey!==p&&a(new KeyboardEvent(f(c.ctrlKey),{...b,key:"Control",code:"ControlLeft"})),c.metaKey!==h&&a(new KeyboardEvent(f(c.metaKey),{...b,key:"Meta",code:"MetaLeft"}))};s.addEventListener("mousedown",c=>{l(c)}),s.addEventListener("mousemove",c=>{l(c)})},fa=Wc;var Uc=s=>(e=>e.replace(/([^\n])[\n]([^\n])/g,"$1 $2"))(`
MIT License

Copyright (c) ${s}

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.`),un=Uc;var nr=class extends Ae{constructor(){super();this.canShowContextMenu=!1;this.stationaryDetector=null;this.clickTolerance=12}canMakeLongPressMenuEvent(e){let r=[2];return e.allPointers.length===1&&r.includes(e.current.device)}onEvent(e){let r=()=>zo(e)&&this.canShowContextMenu&&this.emit({kind:9,screenPos:e.current.screenPos,canvasPos:e.current.canvasPos})?(this.emit({kind:3}),!0):!1;if(e.kind===0)e.allPointers.length===1?(this.canShowContextMenu=!0,this.contextMenuTriggerPointer=e.current,this.contextMenuStartPoint=e.current.screenPos,this.canMakeLongPressMenuEvent(e)&&(this.stationaryDetector=new zt(e.current,Wr,r))):this.canShowContextMenu=!1;else if(e.kind===1){if(this.canShowContextMenu){this.stationaryDetector?.onPointerMove(e.current);let n=e.current.screenPos.minus(this.contextMenuStartPoint),i=this.clickTolerance;n.length()>i&&(this.canShowContextMenu=!1)}}else if(e.kind===2&&(this.stationaryDetector?.destroy(),this.contextMenuTriggerPointer?.id===e.current.id&&this.contextMenuTriggerPointer.device===4&&r()))return!0;return this.emit(e)}};var Zi=class{constructor(o,e={}){this.eventListenerTargets=[];this.previousAccessibilityAnnouncement="";this.pointers={};this.announceUndoCallback=o=>{this.announceForAccessibility(this.localization.undoAnnouncement(o.description(this,this.localization)))};this.announceRedoCallback=o=>{this.announceForAccessibility(this.localization.redoAnnouncement(o.description(this,this.localization)))};this.nextRerenderListeners=[];this.rerenderQueued=!1;this.closeAboutDialog=null;if(this.localization={...Vn(),...e.localization},this.settings={wheelEventsEnabled:e.wheelEventsEnabled??!0,renderingMode:e.renderingMode??1,localization:this.localization,minZoom:e.minZoom??2e-10,maxZoom:e.maxZoom??1e12,keyboardShortcutOverrides:e.keyboardShortcutOverrides??{},iconProvider:e.iconProvider??new Ye,notices:e.notices??[],appInfo:e.appInfo?{...e.appInfo}:null,pens:{additionalPenTypes:e.pens?.additionalPenTypes??[],filterPenTypes:e.pens?.filterPenTypes??(()=>!0)},text:{fonts:e.text?.fonts??["sans-serif","serif","monospace"]},image:{showImagePicker:e.image?.showImagePicker??void 0},svg:{loaderPlugins:e.svg?.loaderPlugins??[]},clipboardApi:e.clipboardApi??null},this.settings.minZoom>this.settings.maxZoom)throw new Error("Minimum zoom must be lesser than maximum zoom!");this.readOnly=de.fromInitialValue(!1),this.icons=this.settings.iconProvider,this.shortcuts=new H(this.settings.keyboardShortcutOverrides),this.container=document.createElement("div"),this.renderingRegion=document.createElement("div"),this.container.appendChild(this.renderingRegion),this.container.classList.add("imageEditorContainer","js-draw"),this.loadingWarning=document.createElement("div"),this.loadingWarning.classList.add("loadingMessage"),this.loadingWarning.ariaLive="polite",this.container.appendChild(this.loadingWarning),this.accessibilityControlArea=document.createElement("textarea"),this.accessibilityControlArea.setAttribute("placeholder",this.localization.accessibilityInputInstructions),this.accessibilityControlArea.style.opacity="0",this.accessibilityControlArea.style.width="0",this.accessibilityControlArea.style.height="0",this.accessibilityControlArea.style.position="absolute",this.accessibilityAnnounceArea=document.createElement("div"),this.accessibilityAnnounceArea.setAttribute("aria-live","assertive"),this.accessibilityAnnounceArea.className="accessibilityAnnouncement",this.container.appendChild(this.accessibilityAnnounceArea),this.renderingRegion.style.touchAction="none",this.renderingRegion.className="imageEditorRenderArea",this.renderingRegion.appendChild(this.accessibilityControlArea),this.renderingRegion.setAttribute("tabIndex","0"),this.renderingRegion.setAttribute("alt",""),this.notifier=new Be,this.viewport=new q((r,n)=>{this.notifier.dispatch(7,{kind:7,newTransform:n,oldTransform:r})}),this.display=new co(this,this.settings.renderingMode,this.renderingRegion),this.image=new X,this.history=new ki(this,this.announceRedoCallback,this.announceUndoCallback),this.toolController=new ao(this,this.localization),this.toolController.addInputMapper(or.fromEditor(this)),this.toolController.addInputMapper(new nr),o.appendChild(this.container),this.viewport.updateScreenSize(T.of(this.display.width,this.display.height)),this.registerListeners(),this.queueRerender(),this.hideLoadingWarning(),this.notifier.on(7,r=>{if(r.kind!==7)return;let n=a=>a.transformVec3(T.unitX).length(),i=n(r.newTransform);if(i>this.settings.maxZoom||i<this.settings.minZoom){let a=n(r.oldTransform),l=k.identity;a<=this.settings.maxZoom&&a>=this.settings.minZoom?l=r.oldTransform:l=k.scaling2D((this.settings.minZoom+this.settings.maxZoom)/2),this.viewport.resetTransform(l)}else isFinite(i)||(console.warn(`Non-finite zoom (${i}) detected. Resetting the viewport. This was likely caused by division by zero.`),isFinite(n(r.oldTransform))?this.viewport.resetTransform(r.oldTransform):this.viewport.resetTransform())})}getCurrentSettings(){return{...this.settings}}getRootElement(){return this.container}getOutputBBoxInDOM(){return R.of(this.renderingRegion.getBoundingClientRect())}showLoadingWarning(o){let e=Math.round(o*100);this.loadingWarning.innerText=this.localization.loading(e),this.loadingWarning.style.display="block"}hideLoadingWarning(){this.loadingWarning.style.display="none",this.announceForAccessibility(this.localization.doneLoading)}announceForAccessibility(o){o===this.previousAccessibilityAnnouncement&&(o=o+". "),this.accessibilityAnnounceArea.innerText=o,this.previousAccessibilityAnnouncement=o}addToolbar(o=!0){let e=new yo(this,this.container,this.localization);return o&&e.addDefaults(),e}registerListeners(){this.handlePointerEventsFrom(this.renderingRegion),this.handleKeyEventsFrom(this.renderingRegion),this.handlePointerEventsFrom(this.accessibilityAnnounceArea);let o=[this.renderingRegion,this.accessibilityAnnounceArea,this.accessibilityControlArea,this.loadingWarning];for(let n of o)n.addEventListener("drag",i=>(i.preventDefault(),!1)),n.addEventListener("dragstart",i=>(i.preventDefault(),!1));this.container.addEventListener("wheel",n=>{this.handleHTMLWheelEvent(n)});let e=()=>{this.viewport.updateScreenSize(T.of(this.display.width,this.display.height)),this.rerender(),this.updateEditorSizeVariables()};if("ResizeObserver"in window){let n=new ResizeObserver(e);n.observe(this.renderingRegion),n.observe(this.container)}else addEventListener("resize",e);this.accessibilityControlArea.addEventListener("input",()=>{this.accessibilityControlArea.value=""});let r=new Oe(this);document.addEventListener("copy",async n=>{this.isEventSink(document.querySelector(":focus"))&&r.copy(n)}),document.addEventListener("paste",n=>{this.handlePaste(n)})}updateEditorSizeVariables(){this.container.style.setProperty("--editor-current-width-px",`${this.container.clientWidth}px`),this.container.style.setProperty("--editor-current-height-px",`${this.container.clientHeight}px`),this.container.style.setProperty("--editor-current-display-width-px",`${this.renderingRegion.clientWidth}px`),this.container.style.setProperty("--editor-current-display-height-px",`${this.renderingRegion.clientHeight}px`)}handleHTMLWheelEvent(o){let e=N.of(o.deltaX,o.deltaY,o.deltaZ);if(!o.ctrlKey&&!o.metaKey)if(this.settings.wheelEventsEnabled){if(this.settings.wheelEventsEnabled==="only-if-focused"&&!this.container.querySelector(":focus"))return}else return;o.deltaMode===WheelEvent.DOM_DELTA_LINE?e=e.times(15):o.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e=e.times(100)),(o.ctrlKey||o.metaKey)&&(e=N.of(0,0,o.deltaY));let r=this.getOutputBBoxInDOM(),n=T.of(o.clientX,o.clientY).minus(r.topLeft);return this.toolController.dispatchInputEvent({kind:4,delta:e,screenPos:n})?(o.preventDefault(),!0):!1}getPointerList(){let o=performance.now(),e=[];for(let r in this.pointers)this.pointers[r]&&o-this.pointers[r].timeStamp<2e3&&e.push(this.pointers[r]);return e}setPointerCapture(o,e){if(!("__mockEvent"in e))try{o.setPointerCapture(e.pointerId)}catch(r){console.warn("Failed to setPointerCapture",r)}}releasePointerCapture(o,e){if(!("__mockEvent"in e))try{o.releasePointerCapture(e.pointerId)}catch(r){console.warn("Failed to releasePointerCapture",r)}}handleHTMLPointerEvent(o,e){let r=this.renderingRegion,n=e.target??this.renderingRegion;if(this.display.onPointerEvent(e),o==="pointerdown"){let i=Ue.ofEvent(e,!0,this.viewport,r);this.pointers[i.id]=i,this.setPointerCapture(n,e);let a={kind:0,current:i,allPointers:this.getPointerList()};return this.toolController.dispatchInputEvent(a),!0}else if(o==="pointermove"){let i=Ue.ofEvent(e,this.pointers[e.pointerId]?.down??!1,this.viewport,r);if(i.down){let a=this.pointers[i.id];if(a&&i.screenPos.distanceTo(a.screenPos)<2)return!1;this.pointers[i.id]=i,this.toolController.dispatchInputEvent({kind:1,current:i,allPointers:this.getPointerList()})&&e.preventDefault()}return!0}else if(o==="pointercancel"||o==="pointerup"){let i=Ue.ofEvent(e,!1,this.viewport,r);return this.pointers[i.id]?(this.pointers[i.id]=i,this.releasePointerCapture(n,e),this.toolController.dispatchInputEvent({kind:2,current:i,allPointers:this.getPointerList()})&&e.preventDefault(),delete this.pointers[i.id],!0):!1}return o}isEventSink(o){let e=o;for(;e!==null;){for(let r of this.eventListenerTargets)if(r===e)return!0;e=e.parentElement}return!1}async handleDrop(o){o.preventDefault(),await this.handlePaste(o)}async handlePaste(o){let e=document.querySelector(":focus")??o.target;if(this.isEventSink(e))return await new Oe(this).paste(o)}handlePointerEventsFrom(o,e,r){let a={touchstart:c=>{r&&!r("touchstart",c)||c.preventDefault()},contextmenu:c=>{r&&!r("contextmenu",c)||c.preventDefault()}},l=["pointerdown","pointermove","pointerup","pointercancel"];for(let c of l)a[c]=d=>{let p=d;if(!(e&&!e(c,p)))return this.handleHTMLPointerEvent(c,p)};for(let c in a)o.addEventListener(c,a[c]);return{remove:()=>{for(let c in a)o.removeEventListener(c,a[c])}}}handlePointerEventsExceptClicksFrom(o,e,r){let n=Object.create(null);return this.handlePointerEventsFrom(o,(i,a)=>{if(e&&!e(i,a))return!1;let l=T.of(a.pageX??a.clientX,a.pageY??a.clientY),c=a.pointerId??0,d=!0;if(i==="pointerdown")n[c]={eventBuffer:[[i,a]],startPoint:l,hasMovedSignificantly:!1},this.setPointerCapture(o,a),d=!1;else if(i==="pointermove"&&n[c]){let p=n[c].startPoint,u=n[c].eventBuffer;if(p&&l.distanceTo(p)<10&&!n[c].hasMovedSignificantly)u.push([i,a]),d=!1;else{for(let[b,v]of u)this.handleHTMLPointerEvent(b,v);n[c].eventBuffer=[],n[c].hasMovedSignificantly=!0,d=!0}}else i==="pointermove"?d=!0:(i==="pointerup"||i==="pointercancel")&&n[c]&&n[c].eventBuffer.length>0&&(this.releasePointerCapture(o,a),d=!1,delete n[c]);return d},r)}handleHTMLKeyDownEvent(o){console.assert(o.type==="keydown",`handling a keydown event with type ${o.type}`);let e=Lr(o);return this.toolController.dispatchInputEvent(e)?(o.preventDefault(),!0):e.key==="t"||e.key==="T"?(o.preventDefault(),this.display.rerenderAsText(),!0):e.key==="Escape"?(this.renderingRegion.blur(),!0):!1}handleHTMLKeyUpEvent(o){console.assert(o.type==="keyup",`Handling a keyup event with type ${o.type}`);let e=kr(o);return this.toolController.dispatchInputEvent(e)?(o.preventDefault(),!0):!1}handleKeyEventsFrom(o,e=()=>!0){fa(o,{filter:e,handleKeyDown:r=>{this.handleHTMLKeyDownEvent(r)},handleKeyUp:r=>{this.handleHTMLKeyUpEvent(r)},getHandlesKeyEventsFrom:r=>this.eventListenerTargets.includes(r)}),o.ondragover=r=>{r.preventDefault()},o.ondrop=r=>{this.handleDrop(r)},this.eventListenerTargets.push(o)}setReadOnly(o){o!==this.readOnly.get()&&(this.readOnly.set(o),this.notifier.dispatch(10,{kind:10,editorIsReadOnly:o}))}isReadOnlyReactiveValue(){return this.readOnly}isReadOnly(){return this.readOnly}dispatch(o,e=!0){let r=this.dispatchNoAnnounce(o,e),n=o.description(this,this.localization);return this.announceForAccessibility(n),r}dispatchNoAnnounce(o,e=!1){let r=o.apply(this);return e&&this.history.push(o,!1),r}async asyncApplyOrUnapplyCommands(o,e,r){console.assert(r>0),this.display.setDraftMode(!0);for(let n=0;n<o.length;n+=r){this.showLoadingWarning(n/o.length);for(let i=n;i<o.length&&i<n+r;i++){let a=o[i];e?a.apply(this):a.unapply(this)}n+r<o.length&&await new Promise(i=>{this.rerender(),requestAnimationFrame(i)})}this.display.setDraftMode(!1),this.hideLoadingWarning()}asyncApplyCommands(o,e){return this.asyncApplyOrUnapplyCommands(o,!0,e)}asyncUnapplyCommands(o,e,r=!1){return r&&(o=[...o],o.reverse()),this.asyncApplyOrUnapplyCommands(o,!1,e)}queueRerender(){return this.rerenderQueued||(this.rerenderQueued=!0,requestAnimationFrame(()=>{this.rerenderQueued&&(this.rerender(),this.rerenderQueued=!1)})),new Promise(o=>{this.nextRerenderListeners.push(()=>o())})}isRerenderQueued(){return this.rerenderQueued}rerender(o=!0){if(this.display.startRerender(),this.display.width===0||this.display.height===0)return;let e=this.display.getDryInkRenderer();if(this.image.renderWithCache(e,this.display.getCache(),this.viewport),o&&!this.image.getAutoresizeEnabled()){let r={fill:M.fromHex("#44444455")},n=5*this.viewport.getSizeOfPixelOnCanvas();e.drawRect(this.getImportExportRect(),n,r)}this.rerenderQueued=!1,this.nextRerenderListeners.forEach(r=>r()),this.nextRerenderListeners=[]}drawWetInk(...o){for(let e of o)this.display.getWetInkRenderer().drawPath(e)}clearWetInk(){this.display.getWetInkRenderer().clear()}focus(){this.renderingRegion.focus()}createHTMLOverlay(o){return o.classList.add("overlay","js-draw-editor-overlay"),this.container.appendChild(o),{remove:()=>o.remove()}}anchorElementToCanvas(o,e){e instanceof k&&(e=Rr.fromImmutable(e));let r=document.createElement("div");r.classList.add("anchored-element-overlay");let n=document.createElement("div");n.classList.add("content-wrapper"),o.classList.add("content");let i=()=>{let p=e.get().transformVec3(T.unitX).angle()+this.viewport.getRotationAngle(),u=this.viewport.canvasToScreenTransform.rightMul(e.get());r.style.setProperty("--full-transform",u.toCSSMatrix());let h=u.transformVec2(T.zero);r.style.setProperty("--position-x",`${h.x}px`),r.style.setProperty("--position-y",`${h.y}px`),r.style.setProperty("--rotation",`${p*180/Math.PI}deg`),r.style.setProperty("--scale",`${u.getScaleFactor()}`)};i();let a=e.onUpdate(i),l=this.notifier.on(7,i);return n.appendChild(o),r.appendChild(n),r.classList.add("overlay","js-draw-editor-overlay"),this.renderingRegion.insertAdjacentElement("afterend",r),{remove:()=>{r.remove(),a.remove(),l.remove()}}}addStyleSheet(o){let e=document.createElement("style");return e.innerText=o,this.container.appendChild(e),e}sendKeyboardEvent(o,e,r=!1,n=!1,i=void 0){i??=e.toUpperCase()===e&&e.toLowerCase()!==e,this.toolController.dispatchInputEvent({kind:o,key:e,code:ca(e),ctrlKey:r,altKey:n,shiftKey:i})}sendPenEvent(o,e,r){Ri(this,o,e,r)}async addAndCenterComponents(o,e=!0,r){let n=null;for(let h of o)n?n=n.union(h.getBBox()):n=h.getBBox();if(!n)return;let i=this.viewport.visibleRect,a=i.width/n.width,l=i.height/n.height,c=a;(n.width*c>i.width||n.height*c>i.height)&&(c=l),c*=2/3,c=q.roundScaleRatio(c);let d=k.translation(i.center.minus(n.center)).rightMul(k.scaling2D(c,n.center)),p=[];for(let h of o)p.push(X.addComponent(h)),p.push(h.transformBy(d));if(await this.dispatch(he(p,{applyChunkSize:100,description:r}),!0),e)for(let h of this.toolController.getMatchingTools(Ee))h.setEnabled(!0),h.setSelection(o)}toDataURL(o="image/png",e){let{element:r,renderer:n}=Re.fromViewport(this.image.getImportExportViewport(),{canvasSize:e});return this.image.renderAll(n),r.toDataURL(o)}toSVG(o){return ha(this.image,o??{})}async toSVGAsync(o={}){let e=o.pauseAfterCount??100;return await ma(this.image,async(r,n,i)=>o.onProgress&&await o.onProgress(n,i)===!1?!1:(n%e===0&&await tt(),!0),{minDimension:o.minDimension})}async loadFrom(o){this.showLoadingWarning(0),this.display.setDraftMode(!0);let e=this.image.getBackgroundComponents(),r=new ie(e);await o.start(async n=>{await this.dispatchNoAnnounce(X.addComponent(n))},(n,i)=>n%500===0?(this.showLoadingWarning(n/i),this.rerender(),tt()):null,(n,i)=>{this.dispatchNoAnnounce(this.setImportExportRect(n),!1),this.dispatchNoAnnounce(this.viewport.zoomTo(n),!1),i&&this.dispatchNoAnnounce(this.image.setAutoresizeEnabled(i.autoresize),!1)}),this.image.getBackgroundComponents().length!==e.length&&await this.dispatchNoAnnounce(r),this.hideLoadingWarning(),this.display.setDraftMode(!1),this.queueRerender()}getTopmostBackgroundComponent(){let o=null;for(let e of this.image.getBackgroundComponents())e instanceof me&&(o=e);return o}setBackgroundStyle(o){let e=this.getTopmostBackgroundComponent(),r=[];e&&r.push(new ie([e]));let n=e?.getBackgroundType?.()??2,i=e?.getStyle?.().color??M.transparent,a=this.image.getAutoresizeEnabled(),l=o.color&&n===2?0:n,c=o.type??l,d=o.color??i,p=o.autoresize??a;if(c!==2){let u=new me(c,d);r.push(X.addComponent(u))}return p!==a&&(r.push(this.image.setAutoresizeEnabled(p)),!p&&this.image.getImportExportRect().maxDimension===0&&r.push(this.image.setImportExportRect(this.image.getImportExportRect().resizedTo(T.of(500,500))))),he(r)}setBackgroundColor(o){let e=this.getTopmostBackgroundComponent();if(e)return e.updateStyle({color:o});{let r=o.eq(M.transparent)?2:0;return e=new me(r,o),this.image.addComponent(e)}}estimateBackgroundColor(){let o=[];for(let e of this.image.getBackgroundComponents())e instanceof me&&o.push(e.getStyle().color??M.transparent);return M.average(o)}getImportExportRect(){return this.image.getImportExportViewport().visibleRect}setImportExportRect(o){return this.image.setImportExportRect(o)}async loadFromSVG(o,e=!1){let r=ft.fromString(o,{sanitize:e,plugins:this.getCurrentSettings().svg?.loaderPlugins});await this.loadFrom(r)}showAboutDialog(){let o=this.icons.licenseInfo(),e=[];if(this.settings.appInfo){let n=[];this.settings.appInfo.version&&n.push(`v${this.settings.appInfo.version}`,""),this.settings.appInfo.description?n.push(this.settings.appInfo.description+`
`):n.push(`js-draw v${rr.number}`),e.push({heading:`${this.settings.appInfo.name}`,text:n.join(`
`)})}else e.push({heading:"js-draw",text:`v${rr.number}`});let r=this.viewport.getScreenRectSize();e.push({heading:this.localization.developerInformation,text:["Image debug information (from when this dialog was opened):",`    ${this.viewport.getScaleFactor()}x zoom, ${180/Math.PI*this.viewport.getRotationAngle()}\xB0 rotation`,`    ${this.image.estimateNumElements()} components`,`    auto-resize: ${this.image.getAutoresizeEnabled()?"enabled":"disabled"}`,`    image size: ${this.getImportExportRect().w}x${this.getImportExportRect().h}`,`    screen size: ${r.x}x${r.y}`,`    device pixel ratio: ${this.display.getDevicePixelRatio()}`,"    cache:",`        ${this.display.getCache().getDebugInfo().replace(/([\n])/g,`
        `)}`].join(`
`),minimized:!0}),e.push({heading:this.localization.softwareLibraries,text:[`This image editor is powered by js-draw v${rr.number}.`,"","At runtime, js-draw uses"," - The Coloris color picker: https://github.com/mdbassit/Coloris"," - The bezier.js B\xE9zier curve library: https://github.com/Pomax/bezierjs","","Both are licensed under the MIT license:","","","== Coloris ==",un("2021 Mohammed Bassit"),"","","== Bezier.js ==",un('2023 Mike "Pomax" Kamermans'),"","","== js-draw ==",un("2023-2025 Henry Heino"),""].join(`
`),minimized:!0}),o&&e.push({heading:"Icon Pack",text:o,minimized:!0}),e.push(...this.settings.notices),this.closeAboutDialog?.(),this.closeAboutDialog=da(this,e).close}remove(){this.container.remove(),this.toolController.onEditorDestroyed()}},Yi=Zi;var Kc=s=>s instanceof K?new class extends K{constructor(){super(...arguments);this._command=s}serializeToJSON(){return s.serialize()}apply(e){s.unapply(e)}unapply(e){s.apply(e)}onDrop(e){s.onDrop(e)}description(e,r){return r.inverseOf(s.description(e,r))}}("inverse"):new class extends Ne{apply(e){s.unapply(e)}unapply(e){s.apply(e)}onDrop(e){s.onDrop(e)}description(e,r){return r.inverseOf(s.description(e,r))}};K.register("inverse",(s,o)=>Kc(K.deserialize(s,o)));var ir=class extends pe{constructor(e,r){super(e,"overflow-widget",r);this.overflowChildren=[];this.container.classList.add("toolbar-overflow-widget"),this.container.classList.add("dropdownShowable"),this.overflowContainer??=document.createElement("div")}shouldAutoDisableInReadOnlyEditor(){return!1}getTitle(){return this.localizationTable.toggleOverflow}createIcon(){return this.editor.icons.makeOverflowIcon()}handleClick(){this.setDropdownVisible(!this.isDropdownVisible())}fillDropdown(e){return this.overflowContainer??=document.createElement("div"),this.overflowContainer.parentElement&&this.overflowContainer.remove(),this.overflowContainer.classList.add("toolbar-overflow-widget-overflow-list"),e.appendChild(this.overflowContainer),!0}clearChildren(){this.overflowContainer.replaceChildren(),this.container.classList.remove("horizontal");let e=this.overflowChildren;return this.overflowChildren=[],e}getChildWidgets(){return[...this.overflowChildren]}hasAsChild(e){for(let r of this.overflowChildren)if(e===r)return!0;return!1}addToOverflow(e){this.overflowChildren.push(e),e.addTo(this.overflowContainer),e.setIsToplevel(!1),this.overflowChildren.length>2&&this.container.classList.add("horizontal")}canBeInOverflowMenu(){return!1}};var Xi=s=>new hn(s,s.getRootElement(),s.localization),hn=class extends wt{constructor(e,r,n){super(e,n);this.widgetOrderCounter=0;this.overflowWidget=null;this.reLayoutQueued=!1;this.container=document.createElement("div"),this.container.classList.add(`${A}root`),this.container.classList.add(`${A}element`),this.container.classList.add(`${A}dropdown-toolbar`),this.container.setAttribute("role","toolbar"),r.appendChild(this.container),"ResizeObserver"in window?(this.resizeObserver=new ResizeObserver(i=>{this.reLayout()}),this.resizeObserver.observe(this.container)):console.warn("ResizeObserver not supported. Toolbar will not resize.")}queueReLayout(){this.reLayoutQueued||(this.reLayoutQueued=!0,requestAnimationFrame(()=>this.reLayout()))}reLayout(){if(this.reLayoutQueued=!1,!this.overflowWidget)return;let e=d=>{let p=0;for(let u of d)u.isHidden()||(p+=u.getButtonWidth());return p},r=d=>{let p=this.overflowWidget?.getChildWidgets()??[];return p.length===0?!1:p[0].getButtonWidth()<=d},n=this.getAllWidgets(),i=e(this.overflowWidget.getChildWidgets()),a=e(n)-i,l=this.container.clientWidth*.87;window.innerHeight>l*1.75&&(l*=1.75);let c=!1;if(r(l-a)){let d=this.overflowWidget.clearChildren();for(let p of d)p.addTo(this.container),p.setIsToplevel(!0),p.isHidden()||(a+=p.getButtonWidth());i=0,c=!0}if(a>=l){for(let d=n.length-1;d>=0&&a>=l;d--){let p=n[d];this.overflowWidget.hasAsChild(p)||p.canBeInOverflowMenu()&&(a-=p.getButtonWidth(),this.overflowWidget.addToOverflow(p))}c=!0}this.overflowWidget.setHidden(this.overflowWidget.getChildWidgets().length===0),c&&this.setupColorPickers()}addWidgetInternal(e){let r=e.addTo(this.container);r.style.order=`${this.widgetOrderCounter++}`,this.queueReLayout()}removeWidgetInternal(e){e.remove(),this.queueReLayout()}addSpacer(e={}){let r=document.createElement("div");r.classList.add(`${A}spacer`),e.grow&&(r.style.flexGrow=`${e.grow}`),e.minSize&&(r.style.minWidth=e.minSize),e.maxSize&&(r.style.maxWidth=e.maxSize),r.style.order=`${this.widgetOrderCounter++}`,this.container.appendChild(r)}addOverflowWidget(){this.overflowWidget=new ir(this.editor,this.localizationTable),this.addWidget(this.overflowWidget)}addDefaults(){this.addDefaultToolWidgets(),this.addOverflowWidget(),this.addDefaultActionButtons()}onRemove(){this.container.remove(),this.resizeObserver.disconnect()}};(()=>{if(typeof document<"u"&&typeof document.createElement=="function"){let s=document.createElement("style");s.textContent='\uFEFF:root .insert-image-widget-dropdown-content.insert-image-widget-dropdown-content.insert-image-widget-dropdown-content>div>div{padding:5px}:root .insert-image-widget-dropdown-content.insert-image-widget-dropdown-content.insert-image-widget-dropdown-content>div{min-height:0}:root .insert-image-widget-dropdown-content.insert-image-widget-dropdown-content.insert-image-widget-dropdown-content img{max-width:100%;max-height:100%;display:block;margin-left:auto;margin-right:auto}:root .insert-image-widget-dropdown-content.insert-image-widget-dropdown-content.insert-image-widget-dropdown-content .insert-image-image-status-view{display:flex;justify-content:space-between;padding-bottom:0}:root .insert-image-widget-dropdown-content.insert-image-widget-dropdown-content.insert-image-widget-dropdown-content .action-button-row{margin-top:4px;display:flex;flex-direction:row;justify-content:flex-end;padding-bottom:0;margin-bottom:0}:root .insert-image-widget-dropdown-content.insert-image-widget-dropdown-content.insert-image-widget-dropdown-content .action-button-row>button{flex-grow:1;text-align:end;max-width:50%;min-width:min(100%,40px)}.toolbar-overflow-widget-overflow-list{display:flex;flex-direction:column;flex-wrap:wrap;justify-content:center}.toolbar-overflow-widget-overflow-list>.toolbar-toolContainer>.toolbar-button{height:var(--toolbar-button-height)}.toolbar-overflow-widget.horizontal .toolbar-overflow-widget-overflow-list{flex-direction:row}.toolbar-overflow-widget.horizontal>.toolbar-dropdown{max-width:100%;left:15px;right:15px;margin-left:0 !important;translate:none !important;padding:4px}:root .toolbar--pen-tool-toggle-buttons.toolbar--pen-tool-toggle-buttons{display:flex;flex-wrap:wrap;justify-content:stretch;padding-top:0;padding-bottom:5px;gap:5px;direction:ltr}:root .toolbar--pen-tool-toggle-buttons.toolbar--pen-tool-toggle-buttons>*{flex-grow:1;text-align:start;width:min-content}:root .toolbar--pen-tool-toggle-buttons.toolbar--pen-tool-toggle-buttons>*>.icon{margin-inline-start:6px;margin-inline-end:10px}:root .toolbar--pen-tool-toggle-buttons.toolbar--pen-tool-toggle-buttons>:nth-child(2){text-align:center}:root .toolbar--pen-tool-toggle-buttons.toolbar--pen-tool-toggle-buttons>:nth-child(3){direction:rtl}.toolbar-zoomLevelEditor{display:flex;flex-direction:row;align-items:center}.toolbar-zoomLevelEditor .zoomDisplay{flex-grow:1}.toolbar-zoomLevelEditor button{min-width:48px}.selection-format-menu.disabled{opacity:.5}.toolbar-document-properties-widget button.about-button{width:100%;text-align:end}.toolbar-document-properties-widget>*{--align-items-to-x: 120px}.toolbar-document-properties-widget .js-draw-size-input-row.js-draw-size-input-row{display:flex}.toolbar-document-properties-widget .js-draw-size-input-row.js-draw-size-input-row.size-input-row--automatic-size{display:none}.toolbar-thicknessSliderContainer{display:flex;flex-direction:row}.toolbar-thicknessSliderContainer input{flex-grow:1}.toolbar-element .clr-field *{cursor:pointer}.toolbar-element .clr-field button{width:1.2em;height:1.2em;top:50%;left:0;border-radius:50%;margin-left:0;margin-right:0}.toolbar-element .clr-field input{opacity:0}.color-input-container{display:inline-flex;flex-direction:row}.color-input-container .coloris_input{height:calc(100% - 6px)}.color-input-container.picker-open .clr-field{pointer-events:none}:root .color-input-container>button.pipetteButton{width:30px;height:30px;padding:0;display:inline-flex}.color-input-container>.color-input-wrapper{display:flex;justify-content:stretch}.color-input-container .pipetteButton>svg{width:100%}.color-input-container .pipetteButton .pickColorInstructions{display:none;font-size:1em;position:absolute;margin-left:30px;background-color:var(--background-color-1);border-radius:30px;padding:4px;opacity:0;transition:.2s ease opacity}@media(prefers-reduced-motion: reduce){.color-input-container .pipetteButton .pickColorInstructions{transition:none}}.color-input-container .pipetteButton.active{background-color:var(--selection-background-color);--icon-color: var(--selection-foreground-color)}.color-input-container .pipetteButton.active .pickColorInstructions{display:block;opacity:.8}.tool-dropdown-separator{--border-color: rgba(100, 100, 100, 0.2);--border-color: color-mix(in srgb, var(--foreground-color-1), rgba(0, 0, 0, 0) 80%);border-top:1px solid var(--border-color);padding-left:2px;margin-top:10px;margin-bottom:10px}.toolbar-element .toolbar--file-input-container{display:flex}.toolbar-element .toolbar--file-input-container.-loading{opacity:.8}.toolbar-element .toolbar--file-input-container>input.file-input{opacity:0;width:0;min-width:0 !important;max-width:0;height:0;overflow:hidden;padding:0;margin:0}.toolbar-element .toolbar--file-input-container>label{display:block;flex-grow:1;padding:0 !important;padding-bottom:5px;--active-border-color: rgba(100, 100, 100, 0.5);--active-border-color: color-mix(in srgb, var(--foreground-color-1), transparent)}.toolbar-element .toolbar--file-input-container>label .cancel-button{padding-left:3px;padding-right:3px}.toolbar-element .toolbar--file-input-container>label>.toolbar--file-input-description{background-color:var(--background-color-3);color:var(--foreground-color-3);border:1px dashed var(--active-border-color);padding:10px;margin-top:10px;display:flex;flex-direction:column;align-items:center;text-align:center;--action-color: var(--primary-action-foreground-color);--icon-color: var(--action-color)}.toolbar-element .toolbar--file-input-container>label>.toolbar--file-input-description>span{white-space:pre-wrap}.toolbar-element .toolbar--file-input-container>label>.toolbar--file-input-description>span>b{color:var(--action-color);cursor:pointer}.toolbar-element .toolbar--file-input-container>label>.toolbar--file-input-description>.icon{width:min(50vw,42px);height:min(50vw,42px);margin-bottom:8px;display:block}.toolbar-element .toolbar--file-input-container>label:active,.toolbar-element .toolbar--file-input-container>label:hover,.toolbar-element .toolbar--file-input-container>label.drag-target{--active-border-color: var(--foreground-color-1)}.toolbar-element .toolbar--file-input-container>label.drag-target>.toolbar--file-input-description{border-width:2px}.toolbar-grid-selector{position:relative}.toolbar-grid-selector>div{display:flex;flex-direction:row;max-width:350px;flex-wrap:wrap;--button-size: 48px}.toolbar-grid-selector .choice-button{display:flex;flex-direction:column-reverse;box-sizing:border-box;cursor:pointer;flex-shrink:1;margin:2px}.toolbar-grid-selector .choice-button.focus-visible{outline:2px solid var(--foreground-color-1)}.toolbar-grid-selector .choice-button input{opacity:0;height:0}.toolbar-grid-selector .choice-button label{display:flex;flex-direction:column;box-sizing:border-box;width:var(--button-size);height:var(--button-size);font-size:.7rem;align-items:center;justify-content:center;padding:4px;user-select:none;-webkit-user-select:none}.toolbar-grid-selector .choice-button .icon{flex-grow:1;flex-shrink:1;width:100%}.toolbar-grid-selector .choice-button.checked{background-color:var(--selection-background-color);color:var(--selection-foreground-color);--icon-color: var(--selection-foreground-color)}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list{height:min(200px,50vh);position:relative;display:flex;align-items:center}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list>.scroller{display:flex;flex-direction:column;overflow-y:auto;scroll-snap-type:y mandatory;height:100%;width:100%;flex-grow:1}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list>.scroller>.item{height:100%;width:100%;flex-shrink:0;display:flex;justify-content:center;align-items:center;scroll-snap-align:start;scroll-snap-stop:always;box-sizing:border-box}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.-empty{display:none}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list>.page-markers{overflow:hidden;display:flex;flex-direction:column;align-items:center;max-height:100%;min-height:0}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list>.page-markers.-one-element{visibility:hidden}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list>.page-markers>.marker{padding:2px;opacity:.1;cursor:pointer;left:0;transition:left .2s ease}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list>.page-markers>.marker>.content{background-color:var(--foreground-color-1);border-radius:2px;padding:2px}:root .toolbar-snapped-scroll-list.toolbar-snapped-scroll-list.toolbar-snapped-scroll-list>.page-markers>.marker.-active{position:relative;left:2px;opacity:.2}.toolbar-button-grid{display:grid;grid-template-columns:repeat(var(--column-count), 1fr);justify-items:center;--button-size: 30px}.toolbar-button-grid>.button{font-size:1em;width:min-content}.toolbar-button-grid>.button>.icon{max-width:var(--button-size);max-height:var(--button-size);width:48px;height:48px}.toolbar-button-grid>.button>label{display:block;font-weight:normal}.toolbar-root{background-color:var(--background-color-1);--icon-color: var(--foreground-color-1);--toolbar-button-height: min(20vh, 60px);flex-wrap:wrap;box-sizing:border-box;width:100%;display:flex;flex-direction:row;justify-content:center}.toolbar-element{z-index:1;font-family:system-ui,-apple-system,sans-serif}.toolbar-element details>summary{cursor:pointer}.toolbar-element>.toolbar-toolContainer>.toolbar-button,.toolbar-element>.toolbar-toolContainer>*>button,.toolbar-element>.toolbar-buttonGroup>button,.toolbar-element>.toolbar-button{white-space:pre;height:var(--toolbar-button-height)}.toolbar-dropdown .toolbar-button>.toolbar-icon{max-width:50px;width:100%}.toolbar-button.disabled{filter:sepia(0.2);opacity:.45;cursor:unset}.toolbar-button,.toolbar-element button{cursor:pointer;text-align:center;border-radius:6px;border:none;box-shadow:0px 0px 2px var(--shadow-color);user-select:none;-webkit-user-select:none;transition:background-color .15s ease,box-shadow .25s ease,opacity .2s ease}.toolbar-button,.toolbar-buttonGroup>button,.toolbar-toolContainer>*>button,.toolbar-root>button{display:flex;flex-direction:column;align-items:center;justify-content:center;padding-left:3px;padding-right:3px;min-width:40px;max-width:105px;width:min-content;font-size:1em}.toolbar-button>label{cursor:inherit;user-select:none;-webkit-user-select:none}.toolbar-root>.toolbar-toolContainer>.toolbar-button>label.long-label{font-size:.75em}.toolbar-dropdown>.toolbar-toolContainer>button,.toolbar-dropdown>.toolbar-toolContainer>.toolbar-button{width:6em}.toolbar-button:not(.disabled):hover,.toolbar-root button:not(:disabled):hover{box-shadow:0px 2px 4px var(--shadow-color)}.toolbar-root button:disabled{cursor:inherit;opacity:.5}.toolbar-root .toolbar-icon{flex-shrink:1;user-select:none;width:100%;min-width:20px;min-height:20px}.toolbar-toolContainer.selected>.toolbar-button{background-color:var(--selection-background-color);color:var(--selection-foreground-color);--icon-color: var(--selection-foreground-color)}.toolbar-toolContainer:not(.selected):not(.dropdownShowable)>.toolbar-button>.toolbar-showHideDropdownIcon{display:none}.toolbar-toolContainer>.toolbar-button>.toolbar-showHideDropdownIcon{height:15px;transition:transform .25s ease}.toolbar-toolContainer.dropdownVisible>.toolbar-button>.toolbar-showHideDropdownIcon{transform:rotate(180deg)}.toolbar-dropdown.hidden,.toolbar-toolContainer:not(.selected):not(.dropdownShowable)>.toolbar-dropdown:not(.hiding){display:none}.toolbar-dropdown{position:absolute;padding:15px;padding-top:5px;display:flex;flex-wrap:wrap;flex-direction:column;max-height:80vh;max-width:fit-content;z-index:2;background-color:var(--background-color-1);box-shadow:0px 3px 3px var(--shadow-color)}@keyframes dropdown-transition-in{0%{opacity:0;transform:scale(1, 0)}100%{opacity:1;transform:scale(1, 1)}}@keyframes dropdown-transition-out{0%{opacity:1;transform:scale(1, 1)}100%{opacity:0;transform:scale(1, 0)}}.toolbar-dropdown{transform-origin:top left;--dropdown-show-animation: dropdown-transition-in;--dropdown-hide-animation: dropdown-transition-out}@media(prefers-reduced-motion: reduce){.toolbar-dropdown{--dropdown-show-animation: none;--dropdown-hide-animation: none}.toolbar-dropdown.hiding{display:none}.toolbar-toolContainer>.toolbar-button>.toolbar-showHideDropdownIcon{transition:none}:root .toolbar-button,.toolbar-root button{transition:none}}.toolbar-buttonGroup{display:flex;flex-direction:row;justify-content:center}.toolbar-element .toolbar--toggle-button{color:var(--foreground-color-1);font-weight:normal}.toolbar-element .toolbar--toggle-button[aria-checked=true]{background:var(--selection-background-color);color:var(--selection-foreground-color)}.toolbar-element .toolbar--toggle-button>.icon{width:25px;height:25px;margin:0 5px}.toolbar-element .toolbar--toggle-button>*{vertical-align:middle}.toolbar-closeColorPickerOverlay{display:none;position:fixed;top:0;left:0;bottom:0;right:0;touch-action:none;background-color:var(--background-color-1);opacity:.3;z-index:2}.toolbar-spacedList>*{padding-bottom:5px;padding-top:5px}.toolbar-indentedList{padding-left:10px}@media print{.toolbar-element{display:none}}@keyframes rehide-label{0%{opacity:.8}80%{opacity:.8}100%{opacity:.1}}@keyframes show-label-delayed{0%{opacity:0}80%{opacity:0}100%{opacity:.8}}@keyframes show-label-now{0%{opacity:0}5%{opacity:0}100%{opacity:.8}}@keyframes keep-label-hidden{0%{opacity:0}100%{opacity:0}}@keyframes toolbar--edgemenu-transition-in{from{transform:translate(0, 100%)}to{transform:translate(0, 0)}}@keyframes toolbar--edgemenu-transition-in-reduce-motion{from{opacity:0}to{opacity:1}}@keyframes toolbar--edgemenu-transition-out{to{transform:translate(0, 100%)}}@keyframes toolbar--edgemenu-transition-out-reduce-motion{from{opacity:1}to{opacity:0}}@keyframes toolbar--edgemenu-container-transition-in{from{overflow-y:hidden}to{overflow-y:hidden}}@keyframes toolbar--edgemenu-container-transition-out{from{overflow-y:hidden}to{overflow-y:hidden}}.toolbar-edge-toolbar{--toolbar-button-height: min(20vh, 48px);--toolbar-button-size: var(--toolbar-button-height);--label-hover-offset-size: calc(14px + var(--toolbar-button-height));box-sizing:border-box;flex-direction:row;justify-content:space-around;--button-label-hover-offset-y: var(--label-hover-offset-size);--button-label-hover-offset-x: 0}@media screen and (min-width: 540px){.toolbar-edge-toolbar{flex-wrap:nowrap}.toolbar-edge-toolbar>.toolbar-action-row{max-width:50vw;flex-grow:0;flex-shrink:0}}@media screen and (max-width: 700px){.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline{font-size:.9em}.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button{width:var(--toolbar-button-size)}.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button label{opacity:0;animation:.2s linear hide-initially}@keyframes hide-initially{from{opacity:0}to{opacity:0}}.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):hover:not(:focus-visible)>label,.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):active>label{opacity:.8;animation:1s ease show-label-delayed}.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button.has-long-press-or-hover>label{opacity:.8}.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button:focus-visible>label,.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button.focus-visible>label{animation:1.5s ease rehide-label;opacity:0}.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button:has(:focus-visible)>label{animation:1.5s ease rehide-label;opacity:0}.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button>label{opacity:0;position:absolute;margin-top:var(--button-label-hover-offset-y);margin-left:var(--button-label-hover-offset-x);z-index:1;pointer-events:none;background-color:var(--background-color-1);color:var(--foreground-color-1);border-radius:25px;padding:10px;transition:.3s ease opacity,.2s ease margin-top}}@media screen and (max-width: 700px)and (prefers-reduced-motion: reduce){.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button>label{transition:none}}@media screen and (max-width: 700px){.toolbar-edge-toolbar.one-row>*>.toolbar-toolContainer.label-inline>.toolbar-button>.toolbar-icon.toolbar-icon{margin-left:0;margin-right:0}}.toolbar-edge-toolbar>div.toolbar-element{flex-direction:row;display:flex;flex-grow:1;justify-content:center;background-color:var(--background-color-2);color:var(--foreground-color-2);--icon-color: var(--foreground-color-2);--extra-left-right-padding: 0px}.toolbar-edge-toolbar>div.toolbar-element::-webkit-scrollbar{width:3px;height:3px}.toolbar-edge-toolbar>div.toolbar-element::-webkit-scrollbar-thumb{background-color:var(--shadow-color)}.toolbar-edge-toolbar>div.toolbar-element.toolbar-tool-row{overflow-x:auto;overflow-y:hidden;flex-grow:100}.toolbar-edge-toolbar>div.toolbar-element.toolbar-action-row{z-index:2;background-color:var(--background-color-3);color:var(--foreground-color-3);--icon-color: var(--foreground-color-3)}.toolbar-edge-toolbar>div.toolbar-element.has-scroll{justify-content:start;position:relative;--button-label-hover-offset-y: 0;--button-label-hover-offset-x: calc(0px - var(--label-hover-offset-size))}.toolbar-edge-toolbar>div.toolbar-element.has-scroll>:nth-child(1){--button-label-hover-offset-x: var(--label-hover-offset-size)}.toolbar-edge-toolbar .toolbar-toolContainer.selected>.toolbar-button{background-color:var(--selection-background-color);color:var(--selection-foreground-color);--icon-color: var(--selection-foreground-color)}.toolbar-edge-toolbar .toolbar-button{box-sizing:border-box;background-color:rgba(0,0,0,0)}.toolbar-edge-toolbar .toolbar-button .toolbar-showHideDropdownIcon{flex-shrink:.01;height:12px}.toolbar-edge-toolbar .toolbar-toolContainer{order:1}.toolbar-edge-toolbar .toolbar-toolContainer.label-inline{flex-grow:1;display:flex;--button-flex-direction: row}.toolbar-edge-toolbar .toolbar-toolContainer.label-inline.label-left{justify-content:end;--button-flex-direction: row-reverse;order:100}.toolbar-edge-toolbar .toolbar-toolContainer.label-inline.label-left>.toolbar-button>.toolbar-icon{margin-left:7px;margin-right:0}.toolbar-edge-toolbar .toolbar-toolContainer.label-inline.label-right{order:-1}.toolbar-edge-toolbar .toolbar-toolContainer.label-inline>.toolbar-button{width:auto;flex-direction:var(--button-flex-direction)}.toolbar-edge-toolbar .toolbar-toolContainer.label-inline>.toolbar-button>.toolbar-icon{height:100%;margin-right:7px;margin-left:0;width:22px}.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button{width:calc(var(--toolbar-button-size) + var(--extra-left-right-padding));height:var(--toolbar-button-size)}.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):hover:not(:focus-visible)>label,.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):active>label{opacity:.8;animation:1s ease show-label-delayed}.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button.has-long-press-or-hover>label{opacity:.8}.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button:focus-visible>label,.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button.focus-visible>label{animation:1.5s ease rehide-label;opacity:0}.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button:has(:focus-visible)>label{animation:1.5s ease rehide-label;opacity:0}.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button>label{opacity:0;position:absolute;margin-top:var(--button-label-hover-offset-y);margin-left:var(--button-label-hover-offset-x);z-index:1;pointer-events:none;background-color:var(--background-color-1);color:var(--foreground-color-1);border-radius:25px;padding:10px;transition:.3s ease opacity,.2s ease margin-top}@media(prefers-reduced-motion: reduce){.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline) .toolbar-button>label{transition:none}}.toolbar-edge-toolbar .toolbar-toolContainer:not(.no-icon):not(.label-inline).dropdownVisible>.toolbar-button>label{opacity:.8;animation:1.5s ease rehide-label .3s,1s ease keep-label-hidden 1.8s infinite}.toolbar-edge-toolbar>div>.toolbar-toolContainer:not(.selected):not(.dropdownShowable)>.toolbar-button>.toolbar-showHideDropdownIcon{display:block;visibility:hidden}.toolbar-edge-toolbar .toolbar-toolContainer>.toolbar-button{margin:0;border-radius:0;padding:8px;box-shadow:none}.toolbar-edge-toolbar .toolbar-toolContainer>.toolbar-button.has-dropdown{padding-left:8px;padding-right:8px;padding-top:8px;padding-bottom:0px}.imageEditorContainer.pipette--color-selection-in-progress .toolbar-edgemenu-container{height:0;background-color:rgba(0,0,0,0);opacity:.9}.imageEditorContainer.pipette--color-selection-in-progress .toolbar-edgemenu-container .toolbar-edgemenu{position:absolute}.toolbar-edgemenu-container{background-color:var(--background-color-transparent);transition:.15s ease-in-out height,.15s ease-in-out background-color,.2s ease-in-out opacity;position:absolute;width:var(--editor-current-width-px);height:var(--editor-current-height-px);box-sizing:border-box;display:flex;flex-direction:column-reverse;align-items:center;z-index:2}@media(prefers-reduced-motion: reduce){.toolbar-edgemenu-container{transition:.15s ease-in-out background-color,.2s ease-in-out opacity}}.toolbar-edgemenu-container.dropdown-below-edge{overflow-y:hidden}.toolbar-edgemenu-container button{font-size:1.2em;box-shadow:none;border:none;padding:10px;transition:.2s ease box-shadow;font-weight:bold;color:var(--primary-action-foreground-color)}.toolbar-edgemenu-container button:not(:disabled):hover{box-shadow:0 0px 2px var(--shadow-color)}.toolbar-edgemenu-container button:disabled{opacity:.5;font-weight:unset;cursor:unset;color:var(--foreground-color-1)}.toolbar-edgemenu-container .toolbar-grid-selector .choice-button{--button-label-hover-offset-y: var(--button-size)}.toolbar-edgemenu-container .toolbar-grid-selector .choice-button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):hover:not(:focus-visible)>label>.button-label-text,.toolbar-edgemenu-container .toolbar-grid-selector .choice-button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):active>label>.button-label-text{opacity:.8;animation:1s ease show-label-delayed}.toolbar-edgemenu-container .toolbar-grid-selector .choice-button.has-long-press-or-hover>label>.button-label-text{opacity:.8}.toolbar-edgemenu-container .toolbar-grid-selector .choice-button:focus-visible>label>.button-label-text,.toolbar-edgemenu-container .toolbar-grid-selector .choice-button.focus-visible>label>.button-label-text{animation:1.5s ease rehide-label;opacity:0}.toolbar-edgemenu-container .toolbar-grid-selector .choice-button:has(:focus-visible)>label>.button-label-text{animation:1.5s ease rehide-label;opacity:0}.toolbar-edgemenu-container .toolbar-grid-selector .choice-button>label>.button-label-text{opacity:0;position:absolute;margin-top:var(--button-label-hover-offset-y);margin-left:var(--button-label-hover-offset-x);z-index:1;pointer-events:none;background-color:var(--background-color-1);color:var(--foreground-color-1);border-radius:25px;padding:10px;transition:.3s ease opacity,.2s ease margin-top}@media(prefers-reduced-motion: reduce){.toolbar-edgemenu-container .toolbar-grid-selector .choice-button>label>.button-label-text{transition:none}}.toolbar-edgemenu-container .toolbar-button-grid button{--button-label-hover-offset-y: 0}.toolbar-edgemenu-container .toolbar-button-grid button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):hover:not(:focus-visible)>label,.toolbar-edgemenu-container .toolbar-button-grid button:not(.no-long-press-or-hover):not(.has-long-press-or-hover):active>label{opacity:.8;animation:1s ease show-label-delayed}.toolbar-edgemenu-container .toolbar-button-grid button.has-long-press-or-hover>label{opacity:.8}.toolbar-edgemenu-container .toolbar-button-grid button:focus-visible>label,.toolbar-edgemenu-container .toolbar-button-grid button.focus-visible>label{animation:1.5s ease rehide-label;opacity:0}.toolbar-edgemenu-container .toolbar-button-grid button:has(:focus-visible)>label{animation:1.5s ease rehide-label;opacity:0}.toolbar-edgemenu-container .toolbar-button-grid button>label{opacity:0;position:absolute;margin-top:var(--button-label-hover-offset-y);margin-left:var(--button-label-hover-offset-x);z-index:1;pointer-events:none;background-color:var(--background-color-1);color:var(--foreground-color-1);border-radius:25px;padding:10px;transition:.3s ease opacity,.2s ease margin-top}@media(prefers-reduced-motion: reduce){.toolbar-edgemenu-container .toolbar-button-grid button>label{transition:none}}.toolbar-edgemenu-container .toolbar-help-overlay-button{align-items:last baseline}.toolbar-edgemenu-container .toolbar-edgemenu{--toolbar-button-height: 48px;touch-action:none;user-select:none;-webkit-user-select:none;background-color:var(--background-color-2);color:var(--foreground-color-2);--icon-color: var(--foreground-color-2);box-shadow:0px 0px 1px var(--shadow-color);padding-left:10px;padding-right:10px;width:min(400px,100vw);box-sizing:border-box;border-top-left-radius:30px;border-top-right-radius:30px;transition:transform .1s ease,padding-bottom .1s ease}.toolbar-edgemenu-container .toolbar-edgemenu input,.toolbar-edgemenu-container .toolbar-edgemenu textarea{user-select:auto;-webkit-user-select:auto}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-toolContainer{display:inline-block}.toolbar-edgemenu-container .toolbar-edgemenu button{background-color:rgba(0,0,0,0)}.toolbar-edgemenu-container .toolbar-edgemenu>button.drag-elem{height:40px;display:block;cursor:ns-resize;position:relative;margin-top:-15px;margin-bottom:10px;width:100%;border:none;box-shadow:none;background:rgba(0,0,0,0)}.toolbar-edgemenu-container .toolbar-edgemenu>button.drag-elem::before{content:"";background-color:var(--icon-color);opacity:.2;display:block;position:relative;top:10px;height:5px;border-radius:5px;width:min(80%,40px);margin-left:auto;margin-right:auto}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-toolContainer{display:block}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-toolContainer .toolbar-button{flex-direction:row;max-width:unset;width:100%;box-sizing:border-box;justify-content:flex-start;box-shadow:none;padding:2px}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-toolContainer .toolbar-button>.toolbar-icon{width:25px;height:25px;padding:13px;margin-right:15px}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-toolContainer .toolbar-button label,.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-toolContainer .toolbar-button>label.long-label{font-size:1em}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-nonbutton-controls-main-list{padding-left:10px;padding-right:10px}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-spacedList{box-sizing:border-box;--align-items-to-x: 105px}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-spacedList>div{display:flex;align-items:center;margin-top:5px;min-height:35px}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-spacedList>div:first-child{margin-top:0}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-spacedList>div>label{padding-right:35px;min-width:var(--align-items-to-x);flex-shrink:1;box-sizing:border-box}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-spacedList>div>input[type=checkbox]{width:20px;height:20px;margin-left:0}.toolbar-edgemenu-container .toolbar-edgemenu .toolbar-spacedList>div>input:not([type=checkbox]){flex-grow:1;min-width:48px;flex-shrink:1}.toolbar-dropdown-toolbar button,.toolbar-dropdown-toolbar .toolbar-button{background-color:var(--background-color-2);color:var(--foreground-color-2);--icon-color: var(--foreground-color-2)}.toolbar-dropdown-toolbar,.toolbar-dropdown-toolbar .toolbar-dropdown{background-color:var(--background-color-3);color:var(--foreground-color-3)}.toolbar-dropdown-toolbar .toolbar-spacedList>div>label{padding-right:10px;min-width:50px}.toolbar-dropdown-toolbar .clr-field button{width:100%;height:100%;top:50%;left:0;border-radius:5px}.toolbar-dropdown-toolbar .toolbar-grid-selector>div{--button-size: 57px}.toolbar-dropdown-toolbar .toolbar-dropdown>div>.toolbar-toolContainer{display:inline-block}.toolbar-help-overlay{width:100%;height:100%;max-width:none;max-height:none;border:none;margin:0;padding:0;z-index:5;touch-action:none;overflow:hidden;color:#fff;--icon-color: white;background-color:rgba(0,0,0,0);display:flex;flex-direction:column;transition:.3s ease transform}.toolbar-help-overlay::backdrop{background-color:rgba(0,0,0,.8);backdrop-filter:blur(1px);-webkit-backdrop-filter:blur(1px)}.toolbar-help-overlay,.toolbar-help-overlay::backdrop{animation:.25s ease transition-in}@keyframes transition-in{0%{opacity:0}100%{opacity:1}}@keyframes transition-out{0%{opacity:1}100%{opacity:0}}.toolbar-help-overlay.-hiding,.toolbar-help-overlay.-hiding::backdrop{animation:.25s ease transition-out;opacity:0}.toolbar-help-overlay.-dragging{transition:none}@media(prefers-reduced-motion: reduce){.toolbar-help-overlay{transition:none}}@media screen and (min-width: 800px){.toolbar-help-overlay>.navigation-buttons{order:1;margin-top:auto}}.toolbar-help-overlay .with-text-shadow,.toolbar-help-overlay .help-page-container>.label,.toolbar-help-overlay button{text-shadow:0 0 3px rgba(20,20,20,.9);filter:drop-shadow(0px 0px 2px rgba(0, 0, 0, 0.5))}.toolbar-help-overlay button:not(:disabled){cursor:pointer}.toolbar-help-overlay button{background:rgba(0,0,0,0);border:none;color:var(--help-overlay-foreground);border-radius:15px}.toolbar-help-overlay .close-button{align-self:flex-start;width:48px;height:48px;z-index:1}.toolbar-help-overlay .close-button>svg{width:100%}.toolbar-help-overlay .navigation-content{flex-grow:1;display:flex}.toolbar-help-overlay .help-page-container{display:flex;align-items:center;flex-grow:1;touch-action:none}.toolbar-help-overlay .help-page-container>.label{flex-grow:1;text-align:center;font-size:18.5pt;margin-left:15px;margin-right:15px;margin-top:0px;z-index:1;transition:.5s ease margin-top}.toolbar-help-overlay .help-page-container>.label.-large-space-below{margin-top:0;margin-bottom:auto}.toolbar-help-overlay .help-page-container>.label.-small-space-above{margin-top:40px;margin-bottom:auto}.toolbar-help-overlay .help-page-container>.label.-large-space-above{margin-top:auto;margin-bottom:10px}@media(prefers-reduced-motion: reduce){.toolbar-help-overlay .help-page-container>.label{transition:none}}.toolbar-help-overlay .help-page-container>.cloned-element-container{position:absolute;z-index:0;user-select:none;-webkit-user-select:none;border-radius:10px;opacity:.01;background-color:rgba(100,100,100,.01);box-shadow:none;transition:.5s ease opacity,.5s ease background-color}.toolbar-help-overlay .help-page-container>.cloned-element-container *{pointer-events:none !important}.toolbar-help-overlay .help-page-container>.cloned-element-container>*{margin:0;opacity:.01 !important;transition:.3s ease opacity !important}.toolbar-help-overlay .help-page-container>.cloned-element-container:not(.-clickable) *{cursor:unset !important}.toolbar-help-overlay .help-page-container>.cloned-element-container.-clickable,.toolbar-help-overlay .help-page-container>.cloned-element-container.-background{z-index:1;touch-action:none}.toolbar-help-overlay .help-page-container>.cloned-element-container.-clickable{cursor:pointer;z-index:2}.toolbar-help-overlay .help-page-container>.cloned-element-container.-clickable.has-long-press-or-hover{opacity:.5 !important}.toolbar-help-overlay .help-page-container>.cloned-element-container.-clickable.has-long-press-or-hover,.toolbar-help-overlay .help-page-container>.cloned-element-container.-active{background-color:var(--background-color-1)}.toolbar-help-overlay .help-page-container>.cloned-element-container.-active{opacity:1;background-color:var(--background-color-1);box-shadow:0 0 3px rgba(100,100,100,.5)}.toolbar-help-overlay .help-page-container>.cloned-element-container.-active>*{opacity:1 !important}.toolbar-help-overlay .navigation-buttons{display:flex;flex-direction:row;justify-content:space-between;direction:ltr}.toolbar-help-overlay .navigation-buttons>button:disabled{opacity:.5}.toolbar-help-overlay .navigation-buttons>.next,.toolbar-help-overlay .navigation-buttons>.previous{font-size:1em;padding:10px;transition:.2s ease font-size;z-index:3}@media(prefers-reduced-motion: reduce){.toolbar-help-overlay .navigation-buttons>.next,.toolbar-help-overlay .navigation-buttons>.previous{transition:none}}.toolbar-help-overlay .navigation-buttons:not(.-has-previous)>.next:not(:disabled){animation:.5s ease highlight-button .5s}@keyframes highlight-button{0%{transform:scale(1)}50%{transform:scale(1.2)}55%{transform:scale(1.2) rotate(2deg)}65%{transform:scale(1.2) rotate(-2deg)}100%{transform:scale(1)}}@media(prefers-reduced-motion: reduce){.toolbar-help-overlay .navigation-buttons:not(.-has-previous)>.next:not(:disabled){animation:none}}.toolbar-help-overlay .navigation-buttons>.next::after{content:"\u276F";margin-left:3px}.toolbar-help-overlay .navigation-buttons>.previous::before{content:"\u276E";margin-right:3px}.toolbar-help-overlay .navigation-buttons.-has-next>.next{font-size:1.4em}.toolbar-help-overlay .navigation-buttons.-has-previous>.previous{font-size:1.4em}.toolbar-help-overlay .navigation-buttons.-highlight-next>.next,.toolbar-help-overlay .navigation-buttons.-highlight-previous>.previous{font-weight:bold;font-size:1.4em}.toolbar-help-overlay .navigation-buttons.-highlight-next>.next,.toolbar-help-overlay .navigation-buttons.-highlight-previous>.previous,.toolbar-help-overlay .navigation-buttons .next:hover,.toolbar-help-overlay .navigation-buttons .previous:hover{background-color:rgba(200,200,200,.1)}.toolbar-help-overlay .navigation-help{margin-top:1em;font-size:.7em}.toolbar-element .toolbar-help-overlay-button{height:0;position:relative;display:flex;justify-content:end}.toolbar-element .toolbar-help-overlay-button>.button{margin:0;padding:5px;padding-top:0;padding-bottom:0;box-shadow:none;text-align:center;opacity:.5}.toolbar-element .toolbar-help-overlay-button>.button>.icon{width:1.18em;height:1.18em;transition:.2s ease filter}.toolbar-element .toolbar-help-overlay-button>.button:focus-visible>.icon,.toolbar-element .toolbar-help-overlay-button>.button:hover>.icon{filter:drop-shadow(0px 0px 1px var(--shadow-color))}.ScrollbarTool-overlay{width:0;height:0;overflow:visible;opacity:.2;pointer-events:none;--fade-out-animation: 1s ease 0s fade-out;--scrollbar-size: 3px}@media(prefers-reduced-motion: reduce){.ScrollbarTool-overlay{--fade-out-animation: none !important}}@keyframes fade-out{from{opacity:.2}to{opacity:0}}.ScrollbarTool-overlay:not(.just-updated){animation:var(--fade-out-animation);opacity:0}.ScrollbarTool-overlay .vertical-scrollbar,.ScrollbarTool-overlay .horizontal-scrollbar{width:var(--scrollbar-size);height:var(--scrollbar-size);min-width:var(--scrollbar-size);min-height:var(--scrollbar-size);background-color:var(--foreground-color-1);border-radius:var(--scrollbar-size);position:absolute}.ScrollbarTool-overlay .vertical-scrollbar.represents-no-scroll,.ScrollbarTool-overlay .horizontal-scrollbar.represents-no-scroll{animation:var(--fade-out-animation);opacity:0}.ScrollbarTool-overlay:not(.scrollbar-left) .vertical-scrollbar{margin-left:calc(var(--editor-current-display-width-px) - var(--scrollbar-size))}.ScrollbarTool-overlay:not(.scrollbar-top) .horizontal-scrollbar{margin-top:calc(var(--editor-current-display-height-px) - var(--scrollbar-size))}.clipboard-error-dialog details>summary{cursor:pointer}.clipboard-error-dialog details[open]{margin-bottom:12px}.clipboard-error-dialog textarea{width:100%;box-sizing:border-box}.selection-tool-selection-background{background-color:var(--selection-background-color);opacity:.5;overflow:visible}.selection-tool-handle{position:absolute;box-sizing:border-box;display:flex;align-items:center;justify-content:center;--max-size: 17px}.selection-tool-handle .selection-tool-content{border:1px solid var(--foreground-color-1);background:var(--background-color-1);box-sizing:border-box;max-width:var(--max-size);max-height:var(--max-size);width:100%;height:100%;display:flex;justify-content:center;align-items:center;padding:3px}.selection-tool-handle .selection-tool-content .icon{width:100%;height:100%}.selection-tool-handle.selection-tool-circle .selection-tool-content{border-radius:100%}.selection-tool-handle.selection-tool-rotate{--max-size: 28px;cursor:grab}.selection-tool-handle.selection-tool-resize-x{cursor:ew-resize}.selection-tool-handle.selection-tool-resize-y{cursor:ns-resize}.selection-tool-handle.selection-tool-resize-xy{cursor:nwse-resize}.selection-tool-rotated-near-perpendicular .selection-tool-handle.selection-tool-resize-x{cursor:ns-resize}.selection-tool-rotated-near-perpendicular .selection-tool-handle.selection-tool-resize-y{cursor:ew-resize}.selection-tool-rotated-near-perpendicular .selection-tool-handle.selection-tool-resize-xy{cursor:nesw-resize}.selection-tool-selection-menu>button{max-height:var(--vertical-offset);background-color:var(--background-color-1);width:24px;height:24px;padding:6px;font-size:14px;user-select:none;-webkit-user-select:none;color:var(--foreground-color-1);border:.5px solid var(--foreground-color-1);border-radius:3px;opacity:.8;transition:.2s ease opacity}.selection-tool-selection-menu>button:hover,.selection-tool-selection-menu>button:focus-visible{background-color:var(--background-color-2);color:var(--foreground-color-2);cursor:pointer;opacity:1}.selection-tool-selection-menu>button>.icon{width:100%;height:100%}.overlay.handleOverlay{touch-action:none;direction:ltr}.overlay.handleOverlay,.overlay.handleOverlay .selection-tool-selection-outer-container{height:0;overflow:visible}.overlay.handleOverlay .selection-tool-selection-inner-container{width:var(--editor-current-display-width-px);height:var(--editor-current-display-height-px);overflow:hidden;pointer-events:none}.overlay.handleOverlay .selection-tool-selection-inner-container>*{pointer-events:all}.overlay.handleOverlay .selection-tool-selection-inner-container.-empty{opacity:0;display:none}.overlay.handleOverlay .selection-tool-selection-inner-container.-hide-handles .selection-tool-handle{display:none}@keyframes selection-duplicated-animation{0%{scale:1 1}50%{scale:1.02 1.02}100%{scale:1 1}}@media(prefers-reduced-motion: reduce){@keyframes selection-duplicated-animation{}}.find-tool-overlay{order:-1;position:absolute}.js-draw-sound-ui-toggle{width:0px;height:0px;overflow:hidden;user-select:none;-webkit-user-select:none}.js-draw-sound-ui-toggle button{margin-top:1px}.js-draw-sound-ui-toggle:focus-within,.js-draw-sound-ui-toggle.sound-ui-tool-enabled{overflow:visible;z-index:5}.js-draw-sound-ui-toggle:not(:focus-within):not(:hover).sound-ui-tool-enabled{opacity:.5}@keyframes show-popup-menu-animation{from{opacity:0}to{opacity:1}}.editor-popup-menu{width:100%;height:100%;background-color:rgba(0,0,0,0);border:none;animation:var(--hide-menu-animation-timeout) ease show-popup-menu-animation;opacity:1;transition:var(--hide-menu-animation-timeout) ease opacity;overflow:hidden}.editor-popup-menu.-hide{opacity:0}.editor-popup-menu>.content{position:absolute;left:var(--anchor-x);top:var(--anchor-y);display:flex;flex-direction:column;overflow:clip;border-radius:6px;box-shadow:0px 0px 2px var(--shadow-color);background-color:var(--background-color-1)}.editor-popup-menu::backdrop{background:rgba(0,0,0,0)}.editor-popup-menu-option{display:flex;justify-content:start;cursor:pointer;padding:5px;padding-top:6px;padding-bottom:6px;background-color:rgba(0,0,0,0);color:var(--foreground-color-1);--icon-color: currentColor;border:none;font-size:1em}.editor-popup-menu-option:hover,.editor-popup-menu-option:focus-visible{background-color:var(--background-color-2);color:var(--foreground-color-2)}.editor-popup-menu-option>:first-child{width:1em;height:1em;flex-shrink:0;align-self:center;margin-inline-start:0em;margin-inline-end:.32em}.about-dialog-content>.scroll{white-space:pre-wrap;font-family:monospace}.about-dialog-content>.scroll>details>summary{cursor:pointer}.about-dialog-content>.scroll>h2,.about-dialog-content>.scroll>details>summary{margin-top:15px;font-size:1.2em;font-weight:bold}.about-dialog-content>.scroll>h2 a,.about-dialog-content>.scroll>details>summary a{color:var(--foreground-color-1);text-decoration:underline}@keyframes fade-in{from{opacity:0}to{opacity:1}}.message-dialog-container dialog{display:flex}.message-dialog-container dialog.-closing{opacity:0}.message-dialog-container dialog.-closing::backdrop{opacity:0}.message-dialog-container dialog,.message-dialog-container dialog::backdrop{transition:opacity .2s ease;animation:fade-in .2s ease}.message-dialog-content{display:flex;flex-direction:column;flex-grow:1}.message-dialog-content>.close{display:block;margin-left:auto;margin-right:auto}.message-dialog-content>.scroll{flex-grow:1;flex-shrink:1;overflow-y:auto;margin-left:20px;margin-right:20px;padding-bottom:20px}.dialog-container>dialog{background-color:var(--background-color-1);color:var(--foreground-color-1);border:none;outline:none;box-shadow:0 0 2px var(--shadow-color);border-radius:8px;max-height:90vh;width:min(100%,500px);box-sizing:border-box}.dialog-container>dialog::backdrop{backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);background-color:var(--background-color-transparent)}#clr-picker{--clr-slider-size: 30px}#clr-picker #clr-color-area,#clr-picker .clr_hue{touch-action:none}#clr-picker .clr-alpha{margin-top:15px;margin-bottom:15px}#clr-picker.clr-picker input[type=range]::-moz-range-thumb{width:var(--clr-slider-size);height:var(--clr-slider-size)}#clr-picker.clr-picker input[type=range]::-webkit-slider-thumb{width:var(--clr-slider-size);height:var(--clr-slider-size)}#clr-picker.clr-picker input[type=range]::-webkit-slider-runnable-track{height:var(--clr-slider-size)}#clr-picker.clr-picker input[type=range]::-moz-range-track{height:var(--clr-slider-size)}.imageEditorContainer{--background-color-1: white;--foreground-color-1: black;--background-color-2: #f5f5f5;--foreground-color-2: #2c303a;--background-color-3: #e5e5e5;--foreground-color-3: #1c202a;--selection-background-color: #cbdaf1;--selection-foreground-color: #2c303a;--background-color-transparent: rgba(105, 100, 100, 0.5);--shadow-color: rgba(0, 0, 0, 0.5);--primary-action-foreground-color: #15b}@media(prefers-color-scheme: dark){.imageEditorContainer{--background-color-1: #151515;--foreground-color-1: white;--background-color-2: #222;--foreground-color-2: #efefef;--background-color-3: #272627;--foreground-color-3: #eee;--selection-background-color: #607;--selection-foreground-color: white;--shadow-color: rgba(250, 250, 250, 0.5);--background-color-transparent: rgba(50, 50, 50, 0.5);--primary-action-foreground-color: #7ae}}.imageEditorContainer{--icon-color: var(--foreground-color-1)}.imageEditorContainer{color:var(--foreground-color-1);font-family:system-ui,-apple-system,sans-serif;background-color:var(--background-color-1);width:100%;height:400px;min-height:220px;min-width:100px;writing-mode:horizontal-tb;box-sizing:border-box;display:flex;flex-direction:column-reverse}.imageEditorContainer input{accent-color:var(--primary-action-foreground-color)}.imageEditorContainer .imageEditorRenderArea{display:grid;grid-template-columns:1fr;flex-grow:2;flex-shrink:1;min-height:100px;min-width:0;width:100%;height:100%}.imageEditorContainer .imageEditorRenderArea canvas{grid-row:1/1;grid-column:1/1;touch-action:none;box-sizing:border-box;width:100%;height:100%;min-width:0;max-width:inherit;min-height:0px;max-height:inherit;user-select:none;-webkit-user-select:none;-webkit-user-drag:none}.imageEditorContainer .loadingMessage{position:fixed;text-align:center;font-size:2em;text-shadow:0px 0px 1px var(--background-color-1);bottom:0;left:0;right:0}.imageEditorContainer .accessibilityAnnouncement{opacity:0;width:0;height:0;overflow:hidden;pointer-events:none;user-select:none;-webkit-user-select:none}.imageEditorContainer .textRendererOutputContainer{width:.001px;height:.001px;overflow:hidden;-webkit-user-select:none;user-select:none}.imageEditorContainer .textRendererOutputContainer:focus-within{overflow:visible;z-index:5}.imageEditorContainer .anchored-element-overlay{overflow:visible;height:0}.imageEditorContainer .anchored-element-overlay>.content-wrapper{width:var(--editor-current-display-width-px);height:var(--editor-current-display-height-px);overflow:hidden;position:relative;pointer-events:none}.imageEditorContainer .anchored-element-overlay>.content-wrapper>.content{position:absolute;left:var(--position-x);top:var(--position-y);transform:scale(var(--scale)) rotate(var(--rotation));transform-origin:left top;margin:0;pointer-events:all}@media print{.imageEditorContainer .loadingMessage{display:none}.imageEditorContainer .imageEditorRenderArea canvas{width:100%;height:initial}}',document.head.appendChild(s)}})();(()=>{if(typeof document<"u"&&typeof document.createElement=="function"){let s=document.createElement("style");s.textContent='.clr-picker{display:none;flex-wrap:wrap;position:absolute;width:200px;z-index:1000;border-radius:10px;background-color:#fff;justify-content:flex-end;direction:ltr;box-shadow:0 0 5px rgba(0, 0, 0, 0.05),0 5px 20px rgba(0, 0, 0, 0.1);-moz-user-select:none;-webkit-user-select:none;user-select:none}.clr-picker.clr-open,.clr-picker[data-inline=true]{display:flex}.clr-picker[data-inline=true]{position:relative}.clr-gradient{position:relative;width:100%;height:100px;margin-bottom:15px;border-radius:3px 3px 0 0;background-image:linear-gradient(rgba(0, 0, 0, 0), #000),linear-gradient(90deg, #fff, currentColor);cursor:pointer}.clr-marker{position:absolute;width:12px;height:12px;margin:-6px 0 0 -6px;border:1px solid #fff;border-radius:50%;background-color:currentColor;cursor:pointer}.clr-picker input[type=range]::-webkit-slider-runnable-track{width:100%;height:16px}.clr-picker input[type=range]::-webkit-slider-thumb{width:16px;height:16px;-webkit-appearance:none}.clr-picker input[type=range]::-moz-range-track{width:100%;height:16px;border:0}.clr-picker input[type=range]::-moz-range-thumb{width:16px;height:16px;border:0}.clr-hue{background-image:linear-gradient(to right, #f00 0%, #ff0 16.66%, #0f0 33.33%, #0ff 50%, #00f 66.66%, #f0f 83.33%, #f00 100%)}.clr-hue,.clr-alpha{position:relative;width:calc(100% - 40px);height:8px;margin:5px 20px;border-radius:4px}.clr-alpha span{display:block;height:100%;width:100%;border-radius:inherit;background-image:linear-gradient(90deg, rgba(0, 0, 0, 0), currentColor)}.clr-hue input,.clr-alpha input{position:absolute;width:calc(100% + 32px);height:16px;left:-16px;top:-4px;margin:0;background-color:transparent;opacity:0;cursor:pointer;appearance:none;-webkit-appearance:none}.clr-hue div,.clr-alpha div{position:absolute;width:16px;height:16px;left:0;top:50%;margin-left:-8px;transform:translateY(-50%);border:2px solid #fff;border-radius:50%;background-color:currentColor;box-shadow:0 0 1px #888;pointer-events:none}.clr-alpha div:before{content:"";position:absolute;height:100%;width:100%;left:0;top:0;border-radius:50%;background-color:currentColor}.clr-format{display:none;order:1;width:calc(100% - 40px);margin:0 20px 20px}.clr-segmented{display:flex;position:relative;width:100%;margin:0;padding:0;border:1px solid #ddd;border-radius:15px;box-sizing:border-box;color:#999;font-size:12px}.clr-segmented input,.clr-segmented legend{position:absolute;width:100%;height:100%;margin:0;padding:0;border:0;left:0;top:0;opacity:0;pointer-events:none}.clr-segmented label{flex-grow:1;margin:0;padding:4px 0;font-size:inherit;font-weight:normal;line-height:initial;text-align:center;cursor:pointer}.clr-segmented label:first-of-type{border-radius:10px 0 0 10px}.clr-segmented label:last-of-type{border-radius:0 10px 10px 0}.clr-segmented input:checked+label{color:#fff;background-color:#666}.clr-swatches{order:2;width:calc(100% - 32px);margin:0 16px}.clr-swatches div{display:flex;flex-wrap:wrap;padding-bottom:12px;justify-content:center}.clr-swatches button{position:relative;width:20px;height:20px;margin:0 4px 6px 4px;padding:0;border:0;border-radius:50%;color:inherit;text-indent:-1000px;white-space:nowrap;overflow:hidden;cursor:pointer}.clr-swatches button:after{content:"";display:block;position:absolute;width:100%;height:100%;left:0;top:0;border-radius:inherit;background-color:currentColor;box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.1)}input.clr-color{order:1;width:calc(100% - 80px);height:32px;margin:15px 20px 20px auto;padding:0 10px;border:1px solid #ddd;border-radius:16px;color:#444;background-color:#fff;font-family:sans-serif;font-size:14px;text-align:center;box-shadow:none}input.clr-color:focus{outline:none;border:1px solid #1e90ff}.clr-close,.clr-clear{display:none;order:2;height:24px;margin:0 20px 20px;padding:0 20px;border:0;border-radius:12px;color:#fff;background-color:#666;font-family:inherit;font-size:12px;font-weight:400;cursor:pointer}.clr-close{display:block;margin:0 20px 20px auto}.clr-preview{position:relative;width:32px;height:32px;margin:15px 0 20px 20px;border-radius:50%;overflow:hidden}.clr-preview:before,.clr-preview:after{content:"";position:absolute;height:100%;width:100%;left:0;top:0;border:1px solid #fff;border-radius:50%}.clr-preview:after{border:0;background-color:currentColor;box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.1)}.clr-preview button{position:absolute;width:100%;height:100%;z-index:1;margin:0;padding:0;border:0;border-radius:50%;outline-offset:-2px;background-color:transparent;text-indent:-9999px;cursor:pointer;overflow:hidden}.clr-marker,.clr-hue div,.clr-alpha div,.clr-color{box-sizing:border-box}.clr-field{display:inline-block;position:relative;color:transparent}.clr-field input{margin:0;direction:ltr}.clr-field.clr-rtl input{text-align:right}.clr-field button{position:absolute;width:30px;height:100%;right:0;top:50%;transform:translateY(-50%);margin:0;padding:0;border:0;color:inherit;text-indent:-1000px;white-space:nowrap;overflow:hidden;pointer-events:none}.clr-field.clr-rtl button{right:auto;left:0}.clr-field button:after{content:"";display:block;position:absolute;width:100%;height:100%;left:0;top:0;border-radius:inherit;background-color:currentColor;box-shadow:inset 0 0 1px rgba(0, 0, 0, 0.5)}.clr-alpha,.clr-alpha div,.clr-swatches button,.clr-preview:before,.clr-field button{background-image:repeating-linear-gradient(45deg, #aaa 25%, transparent 25%, transparent 75%, #aaa 75%, #aaa),repeating-linear-gradient(45deg, #aaa 25%, #fff 25%, #fff 75%, #aaa 75%, #aaa);background-position:0 0,4px 4px;background-size:8px 8px}.clr-marker:focus{outline:none}.clr-keyboard-nav .clr-marker:focus,.clr-keyboard-nav .clr-hue input:focus+div,.clr-keyboard-nav .clr-alpha input:focus+div,.clr-keyboard-nav .clr-segmented input:focus+label{outline:none;box-shadow:0 0 0 2px #1e90ff,0 0 2px 2px #fff}.clr-picker[data-alpha=false] .clr-alpha{display:none}.clr-picker[data-minimal=true]{padding-top:16px}.clr-picker[data-minimal=true] .clr-gradient,.clr-picker[data-minimal=true] .clr-hue,.clr-picker[data-minimal=true] .clr-alpha,.clr-picker[data-minimal=true] .clr-color,.clr-picker[data-minimal=true] .clr-preview{display:none}.clr-dark{background-color:#444}.clr-dark .clr-segmented{border-color:#777}.clr-dark .clr-swatches button:after{box-shadow:inset 0 0 0 1px rgba(255, 255, 255, 0.3)}.clr-dark input.clr-color{color:#fff;border-color:#777;background-color:#555}.clr-dark input.clr-color:focus{border-color:#1e90ff}.clr-dark .clr-preview:after{box-shadow:inset 0 0 0 1px rgba(255, 255, 255, 0.5)}.clr-dark .clr-alpha,.clr-dark .clr-alpha div,.clr-dark .clr-swatches button,.clr-dark .clr-preview:before{background-image:repeating-linear-gradient(45deg, #666 25%, transparent 25%, transparent 75%, #888 75%, #888),repeating-linear-gradient(45deg, #888 25%, #444 25%, #444 75%, #888 75%, #888)}.clr-picker.clr-polaroid{border-radius:6px;box-shadow:0 0 5px rgba(0, 0, 0, 0.1),0 5px 30px rgba(0, 0, 0, 0.2)}.clr-picker.clr-polaroid:before{content:"";display:block;position:absolute;width:16px;height:10px;left:20px;top:-10px;border:solid transparent;border-width:0 8px 10px 8px;border-bottom-color:currentColor;box-sizing:border-box;color:#fff;filter:drop-shadow(0 -4px 3px rgba(0, 0, 0, 0.1));pointer-events:none}.clr-picker.clr-polaroid.clr-dark:before{color:#444}.clr-picker.clr-polaroid.clr-left:before{left:auto;right:20px}.clr-picker.clr-polaroid.clr-top:before{top:auto;bottom:-10px;transform:rotateZ(180deg)}.clr-polaroid .clr-gradient{width:calc(100% - 20px);height:120px;margin:10px;border-radius:3px}.clr-polaroid .clr-hue,.clr-polaroid .clr-alpha{width:calc(100% - 30px);height:10px;margin:6px 15px;border-radius:5px}.clr-polaroid .clr-hue div,.clr-polaroid .clr-alpha div{box-shadow:0 0 5px rgba(0, 0, 0, 0.2)}.clr-polaroid .clr-format{width:calc(100% - 20px);margin:0 10px 15px}.clr-polaroid .clr-swatches{width:calc(100% - 12px);margin:0 6px}.clr-polaroid .clr-swatches div{padding-bottom:10px}.clr-polaroid .clr-swatches button{width:22px;height:22px}.clr-polaroid input.clr-color{width:calc(100% - 60px);margin:10px 10px 15px auto}.clr-polaroid .clr-clear{margin:0 10px 15px 10px}.clr-polaroid .clr-close{margin:0 10px 15px auto}.clr-polaroid .clr-preview{margin:10px 0 15px 10px}.clr-picker.clr-large{width:275px}.clr-large .clr-gradient{height:150px}.clr-large .clr-swatches button{width:22px;height:22px}.clr-picker.clr-pill{width:380px;padding-left:180px;box-sizing:border-box}.clr-pill .clr-gradient{position:absolute;width:180px;height:100%;left:0;top:0;margin-bottom:0;border-radius:3px 0 0 3px}.clr-pill .clr-hue{margin-top:20px}',document.head.appendChild(s)}})();var ga=`\`@js-draw/material-icons\`: Material icon integration for \`js-draw\`.

All icons in \`@js-draw/material-icons\` were found using [Google WebFonts search](https://fonts.google.com/icons) and downloaded from there.

A copy of the license for these icons is included below:

\`\`\`

                                 Apache License
                           Version 2.0, January 2004
                        http://www.apache.org/licenses/

   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

   1. Definitions.

      "License" shall mean the terms and conditions for use, reproduction,
      and distribution as defined by Sections 1 through 9 of this document.

      "Licensor" shall mean the copyright owner or entity authorized by
      the copyright owner that is granting the License.

      "Legal Entity" shall mean the union of the acting entity and all
      other entities that control, are controlled by, or are under common
      control with that entity. For the purposes of this definition,
      "control" means (i) the power, direct or indirect, to cause the
      direction or management of such entity, whether by contract or
      otherwise, or (ii) ownership of fifty percent (50%) or more of the
      outstanding shares, or (iii) beneficial ownership of such entity.

      "You" (or "Your") shall mean an individual or Legal Entity
      exercising permissions granted by this License.

      "Source" form shall mean the preferred form for making modifications,
      including but not limited to software source code, documentation
      source, and configuration files.

      "Object" form shall mean any form resulting from mechanical
      transformation or translation of a Source form, including but
      not limited to compiled object code, generated documentation,
      and conversions to other media types.

      "Work" shall mean the work of authorship, whether in Source or
      Object form, made available under the License, as indicated by a
      copyright notice that is included in or attached to the work
      (an example is provided in the Appendix below).

      "Derivative Works" shall mean any work, whether in Source or Object
      form, that is based on (or derived from) the Work and for which the
      editorial revisions, annotations, elaborations, or other modifications
      represent, as a whole, an original work of authorship. For the purposes
      of this License, Derivative Works shall not include works that remain
      separable from, or merely link (or bind by name) to the interfaces of,
      the Work and Derivative Works thereof.

      "Contribution" shall mean any work of authorship, including
      the original version of the Work and any modifications or additions
      to that Work or Derivative Works thereof, that is intentionally
      submitted to Licensor for inclusion in the Work by the copyright owner
      or by an individual or Legal Entity authorized to submit on behalf of
      the copyright owner. For the purposes of this definition, "submitted"
      means any form of electronic, verbal, or written communication sent
      to the Licensor or its representatives, including but not limited to
      communication on electronic mailing lists, source code control systems,
      and issue tracking systems that are managed by, or on behalf of, the
      Licensor for the purpose of discussing and improving the Work, but
      excluding communication that is conspicuously marked or otherwise
      designated in writing by the copyright owner as "Not a Contribution."

      "Contributor" shall mean Licensor and any individual or Legal Entity
      on behalf of whom a Contribution has been received by Licensor and
      subsequently incorporated within the Work.

   2. Grant of Copyright License. Subject to the terms and conditions of
      this License, each Contributor hereby grants to You a perpetual,
      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
      copyright license to reproduce, prepare Derivative Works of,
      publicly display, publicly perform, sublicense, and distribute the
      Work and such Derivative Works in Source or Object form.

   3. Grant of Patent License. Subject to the terms and conditions of
      this License, each Contributor hereby grants to You a perpetual,
      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
      (except as stated in this section) patent license to make, have made,
      use, offer to sell, sell, import, and otherwise transfer the Work,
      where such license applies only to those patent claims licensable
      by such Contributor that are necessarily infringed by their
      Contribution(s) alone or by combination of their Contribution(s)
      with the Work to which such Contribution(s) was submitted. If You
      institute patent litigation against any entity (including a
      cross-claim or counterclaim in a lawsuit) alleging that the Work
      or a Contribution incorporated within the Work constitutes direct
      or contributory patent infringement, then any patent licenses
      granted to You under this License for that Work shall terminate
      as of the date such litigation is filed.

   4. Redistribution. You may reproduce and distribute copies of the
      Work or Derivative Works thereof in any medium, with or without
      modifications, and in Source or Object form, provided that You
      meet the following conditions:

      (a) You must give any other recipients of the Work or
          Derivative Works a copy of this License; and

      (b) You must cause any modified files to carry prominent notices
          stating that You changed the files; and

      (c) You must retain, in the Source form of any Derivative Works
          that You distribute, all copyright, patent, trademark, and
          attribution notices from the Source form of the Work,
          excluding those notices that do not pertain to any part of
          the Derivative Works; and

      (d) If the Work includes a "NOTICE" text file as part of its
          distribution, then any Derivative Works that You distribute must
          include a readable copy of the attribution notices contained
          within such NOTICE file, excluding those notices that do not
          pertain to any part of the Derivative Works, in at least one
          of the following places: within a NOTICE text file distributed
          as part of the Derivative Works; within the Source form or
          documentation, if provided along with the Derivative Works; or,
          within a display generated by the Derivative Works, if and
          wherever such third-party notices normally appear. The contents
          of the NOTICE file are for informational purposes only and
          do not modify the License. You may add Your own attribution
          notices within Derivative Works that You distribute, alongside
          or as an addendum to the NOTICE text from the Work, provided
          that such additional attribution notices cannot be construed
          as modifying the License.

      You may add Your own copyright statement to Your modifications and
      may provide additional or different license terms and conditions
      for use, reproduction, or distribution of Your modifications, or
      for any such Derivative Works as a whole, provided Your use,
      reproduction, and distribution of the Work otherwise complies with
      the conditions stated in this License.

   5. Submission of Contributions. Unless You explicitly state otherwise,
      any Contribution intentionally submitted for inclusion in the Work
      by You to the Licensor shall be under the terms and conditions of
      this License, without any additional terms or conditions.
      Notwithstanding the above, nothing herein shall supersede or modify
      the terms of any separate license agreement you may have executed
      with Licensor regarding such Contributions.

   6. Trademarks. This License does not grant permission to use the trade
      names, trademarks, service marks, or product names of the Licensor,
      except as required for reasonable and customary use in describing the
      origin of the Work and reproducing the content of the NOTICE file.

   7. Disclaimer of Warranty. Unless required by applicable law or
      agreed to in writing, Licensor provides the Work (and each
      Contributor provides its Contributions) on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
      implied, including, without limitation, any warranties or conditions
      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
      PARTICULAR PURPOSE. You are solely responsible for determining the
      appropriateness of using or redistributing the Work and assume any
      risks associated with Your exercise of permissions under this License.

   8. Limitation of Liability. In no event and under no legal theory,
      whether in tort (including negligence), contract, or otherwise,
      unless required by applicable law (such as deliberate and grossly
      negligent acts) or agreed to in writing, shall any Contributor be
      liable to You for damages, including any direct, indirect, special,
      incidental, or consequential damages of any character arising as a
      result of this License or out of the use or inability to use the
      Work (including but not limited to damages for loss of goodwill,
      work stoppage, computer failure or malfunction, or any and all
      other commercial damages or losses), even if such Contributor
      has been advised of the possibility of such damages.

   9. Accepting Warranty or Additional Liability. While redistributing
      the Work or Derivative Works thereof, You may choose to offer,
      and charge a fee for, acceptance of support, warranty, indemnity,
      or other liability obligations and/or rights consistent with this
      License. However, in accepting such obligations, You may act only
      on Your own behalf and on Your sole responsibility, not on behalf
      of any other Contributor, and only if You agree to indemnify,
      defend, and hold each Contributor harmless for any liability
      incurred by, or claims asserted against, such Contributor by reason
      of your accepting any such warranty or additional liability.

   END OF TERMS AND CONDITIONS

   APPENDIX: How to apply the Apache License to your work.

      To apply the Apache License to your work, attach the following
      boilerplate notice, with the fields enclosed by brackets "[]"
      replaced with your own identifying information. (Don't include
      the brackets!)  The text should be enclosed in the appropriate
      comment syntax for the file format. We also recommend that a
      file or class name and description of purpose be included on the
      same "printed page" as the copyright notice for easier
      identification within third-party archives.

   Copyright [yyyy] [name of copyright owner]

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
\`\`\`
`;var Gc='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M480-339.5 234.261-585.239 283-633.978l197 198 197-197 48.739 48.739L480-339.5Z"/></svg>',ba=Gc;var _c='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M261.152-194.022v-68.13h311.674q67.848 0 116.435-45.783 48.587-45.782 48.587-113.108 0-67.087-48.587-112.99-48.587-45.902-116.435-45.902H283.805l110.173 110.174-47.739 47.739L154.022-614l192.217-192.218 47.739 47.74-110.173 110.413h288.021q96.196 0 165.294 65.674 69.098 65.674 69.098 161.348 0 95.434-69.098 161.228-69.098 65.793-165.294 65.793H261.152Z"/></svg>',va=_c;var jc='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M388.174-194.022q-96.196 0-165.174-65.674-68.978-65.674-68.978-161.347 0-95.435 68.978-161.229 68.978-65.793 165.174-65.793h288.261L566.022-758.478l47.739-47.74L806.218-614 613.761-422.022l-47.739-47.739 110.413-110.174H387.174q-67.848 0-116.435 45.783-48.587 45.782-48.587 113.109 0 67.326 48.587 113.108 48.587 45.783 116.435 45.783h311.674v68.13H388.174Z"/></svg>',ya=jc;var Zc='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M687.805-222.152h203v68.13h-271.37l68.37-68.13Zm-515.501 68.13-81.478-84.239q-20.431-19.622-19.792-47.235.64-27.613 19.031-47.004l456.326-494.413q18.391-19.391 46.314-19.272 27.923.12 47.404 19.511L841.283-615.5q19.63 19.622 20.63 47.855 1 28.232-18.63 47.623l-341.957 366H172.304Zm302.695-68.13 322.305-349.37-203.413-213.413-452.848 499.174 61.37 63.609h272.586ZM480-480Z"/></svg>',xa=Zc;var Yc='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M813-61 605-269 503-160H179l-81-84q-18-17-17.5-41.5T97-327l216-234L61-813l43-43 752 752-43 43ZM206-220h274l83-91-209-209-212 234 64 66Zm482-138-42-42 158-172-207-217-161 179-41-41 160-174q16-17 40.567-17 24.566 0 41.433 17l205 215q17 17 18 42t-16 42L688-358ZM541-505Zm-82 89Z"/></svg>',wa=Yc;var Xc='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M402.097-34.022q-27.578 0-52.794-12.858-25.216-12.859-40.216-36.337L53.044-468.24l20.928-16q17.985-15 41.322-19 23.336-4 47.801 14.383l114.514 87.312v-411.804q0-13.641 9.439-23.016 9.439-9.375 23.174-9.375t22.952 9.375q9.217 9.375 9.217 23.016v533.978L172.935-404.022l189.934 284.373q6.805 10.323 16.699 15.584 9.893 5.26 22.432 5.26h291.826q37.1 0 62.355-25.254 25.254-25.254 25.254-62.354v-587.413q0-13.641 9.439-23.016 9.439-9.376 23.174-9.376T837-796.842q9.218 9.375 9.218 23.016v587.413q0 63.957-44.218 108.174-44.217 44.217-108.174 44.217H402.097Zm43.946-443.587v-417.174q0-13.641 9.274-23.016 9.273-9.375 23.008-9.375t22.998 9.375q9.264 9.375 9.264 23.016v417.174h-64.544Zm168.196 0v-376.217q0-13.641 9.426-23.016 9.426-9.376 23.141-9.376 13.614 0 22.795 9.376 9.182 9.375 9.182 23.016v376.217h-64.544ZM477.065-288.326Z"/></svg>',Ta=Xc;var Qc='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M439.5-74.022q-32.2 0-61.652-13.247-29.452-13.248-49.153-38.535L109.543-404.913l27.218-27.065q15.888-15.545 38.194-18.773 22.306-3.227 42.219 7.49l93.978 49.652v-357.348q0-13.915 9.653-23.512 9.653-9.596 23.66-9.596 14.008 0 23.456 9.596 9.449 9.597 9.449 23.512v467.631l-150.935-80.348 156.478 197.761q10.486 12.622 25.085 19.028 14.599 6.407 31.024 6.407H652.87q36.463 0 61.677-25.04t25.214-61.692v-163.942q0-27.891-19.091-46.815-19.092-18.924-46.888-18.924H457.37v-66.457h216.058q55.15 0 93.97 38.647t38.82 93.549v164.022q0 64.195-44.577 108.652-44.576 44.456-108.664 44.456H439.5ZM191.761-662.609q-11.535-19.444-17.746-41.981-6.211-22.538-6.211-46.401 0-73.357 51.604-124.77 51.603-51.413 124.818-51.413t124.853 51.635q51.638 51.635 51.638 124.895 0 23.799-6.211 46.238t-17.745 41.797l-57.5-33.108q7-12 11-26t4-29.478q0-45.522-32.118-77.522-32.118-32-78-32t-77.882 32.083q-32 32.083-32 77.917 0 15 4 29t11 26l-57.5 33.108Zm291.456 330.696Z"/></svg>',Sa=Qc;var Jc='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="m724.391-486.891 48.979-48.739 52.521 52.521q21.631 21.746 21.631 52.156t-21.631 52.04L672.087-226.348q-22.746 22.631-52.155 22.631-29.41 0-52.041-22.631L249.587-544.891q-22.391-22.152-22.511-51.739-.119-29.588 22.511-52.218l153.565-152.565q22.63-22.63 52.098-22.63 29.467 0 52.098 22.63l47.282 47.522-47.739 48.5-51.521-51.522L295.087-596.63l325.022 325.782 160.043-160.043-55.761-56ZM533.574-30.761q-98.76 0-186.047-37.5-87.288-37.5-152.168-102.88-64.881-65.381-102.38-152.638-37.5-87.257-37.5-185.982h62.63q0 78.565 28.163 148.75t76.967 124.587q48.804 54.402 115.272 89.663 66.467 35.261 142.554 43.978L355.848-228 401-273.152 631.152-43.053Q608.253-37 585.237-33.88t-51.663 3.12ZM664.63-602.63q-15 0-27.5-12.5t-12.5-27.5v-120q0-15 12.5-27.5t27.5-12.5h1v-42q0-33 22.5-55.5t55.5-22.5q33 0 55.5 22.5t22.5 55.5v42h2q15 0 27.5 12.5t12.5 27.5v120q0 15-12.5 27.5t-27.5 12.5h-159Zm39-200h80v-42.106q0-17.894-11-28.894t-29-11q-18 0-29 11t-11 28.894v42.106ZM540.239-513.761Z"/></svg>',Ca=Jc;var ed='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M182.152-114.022q-27.599 0-47.865-20.265-20.265-20.266-20.265-47.865v-595.696q0-27.697 20.265-48.033 20.266-20.337 47.865-20.337h595.696q27.697 0 48.033 20.337 20.337 20.336 20.337 48.033v595.696q0 27.599-20.337 47.865-20.336 20.265-48.033 20.265H182.152Zm0-68.13h595.696v-595.696H182.152v595.696Zm50.739-92.696h495.218L578-476.587l-132 171-93-127-120.109 157.739Zm-50.739 92.696v-595.696 595.696Zm157.966-383.783q22.576 0 38.262-15.803 15.685-15.803 15.685-38.38 0-22.576-15.803-38.262-15.803-15.685-38.38-15.685-22.576 0-38.262 15.803-15.685 15.803-15.685 38.38 0 22.576 15.803 38.262 15.803 15.685 38.38 15.685Z"/></svg>',Ea=ed;var td='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M425.935-154.022v-544.065H194.022v-108.131h572.196v108.131H534.304v544.065H425.935Z"/></svg>',Pa=td;var od='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M120-439v-83h60v83h-60Zm0-170v-83h60v83h-60Zm0-171v-60h60v60h-60Zm148 0v-60h83v60h-83Zm171 660v-60h83v60h-83Zm0-660v-60h83v60h-83Zm170 660v-60h83v60h-83Zm171 0v-60h60v60h-60Zm0-148v-83h60v83h-60Zm0-171v-83h60v83h-60Zm0-170v-171H609v-60h231v231h-60ZM120-120v-231h60v171h171v60H120Z"/></svg>',ka=od;var rd='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M261-120q-24.75 0-42.375-17.625T201-180v-570h-41v-60h188v-30h264v30h188v60h-41v570q0 24-18 42t-42 18H261Zm438-630H261v570h438v-570ZM367-266h60v-399h-60v399Zm166 0h60v-399h-60v399ZM261-750v570-570Z"/></svg>',La=rd;var nd='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M180-81q-24 0-42-18t-18-42v-603h60v603h474v60H180Zm120-120q-24 0-42-18t-18-42v-560q0-24 18-42t42-18h440q24 0 42 18t18 42v560q0 24-18 42t-42 18H300Zm0-60h440v-560H300v560Zm0 0v-560 560Z"/></svg>',Qi=nd;var id='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M220-80q-24 0-42-18t-18-42v-680q0-24 18-42t42-18h340l240 240v156h-60v-116H520v-220H220v680h300v60H220Zm0-60v-680 680Zm536-223 28 28-164 164v51h51l164-164 28 28L687-80H580v-107l176-176Zm107 107L756-363l61-61q9-9 21-9t21 9l65 65q9 9 9 21t-9 21l-61 61Z"/></svg>',Ia=id;var sd='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M378-246 154-470l43-43 181 181 384-384 43 43-427 427Z"/></svg>',Ra=sd;var ad='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M545.63-401.022 431.587-515.065 217.478-301.196l114.283 114.283L545.63-401.022Zm-65.304-163.021 114.283 114.282 214.674-214.674-114.044-114.282-214.913 214.674Zm-72.848-23.87 211 211L389.5-147.935q-21.152 21.153-58.359 21.153-37.206 0-58.119-21.153l-10.761-10.521-44.913 44.674h-155L184.26-235.456l-3.761-4q-24.391-24.153-23.891-61.12.5-36.968 24.891-61.359l225.978-225.978Zm0 0 241.783-241.783q19.63-19.63 48.859-19.63 29.228 0 49.098 19.63l111.043 111.283q19.63 19.63 19.13 51.478-.5 31.848-20.13 51.479L618.478-376.913l-211-211Z"/></svg>',za=ad;var ld='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M180-180h44l443-443-44-44-443 443v44Zm614-486L666-794l42-42q17-17 42-17t42 17l44 44q17 17 17 42t-17 42l-42 42Zm-42 42L248-120H120v-128l504-504 128 128Zm-107-21-22-22 44 44-22-22Z"/></svg>',Ma=ld;var cd='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M250-160q-86 0-148-62T40-370q0-78 49.5-137.5T217-579q20-97 94-158.5T482-799q113 0 189.5 81.5T748-522v24q72-2 122 46.5T920-329q0 69-50 119t-119 50H510q-24 0-42-18t-18-42v-258l-83 83-43-43 156-156 156 156-43 43-83-83v258h241q45 0 77-32t32-77q0-45-32-77t-77-32h-63v-84q0-89-60.5-153T478-739q-89 0-150 64t-61 153h-19q-62 0-105 43.5T100-371q0 62 43.929 106.5Q187.857-220 250-220h140v60H250Zm230-290Z"/></svg>',Ba=cd;var dd='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M435-80q-48-7-93-25t-85-48l43-44q32 24 66 37.5t69 19.5v60Zm90 0v-60q110-21 182.5-103.5T780-443q0-127-86.5-213.5T480-743h-20l79 79-44 44-153-153 153-153 44 44-79 79h20q75 0 140.5 28T735-698q49 49 77 114.5T840-443q0 140-89 241T525-80ZM194-216q-28-38-46.5-84.5T122-398h61q5 38 18.5 73t36.5 65l-44 44Zm-72-272q7-50 25-95.5t47-85.5l44 43q-23 33-36.5 68T183-488h-61Z"/></svg>',Da=dd;var pd='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M180-120q-24 0-42-18t-18-42h60v60Zm-60-120v-125h60v125h-60Zm0-185v-111h60v111h-60Zm0-171v-124h60v124h-60Zm0-184q0-24 18-42t42-18v60h-60Zm120 660v-60h125v60H240Zm0-660v-60h125v60H240Zm185 660v-60h111v60H425Zm0-660v-60h111v60H425Zm171 660v-60h124v60H596Zm0-660v-60h124v60H596Zm184 660v-60h60q0 24-18 42t-42 18Zm0-120v-125h60v125h-60Zm0-185v-111h60v111h-60Zm0-171v-124h60v124h-60Zm0-184v-60q24 0 42 18t18 42h-60Z"/></svg>',Aa=pd;var ud='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="m249-207-42-42 231-231-231-231 42-42 231 231 231-231 42 42-231 231 231 231-42 42-231-231-231 231Z"/></svg>',Va=ud;var hd='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M600-360Zm-280 98q10 2 19.5 2H360q5.5 0 10.25-.25T380-261v121h440v-440H699q.5-5 .75-9.75T700-600v-20.5q0-9.5-2-19.5h122q24.75 0 42.375 17.625T880-580v440q0 24.75-17.625 42.375T820-80H380q-24.75 0-42.375-17.625T320-140v-122Zm40-58q-117 0-198.5-81.5T80-600q0-117 81.5-198.5T360-880q117 0 198.5 81.5T640-600q0 117-81.5 198.5T360-320Zm-.212-60Q451-380 515.5-444.288q64.5-64.288 64.5-155.5T515.712-755.5q-64.288-64.5-155.5-64.5T204.5-755.712q-64.5 64.288-64.5 155.5T204.288-444.5q64.288 64.5 155.5 64.5ZM360-600Z"/></svg>',Oa=hd;var md='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="M560-120q-12 0-21-9t-9-21q0-13 9-21.5t21-8.5q59 0 99.5-24t40.5-56q0-23-29.5-45T591-339l47-47q63 19 92.5 52.5T760-260q0 67-61 103.5T560-120ZM240-414q-64-14-92-44t-28-62q0-35 26-63t120-62q66-24 85-39t19-35q0-25-22-43t-68-18q-27 0-46 7t-34 22q-8 8-20.5 9.5T157-748q-11-8-11.5-20t7.5-21q17-22 51-36.5t76-14.5q68 0 109 32.5t41 88.5q0 41-28.5 69.5T290-590q-67 25-88.5 39.5T180-520q0 16 27 30.5t81 27.5l-48 48Zm496-154L608-696l45-45q18-18 40-18t40 18l48 48q18 18 18 40t-18 40l-45 45ZM220-180h42l345-345-42-42-345 345v42Zm-60 60v-128l405-405 128 128-405 405H160Zm405-447 42 42-42-42Z"/></svg>',Fa=md;var fd='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="m480-522 42 42 249-249-42-42-249 249ZM180-180h42l258-258-42-42-258 258v42Zm362-238L418-542l198-198-30-30-234 234-43-43 228-228q25-25 49.5-25.5T637-807l23 23 45-45q11-11 25-11t25 11l73 73q11 11 11 26t-11 26L542-418ZM244-120H120v-124l298-298 124 124-298 298Z"/></svg>',Ha=fd;var gd='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 0 24 24" width="48"><path style="fill: var(--icon-color);" d="M19 2h-4.18C14.4.84 13.3 0 12 0S9.6.84 9.18 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/></svg>',Na=gd;var bd='<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48"><path style="fill: var(--icon-color);" d="m141-518-60-6q5-46 20-90t40-82l51 33q-19 34-32 70.5T141-518Zm55 317q-32-31-56.5-69T101-353l58-19q13 37 33 69t47 59l-43 43Zm102-568-33-51q40-25 82.5-39.5T438-880l6 60q-41 5-75.5 17.5T298-769ZM488-82q-38 0-74-6t-68-17l22-58q27 10 59 15t61 6v60Zm232-635q-29-29-62-50.5T587-802l21-57q47 16 85.5 41.5T763-760l-43 43Zm93 600L682-248v130h-60v-232h232v60H724l131 131-42 42Zm6-367q-1-29-5.5-59T797-600l58-18q12 32 18 65.5t6 68.5h-60Z"/></svg>',$a=bd;var vd=`<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 0 24 24" width="48px"><path style="fill: var(--icon-color);" d="M3 17h18v-2H3v2zm0 3h18v-1H3v1zm0-7h18v-3H3v3zm0-9v4h18V4H3z"/></svg>
`,Wa=vd;var ee=s=>{let o=document.createElement("div");return o.innerHTML=s,o.childNodes[0]},yd=({IconProvider:s,EraserMode:o})=>class extends s{makeUndoIcon(){return ee(va)}makeRedoIcon(){return ee(ya)}makeDropdownIcon(){return ee(ba)}makeEraserIcon(e,r){return ee(r===o.PartialStroke?wa:xa)}makeSelectionIcon(e){return ee(e==="lasso"?$a:Aa)}makeRotateIcon(){return ee(Da)}makeHandToolIcon(){return ee(Ta)}makeTouchPanningIcon(){return ee(Sa)}makeRotationLockIcon(){return ee(Ca)}makeInsertImageIcon(){return ee(Ea)}makeUploadFileIcon(){return ee(Ba)}makeTextIcon(e){return ee(Pa)}makePenIcon(e){let r=this.isRoundedTipPen(e)?Ma:za;this.isPolylinePen(e)&&(r=Ha);let n=ee(r);n.setAttribute("viewBox","0 -880 960 1000");let i=document.createElementNS("http://www.w3.org/2000/svg","path");if(i.setAttribute("d",`
			M110,-25 L850,-25
		`),i.style.stroke=e.color.toHexString(),i.style.strokeWidth=`${Math.sqrt(e.thickness)*20}`,this.isRoundedTipPen(e)?i.style.strokeLinecap="round":i.style.strokeLinecap="square",n.insertAdjacentElement("afterbegin",i),e.color.a<1){let a=this.makeCheckerboardPattern(),l=document.createElementNS("http://www.w3.org/2000/svg","defs");l.appendChild(a.patternDefElement),n.appendChild(l);let c=i.cloneNode();c.style.stroke=a.patternRef,n.insertAdjacentElement("afterbegin",c)}return n}makeShapeAutocorrectIcon(){return ee(Oa)}makeStrokeSmoothingIcon(){return ee(Fa)}makePressureSensitivityIcon(){return ee(Wa)}makeResizeImageToSelectionIcon(){return ee(ka)}makeDuplicateSelectionIcon(){return ee(Qi)}makeCopyIcon(){return ee(Qi)}makePasteIcon(){return ee(Na)}makeDeleteSelectionIcon(){return ee(La)}makeCloseIcon(){return ee(Va)}makeSaveIcon(){return ee(Ra)}makeConfigureDocumentIcon(){return ee(Ia)}licenseInfo(){return ga}},Ua=yd;var xd=Ua({IconProvider:Ye,EraserMode:Bt,SelectionMode:ot});var qa=xd;var Ka={debugWidgetTitle:"Debug"},wd={en:{...Ka}},Ga=()=>ut(navigator.languages,wd,Ka);var xo=class extends pe{constructor(e){super(e,"custom-pen-widget");this.idCounter=0;this.localizations=Ga(),this.container.classList.add("dropdownShowable")}handleClick(){this.setDropdownVisible(!this.isDropdownVisible())}getTitle(){return this.localizations.debugWidgetTitle}createIcon(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.innerHTML=`
			<style>
				.debug-icon path {
					stroke-linecap:round;
					stroke-linejoin:round;
					stroke-width: 48;
					stroke: #ff4e4e;
					fill: none;
				}
			</style>
			<g class="debug-icon">
				<path d="M159,149q37-43 53-45q33-4 46,46q3,10 -11,10q-23,1 -92,3q-18,0 -39,60q-35,101 30,132q69,33 121,1q71-43 37-138q-5-15 -38-52"/>
				<path d="M307,205q14-13 58-47"/>
				<path d="M316,264q22,3 87,13"/>
				<path d="M304,341q70,54 71,54"/>
				<path d="M133,197q-21-3 -85-14"/>
				<path d="M103,267q-38,10 -70,24q-1,0 -1,0"/>
				<path d="M102,333q-50,39 -50,41"/>
				<path d="M167,182q-42,95 -40,122q0,1 40-94q16-37 12-17q-30,164 -18,131q14-39 53-158q11-34 -16,140q-11,69 2,33q15-39 49-160q11-40 -12,167q0,3 11-10q13-15 25-73q1-4 11,11q6,11 -5,51q-1,4 1-15q12-86 -3-94"/>
				<path d="M198,140q10,2 38,9"/>
			</g>
		`,e.setAttribute("width","32"),e.setAttribute("height","32"),e.setAttribute("viewBox","8 76 419 343"),e}fillDropdown(e){let r=document.createElement("div");r.classList.add("toolbar-spacedList","toolbar-nonbutton-controls-main-list");let n=(d,p)=>{let u=`debugwidget-input-${this.idCounter++}`,h=document.createElement("div"),f=document.createElement("label");f.htmlFor=u,p.id=u,f.innerText=d,h.replaceChildren(f,p),r.appendChild(h)},i=document.createElement("input");i.type="number",i.min="0.1",i.max="10",i.oninput=()=>{this.editor.display.setDevicePixelRatio(parseFloat(i.value))},i.value=`${window.devicePixelRatio}`,n("DPR",i);let a=document.createElement("input");a.type="checkbox",a.oninput=()=>{this.editor.display.getCache().setIsDebugMode(a.checked)},n("Cache debugging",a);let l=document.createElement("input");l.type="checkbox",l.oninput=()=>{X.setDebugMode(l.checked),a.disabled=l.checked,a.checked&&(a.checked=!1)},n("EditorImage debugging",l);let c=document.createElement("input");return c.type="checkbox",c.oninput=()=>{this.editor.getRootElement().style.direction=c.checked?"rtl":"ltr"},c.checked=getComputedStyle(this.editor.getRootElement()).direction==="rtl",n("RTL",c),e.replaceChildren(r),!0}};var sr={};sr.en={localStorageSave:"Local Storage",databaseLoadError:"Database failed to load.",untitledImage:"Untitled Image",templateLightGrid:"Light Grid",templateDarkGrid:"Dark Grid",templateEmptyPageLight:"Empty Page (Light)",templateEmptyPageDark:"Empty Page (Dark)",warningSaveTargetOnlySupportsOneImage:"Warning: On this system, js-draw only supports saving one image. While this image will still be downloadable, you won't be able to save it to this website.",confirmUnsavedChanges:"There may be unsaved changes. Really quit?",advancedOptions:"Advanced...",pasteSVGTextDataHint:"Paste SVG text data here",submit:"Submit",newImageHeading:"New Image",new:"New",saveUnsavedChanges:"There may be unsaved changes. Save them?",save:"Save",delete:"Delete",reallyDelete:s=>`Are you sure you want to delete ${s}?`,settings:"Settings",keyboardShortcuts:"Keyboard Shortcuts",reset:"Reset",bindingParseError:s=>`Error: ${s}`,debugging:"Debugging",enableDebugToolbarWidget:"Enable debug toolbar widget",toolbarType:"Toolbar type",useEdgeToolbar:"Use edgemenu-style toolbar",imageTitleLabel:"Image title: ",viewGeneratedSVGImage:"View generated SVG image",viewGeneratedPNGImage:"View generated PNG image",previewLabel:"Preview: ",download:"Download",close:"Close",savedAs:s=>`Saved as ${s}.`,imageSize:s=>`Image size: ${s}`};sr.es={...sr.en,new:"Nuevo",delete:"Borre",reallyDelete:s=>`\xBFEst\xE1 seguro que quiere borrar "${s}"?`,settings:"Ajustes",imageTitleLabel:"T\xEDtulo: ",viewGeneratedSVGImage:"Ver imagen de SVG",viewGeneratedPNGImage:"Ver imagen de PNG",download:"Descargar",close:"Cerrar",savedAs:s=>`Guardado con t\xEDtulo ${s}.`,imageSize:s=>`Tama\xF1o de imagen: ${s}`};var _a=()=>ut(navigator.languages,sr,sr.en);(()=>{if(typeof document<"u"&&typeof document.createElement=="function"){let s=document.createElement("style");s.textContent=".save-item-list{display:flex;flex-direction:column-reverse;max-width:500px;margin-left:auto;margin-right:auto}.save-item{display:flex;justify-content:space-between;flex-direction:row;max-height:120px;border-bottom:1px solid gray;background-color:#eee;--icon-color: black}.save-item button{background-color:transparent;color:inherit;border:none}.save-item .icon{max-height:100%;width:50px}.save-item button:hover{background-color:#aaa}.save-item .open-button{flex-grow:1;display:flex;flex-direction:row;justify-content:start;align-items:center;font-size:1.5rem}.save-item-list{margin-bottom:30px}@media(prefers-color-scheme: dark){.save-item{background-color:#333;color:white;--icon-color: white}}",document.head.appendChild(s)}})();var Td=async(s,o,e)=>{let r=document.createElement("div");r.classList.add("save-item-list");let n=new Ye;for(let i of await s.getEntries()){let a=Sd(i.title,i.getIcon(),()=>{o(i)},[{label:e.delete,icon:n.makeDeleteSelectionIcon(),action:async l=>{confirm(e.reallyDelete(i.title))&&(await i.delete(),l.remove())}}]);r.appendChild(a)}return r},Sd=(s,o,e,r=[])=>{let n=document.createElement("div");n.classList.add("save-item");let i=document.createElement("button");i.classList.add("open-button");let a=document.createElement("span");a.innerText=s,o=o.cloneNode(!0),o.classList.add("icon"),i.appendChild(o),i.appendChild(a),i.onclick=()=>e(),n.appendChild(i);for(let l of r){let c=document.createElement("button"),d=document.createElement("div");d.innerText=l.label,c.appendChild(l.icon.cloneNode(!0)),c.appendChild(d),c.onclick=()=>l.action(n),n.appendChild(c)}return n},Ji=Td;var mn="http://www.w3.org/2000/svg",wo=s=>{let o=document.createElementNS(mn,"svg"),e=r=>{let n=document.createElementNS(mn,"text");n.appendChild(document.createTextNode(s)),n.setAttribute("x","50"),n.setAttribute("y","50"),n.setAttribute("style",`
			text-anchor: middle;
			dominant-baseline: middle;
			font-size: 100px;
			${r}
		`),o.appendChild(n)};return e(`
		fill: var(--icon-color);
		filter: blur(4px) invert(1);
	`),e("fill: var(--icon-color);"),o.setAttribute("viewBox","0 0 100 100"),o},ja=()=>{let s=document.createElementNS(mn,"svg"),o=e=>{let r=document.createElementNS(mn,"path");r.style.fill="var(--icon-color)",r.setAttribute("d",e),s.appendChild(r)};return o("M 50,10 V 60 H 35 L 55,85 75,60 H 60 V 10 Z"),o("m 15,85 v 10 h 85 V 85 Z"),s.setAttribute("viewBox","5 0 100 100"),s};var Ht="imageData",it="imageMetadata",Cd=s=>s?typeof s.id!="number"?"Given record has non-number ID":typeof s.name!="string"?"Given record has non-string name":typeof s.previewData!="string"&&s.previewData?"Given record has non-string (and non-undefined) previewData":null:"Not given a record!",fn=class s{constructor(o,e){this.db=o;this.localization=e}static create(o){return new Promise((e,r)=>{console.log("creating...");let n=indexedDB.open("js-draw-saves",1);n.onsuccess=()=>{let i=n.result;console.log("indexedDB: \u2611"),e(new s(i,o))},n.onerror=()=>{console.log(`reject: ${n.error}`),r(new Error(o.databaseLoadError))},n.onupgradeneeded=i=>{console.log("upgradeneeded");let a=i.target.result,l=a.createObjectStore(it,{keyPath:"id",autoIncrement:!0});l.createIndex("id","id",{unique:!0}),l.createIndex("name","name",{unique:!1}),a.createObjectStore(Ht,{keyPath:"id",autoIncrement:!0}).createIndex("id","id",{unique:!0})}})}deleteEntry(o){return new Promise((e,r)=>{let n=this.db.transaction(["imageData"],"readwrite").objectStore("imageData").delete(o),i=this.db.transaction(["imageMetadata"],"readwrite").objectStore("imageMetadata").delete(o);n.onerror=()=>r(new Error(`Error deleting image data: ${n.error}`)),i.onerror=()=>r(new Error(`Error deleting image metadata: ${i.error}`));let a=()=>{a=e};n.onsuccess=()=>a(),i.onsuccess=()=>a()})}readImageMetadata(o){return new Promise((e,r)=>{let n=this.db.transaction([it],"readonly").objectStore(it).get(o);n.onsuccess=i=>{let a=i.target.result;if(console.log(`read metadata for ${o} with result ${a}`),a){let l=Cd(a);if(l){r(new Error("Reading image metadata: "+l));return}}e(a??null)},n.onerror=()=>r(new Error(`Error reading image: ${n.error}`))})}updateEntryMetadata(o){return new Promise((e,r)=>{let n=this.db.transaction([it],"readwrite").objectStore(it).put(o);n.onsuccess=()=>e(),n.onerror=()=>r(new Error("Error saving metadata: "+String(n.error)))})}makeMetadata(o,e,r){return{id:o,name:e??this.localization.untitledImage,lastUpdateTime:new Date().getTime(),previewData:r}}async updateEntryPreview(o,e){let r=await this.readImageMetadata(o)??this.makeMetadata(o);r.previewData=e,r.previewType="datauri",await this.updateEntryMetadata(r)}async updateEntryTitle(o,e){let r=await this.readImageMetadata(o)??this.makeMetadata(o);r.name=e,await this.updateEntryMetadata(r)}async updateStoreEntryModifyTime(o){let e=await this.readImageMetadata(o)??this.makeMetadata(o);e.lastUpdateTime=new Date().getTime(),await this.updateEntryMetadata(e)}async writeImage(o,e){await new Promise((r,n)=>{let i=this.db.transaction([Ht],"readwrite").objectStore(Ht).put({id:o,data:e});i.onsuccess=()=>r(),i.onerror=()=>n(new Error("Error saving data: "+String(i.error)))}),await this.updateStoreEntryModifyTime(o)}readImage(o){return new Promise((e,r)=>{let n=this.db.transaction([Ht],"readonly").objectStore(Ht).get(o);n.onsuccess=i=>{let a=i.target.result.data;if(typeof a!="string"){r(new Error("Reading image: Type of image data is not string"));return}e(a)},n.onerror=()=>r(new Error("Error reading image: "+String(n.error)))})}createStoreEntry(o){return{title:o.name,getIcon:()=>{if(o.previewData){let e=new Image;return e.src=o.previewData,e}else return wo("?")},updatePreview:async e=>{await this.updateEntryPreview(o.id,e)},updateTitle:async e=>{await this.updateEntryTitle(o.id,e)},delete:async()=>{await this.deleteEntry(o.id)},write:async e=>{await this.writeImage(o.id,e)},read:async()=>await this.readImage(o.id)}}getEntries(){let o=this.db.transaction(it,"readonly").objectStore(it);return new Promise((e,r)=>{let n=o.getAll();n.onsuccess=i=>{let a=i.target.result;a.sort((l,c)=>{let d=(l.lastUpdateTime??0)-(c.lastUpdateTime??0);return d===0?l.id-c.id:d}),e(a.map(l=>this.createStoreEntry(l)))},n.onerror=i=>{r(i)}})}createNewEntry(){let o={name:this.localization.untitledImage,lastUpdateTime:new Date().getTime()},e=this.db.transaction([it,Ht],"readwrite");return new Promise((r,n)=>{let i=e.objectStore(it).add(o),a=e.objectStore(Ht).add({data:""});i.onerror=()=>n(new Error(`Error adding image metadata: ${i.error}`)),a.onerror=()=>n(new Error(`Error adding image data: ${a.error}`));let l=d=>parseInt(d.target.result),c=d=>{let p=l(d);c=u=>{let h=l(u);if(l(u)!==p){n(new Error(`Error creating new image:
								IDs assigned to image and metadata don't match (${p}, ${h})`));return}r(this.createStoreEntry({id:p,...o}))}};i.onsuccess=d=>c(d),a.onsuccess=d=>c(d)})}};var ar="lastSave",gn=class{constructor(o){this.entry={title:o.localStorageSave,getIcon:()=>ja(),delete:async()=>{localStorage.removeItem(ar)},write:async e=>{localStorage.setItem(ar,e)},read:async()=>localStorage.getItem(ar)??"",updatePreview:null,updateTitle:null}}async getEntries(){return ar in localStorage?[this.entry]:[]}async createNewEntry(){return ar in localStorage?null:this.entry}};var Ed=(s,o,e,r,n,i)=>{let a=o.outerHTML,l=document.createElement("dialog");l.classList.add("popupContainer"),l.appendChild(document.createTextNode("Saving...")),document.body.appendChild(l);let c=document.createElement("iframe");c.src="about:blank",c.setAttribute("sandbox","allow-same-origin allow-downloads allow-scripts"),c.setAttribute("csp","default-src 'about:blank'"),l.replaceChildren(c);let d=c.contentWindow,p=c.contentDocument;if(d===null)throw new Error("Unable to open save popup!");p.open(),p.write(`
		<!DOCTYPE html>
		<html>
		<head>
			<meta name='viewport' content='initial-scale=1.0'/>
			<meta charset='utf-8'/>
		</head>
		<body>
			<style>
				#previewRegion {
					display: flex;
					flex-direction: row;
				}

				svg {
					height: auto;
					width: auto;
					max-width: 500px;
					max-height: 100vh;
					flex-grow: 1;
					border: 1px solid gray;
				}

				textarea {
					flex-grow: 1;
					flex-shrink: 1;
					width: auto;
				}

				main {
					border: 1px solid gray;
					background-color: #eee;
					font-family: sans-serif;

					max-width: 600px;
					margin-left: auto;
					margin-right: auto;

					padding: 15px;
					border-radius: 15px;
				}

				#controlsArea {
					display: flex;
					flex-direction: row;
					margin-top: 14px;
				}

				#controlsArea button {
					flex-grow: 1;
				}

				body, :root {
					background-color: rgba(255, 255, 255, 0.0);
				}

				:root {
					height: 100vh;
				}

				button {
					min-height: 35px;
				}

				@media (prefers-color-scheme: dark) {
					body, :root {
						background-color: rgba(0, 0, 0, 0.0);
						color: white;
					}

					main {
						background-color: #333;
					}

					a {
						color: pink;
					}

					input, button {
						background-color: #444;
						color: #eee;
						border: 1px solid #222;
						border-radius: 2px;

						transition: background-color 0.2s ease;
					}

					button:focus-visible, input:focus-visible {
						outline: 3px solid #777;
						background-color: #555;
					}

					button:active {
						background-color: #333;
					}
				}
			</style>
			<main>
				<div id='previewRegion'>
					<p>Saving to
						<code>${r.title.replace(/[<>&]/g,"")}</code>...
					</p>
				</div>
				<div><label id='filenameLabel' for='filename'>Title: </label><input id='filename' type='text'/></div>
				<div id='controlsArea'>
				</div>
			</main>
		</body>
		</html>`),p.close(),l.show();let u=p.querySelector("#previewRegion"),h=p.querySelector("#filenameLabel");h.innerText=s.imageTitleLabel;let f=p.createElement("button"),b=p.createElement("button");f.innerText=s.viewGeneratedSVGImage,b.innerText=s.viewGeneratedPNGImage,f.onclick=()=>{let B=p.createElement("p"),V=p.createElement("textarea"),F=p.createElement("button");F.style.display="none",F.innerText=s.save,F.onclick=async()=>{a=V.value,await S(a),F.style.display="none"};let U=p.createElement("img");U.style.width="150px",U.style.flexGrow="4",U.style.flexShrink="1";let j=Z=>{let se=window.btoa(String.fromCharCode(...new TextEncoder().encode(Z)));U.src="data:image/svg+xml;base64,"+se};j(a),B.innerText=s.previewLabel,V.value=a,V.oninput=()=>{j(V.value),F.style.display="block"},u.replaceChildren(B,V,U,F)},b.onclick=()=>{let B=p.createElement("img");B.src=e.toDataURL(),B.style.maxWidth="100%",u.replaceChildren(B)};let v=p.querySelector("input#filename");v.value=r.title;let g=d.document.createElement("button");g.innerText=s.download,g.onclick=()=>{let B=new Blob([a],{type:"image/svg"}),V=URL.createObjectURL(B),F=d.document.createElement("a");F.href=V,F.innerText=s.download;let U=v.value;U.endsWith(".svg")||(U+=".svg"),F.setAttribute("download",U),g.style.display="none",P.appendChild(F),F.click(),F.remove(),URL.revokeObjectURL(V)};let y=!1,m=async()=>{r.updateTitle&&r.title!==v.value&&(await r.updateTitle(v.value),y=!1)},w=()=>{y||(y=!0,setTimeout(m,500))};v.oninput=async()=>{g.style.display="block",w()};let C=d.document.createElement("button");C.innerText=s.close;let E=()=>{m(),l.remove(),i?.()};C.onclick=()=>{E()},p.documentElement.onclick=B=>{B.target===p.documentElement&&E()};let P=d.document.querySelector("main > #controlsArea");P.appendChild(C),P.appendChild(f),P.appendChild(b),P.appendChild(g);let S=async B=>{let V=`${Math.round(B.length/1024*10)/10} KiB`;B.length>1024*1024&&(V=`${Math.round(B.length/1024*10/1024)/10} MiB`);let F=s.savedAs(r.title),U;try{if(await r.write(B),r.updatePreview){let Z=T.of(80,80);await r.updatePreview(e.toDataURL(void 0,Z))}}catch(j){F="Error: "+j,U=j}u.replaceChildren(d.document.createTextNode(F),d.document.createTextNode(" "),d.document.createTextNode(s.imageSize(V))),U||n()};S(a)},Za=Ed;var Pd=(s,o)=>({title:s,write:async e=>{try{let r=await o.createWritable();await r.write(e),await r.close()}catch(r){throw new Error(`Error saving to filesystem: ${r}`)}},updateTitle:null,updatePreview:null}),Ya=Pd;(()=>{if(typeof document<"u"&&typeof document.createElement=="function"){let s=document.createElement("style");s.textContent=".floating-action-button.toplevel{position:fixed;bottom:10px;right:10px}.floating-action-button .icon-wrapper{border-radius:20px;background-color:var(--icon-background);margin-bottom:2px;box-shadow:var(--shadow-color) -3px 0px 4px;width:var(--button-width);height:var(--button-width);transition:background-color .2s ease}.floating-action-button>button{background-color:transparent;border:none;color:black;display:flex;flex-direction:column;align-items:center;--icon-color: black;--shadow-color: rgba(0, 0, 0, 0.5);--button-width: 50px;--icon-background: rgba(255, 0, 0, 1);width:var(--button-width);max-width:40vw}.floating-action-button .icon-wrapper:hover{--icon-background: rgba(255, 100, 100, 1)}.floating-action-button>.title{text-align:center}.floating-action-button .submenu-container{position:relative}.floating-action-button>.submenu-container.collapsed{display:none}@media(prefers-color-scheme: dark){.floating-action-button>button{color:white;--icon-color: white;--shadow-color: rgba(200, 200, 200, 0.4)}}",document.head.appendChild(s)}})();var lr=class{constructor({title:o,icon:e,onClick:r},n){this.onClickListeners=new Set;this.container=document.createElement("div"),this.mainButton=document.createElement("button"),this.iconWrapper=document.createElement("div"),this.titleElem=document.createElement("div"),this.container.classList.add("floating-action-button"),this.container.classList.add("toplevel"),this.iconWrapper.classList.add("icon-wrapper"),this.titleElem.classList.add("title"),this.iconWrapper.appendChild(e.cloneNode(!0)),this.titleElem.innerText=o,this.mainButton.replaceChildren(this.iconWrapper,this.titleElem),this.mainButton.onclick=()=>this.onClick(),r&&this.onClickListeners.add(r),this.container.replaceChildren(this.mainButton),n.appendChild(this.container)}onClick(){if(!this.disabled)for(let o of Array.from(this.onClickListeners.values()))o()}setDisabled(o){this.disabled=o,this.mainButton.disabled=this.disabled}addClickListener(o){return this.onClickListeners.add(o),{remove:()=>{this.onClickListeners.delete(o)}}}};var kd={lightGrid:{name:s=>s.templateLightGrid,data:()=>'<svg viewBox="0 0 500 500" width="500" height="500" version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" class="js-draw--autoresize"><g class="js-draw-image-background js-draw-image-background-grid js-draw-image-background-grid-25"><path d="M500,500L500,0L0,0L0,500L500,500" fill="#ffffff"></path><path d="M0,0L500,0M0,25L500,25M0,50L500,50M0,75L500,75M0,100L500,100M0,125L500,125M0,150L500,150M0,175L500,175M0,200L500,200M0,225L500,225M0,250L500,250M0,275L500,275M0,300L500,300M0,325L500,325M0,350L500,350M0,375L500,375M0,400L500,400M0,425L500,425M0,450L500,450M0,475L500,475M0,500L500,500M0,0L0,500M25,0L25,500M50,0L50,500M75,0L75,500M100,0L100,500M125,0L125,500M150,0L150,500M175,0L175,500M200,0L200,500M225,0L225,500M250,0L250,500M275,0L275,500M300,0L300,500M325,0L325,500M350,0L350,500M375,0L375,500M400,0L400,500M425,0L425,500M450,0L450,500M475,0L475,500M500,0L500,500" fill="none" stroke="#00000033" stroke-width=".7"></path></g></svg>'},darkGrid:{name:s=>s.templateDarkGrid,data:()=>'<svg viewBox="0 0 500 500" width="500" height="500" version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" class="js-draw--autoresize"><g class="js-draw-image-background js-draw-image-background-grid js-draw-image-background-grid-25"><path d="M500,500L500,0L0,0L0,500L500,500" fill="#1f1f1f"></path><path d="M0,0L500,0M0,25L500,25M0,50L500,50M0,75L500,75M0,100L500,100M0,125L500,125M0,150L500,150M0,175L500,175M0,200L500,200M0,225L500,225M0,250L500,250M0,275L500,275M0,300L500,300M0,325L500,325M0,350L500,350M0,375L500,375M0,400L500,400M0,425L500,425M0,450L500,450M0,475L500,475M0,500L500,500M0,0L0,500M25,0L25,500M50,0L50,500M75,0L75,500M100,0L100,500M125,0L125,500M150,0L150,500M175,0L175,500M200,0L200,500M225,0L225,500M250,0L250,500M275,0L275,500M300,0L300,500M325,0L325,500M350,0L350,500M375,0L375,500M400,0L400,500M425,0L425,500M450,0L450,500M475,0L475,500M500,0L500,500" fill="none" stroke="#e0e0e033" stroke-width=".7"></path></g></svg>'},emptyPageLight:{name:s=>s.templateEmptyPageLight,data:()=>'<svg viewBox="0 0 30 30" width="300" height="300" version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" class="js-draw--autoresize"><style id="js-draw-style-sheet">path{stroke-linecap:round;stroke-linejoin:round;}text{white-space:pre;}</style><path d="M30,30L30,0L0,0L0,30L30,30" fill="#ffffff" class="js-draw-image-background"></path></svg>'},emptyPageDark:{name:s=>s.templateEmptyPageDark,data:()=>'<svg viewBox="0 0 30 30" width="300" height="300" version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" class="js-draw--autoresize"><style id="js-draw-style-sheet">path{stroke-linecap:round;stroke-linejoin:round;}text{white-space:pre;}</style><path d="M30,30L30,0L0,0L0,30L30,30" fill="#1f1f1f" class="js-draw-image-background"></path></svg>'}},Xa=kd;var Ld=(s,o)=>({title:"Read-only store entry",getIcon(){return wo("!")},delete:async()=>{console.warn("Attempt to delete a dummyStoreEntry"),o?.()},read:async()=>s,write:async()=>{console.warn("Attempt to write to a dummyStoreEntry"),o?.()},updatePreview:null,updateTitle:null}),Qa=Ld;(()=>{if(typeof document<"u"&&typeof document.createElement=="function"){let s=document.createElement("style");s.textContent=".new-image-template-button{background-color:#eee;border:none;color:black;border-radius:5px;display:flex;flex-direction:column;justify-content:center}.new-image-template-button div{text-align:center}.new-image-template-button .icon{width:300px;height:150px;object-position:left top;object-fit:none}.new-image-template-button:hover{background-color:#ddd}.from-template-container{max-height:400px;overflow-y:auto}@media(prefers-color-scheme: dark){.new-image-template-button{background-color:#222;color:white}.new-image-template-button:hover{background-color:#444}}",document.head.appendChild(s)}})();var Id=(s,o)=>{let e,r=m=>{e=m},n=async m=>{let w=()=>{alert("Warning: Not saved.")},C=await o.createNewEntry();C===null?(alert(s.warningSaveTargetOnlySupportsOneImage),C=Qa(m,w)):await C.write(m),r(C)},i=document.createElement("dialog");i.classList.add("dialog-background"),i.classList.add("new-image-dialog-background");let a=document.createElement("div");a.classList.add("dialog"),a.classList.add("new-image-dialog");let l=document.createElement("h2");l.innerText=s.newImageHeading;let c=m=>{let w=document.createElement("fieldset"),C=document.createElement("legend");return C.appendChild(document.createTextNode(m)),w.appendChild(C),w},d=c("From file"),p=c("From template"),u=c("From SVG text");p.classList.add("from-template-container");let h=document.createElement("input");h.type="file",h.setAttribute("accept","image/svg,image/svg+xml,text/plain"),d.appendChild(h);let f=document.createElement("textarea");f.setAttribute("placeholder",s.pasteSVGTextDataHint);let b=document.createElement("button");b.innerText=s.submit,b.onclick=()=>{n(f.value)},u.replaceChildren(f,b);let v=(m,w)=>{let C=document.createElement("button");C.classList.add("new-image-template-button");let E=new Image;E.classList.add("icon"),E.src=`data:image/svg+xml;utf8,${encodeURIComponent(w)}`;let P=document.createElement("div");P.textContent=m,C.onclick=()=>{n(w)},C.replaceChildren(E,P),p.appendChild(C)};for(let m of Object.values(Xa))v(m.name(s),m.data());let g=document.createElement("details"),y=document.createElement("summary");return y.innerText=s.advancedOptions,g.replaceChildren(y,u),a.replaceChildren(l,p,d,g),i.appendChild(a),document.body.appendChild(i),i.show(),h.onchange=()=>{let m=h.files??[];if(m.length>1){alert("Too many files!");return}if(m.length===0)return;let w=new FileReader;w.onload=C=>{C.target?.result&&n(C.target.result)},w.readAsText(m[0])},i.onclick=m=>{m.target===i&&r(null)},new Promise((m,w)=>{e!==void 0&&(i.remove(),m(e)),r=C=>{i.remove(),m(C)}})},Ja=Id;var el="editorState",tl=s=>{try{localStorage.setItem(el,s.serializeState())}catch(o){console.warn("Error saving editor prefs: ",o)}},ol=s=>{let o=localStorage.getItem(el);if(o)try{s.deserializeState(o)}catch(e){console.warn("Error deserializing toolbar state: ",e)}},rl="keybindingOverrides",nl=s=>{let o={};for(let e in s)o[e]=s[e].map(r=>r.toString());localStorage.setItem(rl,JSON.stringify(o))},bn=()=>{let s=localStorage.getItem(rl)??"{}",o={};try{let e=JSON.parse(s);if(typeof e!="object")throw new Error('Expected keybinding overrides to have type "object"!');for(let r in e){if(typeof e[r]!="object"||typeof e[r].length!="number")throw new Error(`Expected keybinding record to be an array. Record: ${r}: ${e[r]}.`);o[r]=e[r].map(n=>Ge.fromString(n))}}catch(e){console.warn("Error loading keybinding overrides",e)}return o},il="debug-widget-enabled",sl=s=>{try{localStorage.setItem(il,`${s}`)}catch(o){console.warn("Error saving debug widget enabled: ",o)}},vn=()=>{try{return localStorage.getItem(il)==="true"}catch(s){console.warn("Error saving debug widget enabled: ",s)}return!1},al="toolbar-mode",ll=s=>{try{localStorage.setItem(al,s?"edge":"dropdown")}catch(o){console.warn("Error saving toolbar type: ",o)}},yn=()=>{try{return localStorage.getItem(al)!=="dropdown"}catch(s){console.warn("Error saving toolbar type: ",s)}return!1};(()=>{if(typeof document<"u"&&typeof document.createElement=="function"){let s=document.createElement("style");s.textContent=".settings-save-button{display:block;width:80%;margin-left:auto;margin-right:auto;margin-top:30px}",document.head.appendChild(s)}})();var Rd=s=>{let o=document.createElement("dialog");o.classList.add("dialog-background");let e=document.createElement("div");e.classList.add("dialog");let r=document.createElement("button");r.innerText=s.save,r.classList.add("settings-save-button");let n=()=>{let h=document.createElement("h2");h.innerText=s.keyboardShortcuts;let f=document.createElement("ul"),b={},v=0,g=bn(),y=C=>{let E=H.getShortcutDescription(C,navigator.languages)??C,P=H.getShortcutDefaultKeybindings(C),S=document.createElement("li");S.style.display="flex";let B=document.createElement("button");B.innerText=s.reset,B.style.display="none";let V=P;C in g&&(V=g[C],b[C]=V,B.style.display="inline-block");let F=te=>te.map(ve=>ve.toString()).join(", "),U=F(P),j=document.createElement("label");j.innerText=E;let Z=document.createElement("input");Z.value=F(V),Z.setAttribute("id",`keybinding-input-${v++}`),Z.style.flexGrow="1",j.htmlFor=Z.id;let se=document.createElement("span");se.innerText="\u26A0",se.style.display="none",Z.oninput=()=>{let te=!1,ve=null;try{let ye=Z.value.split(", ").map(qe=>Ge.fromString(qe));F(ye)!==U?(b[C]=ye,B.style.display="inline-block"):(delete b[C],B.style.display="none")}catch(ye){console.warn("invalid input. Error: ",ye),ve=`${ye}`,te=!0}te&&(Z.setAttribute("aria-invalid","true"),se.setAttribute("title",s.bindingParseError(ve??"null"))),se.style.display=te?"inline-block":"none"},B.onclick=()=>{Z.value=U,delete b[C],B.style.display="none"},S.replaceChildren(j,Z,se,B),f.appendChild(S)},m=H.getAllShortcutIds();for(let C of m)y(C);return e.appendChild(h),e.appendChild(f),()=>{nl(b)}},i=(h,f,b,v)=>{let g=document.createElement("h2");g.innerText=h;let y=document.createElement("div"),m=document.createElement("label"),w=document.createElement("input");return w.id="toolbar-mode-setting-checkbox",m.htmlFor=w.id,m.innerText=f,w.type="checkbox",w.checked=b,y.replaceChildren(m,w),e.appendChild(g),e.appendChild(y),()=>{v(w.checked)}},a=()=>i(s.toolbarType,s.useEdgeToolbar,yn(),h=>ll(h)),l=()=>i(s.debugging,s.enableDebugToolbarWidget,vn(),h=>sl(h)),c=n(),d=l(),p=a();e.appendChild(r),o.appendChild(e),document.body.appendChild(o),o.show();let u=()=>{c(),d(),p()};return new Promise((h,f)=>{r.onclick=()=>{try{u(),o.remove(),h()}catch(b){o.remove(),f(b)}},o.onclick=b=>{b.target===o&&(o.remove(),h())}})},cl=Rd;var dl=async(s,o,e,r)=>{let n=document.body,i=new Yi(n,{keyboardShortcutOverrides:bn(),iconProvider:new qa,appInfo:{name:"js-draw demo",description:"An app demonstrating the js-draw library's functionality."},text:{fonts:["serif","sans-serif","monospace"]}}),{hasChanges:a}=zd(i,o),l;if(yn())l=ji(i),l.addDefaultToolWidgets();else{let p=Xi(i);p.addDefaultToolWidgets(),p.addOverflowWidget(),l=p}let c=()=>{i.remove(),Bd(s,o)};l.addExitButton(()=>{a()&&confirm(s.saveUnsavedChanges)?e(c):c()}),l.addUndoRedoButtons();let d=l.addSaveButton(()=>{e()});return vn()&&l.addWidget(new xo(i)),i.notifier.on(2,()=>{tl(l)}),ol(l),Md(s,a),i.focus(),i.setReadOnly(!0),d.setDisabled(!0),await i.loadFromSVG(await r()),i.setReadOnly(!1),d.setDisabled(!1),console.assert(!a(),"should not have changes just after loading the image"),i},zd=(s,o)=>{let e=!1;return s.notifier.on(4,()=>{e=!0}),s.notifier.on(5,()=>{e=!0}),o.on("image-saved",()=>{e=!1}),{hasChanges:()=>e}},Md=(s,o)=>{window.onbeforeunload=()=>{if(o())return s.confirmUnsavedChanges}},pl=(s,o,e,r,n)=>{let i=()=>{r.dispatch("image-saved",null)},a={minDimension:30};Za(s,o.toSVG(a),o,e,i,n)},To=null,ul=()=>{To=document.querySelector("#launchOptions"),To?.remove()},Bd=async(s,o)=>{To&&(To.replaceChildren(),await hl(To,s,o),document.body.appendChild(To))},Dd=(s,o)=>{"launchQueue"in window&&launchQueue.setConsumer(async({files:e})=>{if(!e||e.length===0)return;if(e.length>1){alert("Too many files!");return}let r=e[0],n=await r.getFile();n.handle=r,ul();let i=Ya(n.name,r),a=await dl(s,o,l=>pl(s,a,i,o,l),()=>n.text())})},hl=async(s,o,e)=>{let r=async u=>{ul();let h=await dl(o,e,f=>pl(o,h,u,e,f),()=>u.read())},n=document.createElement("ul");n.classList.add("error-container"),s.appendChild(n);let i=u=>{let h=document.createElement("li");h.innerText=u,n.appendChild(h),n.classList.add("has-errors")},a=new gn(o),l;try{l=await fn.create(o)}catch(u){i(`${o.databaseLoadError} Error: ${u}`),l=null}if(l){let u=await Ji(l,r,o);s.appendChild(u)}let c=await Ji(a,r,o);s.appendChild(c);let d=new lr({title:o.new,icon:wo("+")},s);d.addClickListener(async()=>{d.setDisabled(!0);let u=await Ja(o,l??a);if(d.setDisabled(!1),u===null){console.log("Creating new item canceled.");return}await r(u)});let p=document.createElement("button");p.innerText=o.settings,p.onclick=async()=>{p.style.display="none",await cl(o),p.style.display="block"},p.classList.add("settingsButton"),s.appendChild(p)};(async()=>{let s=_a(),o=new Be;Dd(s,o);let e=document.querySelector("#launchOptions");await hl(e,s,o)})();})();
/*! Bundled license information:

@melloware/coloris/dist/esm/coloris.js:
  (*!
  * Copyright (c) 2021-2023 Momo Bassit.
  * Licensed under the MIT License (MIT)
  * https://github.com/mdbassit/Coloris
  * Version: 0.21.1
  * NPM: https://github.com/melloware/coloris-npm
  *)
*/
